var __extends,TypeScript;(function(n){function p(n,t){return(n&t)!=0}function f(n){return n}function b(n,t){for(var r="",u,i=1;i<-2147483648;i=i<<1)if((t&i)!=0)for(u in n)if(n[u]==i){r.length>0&&(r+="|"),r+=u;break}return r}var y,v,a,l,c,w,h,s,o,e,u,r,t,i;n.hasFlag=p,function(n){n._map=[],n.None=0,n.Comma=1,n.SColon=2,n.Asg=4,n.BinOp=8,n.RBrack=16,n.RCurly=32,n.RParen=64,n.Dot=128,n.Colon=256,n.PrimType=512,n.AddOp=1024,n.LCurly=2048,n.PreOp=4096,n.RegExp=8192,n.LParen=16384,n.LBrack=32768,n.Scope=65536,n.In=131072,n.SCase=262144,n.Else=524288,n.Catch=1048576,n.Var=2097152,n.Stmt=4194304,n.While=8388608,n.ID=16777216,n.Prefix=33554432,n.Literal=67108864,n.RLit=134217728,n.Func=268435456,n.EOF=536870912,n.TypeScriptS=1073741824,n.ExprStart=n.SColon|n.AddOp|n.LCurly|n.PreOp|n.RegExp|n.LParen|n.LBrack|n.ID|n.Prefix|n.RLit|n.Func|n.Literal,n.StmtStart=n.ExprStart|n.SColon|n.Var|n.Stmt|n.While|n.TypeScriptS,n.Postfix=n.Dot|n.LParen|n.LBrack}(n.ErrorRecoverySet||(n.ErrorRecoverySet={})),y=n.ErrorRecoverySet,function(n){n._map=[],n.None=0,n.Statements=1,n.FunctionDecls=2,n.ModuleDecls=4,n.ClassDecls=8,n.InterfaceDecls=16,n.TypedFuncDecls=32,n.TypedDecls=64,n.TypedFuncSignatures=256,n.TypedSignatures=512,n.AmbientDecls=1024,n.Properties=2048,n.Block=n.Statements|n.FunctionDecls|n.TypedFuncDecls|n.TypedDecls,n.Global=n.Statements|n.FunctionDecls|n.ModuleDecls|n.ClassDecls|n.InterfaceDecls|n.AmbientDecls,n.FunctionBody=n.Statements|n.FunctionDecls,n.ModuleMembers=n.TypedFuncDecls|n.FunctionDecls|n.ModuleDecls|n.ClassDecls|n.InterfaceDecls|n.TypedDecls|n.Statements|n.AmbientDecls,n.ClassMembers=n.TypedFuncDecls|n.FunctionDecls|n.Statements|n.TypedDecls|n.Properties,n.InterfaceMembers=n.TypedFuncSignatures|n.TypedSignatures,n.QuickParse=n.Global|n.Properties}(n.AllowedElements||(n.AllowedElements={})),v=n.AllowedElements,function(n){n._map=[],n.None=0,n.Private=1,n.Public=2,n.Readonly=4,n.Ambient=8,n.Exported=16,n.Getter=32,n.Setter=64,n.Static=128}(n.Modifiers||(n.Modifiers={})),a=n.Modifiers,function(n){n._map=[],n.None=0,n.ExplicitSemicolon=1,n.AutomaticSemicolon=2,n.Writeable=4,n.Error=8,n.DotLHSPartial=16,n.DotLHS=32,n.IsStatement=64,n.StrictMode=128,n.PossibleOptionalParameter=256,n.ClassBaseConstructorCall=512,n.OptionalName=1024}(n.ASTFlags||(n.ASTFlags={})),l=n.ASTFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128}(n.DeclFlags||(n.DeclFlags={})),c=n.DeclFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.IsEnum=256,n.ShouldEmitModuleDecl=512,n.IsWholeFile=1024,n.IsDynamic=2048}(n.ModuleFlags||(n.ModuleFlags={})),w=n.ModuleFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.Property=256,n.Readonly=512,n.ModuleMember=1024,n.InterfaceMember=2048,n.ClassMember=4096,n.BuiltIn=8192,n.TypeSetDuringScopeAssignment=16384,n.Constant=32768,n.Optional=65536,n.RecursivelyReferenced=131072,n.Bound=262144}(n.SymbolFlags||(n.SymbolFlags={})),h=n.SymbolFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.AutoInit=256,n.Property=512,n.Readonly=1024,n.Class=2048,n.ClassProperty=4096,n.ClassBodyProperty=8192,n.ClassConstructorProperty=16384,n.ClassSuperMustBeFirstCallInConstructor=32768,n.Constant=65536}(n.VarFlags||(n.VarFlags={})),s=n.VarFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.Definition=256,n.Signature=512,n.Method=1024,n.HasReturnExpression=2048,n.CallMember=4096,n.ConstructMember=8192,n.HasSelfReference=16384,n.IsFatArrowFunction=32768,n.IndexerMember=65536,n.IsFunctionExpression=131072,n.ClassMethod=262144,n.ClassPropertyMethodExported=524288}(n.FncFlags||(n.FncFlags={})),o=n.FncFlags,function(n){n._map=[],n.None=0,n.IsIndexer=1,n.IsStringIndexer=2,n.IsNumberIndexer=4}(n.SignatureFlags||(n.SignatureFlags={})),e=n.SignatureFlags,n.ToDeclFlags=f,function(n){n._map=[],n.None=0,n.HasImplementation=1,n.HasSelfReference=2,n.MergeResult=4,n.IsEnum=8,n.BuildingName=16,n.HasBaseType=32,n.HasBaseTypeOfObject=64,n.IsClass=128}(n.TypeFlags||(n.TypeFlags={})),u=n.TypeFlags,function(n){n._map=[],n.SuccessfulComparison=0,n.SourceIsNullTargetIsVoidOrUndefined=1,n.RequiredPropertyIsMissing=2,n.IncompatibleSignatures=4,n.SourceSignatureHasTooManyParameters=3,n.IncompatibleReturnTypes=16,n.IncompatiblePropertyTypes=32,n.IncompatibleParameterTypes=64}(n.TypeRelationshipFlags||(n.TypeRelationshipFlags={})),r=n.TypeRelationshipFlags,function(n){n._map=[],n.ES3=0,n.ES5=1}(n.CodeGenTarget||(n.CodeGenTarget={})),t=n.CodeGenTarget,function(n){n._map=[],n.Synchronous=0,n.Asynchronous=1,n.Local=2}(n.ModuleGenTarget||(n.ModuleGenTarget={})),i=n.ModuleGenTarget,n.codeGenTarget=t.ES3,n.moduleGenTarget=i.Synchronous,n.optimizeModuleCodeGen=!0,n.flagsToString=b})(TypeScript||(TypeScript={})),function(n){(function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="Empty",n.Empty=1,n._map[2]="EmptyExpr",n.EmptyExpr=2,n._map[3]="True",n.True=3,n._map[4]="False",n.False=4,n._map[5]="This",n.This=5,n._map[6]="Super",n.Super=6,n._map[7]="QString",n.QString=7,n._map[8]="Regex",n.Regex=8,n._map[9]="Null",n.Null=9,n._map[10]="ArrayLit",n.ArrayLit=10,n._map[11]="ObjectLit",n.ObjectLit=11,n._map[12]="Void",n.Void=12,n._map[13]="Comma",n.Comma=13,n._map[14]="Pos",n.Pos=14,n._map[15]="Neg",n.Neg=15,n._map[16]="Delete",n.Delete=16,n._map[17]="Await",n.Await=17,n._map[18]="In",n.In=18,n._map[19]="Dot",n.Dot=19,n._map[20]="From",n.From=20,n._map[21]="Is",n.Is=21,n._map[22]="InstOf",n.InstOf=22,n._map[23]="Typeof",n.Typeof=23,n._map[24]="NumberLit",n.NumberLit=24,n._map[25]="Name",n.Name=25,n._map[26]="TypeRef",n.TypeRef=26,n._map[27]="Index",n.Index=27,n._map[28]="Call",n.Call=28,n._map[29]="New",n.New=29,n._map[30]="Asg",n.Asg=30,n._map[31]="AsgAdd",n.AsgAdd=31,n._map[32]="AsgSub",n.AsgSub=32,n._map[33]="AsgDiv",n.AsgDiv=33,n._map[34]="AsgMul",n.AsgMul=34,n._map[35]="AsgMod",n.AsgMod=35,n._map[36]="AsgAnd",n.AsgAnd=36,n._map[37]="AsgXor",n.AsgXor=37,n._map[38]="AsgOr",n.AsgOr=38,n._map[39]="AsgLsh",n.AsgLsh=39,n._map[40]="AsgRsh",n.AsgRsh=40,n._map[41]="AsgRs2",n.AsgRs2=41,n._map[42]="QMark",n.QMark=42,n._map[43]="LogOr",n.LogOr=43,n._map[44]="LogAnd",n.LogAnd=44,n._map[45]="Or",n.Or=45,n._map[46]="Xor",n.Xor=46,n._map[47]="And",n.And=47,n._map[48]="Eq",n.Eq=48,n._map[49]="Ne",n.Ne=49,n._map[50]="Eqv",n.Eqv=50,n._map[51]="NEqv",n.NEqv=51,n._map[52]="Lt",n.Lt=52,n._map[53]="Le",n.Le=53,n._map[54]="Gt",n.Gt=54,n._map[55]="Ge",n.Ge=55,n._map[56]="Add",n.Add=56,n._map[57]="Sub",n.Sub=57,n._map[58]="Mul",n.Mul=58,n._map[59]="Div",n.Div=59,n._map[60]="Mod",n.Mod=60,n._map[61]="Lsh",n.Lsh=61,n._map[62]="Rsh",n.Rsh=62,n._map[63]="Rs2",n.Rs2=63,n._map[64]="Not",n.Not=64,n._map[65]="LogNot",n.LogNot=65,n._map[66]="IncPre",n.IncPre=66,n._map[67]="DecPre",n.DecPre=67,n._map[68]="IncPost",n.IncPost=68,n._map[69]="DecPost",n.DecPost=69,n._map[70]="TypeAssertion",n.TypeAssertion=70,n._map[71]="FuncDecl",n.FuncDecl=71,n._map[72]="Member",n.Member=72,n._map[73]="VarDecl",n.VarDecl=73,n._map[74]="ArgDecl",n.ArgDecl=74,n._map[75]="Return",n.Return=75,n._map[76]="Break",n.Break=76,n._map[77]="Continue",n.Continue=77,n._map[78]="Throw",n.Throw=78,n._map[79]="For",n.For=79,n._map[80]="ForIn",n.ForIn=80,n._map[81]="If",n.If=81,n._map[82]="While",n.While=82,n._map[83]="DoWhile",n.DoWhile=83,n._map[84]="Block",n.Block=84,n._map[85]="Case",n.Case=85,n._map[86]="Switch",n.Switch=86,n._map[87]="Try",n.Try=87,n._map[88]="TryCatch",n.TryCatch=88,n._map[89]="TryFinally",n.TryFinally=89,n._map[90]="Finally",n.Finally=90,n._map[91]="Catch",n.Catch=91,n._map[92]="List",n.List=92,n._map[93]="Script",n.Script=93,n._map[94]="Class",n.Class=94,n._map[95]="Interface",n.Interface=95,n._map[96]="Module",n.Module=96,n._map[97]="Import",n.Import=97,n._map[98]="With",n.With=98,n._map[99]="Label",n.Label=99,n._map[100]="LabeledStatement",n.LabeledStatement=100,n._map[101]="EBStart",n.EBStart=101,n._map[102]="GotoEB",n.GotoEB=102,n._map[103]="EndCode",n.EndCode=103,n._map[104]="Error",n.Error=104,n._map[105]="Comment",n.Comment=105,n._map[106]="Debugger",n.Debugger=106,n.GeneralNode=n.FuncDecl,n.LastAsg=n.AsgRs2})(n.NodeType||(n.NodeType={}));var t=n.NodeType}(TypeScript||(TypeScript={})),function(n){function e(n){var t=668265261;return n=n^61^n>>>16,n=n+(n<<3),n=n^n>>>4,n=n*t,n=n^n>>>15}function o(n,t){return t^(n>>5)+n}var i=function(){function n(){this.prototype=undefined,this.toString=undefined,this.toLocaleString=undefined,this.valueOf=undefined,this.hasOwnProperty=undefined,this.propertyIsEnumerable=undefined,this.isPrototypeOf=undefined,this.constructor=undefined}return n}(),r,u,t,f;n.BlockIntrinsics=i,r=function(){function n(){this.itemCount=0,this.table=new i}return n.prototype.getAllKeys=function(){var n=[],t;for(t in this.table)this.table[t]!=undefined&&(n[n.length]=t);return n},n.prototype.add=function(n,t){return this.table[n]!=undefined?!1:(this.table[n]=t,this.itemCount++,!0)},n.prototype.addOrUpdate=function(n,t){return this.table[n]!=undefined?(this.table[n]=t,!1):(this.table[n]=t,this.itemCount++,!0)},n.prototype.map=function(n,t){var i,r;for(i in this.table)r=this.table[i],r!=undefined&&n(i,this.table[i],t)},n.prototype.every=function(n,t){var i,r;for(i in this.table)if(r=this.table[i],r!=undefined&&!n(i,this.table[i],t))return!1;return!0},n.prototype.some=function(n,t){var i,r;for(i in this.table)if(r=this.table[i],r!=undefined&&n(i,this.table[i],t))return!0;return!1},n.prototype.count=function(){return this.itemCount},n.prototype.lookup=function(n){var t=this.table[n];return t!=undefined?t:null},n}(),n.StringHashTable=r,u=function(){function n(n,t){this.primaryTable=n,this.secondaryTable=t,this.insertPrimary=!0}return n.prototype.getAllKeys=function(){return this.primaryTable.getAllKeys().concat(this.secondaryTable.getAllKeys())},n.prototype.add=function(n,t){return this.insertPrimary?this.primaryTable.add(n,t):this.secondaryTable.add(n,t)},n.prototype.addOrUpdate=function(n,t){return this.insertPrimary?this.primaryTable.addOrUpdate(n,t):this.secondaryTable.addOrUpdate(n,t)},n.prototype.map=function(n,t){this.primaryTable.map(n,t),this.secondaryTable.map(n,t)},n.prototype.every=function(n,t){return this.primaryTable.every(n,t)&&this.secondaryTable.every(n,t)},n.prototype.some=function(n,t){return this.primaryTable.some(n,t)||this.secondaryTable.some(n,t)},n.prototype.count=function(){return this.primaryTable.count()+this.secondaryTable.count()},n.prototype.lookup=function(n){var t=this.primaryTable.lookup(n);return t!=undefined?t:this.secondaryTable.lookup(n)},n}(),n.DualStringHashTable=u,n.numberHashFn=e,n.combineHashes=o,t=function(){function n(n,t){this.key=n,this.data=t}return n}(),n.HashEntry=t,f=function(){function n(n,t,i){this.size=n,this.hashFn=t,this.equalsFn=i,this.itemCount=0,this.table=[];for(var r=0;r<this.size;r++)this.table[r]=null}return n.prototype.add=function(n,i){for(var f=new t(n,i),u=this.hashFn(n),u=u%this.size,r=this.table[u];r!=null;r=r.next)if(this.equalsFn(n,r.key))return!1;return f.next=this.table[u],this.table[u]=f,this.itemCount++,!0},n.prototype.remove=function(n){for(var i=this.hashFn(n),i=i%this.size,u=null,r=null,t=this.table[i];t!=null;t=t.next){if(this.equalsFn(n,t.key)){u=t.data,this.itemCount--,r?r.next=t.next:this.table[i]=t.next;break}r=t}return u},n.prototype.count=function(){return this.itemCount},n.prototype.lookup=function(n){for(var i=this.hashFn(n),i=i%this.size,t=this.table[i];t!=null;t=t.next)if(this.equalsFn(n,t.key))return t.data;return null},n}(),n.HashTable=f}(TypeScript||(TypeScript={})),__extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},function(n){var t=function(){function t(t){this.nodeType=t,this.type=null,this.flags=n.ASTFlags.Writeable,this.minChar=-1,this.limChar=-1,this.passCreated=n.CompilerDiagnostics.analysisPass,this.preComments=null,this.postComments=null,this.isParenthesized=!1}return t.prototype.isStatementOrExpression=function(){return!1},t.prototype.isCompoundStatement=function(){return!1},t.prototype.isLeaf=function(){return this.isStatementOrExpression()&&!this.isCompoundStatement()},t.prototype.typeCheck=function(t){switch(this.nodeType){case n.NodeType.Error:case n.NodeType.EmptyExpr:this.type=t.anyType;break;case n.NodeType.This:return t.typeCheckThis(this);case n.NodeType.Null:this.type=t.nullType;break;case n.NodeType.False:case n.NodeType.True:this.type=t.booleanType;break;case n.NodeType.Super:return t.typeCheckSuper(this);case n.NodeType.EndCode:case n.NodeType.Empty:case n.NodeType.Void:this.type=t.voidType;break;default:throw new Error("please implement in derived class");}return this},t.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);switch(this.nodeType){case n.NodeType.This:t.thisFnc&&n.hasFlag(t.thisFnc.fncFlags,n.FncFlags.IsFatArrowFunction)?t.writeToOutput("_this"):t.writeToOutput("this");break;case n.NodeType.Null:t.writeToOutput("null");break;case n.NodeType.False:t.writeToOutput("false");break;case n.NodeType.True:t.writeToOutput("true");break;case n.NodeType.Super:t.emitSuperReference();case n.NodeType.EndCode:break;case n.NodeType.Error:case n.NodeType.EmptyExpr:break;case n.NodeType.Empty:t.writeToOutput("; ");break;case n.NodeType.Void:t.writeToOutput("void ");break;default:throw new Error("please implement in derived class");}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},t.prototype.print=function(t){var i,r,u;t.startLine(),i={line:-1,col:-1},r={line:-1,col:-1},t.parser!==null&&(t.parser.getSourceLineCol(i,this.minChar),t.parser.getSourceLineCol(r,this.limChar),t.write("("+i.line+","+i.col+")--("+r.line+","+r.col+"): ")),u=this.printLabel(),n.hasFlag(this.flags,n.ASTFlags.Error)&&(u+=" (Error)"),t.writeLine(u)},t.prototype.printLabel=function(){return n.nodeTypeTable[this.nodeType]!==undefined?n.nodeTypeTable[this.nodeType]:n.NodeType._map[this.nodeType]},t.prototype.addToControlFlow=function(n){n.walker.options.goChildren=!1,n.addContent(this)},t.prototype.netFreeUses=function(){},t.prototype.treeViewLabel=function(){return n.NodeType._map[this.nodeType]},t}(),st,o,r,kt,ht,c,ct,lt,at,vt,yt,pt,wt,f,fi,dt,gt,h,s,ni,u,ti,e,ri,ui,i,bt,ot,et,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,ii,ei;n.AST=t,st=function(t){function i(i,r){t.call(this,n.NodeType.Error),this.minChar=i,this.limChar=r}return __extends(i,t),i}(t),n.IncompleteAST=st,o=function(t){function i(){t.call(this,n.NodeType.List),this.enclosingScope=null,this.members=[]}return __extends(i,t),i.prototype.addToControlFlow=function(n){for(var i=this.members.length,t=0;t<i;t++)if(n.noContinuation){n.addUnreachable(this.members[t]);break}else this.members[t]=n.walk(this.members[t],this);n.walker.options.goChildren=!1},i.prototype.append=function(n){return this.members[this.members.length]=n,this},i.prototype.appendAll=function(t){var r,i,u;if(t.nodeType==n.NodeType.List)for(r=t,i=0,u=r.members.length;i<u;i++)this.append(r.members[i]);else this.append(t);return this},i.prototype.emit=function(t,i,r,u){t.emitJavascriptList(this,null,n.TokenID.SColon,r,!1,!1,u)},i.prototype.typeCheck=function(n){var i=this.members.length,t;for(n.nestingLevel++,t=0;t<i;t++)this.members[t]&&(this.members[t]=this.members[t].typeCheck(n));return n.nestingLevel--,this},i}(t),n.ASTList=o,r=function(t){function i(i){t.call(this,n.NodeType.Name),this.text=i,this.sym=null,this.cloId=-1}return __extends(i,t),i.prototype.isMissing=function(){return!1},i.prototype.isLeaf=function(){return!0},i.prototype.treeViewLabel=function(){return"id: "+this.text},i.prototype.printLabel=function(){return this.text?"id: "+this.text:"name node"},i.prototype.typeCheck=function(n){return n.typeCheckName(this)},i.prototype.emit=function(n){n.emitJavascriptName(this,!0)},i}(t),n.Identifier=r,kt=function(n){function t(){n.call(this,"__missing")}return __extends(t,n),t.prototype.isMissing=function(){return!0},t.prototype.emit=function(){},t}(r),n.MissingIdentifier=kt,ht=function(t){function i(i){t.call(this,n.NodeType.Label),this.id=i}return __extends(i,t),i.prototype.printLabel=function(){return this.id.text+":"},i.prototype.typeCheck=function(n){return this.type=n.voidType,this},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeLineToOutput(this.id.text+":"),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(t),n.Label=ht,c=function(t){function i(n,i){t.call(this,n),this.operand=i,this.targetType=null,this.castTerm=null,this.nty=n}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.addToControlFlow=function(i){t.prototype.addToControlFlow.call(this,i),this.nodeType==n.NodeType.Throw&&i.returnStmt()},i.prototype.typeCheck=function(t){switch(this.nty){case n.NodeType.Not:return t.typeCheckBitNot(this);case n.NodeType.LogNot:return t.typeCheckLogNot(this);case n.NodeType.Pos:case n.NodeType.Neg:return t.typeCheckUnaryNumberOperator(this);case n.NodeType.IncPost:case n.NodeType.IncPre:case n.NodeType.DecPost:case n.NodeType.DecPre:return t.typeCheckIncOrDec(this);case n.NodeType.ArrayLit:return t.typeCheckArrayLit(this),this;case n.NodeType.ObjectLit:return t.typeCheckObjectLit(this),this;case n.NodeType.Throw:return this.operand=t.typeCheck(this.operand),this.type=t.voidType,this;case n.NodeType.Typeof:return this.operand=t.typeCheck(this.operand),this.type=t.stringType,this;case n.NodeType.Delete:this.operand=t.typeCheck(this.operand),this.type=t.booleanType;break;case n.NodeType.TypeAssertion:this.castTerm=t.typeCheck(this.castTerm);var i=!this.operand.isParenthesized,r=i?this.castTerm.type:null;return t.checker.typeCheckWithContextualType(r,t.checker.inProvisionalTypecheckMode(),!0,this.operand),t.castWithCoercion(this.operand,this.castTerm.type,!1,!0),this.type=this.castTerm.type,this;case n.NodeType.Void:this.operand=t.typeCheck(this.operand),this.type=t.checker.undefinedType;break;default:throw new Error("please implement in derived class");}return this},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);switch(this.nty){case n.NodeType.IncPost:t.emitJavascript(this.operand,n.TokenID.Inc,!1),t.writeToOutput("++");break;case n.NodeType.LogNot:t.writeToOutput("!"),t.emitJavascript(this.operand,n.TokenID.Bang,!1);break;case n.NodeType.DecPost:t.emitJavascript(this.operand,n.TokenID.Dec,!1),t.writeToOutput("--");break;case n.NodeType.ObjectLit:t.emitObjectLiteral(this.operand);break;case n.NodeType.ArrayLit:t.emitArrayLiteral(this.operand);break;case n.NodeType.Not:t.writeToOutput("~"),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Neg:t.writeToOutput("-"),this.operand.nodeType==n.NodeType.Neg&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,n.TokenID.Sub,!1);break;case n.NodeType.Pos:t.writeToOutput("+"),this.operand.nodeType==n.NodeType.Pos&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,n.TokenID.Add,!1);break;case n.NodeType.IncPre:t.writeToOutput("++"),t.emitJavascript(this.operand,n.TokenID.Inc,!1);break;case n.NodeType.DecPre:t.writeToOutput("--"),t.emitJavascript(this.operand,n.TokenID.Dec,!1);break;case n.NodeType.Throw:t.writeToOutput("throw "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1),t.writeToOutput(";");break;case n.NodeType.Typeof:t.writeToOutput("typeof "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Delete:t.writeToOutput("delete "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Void:t.writeToOutput("void "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.TypeAssertion:t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;default:throw new Error("please implement in derived class");}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(t),n.UnaryExpression=c,ct=function(t){function i(n,i,r){t.call(this,n),this.target=i,this.args=r,this.signature=null,this.nty=n,this.minChar=this.target.minChar}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.typeCheck=function(t){return this.nty==n.NodeType.New?t.typeCheckNew(this):t.typeCheckCall(this)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nty==n.NodeType.New?t.emitNew(this.target,this.args):t.emitCall(this,this.target,this.args),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(t),n.CallExpression=ct,lt=function(t){function i(n,i,r){t.call(this,n),this.operand1=i,this.operand2=r,this.nty=n}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.typeCheck=function(t){switch(this.nty){case n.NodeType.Dot:return t.typeCheckDotOperator(this);case n.NodeType.Asg:return t.typeCheckAsgOperator(this);case n.NodeType.Add:case n.NodeType.Sub:case n.NodeType.Mul:case n.NodeType.Div:case n.NodeType.Mod:case n.NodeType.Or:case n.NodeType.And:return t.typeCheckArithmeticOperator(this,!1);case n.NodeType.Xor:return t.typeCheckBitwiseOperator(this,!1);case n.NodeType.Ne:case n.NodeType.Eq:var i;t.checker.styleSettings.eqeqeq?(i=n.nodeTypeTable[this.nty],t.checker.errorReporter.styleError(this,"use of "+i)):t.checker.styleSettings.eqnull&&(i=n.nodeTypeTable[this.nty],this.operand2!==null&&this.operand2.nodeType==n.NodeType.Null&&t.checker.errorReporter.styleError(this,"use of "+i+" to compare with null"));case n.NodeType.Eqv:case n.NodeType.NEqv:case n.NodeType.Lt:case n.NodeType.Le:case n.NodeType.Ge:case n.NodeType.Gt:return t.typeCheckBooleanOperator(this);case n.NodeType.Index:return t.typeCheckIndex(this);case n.NodeType.Member:return this.type=t.voidType,this;case n.NodeType.LogOr:return t.typeCheckLogOr(this);case n.NodeType.LogAnd:return t.typeCheckLogAnd(this);case n.NodeType.AsgAdd:case n.NodeType.AsgSub:case n.NodeType.AsgMul:case n.NodeType.AsgDiv:case n.NodeType.AsgMod:case n.NodeType.AsgOr:case n.NodeType.AsgAnd:return t.typeCheckArithmeticOperator(this,!0);case n.NodeType.AsgXor:return t.typeCheckBitwiseOperator(this,!0);case n.NodeType.Lsh:case n.NodeType.Rsh:case n.NodeType.Rs2:return t.typeCheckShift(this,!1);case n.NodeType.AsgLsh:case n.NodeType.AsgRsh:case n.NodeType.AsgRs2:return t.typeCheckShift(this,!0);case n.NodeType.Comma:return t.typeCheckCommaOperator(this);case n.NodeType.InstOf:return t.typeCheckInstOf(this);case n.NodeType.In:return t.typeCheckInOperator(this);case n.NodeType.From:t.checker.errorReporter.simpleError(this,"Illegal use of 'from' keyword in binary expression");break;default:throw new Error("please implement in derived class");}return this},i.prototype.emit=function(t){var f=n.nodeTypeToTokTable[this.nodeType],e;if(t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),f!=undefined)t.emitJavascript(this.operand1,f,!1),n.tokenTable[f].text=="instanceof"?t.writeToOutput(" instanceof "):n.tokenTable[f].text=="in"?t.writeToOutput(" in "):t.writeToOutputTrimmable(" "+n.tokenTable[f].text+" "),t.emitJavascript(this.operand2,f,!1);else switch(this.nty){case n.NodeType.Dot:t.tryEmitConstant(this)||(t.emitJavascript(this.operand1,n.TokenID.Dot,!1),t.writeToOutput("."),t.emitJavascriptName(this.operand2,!1));break;case n.NodeType.Index:t.emitIndex(this.operand1,this.operand2);break;case n.NodeType.Member:this.operand2.nodeType==n.NodeType.FuncDecl&&this.operand2.isAccessor()?(e=this.operand2,n.hasFlag(e.fncFlags,n.FncFlags.GetAccessor)?t.writeToOutput("get "):t.writeToOutput("set "),t.emitJavascript(this.operand1,n.TokenID.Colon,!1)):(t.emitJavascript(this.operand1,n.TokenID.Colon,!1),t.writeToOutputTrimmable(": ")),t.emitJavascript(this.operand2,n.TokenID.Comma,!1);break;case n.NodeType.Comma:t.emitJavascript(this.operand1,n.TokenID.Comma,!1),t.emitState.inObjectLiteral?t.writeLineToOutput(", "):t.writeToOutput(","),t.emitJavascript(this.operand2,n.TokenID.Comma,!1);break;case n.NodeType.Is:throw new Error("should be de-sugared during type check");default:throw new Error("please implement in derived class");}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(t),n.BinaryExpression=lt,at=function(t){function i(n,i,r,u){t.call(this,n),this.operand1=i,this.operand2=r,this.operand3=u,this.nty=n}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.typeCheck=function(n){return n.typeCheckQMark(this)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.operand1,n.TokenID.QMark,!1),t.writeToOutput(" ? "),t.emitJavascript(this.operand2,n.TokenID.QMark,!1),t.writeToOutput(" : "),t.emitJavascript(this.operand3,n.TokenID.QMark,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(t),n.TrinaryExpression=at,vt=function(t){function i(i){t.call(this,n.NodeType.NumberLit),this.value=i,this.isNegativeZero=!1}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.typeCheck=function(n){return this.type=n.doubleType,this},i.prototype.treeViewLabel=function(){return"num: "+this.value},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),this.isNegativeZero&&n.writeToOutput("-"),n.writeToOutput(this.value.toString()),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.printLabel=function(){return Math.floor(this.value)!=this.value?this.value.toFixed(2).toString():this.value.toString()},i}(t),n.NumberLiteral=vt,yt=function(t){function i(i){t.call(this,n.NodeType.Regex),this.regex=i}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.typeCheck=function(n){return this.type=n.regexType,this},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeToOutput(this.regex.toString()),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(t),n.RegexLiteral=yt,pt=function(t){function i(i){t.call(this,n.NodeType.QString),this.text=i}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.emitStringLiteral(this.text),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.type=n.stringType,this},i.prototype.treeViewLabel=function(){return"st: "+this.text},i.prototype.printLabel=function(){return this.text},i}(t),n.StringLiteral=pt,wt=function(t){function i(i,r){t.call(this,n.NodeType.Import),this.id=i,this.alias=r,this.varFlags=n.VarFlags.None,this.isDynamicImport=!1}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.emit=function(t,i,r,u){var o=this.alias.type,f,e;u&&t.emitImportDecl(this),this.isDynamicImport&&(!this.id.sym||this.id.sym.onlyReferencedAsTypeRef)||(f=t.modAliasId,e=t.firstModAlias,t.recordSourceMappingStart(this),t.emitParensAndCommentsInPlace(this,!0),t.writeToOutput("var "+this.id.text+" = "),t.modAliasId=this.id.text,t.firstModAlias=this.firstAliasedModToString(),t.emitJavascript(this.alias,n.TokenID.Tilde,!1,u),this.isDynamicImport||t.writeToOutput(";"),t.emitParensAndCommentsInPlace(this,!1),t.recordSourceMappingEnd(this),t.modAliasId=f,t.firstModAlias=e)},i.prototype.typeCheck=function(n){return n.typeCheckImportDecl(this)},i.prototype.getAliasName=function(t){if(typeof t=="undefined"&&(t=this.alias),t.nodeType==n.NodeType.Name)return t.text;var i=t;return this.getAliasName(i.operand1)+"."+this.getAliasName(i.operand2)},i.prototype.firstAliasedModToString=function(){if(this.alias.nodeType==n.NodeType.Name)return this.alias.text;var t=this.alias,i=t.operand1;return i.text},i}(t),n.ImportDecl=wt,f=function(t){function i(i,r,u){t.call(this,r),this.id=i,this.nestingLevel=u,this.init=null,this.typeExpr=null,this.varFlags=n.VarFlags.None,this.sym=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isPrivate=function(){return n.hasFlag(this.varFlags,n.VarFlags.Private)},i.prototype.isPublic=function(){return n.hasFlag(this.varFlags,n.VarFlags.Public)},i.prototype.isProperty=function(){return n.hasFlag(this.varFlags,n.VarFlags.Property)},i.prototype.typeCheck=function(n){return n.typeCheckBoundDecl(this)},i.prototype.printLabel=function(){return this.treeViewLabel()},i}(t),n.BoundDecl=f,fi=function(t){function i(i,r){t.call(this,i,n.NodeType.VarDecl,r)}return __extends(i,t),i.prototype.isAmbient=function(){return n.hasFlag(this.varFlags,n.VarFlags.Ambient)},i.prototype.isExported=function(){return n.hasFlag(this.varFlags,n.VarFlags.Exported)},i.prototype.isStatic=function(){return n.hasFlag(this.varFlags,n.VarFlags.Static)},i.prototype.emit=function(n,t,i,r){n.emitJavascriptVarDecl(this,t,r)},i.prototype.treeViewLabel=function(){return"var "+this.id.text},i}(f),n.VarDecl=fi,dt=function(t){function i(i){t.call(this,i,n.NodeType.ArgDecl,0),this.isOptional=!1,this.parameterPropertySym=null}return __extends(i,t),i.prototype.isOptionalArg=function(){return this.isOptional||this.init},i.prototype.treeViewLabel=function(){return"arg: "+this.id.text},i.prototype.emit=function(n,t,i,r){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeToOutput(this.id.text),r&&n.emitArgDecl(this),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(f),n.ArgDecl=dt,gt=0,h=function(t){function i(i,r,u,f,e,o,s,h){t.call(this,h),this.name=i,this.bod=r,this.isConstructor=u,this.args=f,this.vars=e,this.scopes=o,this.statics=s,this.hint=null,this.fncFlags=n.FncFlags.None,this.returnTypeAnnotation=null,this.variableArgList=!1,this.jumpRefs=null,this.internalNameCache=null,this.tmp1Declared=!1,this.enclosingFnc=null,this.freeVariables=[],this.unitIndex=-1,this.classDecl=null,this.boundToProperty=null,this.isOverload=!1,this.innerStaticFuncs=[],this.isTargetTypedAsMethod=!1,this.isInlineCallLiteral=!1,this.accessorSymbol=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.returnStatementsWithExpressions=[],this.scopeType=null}return __extends(i,t),i.prototype.internalName=function(){if(this.internalNameCache==null){var n=this.getNameText();this.internalNameCache=n?"_internal_"+n:"_internal_"+gt++}return this.internalNameCache},i.prototype.hasSelfReference=function(){return n.hasFlag(this.fncFlags,n.FncFlags.HasSelfReference)},i.prototype.setHasSelfReference=function(){this.fncFlags|=n.FncFlags.HasSelfReference},i.prototype.addCloRef=function(n,t){this.envids==null&&(this.envids=[]),this.envids[this.envids.length]=n;var i=this.enclosingFnc;if(t)while(i&&i.type.symbol!=t.container)i.addJumpRef(t),i=i.enclosingFnc;return this.envids.length-1},i.prototype.addJumpRef=function(n){this.jumpRefs==null&&(this.jumpRefs=[]);var t=new r(n.name);this.jumpRefs[this.jumpRefs.length]=t,t.sym=n,t.cloId=this.addCloRef(t,null)},i.prototype.buildControlFlow=function(){var r=new n.BasicBlock,u=new n.BasicBlock,t=new n.ControlFlowContext(r,u),f=function(n,t,i){return n.addToControlFlow(i.state),n},i=n.getAstWalkerFactory().getWalker(f,null,null,t);return t.walker=i,i.walk(this.bod,this),t},i.prototype.typeCheck=function(n){return n.typeCheckFunction(this)},i.prototype.emit=function(n,t,i,r){n.emitJavascriptFunction(this,r)},i.prototype.getNameText=function(){return this.name?this.name.text:this.hint},i.prototype.isMethod=function(){return(this.fncFlags&n.FncFlags.Method)!=n.FncFlags.None},i.prototype.isCallMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.CallMember)},i.prototype.isConstructMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.ConstructMember)},i.prototype.isIndexerMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.IndexerMember)},i.prototype.isSpecialFn=function(){return this.isCallMember()||this.isIndexerMember()||this.isConstructMember()},i.prototype.isAnonymousFn=function(){return this.name===null},i.prototype.isAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.GetAccessor)||n.hasFlag(this.fncFlags,n.FncFlags.SetAccessor)},i.prototype.isGetAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.GetAccessor)},i.prototype.isSetAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.SetAccessor)},i.prototype.isAmbient=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Ambient)},i.prototype.isExported=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Exported)},i.prototype.isPrivate=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Private)},i.prototype.isPublic=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Public)},i.prototype.isStatic=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Static)},i.prototype.treeViewLabel=function(){return this.name==null?"funcExpr":"func: "+this.name.text},i.prototype.ClearFlags=function(){this.fncFlags=n.FncFlags.None},i.prototype.isSignature=function(){return(this.fncFlags&n.FncFlags.Signature)!=n.FncFlags.None},i.prototype.hasStaticDeclarations=function(){return!this.isConstructor&&(this.statics.members.length>0||this.innerStaticFuncs.length>0)},i}(t),n.FuncDecl=h,s=function(){function n(n,t,i){this.filename=n,this.lineMap=t,this.unitIndex=i}return n}(),n.LocationInfo=s,n.unknownLocationInfo=new s("unknown",null,-1),ni=function(t){function i(i,u){t.call(this,new r("script"),null,!1,null,i,u,null,n.NodeType.Script),this.locationInfo=null,this.requiresGlobal=!1,this.requiresInherits=!1,this.isResident=!1,this.isDeclareFile=!1,this.hasBeenTypeChecked=!1,this.topLevelMod=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.vars=i,this.scopes=u}return __extends(i,t),i.prototype.typeCheck=function(n){return n.typeCheckScript(this)},i.prototype.treeViewLabel=function(){return"Script"},i.prototype.emitRequired=function(){var i,r,t;if(!this.isDeclareFile&&!this.isResident&&this.bod)for(i=0,r=this.bod.members.length;i<r;i++)if(t=this.bod.members[i],t.nodeType==n.NodeType.Module){if(!n.hasFlag(t.modFlags,n.ModuleFlags.ShouldEmitModuleDecl|n.ModuleFlags.Ambient))return!0}else if(t.nodeType==n.NodeType.Class){if(!n.hasFlag(t.varFlags,n.VarFlags.Ambient))return!0}else if(t.nodeType==n.NodeType.VarDecl){if(!n.hasFlag(t.varFlags,n.VarFlags.Ambient))return!0}else if(t.nodeType==n.NodeType.FuncDecl){if(!t.isSignature())return!0}else if(t.nodeType!=n.NodeType.Interface&&t.nodeType!=n.NodeType.Empty)return!0;return!1},i.prototype.emit=function(t,i,r,u){if(this.emitRequired()){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitPrologue(this.requiresInherits);var f=u?t.setDeclContainingAST(this):null;t.emitJavascriptList(this.bod,null,n.TokenID.SColon,!0,!1,!1,u),u&&t.setDeclContainingAST(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)}},i}(h),n.Script=ni,u=function(n){function t(t,i,r){n.call(this,t),this.name=i,this.members=r,this.nty=t}return __extends(t,n),t}(t),n.Record=u,ti=function(t){function i(i,r,u,f){t.call(this,n.NodeType.Module,i,r),this.modFlags=n.ModuleFlags.ShouldEmitModuleDecl,this.alias=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.amdDependencies=[],this.members=r,this.vars=u,this.name=i,this.scopes=f,this.prettyName=this.name.text}return __extends(i,t),i.prototype.isExported=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.Exported)},i.prototype.isAmbient=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.Ambient)},i.prototype.isEnum=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.IsEnum)},i.prototype.recordNonInterface=function(){this.modFlags&=~n.ModuleFlags.ShouldEmitModuleDecl},i.prototype.typeCheck=function(n){return n.typeCheckModule(this)},i.prototype.emit=function(t,i,r,u){n.hasFlag(this.modFlags,n.ModuleFlags.ShouldEmitModuleDecl)?u&&t.emitModuleSignature(this):(t.emitParensAndCommentsInPlace(this,!0),t.emitJavascriptModule(this,u),t.emitParensAndCommentsInPlace(this,!1))},i}(u),n.ModuleDecl=ti,e=function(n){function t(t,i,r,u,f){n.call(this,t,i,f),this.extendsList=r,this.implementsList=u,this.name=i,this.members=f}return __extends(t,n),t}(u),n.NamedType=e,ri=function(t){function i(i,r,u,f){t.call(this,n.NodeType.Class,i,u,f,r),this.varFlags=n.VarFlags.None,this.leftCurlyCount=0,this.rightCurlyCount=0,this.knownMemberNames={},this.constructorDecl=null,this.constructorNestingLevel=0,this.allMemberDefinitions=new o,this.name=i,this.baseClass=u,this.implementsList=f,this.definitionMembers=r}return __extends(i,t),i.prototype.isExported=function(){return n.hasFlag(this.varFlags,n.VarFlags.Exported)},i.prototype.isAmbient=function(){return n.hasFlag(this.varFlags,n.VarFlags.Ambient)},i.prototype.typeCheck=function(n){return n.typeCheckClass(this)},i.prototype.emit=function(n,t,i,r){n.emitJavascriptClass(this,r)},i}(e),n.ClassDecl=ri,ui=function(t){function i(i,r,u,f,e,o){t.call(this,i,r,e,o,u),this.args=f,this.varFlags=n.VarFlags.None,this.isOverload=!1,this.leftCurlyCount=0,this.rightCurlyCount=0,this.nty=i,this.name=r,this.extendsList=e,this.implementsList=o,this.members=u}return __extends(i,t),i.prototype.isExported=function(){return n.hasFlag(this.varFlags,n.VarFlags.Exported)},i.prototype.isAmbient=function(){return n.hasFlag(this.varFlags,n.VarFlags.Ambient)},i.prototype.typeCheck=function(t){if(this.nty==n.NodeType.Interface)return t.typeCheckInterface(this);throw new Error("please implement type check for node type"+this.nty);},i.prototype.emit=function(t,i,r,u){if(this.nty==n.NodeType.Interface)u&&t.emitInterfaceDeclaration(this);else throw new Error("please implement emit for node type"+this.nty);},i}(e),n.TypeDecl=ui,i=function(t){function i(i){t.call(this,i),this.flags|=n.ASTFlags.IsStatement}return __extends(i,t),i.prototype.isLoop=function(){return!1},i.prototype.isCompoundStatement=function(){return this.isLoop()},i.prototype.typeCheck=function(n){return this.type=n.voidType,this},i}(t),n.Statement=i,bt=function(t){function i(i,r){t.call(this,n.NodeType.LabeledStatement),this.labels=i,this.stmt=r}return __extends(i,t),i.prototype.emit=function(n,t,i,r){var f,u;if(n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),this.labels)for(f=this.labels.members.length,u=0;u<f;u++)this.labels.members[u].emit(n,t,i,r);this.stmt.emit(n,t,!0,r),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheck(this.labels),this.stmt=this.stmt.typeCheck(n),this},i.prototype.addToControlFlow=function(t){var r=t.current,i=new n.BasicBlock;t.current=i,r.addSuccessor(i)},i}(i),n.LabeledStatement=bt,ot=function(t){function i(i,r){t.call(this,n.NodeType.Block),this.stmts=i,this.visible=r}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.visible&&(t.writeLineToOutput(" {"),t.increaseIndent());var f=t.setInObjectLiteral(!1);this.stmts&&t.emitJavascriptList(this.stmts,null,n.TokenID.SColon,!0,!1,!1),this.visible&&(t.decreaseIndent(),t.emitIndent(),t.writeToOutput("}")),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){var i=new n.BasicBlock;t.pushStatement(this,t.current,i),this.stmts&&t.walk(this.stmts,this),t.walker.options.goChildren=!1,t.popStatement(),i.predecessors.length>0&&(t.current.addSuccessor(i),t.current=i)},i.prototype.typeCheck=function(n){return n.checker.styleSettings.emptyBlocks||(this.stmts===null||this.stmts.members.length==0)&&n.checker.errorReporter.styleError(this,"empty block"),n.typeCheck(this.stmts),this},i}(i),n.Block=ot,et=function(t){function i(n){t.call(this,n),this.target=null,this.resolvedTarget=null,this.nty=n}return __extends(i,t),i.prototype.hasExplicitTarget=function(){return this.target},i.prototype.setResolvedTarget=function(t,i){return i.isLoop()?(this.resolvedTarget=i,!0):this.nty===n.NodeType.Continue?(t.reportParseError("continue statement applies only to loops"),!1):i.nodeType==n.NodeType.Switch||this.hasExplicitTarget()?(this.resolvedTarget=i,!0):(t.reportParseError("break statement with no label can apply only to a loop or switch statement"),!1)},i.prototype.addToControlFlow=function(i){t.prototype.addToControlFlow.call(this,i),i.unconditionalBranch(this.resolvedTarget,this.nty==n.NodeType.Continue)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nty==n.NodeType.Break?t.writeToOutput("break"):t.writeToOutput("continue"),this.hasExplicitTarget()&&t.writeToOutput(" "+this.target),t.writeToOutput(";"),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(i),n.Jump=et,l=function(t){function i(i){t.call(this,n.NodeType.While),this.cond=i,this.body=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);t.writeToOutput("while("),t.emitJavascript(this.cond,n.TokenID.WHILE,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!1,!1),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckWhile(this)},i.prototype.addToControlFlow=function(t){var o=t.current,i=new n.BasicBlock,r=new n.BasicBlock,u,f,e;o.addSuccessor(i),t.current=i,t.addContent(this.cond),u=t.current,f=null,this.body&&(t.current=new n.BasicBlock,u.addSuccessor(t.current),t.pushStatement(this,i,r),t.walk(this.body,this),f=t.popStatement()),t.noContinuation||(e=t.current,e.addSuccessor(i)),t.current=r,u.addSuccessor(r),t.noContinuation=!1,t.walker.options.goChildren=!1},i}(i),n.WhileStatement=l,a=function(t){function i(){t.call(this,n.NodeType.DoWhile),this.body=null,this.whileAST=null,this.cond=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);t.writeToOutput("do"),t.emitJavascriptStatements(this.body,!0,!1),t.recordSourceMappingStart(this.whileAST),t.writeToOutput("while"),t.recordSourceMappingEnd(this.whileAST),t.writeToOutput("("),t.emitJavascript(this.cond,n.TokenID.RParen,!1),t.writeToOutput(")"),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckDoWhile(this)},i.prototype.addToControlFlow=function(t){var e=t.current,i=new n.BasicBlock,r=new n.BasicBlock,f,u;e.addSuccessor(i),t.current=i,f=null,this.body&&(t.pushStatement(this,i,r),t.walk(this.body,this),f=t.popStatement()),t.noContinuation?t.addUnreachable(this.cond):(u=t.current,u.addSuccessor(i),t.addContent(this.cond),t.current=r,u.addSuccessor(r)),t.walker.options.goChildren=!1},i}(i),n.DoWhileStatement=a,v=function(t){function i(i){t.call(this,n.NodeType.If),this.cond=i,this.elseBod=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);t.writeToOutput("if("),t.emitJavascript(this.cond,n.TokenID.IF,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.thenBod,!0,!1),this.elseBod&&(t.writeToOutput(" else"),t.emitJavascriptStatements(this.elseBod,!0,!0)),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckIf(this)},i.prototype.addToControlFlow=function(t){var i,u,r,f;this.cond.addToControlFlow(t),i=new n.BasicBlock,u=t.current,t.pushStatement(this,u,i),r=!1,t.current=new n.BasicBlock,u.addSuccessor(t.current),t.walk(this.thenBod,this),t.noContinuation||(r=!0,t.current.addSuccessor(i)),this.elseBod?(t.current=new n.BasicBlock,t.noContinuation=!1,u.addSuccessor(t.current),t.walk(this.elseBod,this),t.noContinuation?r&&(t.noContinuation=!1):(r=!0,t.current.addSuccessor(i))):(u.addSuccessor(i),t.noContinuation=!1,r=!0),f=t.popStatement(),i.predecessors.length>0&&(t.noContinuation=!1,r=!0),r&&(t.current=i),t.walker.options.goChildren=!1},i}(i),n.IfStatement=v,y=function(t){function i(){t.call(this,n.NodeType.Return),this.returnExpression=null}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);this.returnExpression?(t.writeToOutput("return "),t.emitJavascript(this.returnExpression,n.TokenID.SColon,!1)):t.writeToOutput("return;"),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n),n.returnStmt()},i.prototype.typeCheck=function(n){return n.typeCheckReturn(this)},i}(i),n.ReturnStatement=y,p=function(t){function i(){t.call(this,n.NodeType.EndCode)}return __extends(i,t),i}(t),n.EndCode=p,w=function(t){function i(i,r){t.call(this,n.NodeType.ForIn),this.lval=i,this.obj=r,this.lval&&this.lval.nodeType==n.NodeType.VarDecl&&(this.lval.varFlags|=n.VarFlags.AutoInit)}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isLoop=function(){return!0},i.prototype.isFiltered=function(){var t,e,i,r,o,u,h,f,s;return this.body&&(t=null,this.body.nodeType==n.NodeType.List?(e=this.body,e.members.length==1&&(t=e.members[0])):t=this.body,t!==null&&(t.nodeType==n.NodeType.Block&&(i=t,i.stmts!==null&&i.stmts.members.length==1&&(t=i.stmts.members[0])),t.nodeType==n.NodeType.If&&(r=t.cond,r.nodeType==n.NodeType.Call&&(o=r.target,o.nodeType==n.NodeType.Dot&&(u=o,u.operand1.nodeType==n.NodeType.Name&&this.obj.nodeType==n.NodeType.Name&&u.operand1.text==this.obj.text&&(h=u.operand2,h.text=="hasOwnProperty"&&(f=r.args,f!==null&&f.members.length==1&&(s=f.members[0],s.nodeType==n.NodeType.Name&&this.lval.nodeType==n.NodeType.Name&&this.lval.text==s.text))))))))?!0:!1},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);t.writeToOutput("for("),t.emitJavascript(this.lval,n.TokenID.FOR,!1),t.writeToOutput(" in "),t.emitJavascript(this.obj,n.TokenID.FOR,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.checker.styleSettings.forin&&(this.isFiltered()||n.checker.errorReporter.styleError(this,"no hasOwnProperty filter")),n.typeCheckForIn(this)},i.prototype.addToControlFlow=function(t){var f;this.lval&&t.addContent(this.lval),this.obj&&t.addContent(this.obj);var u=t.current,i=new n.BasicBlock,r=new n.BasicBlock;u.addSuccessor(i),t.current=i,this.body&&(t.pushStatement(this,i,r),t.walk(this.body,this),t.popStatement()),t.noContinuation||(f=t.current,f.addSuccessor(i)),t.current=r,t.noContinuation=!1,u.addSuccessor(r),t.walker.options.goChildren=!1},i}(i),n.ForInStatement=w,b=function(t){function i(i){t.call(this,n.NodeType.For),this.init=i}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var f=t.setInObjectLiteral(!1);t.writeToOutput("for("),this.init&&(this.init.nodeType!=n.NodeType.List?t.emitJavascript(this.init,n.TokenID.FOR,!1):t.emitForVarList(this.init)),t.writeToOutput("; "),t.emitJavascript(this.cond,n.TokenID.FOR,!1),t.writeToOutput("; "),t.emitJavascript(this.incr,n.TokenID.FOR,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckFor(this)},i.prototype.addToControlFlow=function(t){var o,s;this.init&&t.addContent(this.init);var h=t.current,r=new n.BasicBlock,u=new n.BasicBlock;h.addSuccessor(r),t.current=r;var f=null,e=r,i=null;this.incr&&(i=new n.BasicBlock,e=i),this.cond&&(f=t.current,t.addContent(this.cond),t.current=new n.BasicBlock,f.addSuccessor(t.current)),o=null,this.body&&(t.pushStatement(this,e,u),t.walk(this.body,this),o=t.popStatement()),this.incr&&(t.noContinuation?i.predecessors.length==0&&t.addUnreachable(this.incr):(t.current.addSuccessor(i),t.current=i,t.addContent(this.incr))),s=t.current,t.noContinuation||s.addSuccessor(r),f&&(f.addSuccessor(u),t.noContinuation=!1),u.predecessors.length>0&&(t.noContinuation=!1,t.current=u),t.walker.options.goChildren=!1},i}(i),n.ForStatement=b,k=function(t){function i(i){t.call(this,n.NodeType.With),this.expr=i,this.withSym=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("with ("),this.expr&&t.emitJavascript(this.expr,n.TokenID.WITH,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckWith(this)},i}(i),n.WithStatement=k,d=function(t){function i(i){t.call(this,n.NodeType.Switch),this.val=i,this.defaultCase=null}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){var f,e,u,o;for(t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),f=t.setInObjectLiteral(!1),t.writeToOutput("switch("),t.emitJavascript(this.val,n.TokenID.ID,!1),t.writeLineToOutput(") {"),t.increaseIndent(),e=this.caseList.members.length,u=0;u<e;u++)o=this.caseList.members[u],t.emitJavascript(o,n.TokenID.CASE,!0),t.writeLineToOutput("");t.decreaseIndent(),t.emitIndent(),t.writeToOutput("}"),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){var i=this.caseList.members.length,t;for(this.val=n.typeCheck(this.val),t=0;t<i;t++)this.caseList.members[t]=n.typeCheck(this.caseList.members[t]);return this.defaultCase=n.typeCheck(this.defaultCase),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var u=t.current,i,r,f,e;t.addContent(this.val),i=new n.BasicBlock,r=new n.BasicBlock,u.addSuccessor(i),t.pushSwitch(i),t.current=i,t.pushStatement(this,i,r),t.walk(this.caseList,this),t.popSwitch(),f=t.popStatement(),e=this.defaultCase==null,this.defaultCase==null&&u.addSuccessor(r),r.predecessors.length>0?(t.noContinuation=!1,t.current=r):t.noContinuation=!0,t.walker.options.goChildren=!1},i}(i),n.SwitchStatement=d,g=function(t){function i(){t.call(this,n.NodeType.Case),this.expr=null}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.expr?(t.writeToOutput("case "),t.emitJavascript(this.expr,n.TokenID.ID,!1)):t.writeToOutput("default"),t.writeToOutput(":"),t.emitJavascriptStatements(this.body,!1,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.expr=n.typeCheck(this.expr),n.typeCheck(this.body),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var r=new n.BasicBlock,u=t.currentSwitch[t.currentSwitch.length-1],i;this.expr?(i=new n.BasicBlock,t.current=i,u.addSuccessor(i),t.addContent(this.expr),i.addSuccessor(r)):u.addSuccessor(r),t.current=r,this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},i}(i),n.CaseStatement=g,nt=function(t){function i(i,r){t.call(this,n.NodeType.TypeRef),this.term=i,this.arrayCount=r}return __extends(i,t),i.prototype.emit=function(){throw new Error("should not emit a type ref");},i.prototype.typeCheck=function(t){var r=t.inTypeRefTypeCheck,i;return t.inTypeRefTypeCheck=!0,i=n.getTypeLink(this,t.checker,!0),t.checker.resolveTypeLink(t.scope,i,!1),t.checkForVoidConstructor(i.type,this),this.type=i.type,this.term&&(this.term.type=this.type),t.inTypeRefTypeCheck=r,this},i}(t),n.TypeReference=nt,tt=function(t){function i(i,r){t.call(this,n.NodeType.TryFinally),this.tryNode=i,this.finallyNode=r}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,n.TokenID.TRY,!1),t.emitJavascript(this.finallyNode,n.TokenID.FINALLY,!1),t.recordSourceMappingEnd(this)},i.prototype.typeCheck=function(n){return this.tryNode=n.typeCheck(this.tryNode),this.finallyNode=n.typeCheck(this.finallyNode),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var i=new n.BasicBlock,r;t.walk(this.tryNode,this),r=new n.BasicBlock,t.current&&t.current.addSuccessor(r),t.current=r,t.pushStatement(this,null,i),t.walk(this.finallyNode,this),!t.noContinuation&&t.current&&t.current.addSuccessor(i),i.predecessors.length>0?t.current=i:t.noContinuation=!0,t.popStatement(),t.walker.options.goChildren=!1},i}(i),n.TryFinally=tt,it=function(t){function i(i,r){t.call(this,n.NodeType.TryCatch),this.tryNode=i,this.catchNode=r}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,n.TokenID.TRY,!1),t.emitJavascript(this.catchNode,n.TokenID.CATCH,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){var r=t.current,u=new n.BasicBlock,i;r.addSuccessor(u),t.current=u,i=new n.BasicBlock,t.pushStatement(this,null,i),t.walk(this.tryNode,this),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=new n.BasicBlock,r.addSuccessor(t.current),t.walk(this.catchNode,this),t.popStatement(),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=i,t.walker.options.goChildren=!1},i.prototype.typeCheck=function(n){return this.tryNode=n.typeCheck(this.tryNode),this.catchNode=n.typeCheck(this.catchNode),this.type=n.voidType,this},i}(i),n.TryCatch=it,rt=function(t){function i(i){t.call(this,n.NodeType.Try),this.body=i}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("try "),t.emitJavascript(this.body,n.TokenID.TRY,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.body=n.typeCheck(this.body),this},i.prototype.addToControlFlow=function(n){this.body&&n.walk(this.body,this),n.walker.options.goChildren=!1,n.noContinuation=!1},i}(i),n.Try=rt,ut=function(t){function i(i,r){t.call(this,n.NodeType.Catch),this.param=i,this.body=r,this.containedScope=null,this.param&&(this.param.varFlags|=n.VarFlags.AutoInit)}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput(" catch ("),t.emitJavascript(this.param,n.TokenID.LParen,!1),t.writeToOutput(")"),t.emitJavascript(this.body,n.TokenID.CATCH,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){if(this.param){t.addContent(this.param);var i=new n.BasicBlock;t.current.addSuccessor(i),t.current=i}this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},i.prototype.typeCheck=function(t){var e=t.scope,i,u,r,f;return t.scope=this.containedScope,this.param=t.typeCheck(this.param),i=new n.ValueLocation,u=new n.VariableSymbol(this.param.id.text,this.param.minChar,t.checker.locationInfo.unitIndex,i),i.symbol=u,i.typeLink=new n.TypeLink,i.typeLink.type=t.anyType,r=t.thisFnc,i.symbol.container=r&&r.type?r.type.symbol:null,this.param.sym=i.symbol,t.scope.enter(i.symbol.container,this.param,i.symbol,t.checker.errorReporter,!1,!1,!1),this.body=t.typeCheck(this.body),t.checker.inProvisionalTypecheckMode()&&(f=t.scope.getTable(),f.secondaryTable.table[i.symbol.name]=undefined),this.type=t.voidType,t.scope=e,this},i}(i),n.Catch=ut,ft=function(t){function i(i){t.call(this,n.NodeType.Finally),this.body=i}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("finally"),t.emitJavascript(this.body,n.TokenID.FINALLY,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(n){this.body&&n.walk(this.body,this),n.walker.options.goChildren=!1,n.noContinuation=!1},i.prototype.typeCheck=function(n){return this.body=n.typeCheck(this.body),this},i}(i),n.Finally=ft,ii=function(t){function i(i,r,u){t.call(this,n.NodeType.Comment),this.content=i,this.isBlockComment=r,this.endsLine=u,this.text=null}return __extends(i,t),i.prototype.getText=function(){if(this.text==null)if(this.isBlockComment){this.text=this.content.split("\n");for(var n=0;n<this.text.length;n++)this.text[n]=this.text[n].replace(/^\s+|\s+$/g,"")}else this.text=[this.content.replace(/^\s+|\s+$/g,"")];return this.text},i}(t),n.Comment=ii,ei=function(t){function i(){t.call(this,n.NodeType.Debugger)}return __extends(i,t),i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeLineToOutput("debugger;"),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(i),n.DebuggerStatement=ei}(TypeScript||(TypeScript={})),function(n){function e(){return r||(r=new i),r}var u=function(){function n(){this.goChildren=!0,this.goNextSibling=!0,this.reverseSiblings=!1}return n.prototype.stopWalk=function(n){typeof n=="undefined"&&(n=!0),this.goChildren=!n,this.goNextSibling=!n},n}(),f,i,r,t;n.AstWalkOptions=u,f=function(){function n(n,t,i,r,u){this.childrenWalkers=n,this.pre=t,this.post=i,this.options=r,this.state=u}return n.prototype.walk=function(n,t){var i=this.pre(n,t,this),u,r;return i===undefined&&(i=n),this.options.goChildren?(u=this.options.goNextSibling,this.options.goNextSibling=!0,this.childrenWalkers[n.nodeType](n,t,this),this.options.goNextSibling=u):this.options.goChildren=!0,this.post?(r=this.post(i,t,this),r===undefined&&(r=i),r):i},n}(),i=function(){function i(){this.childrenWalkers=[],this.initChildrenWalkers()}return i.prototype.walk=function(n,t,i,r,u){return this.getWalker(t,i,r,u).walk(n,null)},i.prototype.getWalker=function(n,t,i,r){return this.getSlowWalker(n,t,i,r)},i.prototype.getSlowWalker=function(n,t,i,r){return i||(i=new u),new f(this.childrenWalkers,n,t,i,r)},i.prototype.initChildrenWalkers=function(){this.childrenWalkers[n.NodeType.None]=t.walkNone,this.childrenWalkers[n.NodeType.Empty]=t.walkNone,this.childrenWalkers[n.NodeType.EmptyExpr]=t.walkNone,this.childrenWalkers[n.NodeType.True]=t.walkNone,this.childrenWalkers[n.NodeType.False]=t.walkNone,this.childrenWalkers[n.NodeType.This]=t.walkNone,this.childrenWalkers[n.NodeType.Super]=t.walkNone,this.childrenWalkers[n.NodeType.QString]=t.walkNone,this.childrenWalkers[n.NodeType.Regex]=t.walkNone,this.childrenWalkers[n.NodeType.Null]=t.walkNone,this.childrenWalkers[n.NodeType.ArrayLit]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.ObjectLit]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Void]=t.walkNone,this.childrenWalkers[n.NodeType.Comma]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Pos]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Neg]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Delete]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Await]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.In]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Dot]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.From]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Is]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.InstOf]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Typeof]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.NumberLit]=t.walkNone,this.childrenWalkers[n.NodeType.Name]=t.walkNone,this.childrenWalkers[n.NodeType.TypeRef]=t.walkTypeReferenceChildren,this.childrenWalkers[n.NodeType.Index]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Call]=t.walkCallExpressionChildren,this.childrenWalkers[n.NodeType.New]=t.walkCallExpressionChildren,this.childrenWalkers[n.NodeType.Asg]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgAdd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgSub]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgDiv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgMul]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgMod]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgAnd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgXor]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgOr]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgLsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgRsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgRs2]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.QMark]=t.walkTrinaryExpressionChildren,this.childrenWalkers[n.NodeType.LogOr]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.LogAnd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Or]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Xor]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.And]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Eq]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Ne]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Eqv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.NEqv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Lt]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Le]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Gt]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Ge]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Add]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Sub]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Mul]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Div]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Mod]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Lsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Rsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Rs2]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Not]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.LogNot]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.IncPre]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.DecPre]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.IncPost]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.DecPost]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.TypeAssertion]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.FuncDecl]=t.walkFuncDeclChildren,this.childrenWalkers[n.NodeType.Member]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.VarDecl]=t.walkBoundDeclChildren,this.childrenWalkers[n.NodeType.ArgDecl]=t.walkBoundDeclChildren,this.childrenWalkers[n.NodeType.Return]=t.walkReturnStatementChildren,this.childrenWalkers[n.NodeType.Break]=t.walkNone,this.childrenWalkers[n.NodeType.Continue]=t.walkNone,this.childrenWalkers[n.NodeType.Throw]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.For]=t.walkForStatementChildren,this.childrenWalkers[n.NodeType.ForIn]=t.walkForInStatementChildren,this.childrenWalkers[n.NodeType.If]=t.walkIfStatementChildren,this.childrenWalkers[n.NodeType.While]=t.walkWhileStatementChildren,this.childrenWalkers[n.NodeType.DoWhile]=t.walkDoWhileStatementChildren,this.childrenWalkers[n.NodeType.Block]=t.walkBlockChildren,this.childrenWalkers[n.NodeType.Case]=t.walkCaseStatementChildren,this.childrenWalkers[n.NodeType.Switch]=t.walkSwitchStatementChildren,this.childrenWalkers[n.NodeType.Try]=t.walkTryChildren,this.childrenWalkers[n.NodeType.TryCatch]=t.walkTryCatchChildren,this.childrenWalkers[n.NodeType.TryFinally]=t.walkTryFinallyChildren,this.childrenWalkers[n.NodeType.Finally]=t.walkFinallyChildren,this.childrenWalkers[n.NodeType.Catch]=t.walkCatchChildren,this.childrenWalkers[n.NodeType.List]=t.walkListChildren,this.childrenWalkers[n.NodeType.Script]=t.walkScriptChildren,this.childrenWalkers[n.NodeType.Class]=t.walkClassDeclChildren,this.childrenWalkers[n.NodeType.Interface]=t.walkTypeDeclChildren,this.childrenWalkers[n.NodeType.Module]=t.walkModuleDeclChildren,this.childrenWalkers[n.NodeType.Import]=t.walkImportDeclChildren,this.childrenWalkers[n.NodeType.With]=t.walkWithStatementChildren,this.childrenWalkers[n.NodeType.Label]=t.walkLabelChildren,this.childrenWalkers[n.NodeType.LabeledStatement]=t.walkLabeledStatementChildren,this.childrenWalkers[n.NodeType.EBStart]=t.walkNone,this.childrenWalkers[n.NodeType.GotoEB]=t.walkNone,this.childrenWalkers[n.NodeType.EndCode]=t.walkNone,this.childrenWalkers[n.NodeType.Error]=t.walkNone,this.childrenWalkers[n.NodeType.Comment]=t.walkNone,this.childrenWalkers[n.NodeType.Debugger]=t.walkNone;for(var i in n.NodeType._map)if(this.childrenWalkers[i]===undefined)throw new Error("initWalkers function is not up to date with enum content!");},i}(),n.AstWalkerFactory=i,n.getAstWalkerFactory=e,function(n){function k(){}function d(n,t,i){var u=n.members.length,r;if(i.options.reverseSiblings)for(r=u-1;r>=0;r--)i.options.goNextSibling&&(n.members[r]=i.walk(n.members[r],n));else for(r=0;r<u;r++)i.options.goNextSibling&&(n.members[r]=i.walk(n.members[r],n))}function g(n,t,i){n.castTerm&&(n.castTerm=i.walk(n.castTerm,n)),n.operand&&(n.operand=i.walk(n.operand,n))}function nt(n,t,i){i.options.reverseSiblings?(n.operand2&&(n.operand2=i.walk(n.operand2,n)),n.operand1&&i.options.goNextSibling&&(n.operand1=i.walk(n.operand1,n))):(n.operand1&&(n.operand1=i.walk(n.operand1,n)),n.operand2&&i.options.goNextSibling&&(n.operand2=i.walk(n.operand2,n)))}function tt(n,t,i){n.term&&(n.term=i.walk(n.term,n))}function it(n,t,i){i.options.reverseSiblings||(n.target=i.walk(n.target,n)),n.args&&i.options.goNextSibling&&(n.args=i.walk(n.args,n)),i.options.reverseSiblings&&i.options.goNextSibling&&(n.target=i.walk(n.target,n))}function ut(n,t,i){n.operand1&&(n.operand1=i.walk(n.operand1,n)),n.operand2&&i.options.goNextSibling&&(n.operand2=i.walk(n.operand2,n)),n.operand3&&i.options.goNextSibling&&(n.operand3=i.walk(n.operand3,n))}function lt(n,t,i){n.name&&(n.name=i.walk(n.name,n)),n.args&&n.args.members.length>0&&i.options.goNextSibling&&(n.args=i.walk(n.args,n)),n.returnTypeAnnotation&&i.options.goNextSibling&&(n.returnTypeAnnotation=i.walk(n.returnTypeAnnotation,n)),n.bod&&n.bod.members.length>0&&i.options.goNextSibling&&(n.bod=i.walk(n.bod,n))}function ft(n,t,i){n.id&&(n.id=i.walk(n.id,n)),n.init&&(n.init=i.walk(n.init,n)),n.typeExpr&&i.options.goNextSibling&&(n.typeExpr=i.walk(n.typeExpr,n))}function et(n,t,i){n.returnExpression&&(n.returnExpression=i.walk(n.returnExpression,n))}function ot(n,t,i){n.init&&(n.init=i.walk(n.init,n)),n.cond&&i.options.goNextSibling&&(n.cond=i.walk(n.cond,n)),n.incr&&i.options.goNextSibling&&(n.incr=i.walk(n.incr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function st(n,t,i){n.lval=i.walk(n.lval,n),i.options.goNextSibling&&(n.obj=i.walk(n.obj,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function ht(n,t,i){n.cond=i.walk(n.cond,n),n.thenBod&&i.options.goNextSibling&&(n.thenBod=i.walk(n.thenBod,n)),n.elseBod&&i.options.goNextSibling&&(n.elseBod=i.walk(n.elseBod,n))}function ct(n,t,i){n.cond=i.walk(n.cond,n),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function b(n,t,i){n.cond=i.walk(n.cond,n),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function w(n,t,i){n.stmts&&(n.stmts=i.walk(n.stmts,n))}function p(n,t,i){n.expr&&(n.expr=i.walk(n.expr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function y(n,t,i){n.val&&(n.val=i.walk(n.val,n)),n.caseList&&i.options.goNextSibling&&(n.caseList=i.walk(n.caseList,n))}function v(n,t,i){n.body&&(n.body=i.walk(n.body,n))}function a(n,t,i){n.tryNode&&(n.tryNode=i.walk(n.tryNode,n)),n.catchNode&&i.options.goNextSibling&&(n.catchNode=i.walk(n.catchNode,n))}function l(n,t,i){n.tryNode&&(n.tryNode=i.walk(n.tryNode,n)),n.finallyNode&&i.options.goNextSibling&&(n.finallyNode=i.walk(n.finallyNode,n))}function c(n,t,i){n.body&&(n.body=i.walk(n.body,n))}function h(n,t,i){n.param&&(n.param=i.walk(n.param,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function i(n,t,i){n.name=i.walk(n.name,n),i.options.goNextSibling&&n.members&&(n.members=i.walk(n.members,n))}function t(n,t,r){i(n,t,r)}function s(n,i,r){t(n,i,r),r.options.goNextSibling&&n.baseClass&&(n.baseClass=r.walk(n.baseClass,n)),r.options.goNextSibling&&n.implementsList&&(n.implementsList=r.walk(n.implementsList,n))}function o(n,t,i){n.bod&&(n.bod=i.walk(n.bod,n))}function e(n,i,r){t(n,i,r),r.options.goNextSibling&&n.extendsList&&(n.extendsList=r.walk(n.extendsList,n)),r.options.goNextSibling&&n.implementsList&&(n.implementsList=r.walk(n.implementsList,n))}function f(n,t,r){i(n,t,r),r.options.goNextSibling&&n.alias&&(n.alias=r.walk(n.alias,n))}function u(n,t,i){n.id&&(n.id=i.walk(n.id,n)),n.alias&&(n.alias=i.walk(n.alias,n))}function r(n,t,i){n.expr&&(n.expr=i.walk(n.expr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function rt(){}function at(n,t,i){n.labels=i.walk(n.labels,n),i.options.goNextSibling&&(n.stmt=i.walk(n.stmt,n))}n.walkNone=k,n.walkListChildren=d,n.walkUnaryExpressionChildren=g,n.walkBinaryExpressionChildren=nt,n.walkTypeReferenceChildren=tt,n.walkCallExpressionChildren=it,n.walkTrinaryExpressionChildren=ut,n.walkFuncDeclChildren=lt,n.walkBoundDeclChildren=ft,n.walkReturnStatementChildren=et,n.walkForStatementChildren=ot,n.walkForInStatementChildren=st,n.walkIfStatementChildren=ht,n.walkWhileStatementChildren=ct,n.walkDoWhileStatementChildren=b,n.walkBlockChildren=w,n.walkCaseStatementChildren=p,n.walkSwitchStatementChildren=y,n.walkTryChildren=v,n.walkTryCatchChildren=a,n.walkTryFinallyChildren=l,n.walkFinallyChildren=c,n.walkCatchChildren=h,n.walkRecordChildren=i,n.walkNamedTypeChildren=t,n.walkClassDeclChildren=s,n.walkScriptChildren=o,n.walkTypeDeclChildren=e,n.walkModuleDeclChildren=f,n.walkImportDeclChildren=u,n.walkWithStatementChildren=r,n.walkLabelChildren=rt,n.walkLabeledStatementChildren=at}(t||(t={}))}(TypeScript||(TypeScript={})),function(n){function t(n){return n===null||n.length===0?null:n[n.length-1]}function f(n,t){return n>=t?n:t}function o(n,t){return n<=t?n:t}function e(n){return n===null?!1:n.minChar===-1||n.limChar===-1?!1:!0}function s(t,r,f){typeof f=="undefined"&&(f=i.Default);var s=function(n){var t,u,i;if(n&&n.length>0)for(t=0;t<n.length;t++)u=n[t].minChar,i=n[t].limChar,n[t].isBlockComment||i++,r>=u&&r<i&&o.path.push(n[t])},h=function(u,h,c){var l;if(e(u)){var y=n.hasFlag(f,i.EdgeInclusive)||u.nodeType===n.NodeType.Name||r===t.limChar,a=u.minChar,v=u.limChar+(y?1:0);r>=a&&r<v&&(l=o.path.ast(),(l==null||u.minChar>=l.minChar&&u.limChar<=l.limChar)&&o.path.push(u)),r<v&&s(u.preComments),r>=a&&s(u.postComments),n.hasFlag(f,i.DontPruneSearchBasedOnPosition)||(c.options.goChildren=a<=r&&r<=v)}return u},o=new u;return n.getAstWalkerFactory().walk(t,h,null,null,o),o.path}function h(t,i){var r=0,u=function(t,u,e){return n.isValidAstNode(t)&&(t.minChar<=i&&(r=f(r,t.minChar)),(t.minChar>i||t.limChar<r)&&(e.options.goChildren=!1)),t};return n.getAstWalkerFactory().walk(t,u),r}function c(t,i){var u=function(n,t,r){var u=r.state;return u.push(n),i(u,r),n},f=function(n,t,i){var r=i.state;return r.pop(),n},e=new r;n.getAstWalkerFactory().walk(t,u,f,null,e)}var r,u,i;n.lastOf=t,n.max=f,n.min=o,r=function(){function i(){this.asts=[],this.top=-1}return i.reverseIndexOf=function(n,t){return n===null||n.length<=t?null:n[n.length-t-1]},i.prototype.clone=function(){var n=new i;return n.asts=this.asts.map(function(n){return n}),n.top=this.top,n},i.prototype.pop=function(){var n=this.ast();for(this.up();this.asts.length>this.count();)this.asts.pop();return n},i.prototype.push=function(n){while(this.asts.length>this.count())this.asts.pop();this.top=this.asts.length,this.asts.push(n)},i.prototype.up=function(){if(this.top<=-1)throw new Error("Invalid call to 'up'");this.top--},i.prototype.down=function(){if(this.top==this.ast.length-1)throw new Error("Invalid call to 'down'");this.top++},i.prototype.nodeType=function(){return this.ast()==null?n.NodeType.None:this.ast().nodeType},i.prototype.ast=function(){return i.reverseIndexOf(this.asts,this.asts.length-(this.top+1))},i.prototype.parent=function(){return i.reverseIndexOf(this.asts,this.asts.length-this.top)},i.prototype.count=function(){return this.top+1},i.prototype.get=function(n){return this.asts[n]},i.prototype.isNameOfClass=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.Class&&this.parent().name===this.ast()},i.prototype.isNameOfInterface=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.Interface&&this.parent().name===this.ast()},i.prototype.isNameOfArgument=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.ArgDecl&&this.parent().id===this.ast()},i.prototype.isNameOfVariable=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.VarDecl&&this.parent().id===this.ast()},i.prototype.isNameOfModule=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.Module&&this.parent().name===this.ast()},i.prototype.isNameOfFunction=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.FuncDecl&&this.parent().name===this.ast()},i.prototype.isChildOfScript=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.Script},i.prototype.isChildOfModule=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.Module},i.prototype.isChildOfClass=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.Class},i.prototype.isArgumentOfClassConstructor=function(){var i=t(this.asts);return this.count()>=5&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-3].nodeType===n.NodeType.List&&this.asts[this.top-4].nodeType===n.NodeType.Class&&this.asts[this.top-2].isConstructor&&this.asts[this.top-2].args===this.asts[this.top-1]&&this.asts[this.top-4].constructorDecl===this.asts[this.top-2]},i.prototype.isChildOfInterface=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.Interface},i.prototype.isTopLevelImplicitModule=function(){return this.count()>=1&&this.asts[this.top].nodeType===n.NodeType.Module&&n.hasFlag(this.asts[this.top].modFlags,n.ModuleFlags.IsWholeFile)},i.prototype.isBodyOfTopLevelImplicitModule=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]&&n.hasFlag(this.asts[this.top-1].modFlags,n.ModuleFlags.IsWholeFile)},i.prototype.isBodyOfScript=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Script&&this.asts[this.top-1].bod==this.asts[this.top-0]},i.prototype.isBodyOfSwitch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Switch&&this.asts[this.top-1].caseList==this.asts[this.top-0]},i.prototype.isBodyOfModule=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfClass=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Class&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfFunction=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-1].bod==this.asts[this.top-0]},i.prototype.isBodyOfInterface=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Interface&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfBlock=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Block&&this.asts[this.top-1].stmts==this.asts[this.top-0]},i.prototype.isBodyOfFor=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.For&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfCase=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Case&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfTry=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Try&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfCatch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Catch&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfDoWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.DoWhile&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.While&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfForIn=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ForIn&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfWith=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.With&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfFinally=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Finally&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.Switch&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]},i.prototype.isDefaultCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.Switch&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]&&this.asts[this.top-2].defaultCase==this.asts[this.top-0]},i.prototype.isListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},i.prototype.isBodyOfObjectLit=function(){return this.isListOfObjectLit()},i.prototype.isEmptyListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]&&this.asts[this.top-0].members.length==0},i.prototype.isMemberOfObjectLit=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-0].nodeType===n.NodeType.Member&&this.asts[this.top-2].operand==this.asts[this.top-1]},i.prototype.isNameOfMemberOfObjectLit=function(){return this.count()>=4&&this.asts[this.top-3].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-2].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-0].nodeType===n.NodeType.Name&&this.asts[this.top-3].operand==this.asts[this.top-2]},i.prototype.isListOfArrayLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ArrayLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},i.prototype.isTargetOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-1].operand1===this.asts[this.top-0]},i.prototype.isMemberOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-1].operand2===this.asts[this.top-0]},i.prototype.isItemOfList=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.List},i.prototype.isThenOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.If&&this.asts[this.top-1].thenBod==this.asts[this.top-0]},i.prototype.isElseOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.If&&this.asts[this.top-1].elseBod==this.asts[this.top-0]},i.prototype.isBodyOfDefaultCase=function(){return this.isBodyOfCase()},i.prototype.isSingleStatementList=function(){return this.count()>=1&&this.asts[this.top].nodeType===n.NodeType.List&&this.asts[this.top].members.length===1},i.prototype.isArgumentListOfFunction=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-1].args===this.asts[this.top-0]},i.prototype.isArgumentOfFunction=function(){return this.count()>=3&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-2].args===this.asts[this.top-1]},i.prototype.isArgumentListOfCall=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.Call&&this.asts[this.top-1].args===this.asts[this.top-0]},i.prototype.isArgumentListOfNew=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.New&&this.asts[this.top-1].args===this.asts[this.top-0]},i.prototype.isSynthesizedBlock=function(){return this.count()>=1&&this.asts[this.top-0].nodeType===n.NodeType.Block&&this.asts[this.top-0].visible===!1},i}(),n.AstPath=r,n.isValidAstNode=e,u=function(){function t(){this.path=new n.AstPath}return t}(),n.AstPathContext=u,function(n){n._map=[],n.Default=0,n.EdgeInclusive=1,n.DontPruneSearchBasedOnPosition=2}(n.GetAstPathOptions||(n.GetAstPathOptions={})),i=n.GetAstPathOptions,n.getAstPathToPosition=s,n.getTokenizationOffset=h,n.walkAST=c}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.logger=n}return t.prototype.logScript=function(t){var i=this;this.logLinemap(t.locationInfo.lineMap);var r=[],u=function(n){r.push(n);var f=(r.length-1)*2;return i.logComments(t,n.preComments,f),i.logNode(t,n,f),i.logComments(t,n.postComments,f),n},f=function(n){return r.pop(),n};n.getAstWalkerFactory().walk(t,u,f)},t.prototype.logNode=function(n,t,i){var r=this.addPadding("",i,"| ",!0);r=r.concat("+ "+t.treeViewLabel()),r=this.addPadding(r,70," ",!1),r=r+this.addLineColumn(n,t.minChar),r=this.addPadding(r,80," ",!1),r=r+"=> ",r=r+this.addLineColumn(n,t.limChar),r=this.addPadding(r,102," ",!1),r=r.concat("["+this.addPadding(t.minChar.toString(),1," ",!0)+", "+this.addPadding(t.limChar.toString(),1," ",!0)+"]"),r=this.addPadding(r,115," ",!1),r=r.concat("sym="+t.sym),r=this.addPadding(r,135," ",!1),r=r.concat("type="+(t.type===null?"null":t.type.getTypeName())),this.logger.log(r)},t.prototype.logComments=function(n,t,i){if(t!=null)for(var r=0;r<t.length;r++)this.logNode(n,t[r],i)},t.prototype.logLinemap=function(n){for(var i="[",t=0;t<n.length;t++)t>0&&(i+=","),i+=n[t];i+="]",this.logger.log("linemap: "+i)},t.prototype.addPadding=function(n,t,i,r){for(var u=r?"":n,f=n.length;f<t;f++)u=u+i;return u=u+(r?n:"")},t.prototype.addLineColumn=function(t,i){var r={line:-1,col:-1};return n.getSourceLineColFromMap(r,i,t.locationInfo.lineMap),r.col!==-1&&r.col++,"("+r.line+", "+r.col+")"},t}();n.AstLogger=t}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.checker=n}return t.prototype.resolveBaseTypeLinks=function(n,t){var u=null,i,f,r;if(n)for(u=[],i=0,f=n.length;i<f;i++)r=n[i],this.checker.resolvingBases=!0,this.checker.resolveTypeLink(t,r,!0),this.checker.resolvingBases=!1,u[i]=r.type.isClass()?r.type.instanceType:r.type;return u},t.prototype.resolveBases=function(n,t){var u,f;t.extendsList=this.resolveBaseTypeLinks(t.extendsTypeLinks,n);for(var i=0,r=t.extendsList.length,e=t.isClassInstance();i<r;i++)u=t.extendsList[i].isClassInstance(),t.extendsList[i]!=this.checker.anyType&&(e?u||this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A export class may only extend other classes, "+t.extendsList[i].symbol.fullName()+" is an interface."):u&&this.checker.errorReporter.simpleErrorFromSym(t.symbol,"An interface may only extend other interfaces, "+t.extendsList[i].symbol.fullName()+" is a class."));if(t.implementsList=this.resolveBaseTypeLinks(t.implementsTypeLinks,n),t.implementsList)for(i=0,r=t.implementsList.length;i<r;i++)f=t.implementsList[i],f.isClassInstance()&&e&&this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A class may only implement an interface; "+f.symbol.fullName()+" is a class.")},t.prototype.resolveSignatureGroup=function(n,t,i){for(var h=!n.hasImplementation,r,e,o,u,f=0,s=n.signatures.length;f<s;f++){for(r=n.signatures[f],i?r.returnType.type=i:this.checker.resolveTypeLink(t,r.returnType,h),e=r.parameters.length,o=0;o<e;o++)this.bindSymbol(t,r.parameters[o]);r.hasVariableArgList&&(u=r.parameters[e-1],u.argsOffset=e-1,u.getType().isArray()||(this.checker.errorReporter.simpleErrorFromSym(u,"... parameter must have array type"),u.parameter.typeLink.type=this.checker.makeArrayType(u.parameter.typeLink.type)))}},t.prototype.bindType=function(t,i,r){if(r&&this.bindType(t,r,null),i.hasMembers()){var s=i.members,f=i.ambientMembers,e=i.getAllEnclosedTypes(),o=i.getAllAmbientEnclosedTypes(),h=new n.SymbolTableScope(s,f,e,o,i.symbol),u=new n.SymbolAggregateScope(i.symbol),c=this.checker.currentModDecl,l=this.checker.inBind;u.addParentScope(h),u.addParentScope(t),i.isModuleType()&&(this.checker.currentModDecl=i.symbol.declAST,this.checker.inBind=!0),s&&this.bind(u,i.members.allMembers),e&&this.bind(u,e.allMembers),f&&this.bind(u,f.allMembers),o&&this.bind(u,o.allMembers),this.checker.currentModDecl=c,this.checker.inBind=l}i.extendsTypeLinks&&this.resolveBases(t,i),i.construct&&this.resolveSignatureGroup(i.construct,t,r),i.call&&this.resolveSignatureGroup(i.call,t,null),i.index&&this.resolveSignatureGroup(i.index,t,null),i.elementType&&this.bindType(t,i.elementType,null)},t.prototype.bindSymbol=function(t,i){var e,r,o,f,u;if(!i.bound){e=this.checker.locationInfo,this.checker.units&&i.unitIndex>=0&&i.unitIndex<this.checker.units.length&&(this.checker.locationInfo=this.checker.units[i.unitIndex]);switch(i.kind()){case n.SymbolKind.Type:if(i.flags&n.SymbolFlags.Bound)break;if(r=i,r.flags|=n.SymbolFlags.Bound,r.aliasLink&&!r.type&&r.aliasLink.alias.nodeType==n.NodeType.Name&&(o=r.aliasLink.alias.text,f=this.checker.findSymbolForDynamicModule(o,this.checker.locationInfo.filename,function(n){return t.find(n,!1,!0)}),f&&(r.type=f.getType())),r.type&&r.type!=this.checker.gloModType&&(this.bindType(t,r.type,r.instanceType),r.type.isModuleType()))for(u=0;u<r.expansions.length;u++)this.bindType(t,r.expansions[u],r.instanceType);break;case n.SymbolKind.Field:this.checker.resolveTypeLink(t,i.field.typeLink,!1);break;case n.SymbolKind.Parameter:this.checker.resolveTypeLink(t,i.parameter.typeLink,!0)}this.checker.locationInfo=e}i.bound=!0},t.prototype.bind=function(n,t){t.map(function(t,i,r){r.bindSymbol(n,i)},this)},t}();n.Binder=t}(TypeScript||(TypeScript={})),function(n){var t=function(){function n(){}return n.encodedValues="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n.encode=function(t){if(t<64)return n.encodedValues.charAt(t);throw TypeError(t+": not a 64 based value");},n.decodeChar=function(t){if(t.length===1)return n.encodedValues.indexOf(t);throw TypeError('"'+t+'" must have length 1');},n}(),i=function(){function n(){}return n.encode=function(n){var i,r;n=n<0?(-n<<1)+1:n<<1,i="";do r=n&31,n=n>>5,n>0&&(r=r|32),i=i+t.encode(r);while(n>0);return i},n.decode=function(n){for(var r=0,f=!1,e=0,u,i=0;i<n.length;i++)if(u=t.decodeChar(n[i]),i===0?((u&1)==1&&(f=!0),r=u>>1&15):r=r|(u&31)<<e,e+=i==0?4:5,(u&32)!=32)return{value:f?-r:r,rest:n.substr(i+1)};throw new Error('Base64 value "'+n+'" finished with a continuation bit');},n}();n.Base64VLQFormat=i}(TypeScript||(TypeScript={})),function(n){var i=function(){function n(){this.parent=-1,this.firstChild=-1}return n}(),t;n.SourceMapping=i,t=function(){function t(t,i,r,u){this.jsFile=r,this.sourceMapOut=u,this.sourceMappings=[],this.currentMapping=-1,this.jsFileName=n.getPrettyName(i,!1,!0),this.tsFileName=n.getPrettyName(t,!1,!0)}return t.MapFileExtension=".map",t.CanEmitMapping=function(n,t){if(t.firstChild!==-1){var i=n[t.firstChild];if(i.emittedStartLine===t.emittedStartLine&&i.emittedStartColumn===t.emittedStartColumn)return!1}return!0},t.EmitSourceMapping=function(i){var e=i[0],o,y,s,h,w,u;e.jsFile.WriteLine("//@ sourceMappingURL="+e.jsFileName+t.MapFileExtension);var f=e.sourceMapOut,r="",c=[],l=0,a=0,p=0,k=0,b=0,v=!1;for(o=0;o<i.length;o++)if(e=i[o],e.sourceMappings)for(y=c.length,c.push(e.tsFileName),s=e.sourceMappings,h=0,w=s.length;h<w;h++)if(u=s[h],t.CanEmitMapping(s,u)){if(a!==u.emittedStartLine){while(a<u.emittedStartLine)l=0,r=r+";",a++;v=!1}else v&&(r=r+",");r=r+n.Base64VLQFormat.encode(u.emittedStartColumn-l),l=u.emittedStartColumn,r=r+n.Base64VLQFormat.encode(y-b),b=y,r=r+n.Base64VLQFormat.encode(u.sourceStartLine-1-k),k=u.sourceStartLine-1,r=r+n.Base64VLQFormat.encode(u.sourceStartColumn-p),p=u.sourceStartColumn,v=!0}r!=""&&(f.Write("{"),f.Write('"version":3,'),f.Write('"file":"'+e.jsFileName+'",'),f.Write('"sources":["'+c.join('","')+'"],'),f.Write('"names":[],'),f.Write('"mappings":"'+r),f.Write('"'),f.Write("}")),f.Close()},t}(),n.SourceMapper=t}(TypeScript||(TypeScript={})),function(n){var t,i,r;(function(n){n._map=[],n._map[0]="Prog",n.Prog=0,n._map[1]="Module",n.Module=1,n._map[2]="DynamicModule",n.DynamicModule=2,n._map[3]="Class",n.Class=3,n._map[4]="Constructor",n.Constructor=4,n._map[5]="Function",n.Function=5,n._map[6]="Args",n.Args=6,n._map[7]="Interface",n.Interface=7})(n.EmitContainer||(n.EmitContainer={})),t=n.EmitContainer,i=function(){function n(){this.indentAmt=0,this.column=0,this.line=0,this.pretty=!1,this.inObjectLiteral=!1,this.container=t.Prog}return n}(),n.EmitState=i,r=function(){function r(n,t,r){this.checker=n,this.outfile=t,this.emitOptions=r,this.prologueEmitted=!1,this.indentStep=4,this.thisClassNode=null,this.thisFnc=null,this.moduleDeclList=[],this.moduleName="",this.emitState=new i,this.indentStrings=[],this.ambientModule=!1,this.modAliasId=null,this.firstModAlias=null,this.allSourceMappers=[],this.sourceMapper=null,this.declDottedModuleName=!1,this.declIndentDelta=0,this.declFile=null,this.declContainingAST=null}return r.prototype.canWriteDeclFile=function(){return this.declFile!=null},r.prototype.setSourceMappings=function(n){this.allSourceMappers.push(n),this.sourceMapper=n},r.prototype.setDeclarationFile=function(n){this.declFile=n},r.prototype.increaseIndent=function(){this.emitState.indentAmt+=this.indentStep,this.declDottedModuleName&&this.addDeclIndentDelta()},r.prototype.decreaseIndent=function(){this.emitState.indentAmt-=this.indentStep},r.prototype.addDeclIndentDelta=function(){this.declIndentDelta+=this.indentStep},r.prototype.reduceDeclIndentDelta=function(){this.declIndentDelta-=this.indentStep},r.prototype.writeToOutput=function(n){this.outfile.Write(n),this.emitState.column+=n.length},r.prototype.writeToOutputTrimmable=function(n){this.emitOptions.minWhitespace&&(n=n.replace(/[\s]*/g,"")),this.writeToOutput(n)},r.prototype.writeLineToOutput=function(t){if(this.emitOptions.minWhitespace){this.writeToOutput(t);var i=t.charCodeAt(t.length-1);i==n.LexCodeSpace||i==n.LexCodeSMC||i==n.LexCodeLBR||this.writeToOutput(" ")}else this.outfile.WriteLine(t),this.emitState.column=0,this.emitState.line++},r.prototype.setInObjectLiteral=function(n){var t=this.emitState.inObjectLiteral;return this.emitState.inObjectLiteral=n,t},r.prototype.setContainer=function(n){var t=this.emitState.container;return this.emitState.container=n,t},r.prototype.setDeclContainingAST=function(n){var t=this.declContainingAST;return this.declContainingAST=n,t},r.prototype.getIndentString=function(n){var i,t,r;if(typeof n=="undefined"&&(n=!1),this.emitOptions.minWhitespace)return"";if(i=this.emitState.indentAmt-(n?this.declIndentDelta:0),t=this.indentStrings[i],t===undefined){for(t="",r=0;r<i;r++)t+=" ";this.indentStrings[i]=t}return t},r.prototype.emitIndent=function(){this.writeToOutput(this.getIndentString())},r.prototype.emitIndentToDeclFile=function(){this.declFile.Write(this.getIndentString(!0))},r.prototype.emitCommentInPlace=function(n){var t,i,r;if(this.recordSourceMappingStart(n),t=n.getText(),i=!1,n.isBlockComment){if(this.emitState.column==0&&this.emitIndent(),this.writeToOutput(t[0]),t.length>1||n.endsLine){for(this.writeLineToOutput(""),r=1;r<t.length;r++)this.emitIndent(),this.writeLineToOutput(t[r]);i=!0}}else this.emitState.column==0&&this.emitIndent(),this.writeLineToOutput(t[0]),i=!0;i?this.emitIndent():this.writeToOutput(" "),this.recordSourceMappingEnd(n)},r.prototype.emitParensAndCommentsInPlace=function(n,t){var i=t?n.preComments:n.postComments,r;if(n.isParenthesized&&!t&&this.writeToOutput(")"),this.emitOptions.emitComments&&i&&i.length!=0)for(r=0;r<i.length;r++)this.emitCommentInPlace(i[r]);n.isParenthesized&&t&&this.writeToOutput("(")},r.prototype.emitObjectLiteral=function(t){this.writeLineToOutput("{"),this.increaseIndent();var i=this.setInObjectLiteral(!0);this.emitJavascriptList(t,",",n.TokenID.Comma,!0,!1,!1),this.setInObjectLiteral(i),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")},r.prototype.emitArrayLiteral=function(t){this.writeToOutput("["),t&&(this.writeLineToOutput(""),this.increaseIndent(),this.emitJavascriptList(t,", ",n.TokenID.Comma,!0,!1,!1),this.decreaseIndent(),this.emitIndent()),this.writeToOutput("]")},r.prototype.emitNew=function(t,i){this.recordSourceMappingStart(t),this.writeToOutput("new "),t.nodeType==n.NodeType.TypeRef?this.writeToOutput("Array()"):(this.emitJavascript(t,n.TokenID.Tilde,!1),this.writeToOutput("("),this.emitJavascriptList(i,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput(")")),this.recordSourceMappingEnd(t)},r.prototype.tryEmitConstant=function(t){var i,r,f,u;return this.emitOptions.propagateConstants?(i=t.operand2,i&&i.sym&&i.sym.isVariable()&&n.hasFlag(i.sym.flags,n.SymbolFlags.Constant)&&i.sym.declAST&&(r=i.sym.declAST,r.init&&r.init.nodeType==n.NodeType.NumberLit))?(f=r.init,this.writeToOutput(f.value.toString()),u=" /* ",u+=i.text,u+=" */ ",this.writeToOutput(u),!0):!1:!1},r.prototype.emitCall=function(t,i,r){if(!this.emitSuperCall(t))if(n.hasFlag(t.flags,n.ASTFlags.ClassBaseConstructorCall)){this.decreaseIndent(),this.decreaseIndent();var u=new n.ASTList;u.members[0]=t,this.emitConstructorCalls(u,this.thisClassNode),this.increaseIndent(),this.increaseIndent()}else i.nodeType!=n.NodeType.FuncDecl||i.isParenthesized||this.writeToOutput("("),this.emitJavascript(i,n.TokenID.LParen,!1),i.nodeType!=n.NodeType.FuncDecl||i.isParenthesized||this.writeToOutput(")"),this.writeToOutput("("),this.emitJavascriptList(r,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput(")")},r.prototype.defaultValue=function(n){return n==this.checker.anyType?"undefined":n==this.checker.numberType?"0":n==this.checker.stringType?'""':n==this.checker.booleanType?"false":"null"},r.prototype.emitConstructorCalls=function(t,i){var o,f,r,u,s,e;if(t!=null){for(o=t.members.length,this.recordSourceMappingStart(i),f=0;f<o;f++)r=t.members[f],u=null,u=r.nodeType==n.NodeType.Call?r.target.type.symbol:r.type.symbol,s=u.name,u.declModule!=i.type.symbol.declModule&&(s=u.fullName()),r.nodeType==n.NodeType.Call?(this.emitIndent(),this.writeToOutput("_super.call(this"),e=r.args,e&&e.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(e,", ",n.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")")):r.type&&r.type.isClassInstance()&&(this.emitIndent(),this.writeToOutput(i.name.text+"._super.constructor"),this.writeToOutput(".call(this)"));this.recordSourceMappingEnd(i)}},r.prototype.emitInnerFunction=function(i,r,u,f,e,o,s,h){var g,rt,b,tt,l,y,ft,k,w,p,c,a,ut,it;typeof s=="undefined"&&(s=!1),typeof h=="undefined"&&(h=this.emitState.container);var et=i.isConstructor&&n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod),ot=et&&n.hasFlag(this.thisClassNode.type.instanceType.typeFlags,n.TypeFlags.HasBaseType)&&!n.hasFlag(this.thisClassNode.type.instanceType.typeFlags,n.TypeFlags.HasBaseTypeOfObject),d=ot&&n.hasFlag(this.thisClassNode.varFlags,n.VarFlags.ClassSuperMustBeFirstCallInConstructor);this.emitParensAndCommentsInPlace(i,!0),this.recordSourceMappingStart(i),i.isAccessor()&&i.accessorSymbol.isObjectLitField||this.writeToOutput("function "),r&&(g=i.getNameText(),g&&!i.isAccessor()&&this.writeToOutput(g)),this.writeToOutput("("),s&&(s=this.emitFuncSignatureIdentifier(i,!1,h));var v=0,c=0,l,nt=[];if(i.args){for(rt=this.setContainer(t.Args),v=i.args.members.length,b=v,i.variableArgList&&b--,c=0;c<b;c++)l=i.args.members[c],l.init&&nt.push(l),this.emitJavascript(l,n.TokenID.LParen,!1,s),c<b-1&&(this.writeToOutput(", "),s&&this.declFile.Write(", "));this.setContainer(rt)}for(this.writeLineToOutput(") {"),tt=null,s&&(this.emitFuncSignatureVariableArg(i),i.hasStaticDeclarations()&&(tt=this.setDeclContainingAST(i))),this.increaseIndent(),c=0;c<nt.length;c++)l=nt[c],this.emitIndent(),this.recordSourceMappingStart(l),this.writeToOutput("if (typeof "+l.id.text+' === "undefined") { '),this.recordSourceMappingStart(l.id),this.writeToOutput(l.id.text),this.recordSourceMappingEnd(l.id),this.writeToOutput(" = "),this.emitJavascript(l.init,n.TokenID.LParen,!1),this.writeLineToOutput("; }"),this.recordSourceMappingEnd(l);if(i.isConstructor&&!d){if(i.args)for(v=i.args.members.length,c=0;c<v;c++)l=i.args.members[c],(l.varFlags&n.VarFlags.Property)!=n.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(l),this.recordSourceMappingStart(l.id),this.writeToOutput("this."+l.id.text),this.recordSourceMappingEnd(l.id),this.writeToOutput(" = "),this.recordSourceMappingStart(l.id),this.writeToOutput(l.id.text),this.recordSourceMappingEnd(l.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(l));n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod)||this.emitConstructorCalls(f,o)}if(e&&(this.emitIndent(),this.writeLineToOutput("var _this = this;")),i.variableArgList&&(v=i.args.members.length,y=i.args.members[v-1],this.emitIndent(),this.recordSourceMappingStart(y),this.writeToOutput("var "),this.recordSourceMappingStart(y.id),this.writeToOutput(y.id.text),this.recordSourceMappingEnd(y.id),this.writeLineToOutput(" = [];"),this.recordSourceMappingEnd(y),this.emitIndent(),this.writeLineToOutput("for (var _i = 0; _i < (arguments.length - "+(v-1)+"); _i++) {"),this.increaseIndent(),this.emitIndent(),this.writeLineToOutput(y.id.text+"[_i] = arguments[_i + "+(v-1)+"];"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")),i.isConstructor&&n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod)&&!d)for(ft=this.thisClassNode.members.members.length,c=0;c<ft;c++)this.thisClassNode.members.members[c].nodeType==n.NodeType.VarDecl&&(k=this.thisClassNode.members.members[c],!n.hasFlag(k.varFlags,n.VarFlags.Static)&&k.init&&(this.emitIndent(),this.emitJavascriptVarDecl(k,n.TokenID.Tilde),this.writeLineToOutput("")));if(this.emitBareJavascriptStatements(i.bod,d),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}"),!u&&!n.hasFlag(i.fncFlags,n.FncFlags.IsFunctionExpression)&&(n.hasFlag(i.fncFlags,n.FncFlags.Definition)||i.isConstructor)&&this.writeLineToOutput(""),i.hasStaticDeclarations()){for(this.writeLineToOutput(""),this.emitIndent(),w=i.getNameText(),this.writeLineToOutput("(function ("+w+") {"),this.increaseIndent(),p=0,c=0,p=i.innerStaticFuncs.length,c=0;c<p;c++){if(a=i.innerStaticFuncs[c],a.isOverload){s&&this.emitFuncSignature(a);continue}this.emitIndent(),a.isAccessor()?this.emitPropertyAccessor(a,i.name.text,!1,s):(this.writeToOutput(w+"."+a.name.text+" = "),this.emitInnerFunction(a,a.name&&!a.name.isMissing(),!1,null,a.hasSelfReference(),null,s))}if(i.statics){for(this.recordSourceMappingStart(i.statics),p=i.statics.members.length,c=0;c<p;c++)this.emitIndent(),this.writeToOutput(w),this.emitJavascript(i.statics.members[c],n.TokenID.Tilde,!1,s),this.writeLineToOutput("");this.recordSourceMappingEnd(i.statics)}this.decreaseIndent(),this.emitIndent(),ut=u&&this.thisClassNode,it=ut?this.thisClassNode.name.text+".prototype.":"",this.writeLineToOutput("})("+it+w+");"),s&&(this.setDeclContainingAST(tt),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))}this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1)},r.prototype.emitArgDecl=function(n){this.declFile.Write(n.id.text),n.isOptionalArg()&&this.declFile.Write("?"),(n.typeExpr||n.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(n.type)&&this.declFile.Write(": "+this.getTypeSignature(n.type))},r.prototype.emitFuncSignatureIdentifier=function(t,i,r){if(typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=this.emitState.container),!i&&!t.isOverload)if(t.isConstructor){if(t.type.construct.signatures.length>1)return!1}else if(t.type.call.signatures.length>1)return!1;if(!this.canEmitSignature(n.ToDeclFlags(t.fncFlags),r))return!1;if(t.isConstructor)this.emitIndentToDeclFile(),this.declFile.Write("constructor ");else{var u=t.getNameText();i?(this.emitIndentToDeclFile(),t.isConstructMember()?this.declFile.Write("new"):t.isCallMember()||t.isIndexerMember()||(this.declFile.Write(u),n.hasFlag(t.name.flags,n.ASTFlags.OptionalName)&&this.declFile.Write("? "))):(this.emitDeclFlags(n.ToDeclFlags(t.fncFlags),"function"),this.declFile.Write(u))}return t.isIndexerMember()?this.declFile.Write("["):this.declFile.Write("("),!0},r.prototype.emitFuncSignatureVariableArg=function(n){if(n.variableArgList){var t=n.args.members[n.args.members.length-1];n.args.members.length>1?this.declFile.Write(", ..."):this.declFile.Write("..."),this.emitArgDecl(t)}n.isIndexerMember()?this.declFile.Write("]"):this.declFile.Write(")"),!n.isConstructor&&(n.returnTypeAnnotation||n.signature.returnType.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(n.signature.returnType.type)&&this.declFile.Write(": "+this.getTypeSignature(n.signature.returnType.type)),n.hasStaticDeclarations()?this.declFile.WriteLine(" {"):this.declFile.WriteLine(";")},r.prototype.emitFuncSignature=function(n,t){var u,r,i,f;if(typeof t=="undefined"&&(t=!1),u=this.emitFuncSignatureIdentifier(n,t),u){if(n.args)for(r=n.args.members.length,n.variableArgList&&r--,i=0;i<r;i++)f=n.args.members[i],this.emitArgDecl(f),i<r-1&&this.declFile.Write(", ");this.emitFuncSignatureVariableArg(n)}},r.prototype.emitPropertyAccessorSignature=function(t){var i=t.accessorSymbol;this.emitDeclFlags(n.ToDeclFlags(i.flags),"var"),this.declFile.WriteLine(t.name.text+" : "+this.getTypeSignature(i.getType())+";")},r.prototype.emitDeclFlags=function(t,i){this.emitIndentToDeclFile();var r="";n.hasFlag(t,n.DeclFlags.GetAccessor)?r="get ":n.hasFlag(t,n.DeclFlags.SetAccessor)&&(r="set "),n.hasFlag(t,n.DeclFlags.Exported)&&this.declFile.Write("export "),n.hasFlag(t,n.DeclFlags.LocalStatic)||n.hasFlag(t,n.DeclFlags.Static)?this.declFile.Write("static "+r):n.hasFlag(t,n.DeclFlags.Private)?this.declFile.Write("private "+r):n.hasFlag(t,n.DeclFlags.Public)?this.declFile.Write("public "+r):r==""?this.declFile.Write(i+" "):this.declFile.Write(r)},r.prototype.canEmitTypeAnnotationSignature=function(t,i){if(typeof i=="undefined"&&(i=n.DeclFlags.None),t==null)return!1;if(t.primitiveTypeClass==n.Primitive.None&&t.symbol&&t.symbol.container!=undefined&&t.symbol.container!=this.checker.gloMod){if(n.hasFlag(i,n.DeclFlags.Private))return!1;if(n.hasFlag(t.symbol.container.flags,n.SymbolFlags.Exported))return!0;if(t.symbol.declAST)switch(t.symbol.declAST.nodeType){case n.NodeType.Module:if(!n.hasFlag(t.symbol.declAST.modFlags,n.ModuleFlags.Exported))return!1;break;case n.NodeType.Class:if(!n.hasFlag(t.symbol.declAST.varFlags,n.VarFlags.Exported))return!1;break;case n.NodeType.Interface:if(!n.hasFlag(t.symbol.declAST.varFlags,n.VarFlags.Exported))return!1;break;case n.NodeType.FuncDecl:if(!n.hasFlag(t.symbol.declAST.fncFlags,n.FncFlags.Exported))return!1;break;default:throw Error("Catch this unhandled type container");}}return!0},r.prototype.getTypeSignature=function(t){var i=null,r;if(this.declContainingAST)switch(this.declContainingAST.nodeType){case n.NodeType.Module:case n.NodeType.Interface:case n.NodeType.FuncDecl:this.declContainingAST.type&&(i=this.declContainingAST.type.containedScope);break;case n.NodeType.Script:r=this.declContainingAST,r.bod&&(i=r.bod.enclosingScope);break;case n.NodeType.Class:this.declContainingAST.type&&(i=this.declContainingAST.type.instanceType.containedScope);break;default:throw Error("Unknown containing scope");}return t.getScopedTypeName(i)},r.prototype.canEmitSignature=function(i,r){return(typeof r=="undefined"&&(r=this.emitState.container),r==t.Module&&!n.hasFlag(i,n.DeclFlags.Exported))?!1:!0},r.prototype.emitVarSignature=function(t,i){var r,u;typeof i=="undefined"&&(i=!1),this.canEmitSignature(n.ToDeclFlags(t.varFlags))&&(i?(this.emitIndentToDeclFile(),this.declFile.Write(t.id.text),n.hasFlag(t.id.flags,n.ASTFlags.OptionalName)&&this.declFile.Write("?")):(this.emitDeclFlags(n.ToDeclFlags(t.varFlags),"var"),this.declFile.Write(t.id.text)),r=null,t.typeExpr&&t.typeExpr.type?r=t.typeExpr.type:t.sym&&(r=t.sym.getType(),r==this.checker.anyType&&(r=null)),this.canEmitTypeAnnotationSignature(r,n.ToDeclFlags(t.varFlags))?(u=this.getTypeSignature(r),this.declFile.WriteLine(": "+u+";")):this.declFile.WriteLine(";"))},r.prototype.emitBaseList=function(n,t){var r,i;if(n&&n.members.length>0)for(this.declFile.Write(" "+t+" "),r=n.members.length,i=0;i<r;i++){var u=n.members[i],o=u.type.symbol,f=u.type,e=this.getTypeSignature(f);i>0&&this.declFile.Write(", "),this.declFile.Write(e)}},r.prototype.emitClassSignatureIdentifierAndHeritage=function(t){if(!this.canEmitSignature(n.ToDeclFlags(t.varFlags)))return!1;var i=t.name.text;return this.emitDeclFlags(n.ToDeclFlags(t.varFlags),"class"),this.declFile.Write(i),this.emitBaseList(t.baseClass,"extends"),this.emitBaseList(t.implementsList,"implements"),this.declFile.WriteLine(" {"),!0},r.prototype.emitClassSignatureClassBodyOfAmbientClass=function(t){for(var f=t.definitionMembers.members.length,i,u,r=0;r<f;r++)if(i=t.definitionMembers.members[r],i.nodeType==n.NodeType.FuncDecl)u=i,u.isAccessor()||this.emitFuncSignature(u);else if(i.nodeType==n.NodeType.VarDecl)this.emitVarSignature(i);else throw Error("We want to catch this");},r.prototype.emitMembersFromConstructorDefinition=function(t){var u,r,i;if(t.args)for(u=t.args.members.length,t.variableArgList&&u--,r=0;r<u;r++)i=t.args.members[r],n.hasFlag(i.varFlags,n.VarFlags.Property)&&(this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"var"),this.declFile.Write(i.id.text),i.typeExpr&&this.declFile.Write(": "+this.getTypeSignature(i.type)),this.declFile.WriteLine(";"))},r.prototype.emitClassSignature=function(n){var i=this.emitClassSignatureIdentifierAndHeritage(n),t;i&&(t=this.setDeclContainingAST(n),this.increaseIndent(),this.emitClassSignatureClassBodyOfAmbientClass(n),this.decreaseIndent(),this.setDeclContainingAST(t),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))},r.prototype.emitImportDecl=function(t){this.canEmitSignature(n.ToDeclFlags(t.varFlags))&&(this.emitDeclFlags(n.ToDeclFlags(t.varFlags),"import"),this.declFile.Write(t.id.text+" = "),t.isDynamicImport?this.declFile.WriteLine("module ("+t.getAliasName()+");"):this.declFile.WriteLine(t.getAliasName()+";"))},r.prototype.emitModuleIdentification=function(t){return this.canEmitSignature(n.ToDeclFlags(t.modFlags))?(this.declDottedModuleName?this.declFile.Write("."):this.emitDeclFlags(n.ToDeclFlags(t.modFlags),"module"),this.declFile.Write(t.name.text),t.members.members.length==1&&t.members.members[0].nodeType==n.NodeType.Module&&!t.members.members[0].isEnum()&&n.hasFlag(t.members.members[0].modFlags,n.ModuleFlags.Exported)?this.declDottedModuleName=!0:(this.declDottedModuleName=!1,this.declFile.WriteLine(" {")),!0):!1},r.prototype.emitModuleBodyOfAmbientModule=function(t){for(var u=t.members.members.length,i,r=0;r<u;r++){i=t.members.members[r];switch(i.nodeType){case n.NodeType.VarDecl:this.emitVarSignature(i);break;case n.NodeType.FuncDecl:this.emitFuncSignature(i);break;case n.NodeType.Class:this.emitClassSignature(i);break;case n.NodeType.Interface:this.emitInterfaceDeclaration(i);break;case n.NodeType.Module:this.emitModuleSignature(i);break;case n.NodeType.Import:this.emitImportDecl(i);break;case n.NodeType.Empty:break;default:throw Error("We want to catch this");}}},r.prototype.emitModuleSignature=function(n){var i,r;if(n.isEnum())this.emitEnumSignature(n);else{var u=this.declIndentDelta,f=this.declDottedModuleName,e=this.emitModuleIdentification(n);e&&(i=this.setDeclContainingAST(n),this.increaseIndent(),r=this.setContainer(t.Module),this.emitModuleBodyOfAmbientModule(n),this.setContainer(r),this.decreaseIndent(),this.setDeclContainingAST(i),f||(this.declIndentDelta=u,this.emitIndentToDeclFile(),this.declFile.WriteLine("}")))}},r.prototype.emitEnumBodyOfAmbientEnum=function(t){for(var u=t.members.members.length,r,i=1;i<u;i++)if(r=t.members.members[i],r.nodeType==n.NodeType.VarDecl)this.emitIndentToDeclFile(),this.declFile.WriteLine(r.id.text+",");else if(r.nodeType!=n.NodeType.Asg)throw Error("We want to catch this");},r.prototype.emitEnumSignature=function(t){return this.canEmitSignature(n.ToDeclFlags(t.modFlags))?(this.emitDeclFlags(n.ToDeclFlags(t.modFlags),"enum"),this.declFile.WriteLine(t.name.text+" {"),this.increaseIndent(),this.emitEnumBodyOfAmbientEnum(t),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),!0):!1},r.prototype.emitInterfaceBody=function(t){for(var r,i=0;i<t.members.length;i++){r=t.members[i];switch(r.nodeType){case n.NodeType.FuncDecl:this.emitFuncSignature(r,!0);break;case n.NodeType.VarDecl:this.emitVarSignature(r,!0);break;default:throw Error("Not allowed");}}},r.prototype.emitInterfaceDeclaration=function(i){var r,u,f;this.canEmitSignature(n.ToDeclFlags(i.varFlags))&&(r=this.setContainer(t.Interface),u=i.name.text,this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"interface"),this.declFile.Write(u),this.emitBaseList(i.extendsList,"extends"),this.declFile.WriteLine(" {"),this.increaseIndent(),f=this.setDeclContainingAST(i),this.emitInterfaceBody(i.members),this.setDeclContainingAST(f),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),this.setContainer(r))},r.prototype.emitJavascriptModule=function(i,r){var e=i.name.text,a,u,v,y,b;if(n.isTSFile(e)?i.name.text=e.substring(0,e.length-3):n.isSTRFile(e)&&(i.name.text=e.substring(0,e.length-4)),n.hasFlag(i.modFlags,n.ModuleFlags.Ambient))r&&this.emitModuleSignature(i);else{var f=n.hasFlag(i.modFlags,n.ModuleFlags.IsDynamic),g=this.declIndentDelta,d=this.declDottedModuleName,p=null,k=this.outfile;r&&(f||(r=i.isEnum()?this.emitEnumSignature(i):this.emitModuleIdentification(i)),r&&(p=this.setDeclContainingAST(i)));var l=this.setContainer(t.Module),c=this.moduleName,h=n.hasFlag(i.modFlags,n.ModuleFlags.Exported);if(this.moduleDeclList[this.moduleDeclList.length]=i,this.moduleName=i.name.text,this.recordSourceMappingStart(i),f){if(a=n.stripQuotes(n.trimModName(i.name.text))+".js",this.emitOptions.createFile&&(a!=this.emitOptions.path?this.outfile=this.emitOptions.createFile(a):this.emitOptions.outputMany||this.checker.errorReporter.emitterError(i,"Module emit collides with emitted script: "+a)),this.setContainer(t.DynamicModule),n.moduleGenTarget==n.ModuleGenTarget.Asynchronous){var s='["require", "exports"',w="require, exports",o=null;for(u=0;u<i.mod.importedModules.length;u++)o=i.mod.importedModules[u],o.id.sym&&!o.id.sym.onlyReferencedAsTypeRef&&(u<=i.mod.importedModules.length-1&&(s+=", ",w+=", "),w+="__"+o.id.text+"__",s+=o.firstAliasedModToString());for(u=0;u<i.amdDependencies.length;u++)s+=', "'+i.amdDependencies[u]+'"';s+="]",this.writeLineToOutput("define("+s+", function("+w+") {")}}else h||(this.writeLineToOutput("var "+this.moduleName+";"),this.emitIndent()),this.writeLineToOutput("(function ("+this.moduleName+") {");f&&n.moduleGenTarget!=n.ModuleGenTarget.Asynchronous||(this.increaseIndent(),f&&this.addDeclIndentDelta()),this.emitJavascriptList(i.members,null,n.TokenID.SColon,!0,!1,!1,r&&!i.isEnum()),f&&n.moduleGenTarget!=n.ModuleGenTarget.Asynchronous||(this.decreaseIndent(),f&&this.reduceDeclIndentDelta()),this.emitIndent(),f?(r&&this.setDeclContainingAST(p),n.moduleGenTarget==n.ModuleGenTarget.Asynchronous&&this.writeLineToOutput("})"),this.outfile!=k&&(this.outfile.Close(),this.outfile=k)):(r&&(this.setDeclContainingAST(p),i.isEnum()||d||(this.declIndentDelta=g,this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))),v=null,i.type&&i.type.symbol.container&&i.type.symbol.container.declAST&&(v=i.type.symbol.container.declAST),y=v&&n.hasFlag(v.modFlags,n.ModuleFlags.IsDynamic),l==t.Prog&&h?this.writeLineToOutput("})(this."+this.moduleName+" || (this."+this.moduleName+" = {}));"):h||l==t.Prog?(b=c!=""?(y?"exports":c)+".":c,this.writeLineToOutput("})("+b+this.moduleName+" || ("+b+this.moduleName+" = {}));")):h||l==t.Prog?this.writeLineToOutput("})();"):this.writeLineToOutput("})("+this.moduleName+" || ("+this.moduleName+" = {}));"),l!=t.Prog&&!y&&h&&(this.emitIndent(),this.writeLineToOutput("var "+this.moduleName+" = "+c+"."+this.moduleName+";"))),this.recordSourceMappingEnd(i),this.setContainer(l),this.moduleName=c,this.moduleDeclList.length--}},r.prototype.emitIndex=function(t,i){var r=this.setInObjectLiteral(!1);this.emitJavascript(t,n.TokenID.Tilde,!1),this.writeToOutput("["),this.emitJavascriptList(i,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput("]"),this.setInObjectLiteral(r)},r.prototype.emitStringLiteral=function(n){this.writeToOutput(n)},r.prototype.emitJavascriptFunction=function(i,r){var u,s,h,c;if(n.hasFlag(i.fncFlags,n.FncFlags.Signature)||i.isOverload){r&&this.emitFuncSignature(i);return}s=this.thisFnc,this.thisFnc=i,u=i.isConstructor?this.setContainer(t.Constructor):this.setContainer(t.Function);var e=null,o=!1,f=i.getNameText();(this.emitState.inObjectLiteral||!i.isAccessor())&&(u!=t.Constructor||(i.fncFlags&n.FncFlags.Method)==n.FncFlags.None)&&(h=this.setInObjectLiteral(!1),this.thisClassNode&&(e=this.thisClassNode.extendsList),o=i.hasSelfReference(),this.recordSourceMappingStart(i),n.hasFlag(i.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)&&i.type.symbol.container==this.checker.gloMod&&!i.isConstructor?(this.writeToOutput("this."+f+" = "),this.emitInnerFunction(i,!1,!1,e,o,this.thisClassNode,r,u)):this.emitInnerFunction(i,i.name&&!i.name.isMissing(),!1,e,o,this.thisClassNode,r,u),this.recordSourceMappingEnd(i),this.setInObjectLiteral(h)),this.setContainer(u),this.thisFnc=s,n.hasFlag(i.fncFlags,n.FncFlags.Definition)&&(n.hasFlag(i.fncFlags,n.FncFlags.Static)?this.thisClassNode&&(i.isAccessor()?this.emitPropertyAccessor(i,this.thisClassNode.name.text,!1,!1):(this.emitIndent(),this.recordSourceMappingStart(i),this.writeLineToOutput(this.thisClassNode.name.text+"."+f+" = "+f+";"),this.recordSourceMappingEnd(i))):(this.emitState.container==t.Module||this.emitState.container==t.DynamicModule)&&n.hasFlag(i.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)&&(this.emitIndent(),c=this.emitState.container==t.Module?this.moduleName:"exports",this.recordSourceMappingStart(i),this.writeLineToOutput(c+"."+f+" = "+f+";"),this.recordSourceMappingEnd(i)))},r.prototype.emitAmbientVarDecl=function(t){t.init&&(this.emitParensAndCommentsInPlace(t,!0),this.recordSourceMappingStart(t),this.recordSourceMappingStart(t.id),this.writeToOutput(t.id.text),this.recordSourceMappingEnd(t.id),this.writeToOutput(" = "),this.emitJavascript(t.init,n.TokenID.Comma,!1),this.recordSourceMappingEnd(t),this.writeToOutput(";"),this.emitParensAndCommentsInPlace(t,!1))},r.prototype.emitForVarList=function(t){var r,i,u;if(t){for(this.recordSourceMappingStart(t),r=t.members.length,i=0;i<r;i++)u=t.members[i],this.emitJavascriptVarDecl(u,i==0?n.TokenID.FOR:n.TokenID.LParen),i<r-1&&this.writeToOutput(", ");this.recordSourceMappingEnd(t)}},r.prototype.emitJavascriptVarDecl=function(i,r,u){var f,o,e;typeof u=="undefined"&&(u=!1),(i.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient?this.emitAmbientVarDecl(i):(f=i.sym,o=i.init!=null,this.emitParensAndCommentsInPlace(i,!0),this.recordSourceMappingStart(i),f&&f.isMember()&&f.container&&f.container.kind()==n.SymbolKind.Type?(e=f.container.type,e.isClass()&&!n.hasFlag(f.flags,n.SymbolFlags.ModuleMember)?this.emitState.container!=t.Args&&(n.hasFlag(f.flags,n.SymbolFlags.Static)?this.writeToOutput(f.container.name+"."):this.writeToOutput("this.")):e.hasImplementation()?n.hasFlag(f.flags,n.SymbolFlags.Exported)||f.container!=this.checker.gloMod&&n.hasFlag(f.flags,n.SymbolFlags.Property)?n.hasFlag(i.varFlags,n.VarFlags.LocalStatic)?this.writeToOutput("."):this.emitState.container==t.DynamicModule?this.writeToOutput("exports."):this.writeToOutput(this.moduleName+"."):this.writeToOutput("var "):r!=n.TokenID.LParen&&(n.hasFlag(f.flags,n.SymbolFlags.Exported)&&f.container==this.checker.gloMod?this.writeToOutput("this."):this.writeToOutput("var "))):r!=n.TokenID.LParen&&this.writeToOutput("var "),this.recordSourceMappingStart(i.id),this.writeToOutput(i.id.text),this.recordSourceMappingEnd(i.id),o?(this.writeToOutputTrimmable(" = "),this.emitJavascript(i.init,n.TokenID.Comma,!1)):f&&f.isMember()&&this.emitState.container==t.Constructor&&(this.writeToOutputTrimmable(" = "),this.writeToOutput(this.defaultValue(i.type))),r!=n.TokenID.FOR&&r!=n.TokenID.LParen&&this.writeToOutputTrimmable(";"),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1)),u&&this.emitVarSignature(i)},r.prototype.declEnclosed=function(n){if(n==null)return!0;for(var t=0,i=this.moduleDeclList.length;t<i;t++)if(this.moduleDeclList[t]==n)return!0;return!1},r.prototype.emitJavascriptName=function(i,r){var u=i.sym,s,h,c,e,f,o;this.emitParensAndCommentsInPlace(i,!0),this.recordSourceMappingStart(i),i.isMissing()||(r&&this.emitState.container!=t.Args&&u&&(u.container&&u.container.name!=n.globalId?n.hasFlag(u.flags,n.SymbolFlags.Static)&&n.hasFlag(u.flags,n.SymbolFlags.Property)?u.declModule&&n.hasFlag(u.declModule.modFlags,n.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(u.container.name+"."):u.kind()==n.SymbolKind.Field?(s=u,n.hasFlag(s.flags,n.SymbolFlags.ModuleMember)?u.container!=this.checker.gloMod&&(n.hasFlag(u.flags,n.SymbolFlags.Property)||n.hasFlag(u.flags,n.SymbolFlags.Exported))&&(n.hasFlag(u.declModule.modFlags,n.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(u.container.name+".")):u.isInstanceProperty()&&(!this.thisFnc||this.thisFnc.isMethod()||this.thisFnc.isConstructor?this.writeToOutput("this."):this.writeToOutput("_this."))):u.kind()==n.SymbolKind.Type&&(u.isInstanceProperty()?(h=u,c=h.type,c.call&&!n.hasFlag(u.flags,n.SymbolFlags.ModuleMember)&&(!this.thisFnc||this.thisFnc.isMethod()||this.thisFnc.isConstructor?this.writeToOutput("this."):this.writeToOutput("_this."))):u.unitIndex==this.checker.locationInfo.unitIndex&&this.declEnclosed(u.declModule)||this.writeToOutput(u.container.name+".")):u.container!=this.checker.gloMod||!n.hasFlag(u.flags,n.SymbolFlags.Exported)||n.hasFlag(u.flags,n.SymbolFlags.Ambient)||(u.isType()||u.isMember())&&u.declModule&&n.hasFlag(u.declModule.modFlags,n.ModuleFlags.Ambient)||this.emitState.container!=t.Prog||u.declAST.nodeType==n.NodeType.FuncDecl||this.writeToOutput("this.")),u&&u.declAST&&u.declAST.nodeType==n.NodeType.Module&&n.hasFlag(u.declAST.modFlags,n.ModuleFlags.IsDynamic)?(e=u.declAST,n.moduleGenTarget==n.ModuleGenTarget.Asynchronous?this.writeLineToOutput("__"+this.modAliasId+"__;"):(f=i.text,o=e.mod.symbol.declAST&&n.hasFlag(e.mod.symbol.declAST.modFlags,n.ModuleFlags.Ambient),f=o?f:this.firstModAlias?this.firstModAlias:n.quoteBaseName(f),f=o?f:n.isRelative(n.stripQuotes(f))?f:n.quoteStr("./"+n.stripQuotes(f)),this.writeToOutput("require("+f+")"))):this.writeToOutput(i.text)),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1)},r.prototype.emitJavascriptStatements=function(t,i){var f,u;t?t.nodeType!=n.NodeType.Block?(f=t&&(t.nodeType!=n.NodeType.List||t.members.length>0),(i||f)&&(u=t.nodeType==n.NodeType.Block||t.nodeType==n.NodeType.List&&t.members.length==1&&t.members[0].nodeType==n.NodeType.Block,this.recordSourceMappingStart(t),u||(this.writeLineToOutput(" {"),this.increaseIndent()),this.emitJavascriptList(t,null,n.TokenID.SColon,!0,!1,!1),u||(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")),this.recordSourceMappingEnd(t))):this.emitJavascript(t,n.TokenID.SColon,!0):i&&this.writeToOutput("{ }")},r.prototype.emitBareJavascriptStatements=function(t,i){if(t.nodeType!=n.NodeType.Block)if(t.nodeType==n.NodeType.List){var r=t;r.members.length==2&&r.members[0].nodeType==n.NodeType.Block&&r.members[1].nodeType==n.NodeType.EndCode?(this.emitJavascript(r.members[0],n.TokenID.SColon,!0),this.writeLineToOutput("")):this.emitJavascriptList(t,null,n.TokenID.SColon,!0,!1,i)}else this.emitJavascript(t,n.TokenID.SColon,!0);else this.emitJavascript(t,n.TokenID.SColon,!0)},r.prototype.recordSourceMappingStart=function(t){var r,i,u;this.sourceMapper&&t&&(r={line:-1,col:-1},i=new n.SourceMapping(t),i.emittedStartColumn=this.emitState.column,i.emittedStartLine=this.emitState.line,n.getSourceLineColFromMap(r,t.minChar,this.checker.locationInfo.lineMap),i.sourceStartColumn=r.col,i.sourceStartLine=r.line,n.getSourceLineColFromMap(r,t.limChar,this.checker.locationInfo.lineMap),i.sourceEndColumn=r.col,i.sourceEndLine=r.line,i.parent=this.sourceMapper.currentMapping,this.sourceMapper.currentMapping=this.sourceMapper.sourceMappings.length,this.sourceMapper.sourceMappings.push(i),i.parent>=0&&(u=this.sourceMapper.sourceMappings[i.parent],u.firstChild==-1&&(u.firstChild=this.sourceMapper.currentMapping)))},r.prototype.recordSourceMappingEnd=function(n){if(this.sourceMapper&&n){var i=this.sourceMapper.currentMapping,t=this.sourceMapper.sourceMappings[i];t.emittedEndColumn=this.emitState.column,t.emittedEndLine=this.emitState.line,this.sourceMapper.currentMapping=t.parent}},r.prototype.emitSourceMappings=function(){n.SourceMapper.EmitSourceMapping(this.allSourceMappers)},r.prototype.emitJavascriptList=function(t,i,r,u,f,e,o){var y,w,c,l,k,v,h,d,a,p,s,b;if(t!=null)if(t.nodeType!=n.NodeType.List)this.emitJavascript(t,r,u,o);else{if(y=t,y.members.length==0)return;for(this.emitParensAndCommentsInPlace(t,!0),w=y.members.length,c=0;c<w;c++){if(c==1&&e){if(l=this.thisClassNode.constructorDecl,l&&l.args)for(k=l.args.members.length,v=0;v<k;v++)h=l.args.members[v],(h.varFlags&n.VarFlags.Property)!=n.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(h),this.recordSourceMappingStart(h.id),this.writeToOutput("this."+h.id.text),this.recordSourceMappingEnd(h.id),this.writeToOutput(" = "),this.recordSourceMappingStart(h.id),this.writeToOutput(h.id.text),this.recordSourceMappingEnd(h.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(h));for(d=this.thisClassNode.members.members.length,a=0;a<d;a++)this.thisClassNode.members.members[a].nodeType==n.NodeType.VarDecl&&(p=this.thisClassNode.members.members[a],!n.hasFlag(p.varFlags,n.VarFlags.Static)&&p.init&&(this.emitIndent(),this.emitJavascriptVarDecl(p,n.TokenID.Tilde),this.writeLineToOutput("")))}(s=y.members[c],b=s.nodeType==n.NodeType.FuncDecl&&n.hasFlag(s.fncFlags,n.FncFlags.Static)||s.nodeType==n.NodeType.VarDecl&&n.hasFlag(s.varFlags,n.VarFlags.Static),f?b:!b)&&(this.emitJavascript(s,r,u,o),i&&c<w-1?u?this.writeLineToOutput(i):this.writeToOutput(i):!u||s.nodeType==n.NodeType.Interface||s.nodeType==n.NodeType.VarDecl&&(s.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient&&s.init==null||s.nodeType==n.NodeType.EndCode||s.nodeType==n.NodeType.FuncDecl||this.writeLineToOutput(""))}this.emitParensAndCommentsInPlace(t,!1)}},r.prototype.emitJavascript=function(i,r,u,f){if(typeof f=="undefined"&&(f=!1),i!=null){var e=!1;u&&this.emitState.indentAmt>0&&i.nodeType!=n.NodeType.List&&i.nodeType!=n.NodeType.Block&&(i.nodeType==n.NodeType.Interface||i.nodeType==n.NodeType.VarDecl&&(i.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient&&i.init==null||i.nodeType==n.NodeType.EndCode||i.nodeType==n.NodeType.FuncDecl&&this.emitState.container==t.Constructor||this.emitIndent()),e&&this.writeToOutput("("),i.emit(this,r,u,f),e&&this.writeToOutput(")"),r==n.TokenID.SColon&&i.nodeType<n.NodeType.GeneralNode&&this.writeToOutput(";")}},r.prototype.emitPropertyAccessor=function(n,t,i,r){var u,f,e;n.accessorSymbol.hasBeenEmitted||(u=n.accessorSymbol,this.emitIndent(),this.recordSourceMappingStart(n),this.writeLineToOutput("Object.defineProperty("+t+(i?'.prototype, "':', "')+n.name.text+'", {'),this.increaseIndent(),u.getter&&(f=u.getter.declAST,this.emitIndent(),this.writeToOutput("get: "),this.emitInnerFunction(f,!1,i,null,n.hasSelfReference(),null),this.writeLineToOutput(",")),u.setter&&(e=u.setter.declAST,this.emitIndent(),this.writeToOutput("set: "),this.emitInnerFunction(e,!1,i,null,n.hasSelfReference(),null),this.writeLineToOutput(",")),this.emitIndent(),this.writeLineToOutput("enumerable: true,"),this.emitIndent(),this.writeLineToOutput("configurable: true"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("});"),this.recordSourceMappingEnd(n),r&&this.emitPropertyAccessorSignature(n),u.hasBeenEmitted=!0)},r.prototype.emitPrototypeMember=function(t,i,r){var f,u;t.nodeType==n.NodeType.FuncDecl?(f=t,f.isAccessor()?this.emitPropertyAccessor(f,i,!0,r):(this.emitIndent(),this.recordSourceMappingStart(f),this.writeToOutput(i+".prototype."+f.getNameText()+" = "),this.emitInnerFunction(f,!1,!0,null,f.hasSelfReference(),null,r),this.recordSourceMappingEnd(f),this.writeLineToOutput(";"))):t.nodeType==n.NodeType.VarDecl&&(u=t,u.init&&(this.emitIndent(),this.recordSourceMappingStart(u),this.recordSourceMappingStart(u.id),this.writeToOutput(i+".prototype."+u.id.text),this.recordSourceMappingEnd(u.id),this.writeToOutput(" = "),this.emitJavascript(u.init,n.TokenID.Asg,!1),this.recordSourceMappingEnd(u),this.writeLineToOutput(";")),r&&this.emitVarSignature(u))},r.prototype.emitAddBaseMethods=function(t,i,r){var u,e,f,o;if(i.members&&(u=i.symbol,e=u.name,u.declModule!=r.type.symbol.declModule&&(e=u.fullName()),i.members.allMembers.map(function(i,r){var f=r;f.kind()==n.SymbolKind.Type&&f.type.call&&(this.recordSourceMappingStart(f.declAST),this.writeLineToOutput(t+".prototype."+f.name+" = "+e+".prototype."+f.name+";"),this.recordSourceMappingEnd(f.declAST))},null)),i.extendsList)for(f=0,o=i.extendsList.length;f<o;f++)this.emitAddBaseMethods(t,i.extendsList[f],r)},r.prototype.emitJavascriptClass=function(i,r){var nt,o,b,h,w,g,tt,a,p,e,k,v,s,u,f,it;if(n.hasFlag(i.varFlags,n.VarFlags.Ambient))r&&this.emitClassSignature(i);else{nt=this.thisClassNode,e=0,this.thisClassNode=i,o=i.name.text,this.emitParensAndCommentsInPlace(i,!0),b=null,r&&(r=this.emitClassSignatureIdentifierAndHeritage(i),r&&(b=this.setDeclContainingAST(i))),h=this.setContainer(t.Class),this.recordSourceMappingStart(i),n.hasFlag(i.varFlags,n.VarFlags.Exported)&&i.type.symbol.container==this.checker.gloMod?this.writeToOutput("this."+o):this.writeToOutput("var "+o);var rt=i.type,l=rt.instanceType,y=l?l.baseClass():null,c=null,d=null;if(y?this.writeLineToOutput(" = (function (_super) {"):this.writeLineToOutput(" = (function () {"),this.increaseIndent(),y&&(c=i.extendsList.members[0],d=c.nodeType==n.NodeType.Call?c.target:c,this.emitIndent(),this.writeLineToOutput("__extends("+o+", _super);"),w=l.extendsList.length,w>1))for(e=1;e<w;e++)g=l.extendsList[e],this.emitAddBaseMethods(o,g,i);if(this.emitIndent(),tt=i.constructorDecl,tt)this.emitJavascript(i.constructorDecl,n.TokenID.LParen,!1,!1),r&&this.emitMembersFromConstructorDefinition(i.constructorDecl);else{for(a=0,this.recordSourceMappingStart(i),this.increaseIndent(),this.writeToOutput("function "+i.name.text+"() {"),y&&(this.writeLineToOutput(""),this.emitIndent(),this.writeLineToOutput("_super.apply(this, arguments);"),a++),p=this.thisClassNode.members.members,e=0;e<p.length;e++)p[e].nodeType==n.NodeType.VarDecl&&(f=p[e],!n.hasFlag(f.varFlags,n.VarFlags.Static)&&f.init&&(this.writeLineToOutput(""),this.emitIndent(),this.emitJavascriptVarDecl(f,n.TokenID.Tilde),a++));a?(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")):(this.writeLineToOutput(" }"),this.decreaseIndent()),this.recordSourceMappingEnd(i)}for(k=i.definitionMembers.members.length,v=0;v<k;v++)if(s=i.definitionMembers.members[v],s.nodeType==n.NodeType.FuncDecl)u=s,n.hasFlag(u.fncFlags,n.FncFlags.Method)&&!u.isSignature()?n.hasFlag(u.fncFlags,n.FncFlags.Static)?u.isAccessor()?this.emitPropertyAccessor(u,this.thisClassNode.name.text,!1,r):(this.emitIndent(),this.recordSourceMappingStart(u),this.writeToOutput(i.name.text+"."+u.name.text+" = "),this.emitInnerFunction(u,u.name&&!u.name.isMissing(),!1,null,u.hasSelfReference(),null,r),this.recordSourceMappingEnd(u)):this.emitPrototypeMember(u,o,r):r&&this.emitFuncSignature(u);else if(s.nodeType==n.NodeType.VarDecl)f=s,n.hasFlag(f.varFlags,n.VarFlags.Static)?(this.emitIndent(),this.recordSourceMappingStart(f),this.writeToOutput(i.name.text+"."+f.id.text+" = "),f.init?(this.emitJavascript(f.init,n.TokenID.Asg,!1),this.writeLineToOutput(";")):this.writeLineToOutput(this.defaultValue(f.type)+";"),r&&this.emitVarSignature(f),this.recordSourceMappingEnd(f)):r&&this.emitVarSignature(f);else throw Error("We want to catch this");this.emitIndent(),this.recordSourceMappingStart(i),this.writeLineToOutput("return "+o+";"),this.recordSourceMappingEnd(i),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("})("),y&&this.emitJavascript(d,n.TokenID.Tilde,!1),this.writeToOutput(");"),r&&(this.setDeclContainingAST(b),this.emitIndentToDeclFile(),this.declFile.WriteLine("}")),(h==t.Module||h==t.DynamicModule)&&n.hasFlag(i.varFlags,n.VarFlags.Exported)&&(this.writeLineToOutput(""),this.emitIndent(),it=h==t.Module?this.moduleName:"exports",this.recordSourceMappingStart(i),this.writeToOutput(it+"."+o+" = "+o+";"),this.recordSourceMappingEnd(i)),this.emitIndent(),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1),this.setContainer(h),this.thisClassNode=nt}},r.prototype.emitPrologue=function(n){this.prologueEmitted||n&&(this.prologueEmitted=!0,this.writeLineToOutput("var __extends = this.__extends || function (d, b) {"),this.writeLineToOutput("    function __() { this.constructor = d; }"),this.writeLineToOutput("    __.prototype = b.prototype;"),this.writeLineToOutput("    d.prototype = new __();"),this.writeLineToOutput("}"))},r.prototype.emitSuperReference=function(){this.writeToOutput("_super.prototype")},r.prototype.emitSuperCall=function(t){if(t.target.nodeType==n.NodeType.Dot){var i=t.target;if(i.operand1.nodeType==n.NodeType.Super)return this.emitJavascript(i,n.TokenID.LParen,!1),this.writeToOutput(".call(this"),t.args&&t.args.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(t.args,", ",n.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")"),!0}return!1},r}(),n.Emitter=r}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.outfile=n,this.parser=null,this.checker=null,this.lineCol={line:0,col:0},this.emitAsComments=!0,this.hasErrors=!1,this.pushToErrorSink=!1,this.errorSink=[]}return t.prototype.getCapturedErrors=function(){return this.errorSink},t.prototype.freeCapturedErrors=function(){this.errorSink=[]},t.prototype.captureError=function(n){this.errorSink[this.errorSink.length]=n},t.prototype.setErrOut=function(n){this.outfile=n,this.emitAsComments=!1},t.prototype.emitPrefix=function(){this.emitAsComments&&this.outfile.Write("// "),this.outfile.Write(this.checker.locationInfo.filename+"("+this.lineCol.line+","+this.lineCol.col+"): ")},t.prototype.writePrefix=function(n){n?this.setError(n):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},t.prototype.writePrefixFromSym=function(t){t&&this.checker.locationInfo.lineMap?n.getSourceLineColFromMap(this.lineCol,t.location,this.checker.locationInfo.lineMap):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},t.prototype.setError=function(t){t&&(t.flags|=n.ASTFlags.Error,this.checker.locationInfo.lineMap&&n.getSourceLineColFromMap(this.lineCol,t.minChar,this.checker.locationInfo.lineMap))},t.prototype.reportError=function(n,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=!0;var i=n.limChar-n.minChar;this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(n.minChar,i,t,this.checker.locationInfo.unitIndex):(this.writePrefix(n),this.outfile.WriteLine(t))},t.prototype.reportErrorFromSym=function(n,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=!0,this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(n.location,1,t,this.checker.locationInfo.unitIndex):(this.writePrefixFromSym(n),this.outfile.WriteLine(t))},t.prototype.emitterError=function(n,t){this.reportError(n,t);throw Error("EmitError");},t.prototype.duplicateIdentifier=function(n,t){this.reportError(n,"Duplicate identifier '"+t+"'")},t.prototype.showRef=function(n,t,i){var r={line:-1,col:-1};this.parser.getSourceLineCol(r,i.location),this.reportError(n,"symbol "+t+" defined at ("+r.line+","+r.col+")")},t.prototype.unresolvedSymbol=function(n,t){this.reportError(n,"The name '"+t+"' does not exist in the current scope")},t.prototype.symbolDoesNotReferToAValue=function(n,t){this.reportError(n,"The name '"+t+"' does not refer to a value")},t.prototype.styleError=function(n,t){var i=this.pushToErrorSink;this.pushToErrorSink=!1,this.reportError(n,"STYLE: "+t),this.pushToErrorSink=i},t.prototype.simpleError=function(n,t){this.reportError(n,t)},t.prototype.simpleErrorFromSym=function(n,t){this.reportErrorFromSym(n,t)},t.prototype.invalidSuperReference=function(n){this.simpleError(n,"Keyword 'super' can only be used inside a class instance method")},t.prototype.valueCannotBeModified=function(n){this.simpleError(n,"The left-hand side of an assignment expression must be a variable, property or indexer")},t.prototype.invalidCall=function(t,i,r){var u=t.target.type,f=u.getScopedTypeName(r),e;u.construct&&i==n.NodeType.Call?this.reportError(t,"Value of type '"+f+"' is not callable.  Did you mean to include 'new'?"):(e=i==n.NodeType.Call?"callable":"newable",this.reportError(t,"Value of type '"+f+"' is not "+e))},t.prototype.indexLHS=function(n,t){var i=n.operand1.type.getScopedTypeName(t),r=n.operand2.type.getScopedTypeName(t);this.simpleError(n,"Value of type '"+i+"' is not indexable by type '"+r+"'")},t.prototype.incompatibleTypes=function(n,t,i,r,u,f){t||(t=this.checker.anyType),i||(i=this.checker.anyType);var e=f?f.message:"";r?this.reportError(n,"Operator '"+r+"' cannot be applied to types '"+t.getScopedTypeName(u)+"' and '"+i.getScopedTypeName(u)+"'"+(e?": "+e:"")):this.reportError(n,"Cannot convert '"+t.getScopedTypeName(u)+"' to '"+i.getScopedTypeName(u)+"'"+(e?": "+e:""))},t.prototype.expectedClassOrInterface=function(n){this.simpleError(n,"Expected var, class, interface, or module")},t.prototype.unaryOperatorTypeError=function(n,t,i){this.reportError(n,"Operator '"+t+"' cannot be applied to type '"+i.getTypeName()+"'")},t}();n.ErrorReporter=t}(TypeScript||(TypeScript={})),function(n){function f(t,i,r,f,e,o){var h=r.getText(f,e),s,c,l;return t.log("Quick parse range ("+f+","+e+'): "'+n.stringToLiteral(h,100)+'"'),s=new u,s.setErrorRecovery(null,-1,-1),s.errorCallback=o,c=new n.TypeDecl(n.NodeType.Class,null,null,null,null,null),s.currentClassDecl=c,l=s.quickParse(new n.StringSourceText(h),"",0)}var t,i,r,u;(function(n){n._map=[],n.NoTypes=0,n.ArraySuffix=1,n.Primitive=2,n.Named=4,n.AllSimpleTypes=n.Primitive|n.Named,n.AllTypes=n.Primitive|n.Named|n.ArraySuffix})(n.TypeContext||(n.TypeContext={})),t=n.TypeContext,function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="StartScript",n.StartScript=1,n._map[2]="StartStmtList",n.StartStmtList=2,n._map[3]="StartStatement",n.StartStatement=3,n._map[4]="StartFncDecl",n.StartFncDecl=4,n._map[5]="FncDeclName",n.FncDeclName=5,n._map[6]="FncDeclArgs",n.FncDeclArgs=6,n._map[7]="FncDeclReturnType",n.FncDeclReturnType=7,n._map[8]="ForInit",n.ForInit=8,n._map[9]="ForInitAfterVar",n.ForInitAfterVar=9,n._map[10]="ForCondStart",n.ForCondStart=10,n._map[11]="EndStmtList",n.EndStmtList=11,n._map[12]="EndScript",n.EndScript=12}(n.ParseState||(n.ParseState={})),i=n.ParseState,r=function(){function n(n,t){this.Script=n,this.endLexState=t}return n}(),n.QuickParseResult=r,u=function(){function u(){this.varLists=[],this.scopeLists=[],this.staticsLists=[],this.scanner=new n.Scanner,this.tok=null,this.needTerminator=!1,this.inFnc=!1,this.inStaticFnc=!1,this.inInterfaceDecl=!1,this.currentClassDecl=null,this.inFncDecl=!1,this.anonId=new n.Identifier("_anonymous"),this.style_requireSemi=!1,this.style_funcInLoop=!0,this.incremental=!1,this.errorRecovery=!1,this.outfile=undefined,this.errorCallback=null,this.state=i.StartStmtList,this.cursorLine=-1,this.cursorColumn=-1,this.cursorState=i.None,this.errorMessage="",this.ambientModule=!1,this.ambientClass=!1,this.topLevel=!0,this.currentUnitIndex=-1,this.prevIDTok=null,this.stmtStack=[],this.hasTopLevelImportOrExport=!1,this.strictMode=!1,this.nestingLevel=0,this.prevExpr=null,this.currentClassDefinition=null,this.parsingClassConstructorDefinition=!1,this.parsingDeclareFile=!1,this.amdDependencies=[],this.inferPropertiesFromThisAssignment=!1,this.fname="",this.parseError=!1}return u.prototype.resetStmtStack=function(){this.stmtStack=[]},u.prototype.inLoop=function(){for(var n=this.stmtStack.length-1;n>=0;n--)if(this.stmtStack[n].stmt.isLoop())return!0;return!1},u.prototype.pushStmt=function(n,t){var i={stmt:n,labels:t};this.stmtStack.push(i)},u.prototype.popStmt=function(){return this.stmtStack.pop()},u.prototype.resolveJumpTarget=function(t){for(var o=this.stmtStack.length,i,u,f,e,r=o-1;r>=0;r--)if(i=this.stmtStack[r],t.target){if(i.labels&&i.labels.members.length>0)for(u=0,f=i.labels.members.length;u<f;u++)if(e=i.labels.members[u],e.id.text==t.target){t.setResolvedTarget(this,i.stmt);return}}else{if(i.stmt.isLoop()){t.setResolvedTarget(this,i.stmt);return}if(i.stmt.nodeType==n.NodeType.Switch&&t.nodeType==n.NodeType.Break){t.setResolvedTarget(this,i.stmt);return}}t.target?this.reportParseError("could not find enclosing statement with label "+t.target):t.nodeType==n.NodeType.Break?this.reportParseError("break statement requires enclosing loop or switch"):this.reportParseError("continue statement requires enclosing loop")},u.prototype.setNonInteractive=function(){this.errorRecovery=!1},u.prototype.setErrorRecovery=function(n,t,r){this.outfile=n,this.cursorLine=t,this.cursorColumn=r,this.cursorState=i.None,this.errorRecovery=!0},u.prototype.posMatchesCursor=function(n){var t={line:-1,col:-1};return this.getSourceLineCol(t,n),t.line==this.cursorLine&&t.col==this.cursorColumn},u.prototype.getSourceLineCol=function(t,i){n.getSourceLineColFromMap(t,i,this.scanner.lineMap)},u.prototype.createRef=function(t,i){var r=new n.Identifier(t);return r.minChar=i,r},u.prototype.reportParseStyleError=function(n){this.reportParseError("STYLE: "+n)},u.prototype.reportParseError=function(n,t,i){var u,r;if(typeof t=="undefined"&&(t=this.scanner.startPos),typeof i=="undefined"&&(i=this.scanner.pos),u=Math.max(1,i-t),this.errorCallback)this.errorCallback(t,u,n,this.currentUnitIndex);else if(this.errorRecovery)r={line:-1,col:-1},this.getSourceLineCol(r,t),this.outfile&&this.outfile.WriteLine("// "+this.fname+" ("+r.line+","+r.col+"): "+n);else throw new SyntaxError(this.fname+" ("+this.scanner.line+","+this.scanner.col+"): "+n);},u.prototype.chkNxtTok=function(n,t,i){this.tok=this.scanner.scan(),this.chkCurTok(n,t,i)},u.prototype.skip=function(t){var r,i,u;for(t|=n.ErrorRecoverySet.EOF,r=n.ErrorRecoverySet.None,i=n.lookupToken(this.tok.tokenId),i!=undefined&&(r=i.ers),u=0;(r&t)==n.ErrorRecoverySet.None||this.tok.tokenId==n.TokenID.RCurly&&u>0;)this.tok.tokenId==n.TokenID.LCurly?u++:this.tok.tokenId==n.TokenID.RCurly&&u--,this.tok=this.scanner.scan(),r=n.ErrorRecoverySet.None,i=n.lookupToken(this.tok.tokenId),i!=undefined&&(r=i.ers)},u.prototype.chkCurTok=function(n,t,i){this.tok.tokenId!=n?(this.reportParseError(t),this.errorRecovery&&this.skip(i)):this.tok=this.scanner.scan()},u.prototype.pushDeclLists=function(){this.staticsLists.push(new n.ASTList),this.varLists.push(new n.ASTList),this.scopeLists.push(new n.ASTList)},u.prototype.popDeclLists=function(){this.staticsLists.pop(),this.varLists.pop(),this.scopeLists.pop()},u.prototype.topVarList=function(){return this.varLists[this.varLists.length-1]},u.prototype.topScopeList=function(){return this.scopeLists[this.scopeLists.length-1]},u.prototype.topStaticsList=function(){return this.staticsLists[this.staticsLists.length-1]},u.prototype.parseComment=function(t){var i,r;return t?(i=new n.Comment(t.value,t.isBlock,t.endsLine),i.minChar=t.startPos,i.limChar=t.startPos+t.value.length,!t.isBlock&&t.value.length>3&&t.value.substring(0,3)=="///"&&(r=n.getAdditionalDependencyPath(t.value),r&&this.amdDependencies.push(r)),i):null},u.prototype.parseCommentsInner=function(n){var i,t;if(n){for(i=[],t=0;t<n.length;t++)i.push(this.parseComment(n[t]));return i}return null},u.prototype.parseComments=function(){var n=this.scanner.getComments();return this.parseCommentsInner(n)},u.prototype.parseCommentsForLine=function(n){var t=this.scanner.getCommentsForLine(n);return this.parseCommentsInner(t)},u.prototype.combineComments=function(n,t){return n==null?t:t==null?n:n.concat(t)},u.prototype.parseEnumDecl=function(i){var d=this.scanner.leftCurlyCount,k=this.scanner.rightCurlyCount,o=null,v,s,c,h,w,u,l;for(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(o=new n.Identifier(this.tok.getText()),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("Enum declaration requires identifier"),this.errorRecovery&&(o=new n.MissingIdentifier,o.minChar=this.scanner.startPos,o.limChar=this.scanner.startPos,o.flags|=n.ASTFlags.Error)),v=this.scanner.startPos,this.chkCurTok(n.TokenID.LCurly,"Expected '{'",i|n.ErrorRecoverySet.ID),this.pushDeclLists(),s=new n.ASTList,s.minChar=v,c=new n.VarDecl(new n.Identifier("_map"),0),c.varFlags|=n.VarFlags.Exported,c.varFlags|=n.VarFlags.Private,c.varFlags|=n.VarFlags.Property|n.VarFlags.Public,c.init=new n.UnaryExpression(n.NodeType.ArrayLit,null),s.append(c),h=null;;){var b=this.scanner.startPos,a,e=null,f=null,y=null,p=null;if(this.tok.tokenId==n.TokenID.ID||n.convertTokToIDName(this.tok))e=new n.Identifier(this.tok.getText()),e.minChar=this.scanner.startPos,e.limChar=this.scanner.pos;else if(this.tok.tokenId==n.TokenID.RCurly)break;else this.reportParseError("Expected identifer of enum member"),this.errorRecovery&&(e=new n.MissingIdentifier,e.minChar=this.scanner.startPos,e.limChar=this.scanner.startPos,e.flags|=n.ASTFlags.Error);if(a=this.scanner.pos,y=this.parseComments(),this.tok=this.scanner.scan(),p=this.parseComments(),this.tok.tokenId==n.TokenID.Asg?(this.tok=this.scanner.scan(),f=this.parseExpr(i,n.OperatorPrecedence.Cma,!0,t.NoTypes),h=f,a=f.limChar):(h==null?(f=new n.NumberLiteral(0),h=f):(f=new n.NumberLiteral(h.value+1),h=f),w=new n.BinaryExpression(n.NodeType.Asg,new n.BinaryExpression(n.NodeType.Index,new n.Identifier("_map"),f),new n.StringLiteral('"'+e.text+'"')),s.append(w)),u=new n.VarDecl(e,this.nestingLevel),u.minChar=b,u.limChar=a,u.init=f,u.typeExpr=new n.TypeReference(this.createRef(o.text,-1),0),u.varFlags|=n.VarFlags.Readonly|n.VarFlags.Property,f.nodeType==n.NodeType.NumberLit&&(u.varFlags|=n.VarFlags.Constant),u.preComments=y,s.append(u),u.postComments=p,u.varFlags|=n.VarFlags.Exported,this.tok.tokenId!=n.TokenID.Comma||(this.tok=this.scanner.scan(),u.postComments=this.combineComments(u.postComments,this.parseCommentsForLine(this.scanner.prevLine)),this.tok.tokenId!=n.TokenID.ID&&!n.convertTokToIDName(this.tok)))break}return this.chkCurTok(n.TokenID.RCurly,"Expected '}'",i),s.limChar=this.scanner.lastTokenLimChar(),l=new n.ModuleDecl(o,s,this.topVarList(),this.topScopeList()),l.modFlags|=n.ModuleFlags.IsEnum,this.popDeclLists(),l.leftCurlyCount=this.scanner.leftCurlyCount-d,l.rightCurlyCount=this.scanner.rightCurlyCount-k,l},u.prototype.parseDottedName=function(t){if(this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)){var i=new n.Identifier(this.tok.getText());i.preComments=this.parseComments(),t[t.length]=i,i.minChar=this.scanner.startPos,i.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.Dot&&this.parseDottedName(t)}else this.reportParseError("need identifier after '.'")},u.prototype.isValidImportPath=function(t){return(t=n.stripQuotes(t),!t||t.indexOf(":")!=-1||t.indexOf("\\")!=-1||t.charAt(0)=="/")?!1:!0},u.prototype.parseImportDecl=function(i,r){var o=null,u=null,f=null,l=this.scanner.startPos,c=!1,s,e,h;return this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?o=new n.Identifier(this.tok.getText()):(this.reportParseError("Expected identifer after 'import'"),o=new n.MissingIdentifier),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.chkCurTok(n.TokenID.Asg,"Expected =",i|n.ErrorRecoverySet.ID),s=this.parseComments(),this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?this.tok.tokenId==n.TokenID.MODULE?(e=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.LParen&&(this.tok=this.scanner.scan(),(this.tok.tokenId==n.TokenID.QString||this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(this.tok.tokenId==n.TokenID.QString?(this.topLevel&&(this.hasTopLevelImportOrExport=!0),h=this.tok.getText(),this.isValidImportPath(h)||this.reportParseError("Invalid import path"),u=new n.Identifier(h),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,c=!0,this.tok=this.scanner.scan(),u.preComments=s):(u=this.parseExpr(i|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Asg,!0,t.NoTypes),u.preComments=s)),e=this.scanner.pos,this.chkCurTok(n.TokenID.RParen,"Expected ')'",i|n.ErrorRecoverySet.ID),u&&(u.postComments=this.parseComments()),this.tok.tokenId==n.TokenID.SColon&&(e=this.scanner.pos,this.tok=this.scanner.scan()))):(u=this.parseExpr(i|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Asg,!0,t.NoTypes),e=this.scanner.pos):(this.reportParseError("Expected module name"),u=new n.MissingIdentifier,u.minChar=this.scanner.startPos,u.limChar=this.scanner.startPos,u.flags|=n.ASTFlags.Error,e=u.limChar),f=new n.ImportDecl(o,u),f.isDynamicImport=c,n.hasFlag(r,n.Modifiers.Exported)&&(f.varFlags|=n.VarFlags.Exported),f.minChar=l,f.limChar=e,f},u.prototype.parseModuleDecl=function(t,i){var g=this.scanner.leftCurlyCount,d=this.scanner.rightCurlyCount,k=this.ambientModule,b=this.topLevel,u,o,v,s,y,c,f,e,l;this.topLevel=!1,(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(this.ambientModule=!0),this.tok=this.scanner.scan(),u=null,o=null,this.pushDeclLists();var nt=this.parseComments(),h=this.scanner.startPos,w=!1;if(this.tok.tokenId==n.TokenID.ID||this.tok.tokenId==n.TokenID.QString||n.convertTokToID(this.tok,this.strictMode)?(v=this.tok.getText(),this.tok.tokenId==n.TokenID.QString&&(w=!0,this.ambientModule||this.reportParseError("Only ambient dynamic modules may have string literal names")),u=new n.Identifier(v),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,this.tok=this.scanner.scan()):this.tok.tokenId==n.TokenID.LCurly&&(this.reportParseError("Module name missing"),u=new n.Identifier(""),u.minChar=h,u.limChar=h),this.tok.tokenId==n.TokenID.Dot&&(o=[],this.parseDottedName(o)),u==null&&(u=new n.MissingIdentifier),s=new n.ASTList,y=this.scanner.startPos,this.chkCurTok(n.TokenID.LCurly,"Expected '{'",t|n.ErrorRecoverySet.ID),this.parseStmtList(t|n.ErrorRecoverySet.RCurly,s,!0,!0,n.AllowedElements.ModuleMembers,i),s.minChar=y,s.limChar=this.scanner.pos,this.chkCurTok(n.TokenID.RCurly,"Expected '}'",t),c=this.scanner.pos,o&&o.length>0){var p=o.length,a=o[p-1],r=new n.ModuleDecl(a,s,this.topVarList(),this.topScopeList());for((this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(r.modFlags|=n.ModuleFlags.Ambient),r.modFlags|=n.ModuleFlags.Exported,r.minChar=h,r.limChar=c,this.popDeclLists(),l=p-2;l>=0;l--)e=new n.ASTList,e.append(r),a=o[l],r=new n.ModuleDecl(a,e,new n.ASTList,new n.ASTList),e.minChar=r.minChar=h,e.limChar=r.limChar=c,(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(r.modFlags|=n.ModuleFlags.Ambient),r.modFlags|=n.ModuleFlags.Exported;e=new n.ASTList,e.append(r),e.minChar=h,e.limChar=c,f=new n.ModuleDecl(u,e,new n.ASTList,new n.ASTList)}else f=new n.ModuleDecl(u,s,this.topVarList(),this.topScopeList()),this.popDeclLists();return(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(f.modFlags|=n.ModuleFlags.Ambient),n.hasFlag(i,n.Modifiers.Exported)&&(f.modFlags|=n.ModuleFlags.Exported),w&&(f.modFlags|=n.ModuleFlags.IsDynamic),f.preComments=nt,f.postComments=this.parseComments(),this.ambientModule=k,this.topLevel=b,f.leftCurlyCount=this.scanner.leftCurlyCount-g,f.rightCurlyCount=this.scanner.rightCurlyCount-d,f},u.prototype.parseTypeReferenceTail=function(t,i,r){var u=new n.TypeReference(r,0);for(u.minChar=i;this.tok.tokenId==n.TokenID.LBrack;)this.tok=this.scanner.scan(),u.arrayCount++,this.chkCurTok(n.TokenID.RBrack,"Expected ']'",t|n.ErrorRecoverySet.LBrack);return u.limChar=this.scanner.lastTokenLimChar(),u},u.prototype.parseNamedType=function(t,i,r,u){var h,f,s,e,o;return this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.Dot?(h=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(f=new n.Identifier(this.tok.getText()),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,s=new n.BinaryExpression(n.NodeType.Dot,r,f),s.minChar=r.minChar,s.limChar=f.limChar,this.parseNamedType(t,i,s,u)):(this.reportParseError("need identifier after '.'"),this.errorRecovery?(r.flags|=n.ASTFlags.DotLHS,r.limChar=this.scanner.lastTokenLimChar(),r):(e=new n.MissingIdentifier,e.minChar=this.scanner.pos,e.limChar=this.scanner.pos,o=new n.BinaryExpression(n.NodeType.Dot,r,e),o.flags|=n.ASTFlags.Error,o.minChar=r.minChar,o.limChar=e.limChar,this.parseNamedType(t,i,o,u)))):u?this.parseTypeReferenceTail(t,i,r):r},u.prototype.parseTypeReference=function(t,i){var r=this.scanner.startPos,l=!1,a,o,h,f,v,s,c,y,p,u,e;switch(this.tok.tokenId){case n.TokenID.VOID:i||this.reportParseError("void not a valid type in this context");case n.TokenID.NUMBER:case n.TokenID.BOOL:case n.TokenID.ANY:case n.TokenID.STRING:return a=n.tokenTable[this.tok.tokenId].text,o=new n.Identifier(a),o.minChar=r,o.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.parseTypeReferenceTail(t,r,o);case n.TokenID.ID:return h=this.createRef(this.tok.getText(),r),h.limChar=this.scanner.pos,this.parseNamedType(t,r,h,!0);case n.TokenID.LCurly:return this.tok=this.scanner.scan(),f=new n.ASTList,f.minChar=r,v=this.inInterfaceDecl,this.inInterfaceDecl=!0,this.parseInterfaceMembers(t|n.ErrorRecoverySet.RCurly,f),this.inInterfaceDecl=v,this.chkCurTok(n.TokenID.RCurly,"Expected '}'",t),s=new n.TypeDecl(n.NodeType.Interface,this.anonId,f,null,null,null),s.minChar=r,s.limChar=f.limChar,this.parseTypeReferenceTail(t,r,s);case n.TokenID.NEW:this.tok=this.scanner.scan(),this.tok.tokenId!=n.TokenID.LParen?this.reportParseError("Expected '('"):l=!0;case n.TokenID.LParen:return c=new n.ASTList,y=this.parseFormalParameterList(t|n.ErrorRecoverySet.RParen,c,!1,!0,!1,!1,!1,null),this.chkCurTok(n.TokenID.Arrow,"Expected '=>'",t),p=this.parseTypeReference(t,!0),u=new n.FuncDecl(null,null,!1,c,null,null,null,n.NodeType.FuncDecl),u.returnTypeAnnotation=p,u.variableArgList=y,u.fncFlags|=n.FncFlags.Signature,l&&(u.fncFlags|=n.FncFlags.ConstructMember,u.hint="_construct",u.classDecl=null),u.minChar=r,this.parseTypeReferenceTail(t,r,u);default:return this.reportParseError("Expected type name"),e=new n.TypeReference(null,0),e.flags|=n.ASTFlags.Error,e.minChar=this.scanner.pos,e.limChar=this.scanner.pos,e}},u.prototype.parseFunctionStatements=function(r,u,f,e,o,s,h,c,l){var tt,b,d,k,g,y,v,nt,rt,it;this.pushDeclLists(),tt=this.stmtStack,this.resetStmtStack();var a=null,p=!1,w=!1;return c||(a=new n.ASTList,b=this.scanner.startPos,this.tok.tokenId==n.TokenID.Arrow&&(e&&this.reportParseError("'=>' may not be used for class methods"),p=!0,this.tok=this.scanner.scan()),p&&this.tok.tokenId!=n.TokenID.LCurly?(d=this.parseExpr(r|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Asg,!0,t.NoTypes),k=new n.ReturnStatement,k.returnExpression=d,a.minChar=b,a.append(k)):(this.state=i.StartStmtList,this.chkCurTok(n.TokenID.LCurly,"Expected '{'",r|n.ErrorRecoverySet.StmtStart),g=this.inFnc,w=p,this.inFnc=!0,this.parseStmtList(r|n.ErrorRecoverySet.RCurly|n.ErrorRecoverySet.StmtStart,a,!0,!1,s,l),a.minChar=b,a.limChar=this.scanner.pos,this.inFnc=g,y=new n.EndCode,y.minChar=a.limChar,y.limChar=y.minChar,a.append(y))),v=new n.FuncDecl(u,a,f,o,this.topVarList(),this.topScopeList(),this.topStaticsList(),n.NodeType.FuncDecl),this.popDeclLists(),nt=this.topScopeList(),nt.append(v),rt=!1,it=this.scanner.pos,c?this.chkCurTok(n.TokenID.SColon,"Expected ';'",r):!p||w?(this.chkCurTok(n.TokenID.RCurly,"Expected '}'",r),w&&(v.fncFlags|=n.FncFlags.IsFatArrowFunction)):(v.fncFlags|=n.FncFlags.IsFatArrowFunction,this.tok.tokenId==n.TokenID.SColon&&(this.tok=this.scanner.scan())),v.minChar=h,v.limChar=it,c||(v.fncFlags|=n.FncFlags.Definition),this.stmtStack=tt,v},u.prototype.transformAnonymousArgsIntoFormals=function(t,i){var f=this,r=function(i){if(i.nodeType==n.NodeType.Comma)f.transformAnonymousArgsIntoFormals(t,i);else if(i.nodeType==n.NodeType.Name||i.nodeType==n.NodeType.Asg){var u=i.nodeType==n.NodeType.Asg?i.operand1:i,r=new n.ArgDecl(u);r.preComments=u.preComments,r.postComments=u.postComments,r.minChar=u.minChar,r.limChar=u.limChar,n.hasFlag(u.flags,n.ASTFlags.PossibleOptionalParameter)&&(r.isOptional=!0),i.nodeType==n.NodeType.Asg&&(r.init=i.operand2),t.append(r)}else f.reportParseError("Invalid lambda argument")},u;i&&(i.nodeType==n.NodeType.Comma?(u=i,r(u.operand1),r(u.operand2)):r(i))},u.prototype.parseFormalParameterList=function(i,r,u,f,e,o,s,h){var a,w,c;r.minChar=this.scanner.startPos,e?this.tok=this.scanner.scan():h||this.chkCurTok(n.TokenID.LParen,"Expected '('",i|n.ErrorRecoverySet.RParen);var y=!1,d=!0,p=!1,l=!1,b=!1;for(h&&(this.transformAnonymousArgsIntoFormals(r,h),l=!0);;){var k=!1,v=n.VarFlags.None,g=this.scanner.startPos;if(this.inferPropertiesFromThisAssignment&&this.tok.tokenId==n.TokenID.THIS&&(u||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),v|=n.VarFlags.Public|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)),this.tok.tokenId==n.TokenID.PUBLIC?(v|=n.VarFlags.Public|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)):this.tok.tokenId==n.TokenID.PRIVATE&&(v|=n.VarFlags.Private|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)),v!=n.VarFlags.None?(u||this.reportParseError("only constructor parameters can be properties"),this.tok=this.scanner.scan(),this.inferPropertiesFromThisAssignment&&this.tok.tokenId==n.TokenID.THIS&&(u||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),this.tok=this.scanner.scan())):this.tok.tokenId==n.TokenID.Ellipsis&&(y=!0,this.tok=this.scanner.scan()),a=null,(!l&&this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(a=new n.Identifier(this.tok.getText()),a.minChar=this.scanner.startPos,a.limChar=this.scanner.pos),(l||a)&&(k=!0,w=null,c=null,l&&r.members.length?(c=r.members[r.members.length-1],c.isOptional&&(p=!0,b=!0)):(c=new n.ArgDecl(a),o&&this.reportParseError("Property getters may not take any arguments"),s&&!d&&this.reportParseError("Property setters may only take one argument"),c.minChar=g,c.preComments=this.parseComments(),this.tok=this.scanner.scan()),this.tok.tokenId==n.TokenID.QMark&&(c.isOptional=!0,p=!0,this.tok=this.scanner.scan()),this.tok.tokenId==n.TokenID.Colon&&(this.tok=this.scanner.scan(),w=this.parseTypeReference(i,!1),h&&(b=!0)),this.tok.tokenId==n.TokenID.Asg&&(f&&this.reportParseError("Arguments in signatures may not have default values"),p=!0,this.tok=this.scanner.scan(),c.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,!1,t.NoTypes)),!p||c.isOptionalArg()||y||this.reportParseError("Optional parameters may only be followed by other optional parameters"),y&&c.isOptionalArg()&&this.reportParseError("Varargs may not be optional or have default parameters"),c.postComments=this.parseComments(),c.typeExpr=w,c.limChar=this.scanner.lastTokenLimChar(),c.varFlags|=v,l?l=!1:r.append(c)),d=!1,this.tok.tokenId==n.TokenID.Comma){if(k&&!y){this.tok=this.scanner.scan();continue}else if(this.reportParseError("Unexpected ',' in argument list"),this.errorRecovery){this.tok=this.scanner.scan();continue}}else break}return e?this.chkCurTok(n.TokenID.RBrack,"Expected ']'",i|n.ErrorRecoverySet.LCurly|n.ErrorRecoverySet.SColon):(!h||b)&&this.chkCurTok(n.TokenID.RParen,"Expected ')'",i|n.ErrorRecoverySet.LCurly|n.ErrorRecoverySet.SColon),r.limChar=this.scanner.lastTokenLimChar(),y},u.prototype.parseFncDecl=function(t,r,u,f,e,o,s,h,c,l){var ut=this.scanner.leftCurlyCount,g=this.scanner.rightCurlyCount,ft=this.parsingClassConstructorDefinition,p,w,a;this.parsingClassConstructorDefinition=!1;var v=null,nt=this.scanner.startPos,tt=this.scanner.pos,b=this.nestingLevel;if(this.nestingLevel=0,!this.style_funcInLoop&&this.inLoop()&&this.reportParseStyleError("function declaration in loop"),f||s||o||l)e&&(v=e);else if(this.tok=this.scanner.scan(),this.state=i.StartFncDecl,this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))v=new n.Identifier(this.tok.getText()),v.minChar=this.scanner.startPos,v.limChar=this.scanner.pos,this.tok=this.scanner.scan();else if(r)return this.reportParseError("Function declaration must include identifier"),this.nestingLevel=b,new n.IncompleteAST(nt,this.scanner.pos);this.state=i.FncDeclName;var y=new n.ASTList,k=!1,d=!1,it=n.hasFlag(c,n.Modifiers.Getter),rt=n.hasFlag(c,n.Modifiers.Setter);return(this.tok.tokenId==n.TokenID.LParen||o&&this.tok.tokenId==n.TokenID.LBrack||l&&l.preProcessedLambdaArgs)&&(k=this.parseFormalParameterList(t,y,!1,u,o,it,rt,l?l.preProcessedLambdaArgs:null)),this.state=i.FncDeclArgs,p=null,this.tok.tokenId==n.TokenID.Colon&&(this.tok=this.scanner.scan(),n.hasFlag(c,n.Modifiers.Setter)&&this.reportParseError("Property setters may not declare a return type"),p=this.parseTypeReference(t,!0)),o&&y.members.length==0&&this.reportParseError("Index signatures require a parameter type to be specified"),this.state=i.FncDeclReturnType,!r||this.parsingDeclareFile||h||f&&(this.ambientModule||this.ambientClass||this.inInterfaceDecl)||this.tok.tokenId!=n.TokenID.SColon||(d=!0,r=!1,u=!0),w=this.inFncDecl,this.inFncDecl=!0,a=this.parseFunctionStatements(t|n.ErrorRecoverySet.RCurly,v,!1,f,y,n.AllowedElements.FunctionBody,tt,u,n.Modifiers.None),this.inFncDecl=w,a.variableArgList=k,a.isOverload=d,u||(a.fncFlags|=n.FncFlags.Definition),s&&(a.fncFlags|=n.FncFlags.Static),u&&(a.fncFlags|=n.FncFlags.Signature),o&&(a.fncFlags|=n.FncFlags.IndexerMember),a.returnTypeAnnotation=p,f&&(a.fncFlags|=n.FncFlags.Method,a.fncFlags|=n.FncFlags.ClassPropertyMethodExported),a.leftCurlyCount=this.scanner.leftCurlyCount-ut,a.rightCurlyCount=this.scanner.rightCurlyCount-g,this.nestingLevel=b,this.parsingClassConstructorDefinition=ft,a},u.prototype.convertToTypeReference=function(t){var i,r,u;switch(t.nodeType){case n.NodeType.TypeRef:return t;case n.NodeType.Name:return i=new n.TypeReference(t,0),i.minChar=t.minChar,i.limChar=t.limChar,i;case n.NodeType.Index:return r=t,i=this.convertToTypeReference(r.operand1),i?(i.arrayCount++,i.minChar=r.minChar,i.limChar=r.limChar,i):u=new n.AST(n.NodeType.Error)}return null},u.prototype.parseArgList=function(i){var r=new n.ASTList,u;if(r.minChar=this.scanner.startPos,this.tok=this.scanner.scan(),this.tok.tokenId!==n.TokenID.RParen)for(;;){if(r.members.length>65535){this.reportParseError("max number of args exceeded");break}if(u=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,!1,t.NoTypes),r.append(u),this.tok.tokenId!=n.TokenID.Comma)break;this.tok=this.scanner.scan()}return r.limChar=this.scanner.pos,r},u.prototype.parseBaseList=function(t,i,r,u,f){for(var s=!0,o=t,e,h,l,c;;){if(s&&(this.tok.tokenId==n.TokenID.IMPLEMENTS&&(u&&this.reportParseError("interfaces can not implement other types"),o=i),this.tok=this.scanner.scan(),s=!1),e=null,this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(h=this.scanner.startPos,e=new n.Identifier(this.tok.getText()),e.minChar=h,e.limChar=this.scanner.pos,e=this.parseNamedType(r|n.ErrorRecoverySet.LCurly,h,e,!1)):(this.reportParseError("Expected base name"),this.errorRecovery&&(e=new n.MissingIdentifier,e.minChar=this.scanner.pos,e.limChar=this.scanner.pos,e.flags|=n.ASTFlags.Error)),this.tok.tokenId==n.TokenID.LParen?(f&&this.reportParseError("Base classes may only be initialized via a 'super' call within the constructor body"),l=this.parseArgList(r|n.ErrorRecoverySet.RParen),c=new n.CallExpression(n.NodeType.Call,e,l),this.tok=this.scanner.scan(),c.limChar=this.scanner.pos,o.append(c)):o.append(e),!u&&o==t&&t.members.length>1&&this.reportParseError("A class may only extend one other class"),this.tok.tokenId==n.TokenID.Comma){this.tok=this.scanner.scan();continue}else if(this.tok.tokenId==n.TokenID.EXTENDS||this.tok.tokenId==n.TokenID.IMPLEMENTS){o=t,s=!0;continue}break}},u.prototype.parseClassDecl=function(t,i,r){var c=this.scanner.leftCurlyCount,l=this.scanner.rightCurlyCount,s,h,u,f;(r&n.Modifiers.Readonly)!=n.Modifiers.None&&this.reportParseError("const modifier is implicit for class"),(this.parsingDeclareFile||this.ambientModule)&&(r|=n.Modifiers.Ambient,r|=n.Modifiers.Exported),s=this.parsingDeclareFile||(r&n.Modifiers.Ambient)!=n.Modifiers.None,h=this.ambientClass,this.ambientClass=s,this.tok=this.scanner.scan(),u=null,this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(u=new n.Identifier(this.tok.getText()),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("class missing name"),this.errorRecovery&&(u=new n.MissingIdentifier,u.minChar=this.scanner.pos,u.limChar=this.scanner.pos,u.flags|=n.ASTFlags.Error));var e=null,o=null,a=!1;return(this.tok.tokenId==n.TokenID.EXTENDS||this.tok.tokenId==n.TokenID.IMPLEMENTS)&&(e=new n.ASTList,o=new n.ASTList,this.parseBaseList(e,o,t,!1,!0)),f=new n.ClassDecl(u,new n.ASTList,e,o),this.currentClassDefinition=f,this.parseClassElements(f,t,r),(this.ambientModule||this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Exported))&&(f.varFlags|=n.VarFlags.Exported),(this.ambientModule||n.hasFlag(r,n.Modifiers.Ambient))&&(f.varFlags|=n.VarFlags.Ambient),f.varFlags|=n.VarFlags.Class,this.ambientClass=h,f.leftCurlyCount=this.scanner.leftCurlyCount-c,f.rightCurlyCount=this.scanner.rightCurlyCount-l,f},u.prototype.parseClassElements=function(t,i,r){var u=r,s=!1,y=this.scanner.startPos,h,e,f,l,v,c,o,a;for(this.chkCurTok(n.TokenID.LCurly,"Expected '{'",i),this.nestingLevel++,h=this.scanner.startPos,e=!1;!(this.tok.tokenId==n.TokenID.RCurly||this.tok.tokenId==n.TokenID.EOF);)f=!0,l=n.Modifiers.Public|n.Modifiers.Private,this.tok.tokenId==n.TokenID.GET?(u&n.Modifiers.Getter&&this.reportParseError("Duplicate 'get' declaration in class body"),u&n.Modifiers.Setter&&this.reportParseError("Getter already marked as a setter"),u|=n.Modifiers.Getter):this.tok.tokenId==n.TokenID.SET?(u&n.Modifiers.Setter&&this.reportParseError("Duplicate 'set' declaration in class body"),u&n.Modifiers.Getter&&this.reportParseError("Setter already marked as a getter"),u|=n.Modifiers.Setter):this.tok.tokenId==n.TokenID.PRIVATE?(u&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Private):this.tok.tokenId==n.TokenID.PUBLIC?(u&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Public):this.tok.tokenId==n.TokenID.STATIC?(u&n.Modifiers.Static&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Static):this.tok.tokenId==n.TokenID.CONSTRUCTOR?(u!=r&&this.reportParseError("Constructors may not have modifiers"),this.parseClassConstructorDeclaration(h,i,u),f=!1,s=!0):e||this.tok.tokenId==n.TokenID.ID||n.convertTokToIDName(this.tok)?(v=e?u&n.Modifiers.Getter?"get":"set":this.tok.getText(),c=new n.Identifier(v),c.minChar=this.scanner.startPos,c.limChar=this.scanner.pos,e?(u=u^(u&n.Modifiers.Getter?n.Modifiers.Getter:n.Modifiers.Setter),e=!1):this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.LParen?(this.parseClassMemberFunctionDeclaration(c,h,i,u),f=!1):((u&n.Modifiers.Getter||u&n.Modifiers.Setter)&&this.reportParseError("Property accessors must be functions"),o=this.parseClassMemberVariableDeclaration(c,h,!1,i,u),o.init&&o.init.nodeType==n.NodeType.FuncDecl?this.tok.tokenId==n.TokenID.RCurly&&(f=!1):o.init&&o.init.nodeType==n.NodeType.ObjectLit&&this.tok.tokenId!=n.TokenID.SColon?(f=!1,o.init.flags|=n.ASTFlags.AutomaticSemicolon):this.tok.tokenId!=n.TokenID.SColon&&(this.reportParseError("Expected ';'"),f=!1)),s=!0):this.tok.tokenId==n.TokenID.SUPER?this.reportParseError("Base class initializers must be the first statement in a class definition"):!e&&(u&n.Modifiers.Getter||u&n.Modifiers.Setter)&&this.tok.tokenId==n.TokenID.LParen||this.tok.tokenId==n.TokenID.Asg?(e=!0,f=!1):this.tok.tokenId!=n.TokenID.SColon&&(this.reportParseError("Unexpected '"+this.tok.getText()+"' in class definition"),s=!0),f&&(this.tok=this.scanner.scan()),s&&(u=r,h=this.scanner.startPos,s=!1);a=this.scanner.pos,this.tok.tokenId==n.TokenID.RCurly&&(this.currentClassDefinition.definitionMembers.members.length||(this.currentClassDefinition.preComments=this.parseComments()),this.tok=this.scanner.scan()),this.nestingLevel--,this.currentClassDefinition.members.minChar=y,this.currentClassDefinition.members.limChar=a,this.currentClassDefinition.limChar=a,this.currentClassDefinition=null},u.prototype.parseClassConstructorDeclaration=function(t,i,r){var a,o,s,c,u;this.parsingClassConstructorDefinition=!0;var e=this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient),f=new n.ASTList,h=!1,l=this.parseComments();if(this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.LParen&&(h=this.parseFormalParameterList(i,f,!0,e,!1,!1,!1,null),f.members.length>0&&(a=f.members[f.members.length-1])),o=e||this.tok.tokenId==n.TokenID.SColon,o)for(s=0;s<f.members.length;s++)c=f.members[s],n.hasFlag(c.varFlags,n.VarFlags.Property)&&this.reportParseError("Overload or ambient signatures may not specify parameter properties");return o||(this.currentClassDefinition.constructorNestingLevel=this.nestingLevel+1),u=this.parseFunctionStatements(i|n.ErrorRecoverySet.RCurly,this.currentClassDefinition.name,!0,!1,f,n.AllowedElements.ClassMembers,t,o,r),u.preComments=l,o&&!e&&(u.isOverload=!0),u.variableArgList=h,this.currentClassDecl=null,u.returnTypeAnnotation=this.convertToTypeReference(this.currentClassDefinition.name),u.classDecl=this.currentClassDefinition,e&&(u.fncFlags|=n.FncFlags.Ambient),o&&(u.fncFlags|=n.FncFlags.Signature),(this.ambientModule||n.hasFlag(r,n.Modifiers.Exported))&&(u.fncFlags|=n.FncFlags.Exported),this.currentClassDefinition.constructorDecl&&(e||this.currentClassDefinition.constructorDecl.isSignature()||u.isSignature()||this.reportParseError("Duplicate constructor definition")),(e||!u.isSignature())&&(this.currentClassDefinition.constructorDecl=u),u.fncFlags|=n.FncFlags.ClassMethod,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=u,this.parsingClassConstructorDefinition=!1,u.postComments=this.parseComments(),u},u.prototype.parseClassMemberVariableDeclaration=function(i,r,u,f,e){var o=new n.VarDecl(i,this.nestingLevel),s;if(o.minChar=r,s=!1,o.preComments=this.parseComments(),this.tok.tokenId==n.TokenID.Colon&&(this.tok=this.scanner.scan(),o.typeExpr=this.parseTypeReference(f|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1)),this.tok.tokenId==n.TokenID.Asg){if((this.parsingDeclareFile||n.hasFlag(e,n.Modifiers.Ambient))&&(this.reportParseError("context does not permit variable initializer"),this.errorRecovery))return this.skip(f),o.flags|=n.ASTFlags.Error,o.limChar=this.scanner.lastTokenLimChar(),o;this.tok=this.scanner.scan(),o.init=this.parseExpr(n.ErrorRecoverySet.Comma|f,n.OperatorPrecedence.Cma,!0,t.NoTypes),o.limChar=o.init.limChar,this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor}else o.limChar=this.scanner.pos;return e&n.Modifiers.Static&&(o.varFlags|=n.VarFlags.Static,s=!0),o.varFlags|=(e&n.Modifiers.Private)!=n.Modifiers.None?n.VarFlags.Private:n.VarFlags.Public,o.varFlags|=n.VarFlags.Property,u&&(o.varFlags|=n.VarFlags.ClassConstructorProperty),u||s||(o.varFlags|=n.VarFlags.ClassBodyProperty),this.currentClassDefinition.knownMemberNames[i.text]=!0,u||(this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=o),this.currentClassDefinition.allMemberDefinitions.members[this.currentClassDefinition.allMemberDefinitions.members.length]=o,o.postComments=this.parseComments(),o},u.prototype.parseClassMemberFunctionDeclaration=function(t,i,r,u){var l=this.prevIDTok!=null,o=n.hasFlag(u,n.Modifiers.Getter)||n.hasFlag(u,n.Modifiers.Setter),s=n.hasFlag(u,n.Modifiers.Static),h=this.ambientModule||n.hasFlag(u,n.Modifiers.Ambient),c,e,f;return(r|=n.ErrorRecoverySet.RParen,c=this.parseComments(),o&&u&n.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient classes"),e=this.parseFncDecl(r,!0,h,!0,t,!1,s,h,u,null),e.nodeType==n.NodeType.Error)?e:(f=e,f.preComments=c,f.minChar=i,f.bod!==null&&(f.limChar=f.bod.limChar),f.fncFlags|=u&n.Modifiers.Private?n.FncFlags.Private:n.FncFlags.Public,s&&(f.fncFlags|=n.FncFlags.Static),o&&(n.hasFlag(u,n.Modifiers.Getter)?(f.fncFlags|=n.FncFlags.GetAccessor,f.hint="get"+f.name.text):(f.fncFlags|=n.FncFlags.SetAccessor,f.hint="set"+f.name.text),f.fncFlags|=n.FncFlags.IsFunctionExpression,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")),f.fncFlags|=n.FncFlags.ClassMethod,this.currentClassDefinition.knownMemberNames[t.text]=!0,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=f,f.postComments=this.parseComments(),f)},u.prototype.parseInterfaceMember=function(t){var r=this.scanner.startPos,i=this.parsePropertyDecl(t,n.Modifiers.Public,!0,!1);return i.nodeType==n.NodeType.VarDecl&&this.chkCurTok(n.TokenID.SColon,"Expected ';'",t),i&&(i.minChar=r),i},u.prototype.parseInterfaceMembers=function(t,i){for(;;){switch(this.tok.tokenId){case n.TokenID.RCurly:case n.TokenID.EOF:i.limChar=this.scanner.pos;return}var r=this.parseInterfaceMember(t|n.ErrorRecoverySet.TypeScriptS);r&&i.append(r)}},u.prototype.parseInterfaceDecl=function(t,i){var h=this.scanner.leftCurlyCount,c=this.scanner.rightCurlyCount,l,r,f,o,e,s,u;return this.tok=this.scanner.scan(),l=this.scanner.pos,r=null,this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(r=new n.Identifier(this.tok.getText()),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("interface missing name"),this.errorRecovery&&(r=new n.MissingIdentifier,r.minChar=this.scanner.pos,r.limChar=this.scanner.pos,r.flags|=n.ASTFlags.Error)),f=null,this.tok.tokenId==n.TokenID.EXTENDS&&(f=new n.ASTList,f.minChar=this.scanner.startPos,this.parseBaseList(f,null,t,!0,!1)),o=this.scanner.startPos,this.chkCurTok(n.TokenID.LCurly,"Expected '{'",t|n.ErrorRecoverySet.TypeScriptS),e=new n.ASTList,e.minChar=o,s=this.inInterfaceDecl,this.inInterfaceDecl=!0,this.parseInterfaceMembers(t|n.ErrorRecoverySet.RCurly,e),this.inInterfaceDecl=s,this.chkCurTok(n.TokenID.RCurly,"Expected '}'",t),u=new n.TypeDecl(n.NodeType.Interface,r,e,null,f,null),n.hasFlag(i,n.Modifiers.Private)&&(u.varFlags|=n.VarFlags.Private),n.hasFlag(i,n.Modifiers.Public)&&(u.varFlags|=n.VarFlags.Public),(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Exported))&&(u.varFlags|=n.VarFlags.Exported),u.leftCurlyCount=this.scanner.leftCurlyCount-h,u.rightCurlyCount=this.scanner.rightCurlyCount-c,u},u.prototype.makeVarDecl=function(t,i){var r=new n.VarDecl(t,i),u=this.topVarList();return u&&u.append(r),r},u.prototype.parsePropertyDecl=function(i,r,u,f){var s=null,w=this.scanner.startPos,c=w,v=!1,a=!1,y=this.prevIDTok!=null,b=n.hasFlag(r,n.Modifiers.Getter)||n.hasFlag(r,n.Modifiers.Setter),k,d,h,p,l,o,e;if((this.parsingDeclareFile||this.ambientModule||n.hasFlag(r,n.Modifiers.Ambient))&&(u=!0),this.tok.tokenId!=n.TokenID.LParen||y){if(this.tok.tokenId==n.TokenID.NEW)u&&(this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.LParen&&(v=!0)),v||(u||(this.tok=this.scanner.scan()),s=new n.Identifier("new"),s.minChar=this.scanner.pos-3,s.limChar=this.scanner.pos,c=this.scanner.pos);else if(this.tok.tokenId==n.TokenID.LBrack&&u)a=!0,s=new n.Identifier("__item");else if(this.tok.tokenId==n.TokenID.ID||n.convertTokToIDName(this.tok)||y)y?(s=new n.Identifier(this.prevIDTok.getText()),s.minChar=this.scanner.lastTokenLimChar()-3,s.limChar=this.scanner.lastTokenLimChar(),c=s.limChar,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),this.tok.getText()==s.text&&this.tok!=this.prevIDTok&&(this.tok=this.scanner.scan()),this.prevIDTok=null):(s=new n.Identifier(this.tok.getText()),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,c=this.scanner.pos,this.tok=this.scanner.scan());else if(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery)return k=this.scanner.startPos,d=this.scanner.pos,this.skip(i&~n.ErrorRecoverySet.Comma),this.scanner.pos==d&&(this.tok=this.scanner.scan()),h=new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),h.flags|=n.ASTFlags.Error,h.minChar=k,h.limChar=this.scanner.lastTokenLimChar(),h}else u||f||(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery&&(this.skip(i),s=new n.MissingIdentifier));if(this.tok.tokenId==n.TokenID.QMark&&(this.inInterfaceDecl&&s?s.flags|=n.ASTFlags.OptionalName:this.reportParseError("Optional properties may only be declared on interface or object types"),this.tok=this.scanner.scan()),this.tok.tokenId==n.TokenID.LParen||a&&this.tok.tokenId==n.TokenID.LBrack)return(p=i|n.ErrorRecoverySet.RParen,a&&(p=i|n.ErrorRecoverySet.RBrack),l=this.parseFncDecl(p,!0,u,!this.inFncDecl,s,a,f,this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient),r,null),l.nodeType==n.NodeType.Error)?l:(e=l,e.name&&(e.name.minChar=w,e.name.limChar=c),(r&n.Modifiers.Public)!=n.Modifiers.None&&(e.fncFlags|=n.FncFlags.Public),(r&n.Modifiers.Private)!=n.Modifiers.None&&(e.fncFlags|=n.FncFlags.Private),f&&(e.fncFlags|=n.FncFlags.Static),(this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient))&&(e.fncFlags|=n.FncFlags.Ambient),b&&(n.hasFlag(r,n.Modifiers.Getter)?(e.fncFlags|=n.FncFlags.GetAccessor,e.hint="get"+e.name.text):(e.fncFlags|=n.FncFlags.SetAccessor,e.hint="set"+e.name.text),e.fncFlags|=n.FncFlags.IsFunctionExpression,r&n.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient types")),s==null&&(v?(e.fncFlags|=n.FncFlags.ConstructMember,e.hint="_construct",e.classDecl=this.currentClassDecl):(e.hint="_call",e.fncFlags|=n.FncFlags.CallMember)),e);if(o=new n.VarDecl(s,this.nestingLevel),o.minChar=w,this.tok.tokenId==n.TokenID.Colon&&(this.tok=this.scanner.scan(),o.typeExpr=this.parseTypeReference(i|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1)),this.tok.tokenId==n.TokenID.Asg){if(u&&(this.reportParseError("context does not permit variable initializer"),this.errorRecovery))return this.skip(i),o.flags|=n.ASTFlags.Error,o.limChar=this.scanner.lastTokenLimChar(),o;this.tok=this.scanner.scan(),o.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,!0,t.NoTypes),o.limChar=o.init.limChar,o.init.nodeType==n.NodeType.FuncDecl?(e=o.init,e.hint=o.id.text,e.boundToProperty=o):b&&this.reportParseError("Accessors may only be functions")}else o.limChar=this.scanner.pos;return(r&n.Modifiers.Readonly)!=n.Modifiers.None&&(o.varFlags|=n.VarFlags.Readonly),f&&(o.varFlags|=n.VarFlags.Static),(r&n.Modifiers.Public)!=n.Modifiers.None&&(o.varFlags|=n.VarFlags.Public),(r&n.Modifiers.Private)!=n.Modifiers.None&&(o.varFlags|=n.VarFlags.Private),o.varFlags|=n.VarFlags.Property,o},u.prototype.parseVarDecl=function(i,r,u,f,e){var y=n.hasFlag(r,n.Modifiers.Readonly),h=this.scanner.startPos,c,a,v;this.tok=this.scanner.scan();for(var o=null,s=null,l=!1,p=this.parseComments();;){if(this.tok.tokenId!=n.TokenID.ID&&!n.convertTokToID(this.tok,this.strictMode)&&(this.reportParseError("Expected identifier in variable declaration"),this.errorRecovery))return o=new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),o.minChar=h,this.skip(i),o.flags|=n.ASTFlags.Error,o.limChar=this.scanner.lastTokenLimChar(),o;if(c=this.tok.getText(),this.strictMode&&c=="eval"&&this.reportParseError("can not name a variable eval in strict mode"),o=this.makeVarDecl(new n.Identifier(c),this.nestingLevel),o.id.minChar=this.scanner.startPos,o.id.limChar=this.scanner.pos,o.preComments=p,e&&(o.varFlags|=n.VarFlags.Static),n.hasFlag(r,n.Modifiers.Readonly)&&(o.varFlags|=n.VarFlags.Readonly),(this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient))&&(o.varFlags|=n.VarFlags.Ambient),(this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Exported))&&(o.varFlags|=n.VarFlags.Exported),o.minChar=h,s&&s.append(o),this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.Colon&&(this.tok=this.scanner.scan(),a=this.inFncDecl,this.inFncDecl=!1,o.typeExpr=this.parseTypeReference(i|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1),this.inFncDecl=a),this.tok.tokenId==n.TokenID.Asg){if(f&&(this.reportParseError("context does not permit variable initializer"),this.errorRecovery))return this.skip(i),o.flags|=n.ASTFlags.Error,o;this.tok=this.scanner.scan(),o.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,u,t.NoTypes),o.limChar=o.init.limChar,o.init.nodeType==n.NodeType.FuncDecl&&(v=o.init,v.hint=o.id.text)}else y&&this.reportParseError("const declaration requires initializer"),o.limChar=this.scanner.pos;if(o.postComments=this.parseCommentsForLine(this.scanner.line),this.tok.tokenId!=n.TokenID.Comma)return s?(s.limChar=o.limChar,s):o;l||(s=new n.ASTList,s.minChar=o.minChar,s.append(o),l=!0),this.tok=this.scanner.scan(),h=this.scanner.startPos}},u.prototype.parseMemberList=function(i){var e=new n.ASTList,l,b,a,f;if(this.tok.tokenId==n.TokenID.RCurly)return e;for(var u=null,r=null,o=null,s=null,v=this.scanner.startPos,h=!1,c=!1,y=null,p=0,w=0;;){if(l=!1,this.tok.tokenId==n.TokenID.GET||this.tok.tokenId==n.TokenID.SET?(h=this.tok.tokenId==n.TokenID.SET,y=this.tok,p=this.scanner.startPos,w=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.ID||n.convertTokToIDName(this.tok)?(u=h?"set":"get",u=u+this.tok.getText(),r=new n.Identifier(this.tok.getText()),r.minChar=this.scanner.startPos,l=!0,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")):this.tok.tokenId!=n.TokenID.Colon?this.reportParseError("Expected identifier, string or number as accessor name"):(c=!0,r=new n.Identifier(y.getText()),r.minChar=p,r.limChar=w)):this.tok.tokenId==n.TokenID.ID||n.convertTokToIDName(this.tok)?(u=this.tok.getText(),r=new n.Identifier(u),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):this.tok.tokenId==n.TokenID.QString?(u=this.tok.getText(),r=new n.StringLiteral(u),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):this.tok.tokenId==n.TokenID.NumberLit?(b=this.tok,u=b.value.toString(),r=new n.StringLiteral(u),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):(this.reportParseError("Expected identifier, string or number as member name"),this.errorRecovery&&(r=new n.MissingIdentifier,r.minChar=this.scanner.startPos,r.flags|=n.ASTFlags.Error,this.skip(i|n.ErrorRecoverySet.Comma),r.limChar=this.scanner.lastTokenLimChar())),c?c=!1:this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.QMark&&(r.flags|=n.ASTFlags.OptionalName,this.tok=this.scanner.scan()),l)a=new n.ASTList,this.parseFormalParameterList(i|n.ErrorRecoverySet.RParen,a,!1,!0,!1,!h,h,null),f=this.parseFunctionStatements(i|n.ErrorRecoverySet.RCurly,r,!1,!0,a,n.AllowedElements.FunctionDecls,this.scanner.startPos,!1,n.Modifiers.None),h&&f.returnTypeAnnotation&&this.reportParseError("Property setters may not declare a return type"),f.fncFlags|=h?n.FncFlags.SetAccessor:n.FncFlags.GetAccessor,f.fncFlags|=n.FncFlags.IsFunctionExpression,f.hint=u,o=f,s=new n.BinaryExpression(n.NodeType.Member,r,o),s.minChar=r.minChar,o.nodeType==n.NodeType.FuncDecl&&(f=o,f.hint=u);else if(this.tok.tokenId==n.TokenID.Colon)this.tok=this.scanner.scan(),o=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,!0,t.NoTypes),o.nodeType==n.NodeType.TypeRef&&this.reportParseError("Expected 'new' on array declaration in member definition"),s=new n.BinaryExpression(n.NodeType.Member,r,o),s.minChar=r.minChar,o.nodeType==n.NodeType.FuncDecl&&(f=o,f.hint=u);else if(this.reportParseError("Expected ':' in member definition"),this.errorRecovery)return this.skip(i),e.flags|=n.ASTFlags.Error,e.minChar=v,e.limChar=this.scanner.lastTokenLimChar(),e;if(u=null,e.append(s),s.limChar=this.scanner.lastTokenLimChar(),this.tok.tokenId!=n.TokenID.Comma)break;else this.tok=this.scanner.scan();if(this.tok.tokenId==n.TokenID.RCurly)break}return s&&(e.limChar=s.limChar),e.minChar=v,e},u.prototype.parseArrayList=function(i){var r=null,u;if(this.tok.tokenId==n.TokenID.RBrack)return r;for(r=new n.ASTList,r.minChar=this.scanner.startPos;;){if(u=this.tok.tokenId==n.TokenID.Comma||this.tok.tokenId==n.TokenID.RBrack?new n.AST(n.NodeType.EmptyExpr):this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Cma,!0,t.NoTypes),r.append(u),this.tok.tokenId!=n.TokenID.Comma)break;this.tok=this.scanner.scan()}return r.limChar=this.scanner.lastTokenLimChar(),r},u.prototype.parseArrayLiteral=function(t){var i=null;return i=new n.UnaryExpression(n.NodeType.ArrayLit,this.parseArrayList(t))},u.prototype.parseTerm=function(i,r,u,f){var e=null,l=!1,nt=!1,o=this.scanner.startPos,s=this.scanner.pos,c=!1,p,d,v,w,b,k,y,g,a,h,tt;switch(this.tok.tokenId){case n.TokenID.NUMBER:case n.TokenID.BOOL:case n.TokenID.ANY:case n.TokenID.STRING:p=new n.Identifier(n.tokenTable[this.tok.tokenId].text),n.hasFlag(u,t.Primitive)?(e=new n.TypeReference(p,0),l=!0):(e=p,l=!0),e.minChar=o,this.tok=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.THIS:e=new n.AST(n.NodeType.This),e.minChar=o,this.tok=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.SUPER:e=new n.AST(n.NodeType.Super),e.minChar=o,this.tok=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.TRUE:e=new n.AST(n.NodeType.True),this.tok=this.scanner.scan(),e.minChar=o;break;case n.TokenID.FALSE:e=new n.AST(n.NodeType.False),this.tok=this.scanner.scan(),e.minChar=o;break;case n.TokenID.NULL:e=new n.AST(n.NodeType.Null),this.tok=this.scanner.scan(),e.minChar=o;break;case n.TokenID.NEW:o=this.scanner.pos,this.tok=this.scanner.scan(),e=new n.CallExpression(n.NodeType.New,this.parseTerm(i,!1,t.AllSimpleTypes,f),null),e.minChar=o,s=this.scanner.lastTokenLimChar(),nt=!0;break;case n.TokenID.FUNCTION:o=this.scanner.pos,e=this.parseFncDecl(i,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,null),e.fncFlags|=n.FncFlags.IsFunctionExpression,e.minChar=o,s=this.scanner.lastTokenLimChar(),e.limChar=s}if(e==null&&(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(d=this.tok.getText(),e=this.createRef(d,o),l=!0,e.minChar=o,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.QMark?e.flags|=n.ASTFlags.PossibleOptionalParameter:this.tok.tokenId==n.TokenID.Arrow&&(c=!0),s=this.scanner.lastTokenLimChar()),f&&this.chkCurTok(n.TokenID.GT,"Expected '>'",i),e==null)switch(this.tok.tokenId){case n.TokenID.LParen:o=this.scanner.pos,v=this.scanner.previousToken().tokenId,this.tok=this.scanner.scan(),w=v==n.TokenID.LParen||v==n.TokenID.Comma||v==n.TokenID.EQ||v==n.TokenID.Colon,w&&this.tok.tokenId==n.TokenID.RParen?(c=!0,this.tok=this.scanner.scan()):(e=this.parseExpr(i|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes),s=this.scanner.lastTokenLimChar(),c=w&&(e.nodeType==n.NodeType.Name||e.nodeType==n.NodeType.Comma)&&(this.tok.tokenId==n.TokenID.Colon||this.tok.tokenId==n.TokenID.QMark)),e&&!c&&(this.chkCurTok(n.TokenID.RParen,"Expected ')'",i),e.isParenthesized=!0);break;case n.TokenID.NumberLit:b=this.tok,this.tok=this.scanner.scan(),e=new n.NumberLiteral(b.value),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.QString:e=new n.StringLiteral(this.tok.getText()),this.tok=this.scanner.scan(),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.Regex:k=this.tok,e=new n.RegexLiteral(k.regex),this.tok=this.scanner.scan(),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.LBrack:o=this.scanner.startPos,this.tok=this.scanner.scan(),e=this.parseArrayLiteral(n.ErrorRecoverySet.RBrack|i),e.minChar=o,s=this.scanner.pos,this.chkCurTok(n.TokenID.RBrack,"Expected ']'",i);break;case n.TokenID.LCurly:o=this.scanner.startPos,this.tok=this.scanner.scan(),y=this.parseMemberList(n.ErrorRecoverySet.RCurly|i),this.chkCurTok(n.TokenID.RCurly,"Expected '}'",i),e=new n.UnaryExpression(n.NodeType.ObjectLit,y),e.minChar=o,s=this.scanner.lastTokenLimChar(),y.minChar=o,y.limChar=s;break;case n.TokenID.LT:o=this.scanner.startPos,this.tok=this.scanner.scan(),g=this.parseTypeReference(n.ErrorRecoverySet.BinOp,!1),this.chkCurTok(n.TokenID.GT,"Expected '>'",i),e=new n.UnaryExpression(n.NodeType.TypeAssertion,this.parseExpr(i,n.OperatorPrecedence.Uni,!1,t.NoTypes)),e.castTerm=g;break;default:this.prevExpr&&n.hasFlag(this.prevExpr.flags,n.ASTFlags.PossibleOptionalParameter)?(c=!0,e=this.prevExpr):(this.reportParseError("Check format of expression term"),this.errorRecovery&&(a=new n.MissingIdentifier,a.minChar=o,a.flags|=n.ASTFlags.Error,this.skip(i|n.ErrorRecoverySet.Postfix),this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode)?(a.text=this.tok.getText(),this.tok=this.scanner.scan(),s=this.scanner.lastTokenLimChar()):s=this.scanner.lastTokenLimChar(),e=a))}return c&&(this.tok.tokenId==n.TokenID.Arrow||this.tok.tokenId==n.TokenID.Colon||this.tok.tokenId==n.TokenID.Comma||this.tok.tokenId==n.TokenID.RParen?(e=this.parseFncDecl(i,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,{preProcessedLambdaArgs:e}),e.fncFlags|=n.FncFlags.IsFunctionExpression,e.fncFlags|=n.FncFlags.IsFatArrowFunction,e.minChar=o,s=this.scanner.lastTokenLimChar(),e.limChar=s):e&&(e.isParenthesized=!0)),l&&u!=t.NoTypes&&(u|=t.ArraySuffix),h=this.parsePostfixOperators(i,e,r,nt,u,o,s),h?(l&&h.nodeType==n.NodeType.Index&&(tt=h,tt.operand2==null&&(h=this.convertToTypeReference(h))),h.minChar=o,h.limChar=n.max(h.limChar,this.scanner.lastTokenLimChar()),h):new n.AST(n.NodeType.Error)},u.prototype.parseExpr=function(i,r,u,f){var e=null,o=n.lookupToken(this.tok.tokenId),v=!0,y=null,d=this.scanner.startPos,it=this.parseComments(),g=!1,s,l,p,c,w,b,nt,k,a,rt,h,tt;if(o!=undefined&&o.unopNodeType!=n.NodeType.None)v=!1,this.tok=this.scanner.scan(),s=this.parseExpr(n.ErrorRecoverySet.BinOp|i,o.unopPrecedence,u,t.NoTypes),o.unopNodeType==n.NodeType.Pos&&s.nodeType==n.NodeType.NumberLit?e=s:o.unopNodeType==n.NodeType.Neg&&s.nodeType==n.NodeType.NumberLit?(l=s,l.value=-l.value,l.value==0&&(l.isNegativeZero=!0),e=s):(e=new n.UnaryExpression(o.unopNodeType,s),e.limChar=s.limChar),e.minChar=d;else{if(e=this.parseTerm(n.ErrorRecoverySet.BinOp|n.ErrorRecoverySet.AddOp|i,!0,f,!1),e.nodeType==n.NodeType.Name)p=e,y=p.text;else if(e.nodeType==n.NodeType.Dot&&(w=!1,this.inferPropertiesFromThisAssignment&&(this.tok.tokenId==n.TokenID.Colon||this.tok.tokenId==n.TokenID.Asg)&&this.parsingClassConstructorDefinition&&this.nestingLevel==this.currentClassDefinition.constructorNestingLevel&&e.operand1.nodeType==n.NodeType.This&&e.operand2.nodeType==n.NodeType.Name&&(b=e.operand2,this.currentClassDefinition.knownMemberNames[b.text]||(e=this.parseClassMemberVariableDeclaration(b,e.minChar,!0,i,n.Modifiers.Public),w=!0)),!w)){for(c=e;c.nodeType==n.NodeType.Dot;)nt=c,c=nt.operand2;c.nodeType==n.NodeType.Name&&(p=c,y=p.text)}this.scanner.lastTokenHadNewline()||this.tok.tokenId!=n.TokenID.Inc&&this.tok.tokenId!=n.TokenID.Dec||(v=!1,k=e,e=new n.UnaryExpression(this.tok.tokenId==n.TokenID.Inc?n.NodeType.IncPost:n.NodeType.DecPost,k),e.limChar=this.scanner.pos,e.minChar=k.minChar,this.tok=this.scanner.scan())}for(;;){if(o=n.lookupToken(this.tok.tokenId),o==undefined||o.binopNodeType==n.NodeType.None)break;if(!u&&o.binopNodeType==n.NodeType.In)break;if(o.binopPrecedence==n.OperatorPrecedence.Asg){if(o.binopPrecedence<r)break;v||this.reportParseError("illegal assignment")}else if(o.binopPrecedence<=r)break;this.tok=this.scanner.scan(),v=!1,o.binopNodeType==n.NodeType.QMark?(this.prevExpr=e,a=this.parseExpr(i|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.Asg,u,t.NoTypes),this.prevExpr=null,a.nodeType==n.NodeType.FuncDecl&&n.hasFlag(a.fncFlags,n.FncFlags.IsFatArrowFunction)?(e=a,g=!0):(this.chkCurTok(n.TokenID.Colon,"Expected :",i|n.ErrorRecoverySet.ExprStart),e=new n.TrinaryExpression(n.NodeType.QMark,e,a,this.parseExpr(i|n.ErrorRecoverySet.BinOp,n.OperatorPrecedence.Asg,u,t.NoTypes)))):(rt=t.NoTypes,h=new n.BinaryExpression(o.binopNodeType,e,this.parseExpr(i|n.ErrorRecoverySet.BinOp,o.binopPrecedence,u,t.NoTypes)),h.operand2.nodeType==n.NodeType.FuncDecl&&(tt=h.operand2,tt.hint=y),h.minChar=e.minChar,h.limChar=this.scanner.lastTokenLimChar(),y=null,e=h)}return v&&(e.flags|=n.ASTFlags.Writeable),g||(e.minChar=d,e.limChar=n.max(e.limChar,this.scanner.lastTokenLimChar()),e.preComments=it,e.postComments=this.parseCommentsForLine(this.scanner.line)),e},u.prototype.parsePostfixOperators=function(i,r,u,f,e,o,s){var v=0,c,l,h,a;for(r||(r=new n.AST(n.NodeType.EmptyExpr),r.isParenthesized=!0),r.minChar=o,r.limChar=s;;)switch(this.tok.tokenId){case n.TokenID.LParen:if(f)c=r,c.args=this.parseArgList(i),f=!1;else{if(!u)return r;r=new n.CallExpression(n.NodeType.Call,r,this.parseArgList(i)),r.minChar=o}r.limChar=this.scanner.pos,this.chkCurTok(n.TokenID.RParen,"Expected ')'",i);break;case n.TokenID.LBrack:if(this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.RBrack&&n.hasFlag(e,t.ArraySuffix)){this.tok=this.scanner.scan(),r.nodeType==n.NodeType.TypeRef?(l=r,l.arrayCount++):r=new n.BinaryExpression(n.NodeType.Index,r,null),r.limChar=this.scanner.pos;break}r=new n.BinaryExpression(n.NodeType.Index,r,this.parseExpr(i|n.ErrorRecoverySet.RBrack,n.OperatorPrecedence.No,!0,t.NoTypes)),r.minChar=o,r.limChar=this.scanner.pos,this.chkCurTok(n.TokenID.RBrack,"Expected ']'",i);break;case n.TokenID.Dot:if(h=null,a=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.ID||!this.scanner.lastTokenHadNewline()&&n.convertTokToIDName(this.tok))r.flags|=n.ASTFlags.DotLHS,h=this.createRef(this.tok.getText(),this.scanner.startPos),h.limChar=this.scanner.pos,this.tok=this.scanner.scan();else{if(this.reportParseError("Expected identifier following dot"),this.errorRecovery)return this.skip(i),r.flags|=n.ASTFlags.Error|n.ASTFlags.DotLHS,r;h=new n.MissingIdentifier}r=new n.BinaryExpression(n.NodeType.Dot,r,h),r.minChar=o,r.limChar=this.scanner.lastTokenLimChar();break;case n.TokenID.Arrow:r=this.parseFncDecl(i,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,{preProcessedLambdaArgs:r}),r.fncFlags|=n.FncFlags.IsFunctionExpression,r.minChar=o,r.limChar=this.scanner.lastTokenLimChar();break;default:return r}},u.prototype.parseTry=function(t,i,r,u){var e=this.scanner.startPos,o=this.parseComments(),f;return(this.tok=this.scanner.scan(),this.tok.tokenId!=n.TokenID.LCurly&&(this.reportParseError("Expected '{'"),this.errorRecovery))?(f=t,f.minChar=e,f.limChar=this.scanner.lastTokenLimChar(),f.flags|=n.ASTFlags.Error,f):(t.body=this.parseStatement(i,r,u),t.minChar=e,t.limChar=t.body.limChar,t.preComments=o,t.postComments=this.parseComments(),t)},u.prototype.parseCatch=function(t,i,r){var s=this.scanner.startPos,h=this.parseComments(),f,u,o,e;return(this.tok=this.scanner.scan(),this.chkCurTok(n.TokenID.LParen,"Expected '('",t|n.ErrorRecoverySet.ExprStart),(this.tok.tokenId!=n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(this.reportParseError("Expected identifier in catch header"),this.errorRecovery))?(this.skip(t),u=new n.Catch(new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),new n.Statement(n.NodeType.Empty)),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,u.flags|=n.ASTFlags.Error,u):(f=new n.VarDecl(new n.Identifier(this.tok.getText()),this.nestingLevel),f.id.minChar=this.scanner.startPos,f.id.limChar=this.scanner.pos,f.minChar=f.id.minChar,f.limChar=f.id.limChar,this.tok=this.scanner.scan(),this.chkCurTok(n.TokenID.RParen,"Expected ')'",t|n.ErrorRecoverySet.StmtStart),this.tok.tokenId!=n.TokenID.LCurly&&(this.reportParseError("Expected '{' to start catch body"),this.errorRecovery))?(this.skip(t),u=new n.Catch(new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),new n.Statement(n.NodeType.Empty)),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,u.flags|=n.ASTFlags.Error,u):(o=this.parseStatement(t,i,r),e=new n.Catch(f,o),e.minChar=s,e.limChar=o.limChar,e.preComments=h,e.postComments=this.parseComments(),e)},u.prototype.parseFinally=function(t,i,r){var o=this.scanner.startPos,s=this.parseComments(),f,e,u;return(this.tok=this.scanner.scan(),this.tok.tokenId!=n.TokenID.LCurly&&(this.reportParseError("Expected '{' to start body of finally statement"),this.errorRecovery))?(this.skip(t),f=new n.Finally(new n.Statement(n.NodeType.Empty)),f.flags|=n.ASTFlags.Error,f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,f):(e=this.parseStatement(t,i,r),u=new n.Finally(e),u.minChar=o,u.limChar=u.body.limChar,u.preComments=s,u.postComments=this.parseComments(),u)},u.prototype.parseTryCatchFinally=function(t,i,r,u){var f=new n.Try(null),l=this.scanner.startPos,e,o,h,s,c;return this.pushStmt(f,u),this.parseTry(f,t|n.ErrorRecoverySet.Catch,i,r),this.popStmt(),e=null,o=null,this.tok.tokenId==n.TokenID.CATCH&&(h=this.parseCatch(t|n.ErrorRecoverySet.Catch,i,r),e=new n.TryCatch(f,h),e.minChar=f.minChar,e.limChar=h.limChar),this.tok.tokenId!=n.TokenID.FINALLY?e==null?(this.reportParseError("try with neither catch nor finally"),this.errorRecovery)?(s=new n.TryFinally(f,new n.Finally(new n.AST(n.NodeType.Empty))),s.flags|=n.ASTFlags.Error,s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,s):new n.TryFinally(f,new n.Finally(new n.AST(n.NodeType.Empty))):e:(e&&(f=e),c=this.parseFinally(t,i,r),o=new n.TryFinally(f,c),o.minChar=l,o.limChar=c.limChar,o)},u.prototype.parseStatement=function(r,u,f){function rt(){return n.hasFlag(o,n.Modifiers.Ambient)||n.hasFlag(f,n.Modifiers.Ambient)}function l(){n.hasFlag(o,n.Modifiers.Exported)&&this.reportError("Statement may not be exported")}var e=null,a=null,pt=null,c,o=n.Modifiers.None,s=this.scanner.startPos,lt=!1,y=!1,h=null,yt=this.parseComments(),g,et,st,tt,v,ct,it,p,at,b,ht,nt,w,d,k,ft,ut,ot,vt;for(this.state=i.StartStatement;;){switch(this.tok.tokenId){case n.TokenID.EOF:e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.pos;break;case n.TokenID.FUNCTION:this.inStaticFnc&&this.reportParseError("Ambient static function delarations may only contain other ambient static function declarations"),this.parsingDeclareFile||rt()||this.ambientModule?(this.tok=this.scanner.scan(),h=this.parsePropertyDecl(r|n.ErrorRecoverySet.SColon,o,!0,!1),h.nodeType==n.NodeType.VarDecl?this.reportParseError("function keyword can only introduce function declaration"):h.nodeType==n.NodeType.FuncDecl&&(h.fncFlags,n.FncFlags.IsFatArrowFunction)&&(y=!0),e=h):(e=this.parseFncDecl(r,!0,!1,!1,null,!1,!1,rt(),o,null),n.hasFlag(e.fncFlags,n.FncFlags.IsFatArrowFunction)&&(y=!0),this.ambientModule&&this.reportParseError("function declaration not permitted within ambient module"),n.hasFlag(o,n.Modifiers.Exported)&&(e.fncFlags|=n.FncFlags.Exported));break;case n.TokenID.MODULE:(u&n.AllowedElements.ModuleDecls)==n.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseModuleDecl(r,o);break;case n.TokenID.IMPORT:(u&n.AllowedElements.ModuleDecls)==n.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseImportDecl(r,o);break;case n.TokenID.EXPORT:(u&n.AllowedElements.ModuleDecls)==n.AllowedElements.None&&(this.reportParseError("'export' statements are only allowed at the global and module levels"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()),this.topLevel&&(this.hasTopLevelImportOrExport=!0),o|=n.Modifiers.Exported,this.tok=this.scanner.scan();break;case n.TokenID.PRIVATE:o|=n.Modifiers.Private,this.tok=this.scanner.scan(),this.parsingClassConstructorDefinition?(this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),s=this.scanner.pos,this.inferPropertiesFromThisAssignment&&(this.tok.tokenId!=n.TokenID.THIS||(this.tok=this.scanner.scan()).tokenId!=n.TokenID.Dot)?(this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(this.tok=this.scanner.scan(),g=new n.Identifier(this.tok.getText()),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.tok=this.scanner.scan(),e=this.parseClassMemberVariableDeclaration(g,s,this.parsingClassConstructorDefinition,r,o))):this.tok.tokenId!=n.TokenID.INTERFACE&&(this.tok.tokenId==n.TokenID.GET?(this.prevIDTok=this.tok,this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.tok.tokenId==n.TokenID.SET&&(this.prevIDTok=this.tok,this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Setter,this.prevIDTok=null)),h=this.parsePropertyDecl(r|n.ErrorRecoverySet.SColon,o,rt(),!1),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(y=!0),e=h);break;case n.TokenID.PUBLIC:this.parsingClassConstructorDefinition?(this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),this.tok=this.scanner.scan(),s=this.scanner.pos,o|=n.Modifiers.Public,this.inferPropertiesFromThisAssignment&&(this.tok.tokenId!=n.TokenID.THIS||(this.tok=this.scanner.scan()).tokenId!=n.TokenID.Dot)?(this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(this.tok=this.scanner.scan(),g=new n.Identifier(this.tok.getText()),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.tok=this.scanner.scan(),e=this.parseClassMemberVariableDeclaration(g,s,this.parsingClassConstructorDefinition,r,o))):(u&n.AllowedElements.Properties)==n.AllowedElements.None?(this.reportParseError("'property' statements are only allowed within classes"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(o|=n.Modifiers.Public,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.GET?(this.prevIDTok=this.tok,this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.tok.tokenId==n.TokenID.SET&&(this.prevIDTok=this.tok,this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Setter,this.prevIDTok=null)),h=this.parsePropertyDecl(r|n.ErrorRecoverySet.SColon,o,rt(),!1),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(y=!0),e=h);break;case n.TokenID.DECLARE:u&n.AllowedElements.AmbientDecls||this.reportParseError("Ambient declarations are only allowed at the top-level or module scopes"),!this.parsingDeclareFile&&n.hasFlag(f,n.Modifiers.Ambient)&&this.reportParseError("Duplicate ambient declaration in this context. (Is the enclosing module or class already ambient?)"),o|=n.Modifiers.Ambient,this.tok=this.scanner.scan();break;case n.TokenID.CLASS:(u&n.AllowedElements.ClassDecls)==n.AllowedElements.None?(this.reportParseError("class not allowed in this context"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseClassDecl(r,s,o);break;case n.TokenID.INTERFACE:(u&n.AllowedElements.InterfaceDecls)==n.AllowedElements.None?(this.reportParseError("interface not allowed in this context"),this.tok=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseInterfaceDecl(r,o);break;case n.TokenID.VAR:et=this.parseVarDecl(r|n.ErrorRecoverySet.StmtStart,o,!0,!1,!1),e=et.nodeType==n.NodeType.VarDecl?et:new n.Block(et,!1),y=!0,(this.parsingDeclareFile||this.ambientModule&&e.nodeType==n.NodeType.VarDecl)&&(e.varFlags|=n.VarFlags.Exported);break;case n.TokenID.STATIC:this.currentClassDecl==null&&this.reportParseError("Statics may only be class members"),l(),o|=n.Modifiers.Public,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.GET?(this.prevIDTok=this.tok,this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.tok.tokenId==n.TokenID.SET&&(this.tok=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.tok.tokenId==n.TokenID.ID||n.convertTokToID(this.tok,this.strictMode))&&(o|=n.Modifiers.Setter)),rt()&&(o|=n.Modifiers.Ambient),h=this.parsePropertyDecl(r|n.ErrorRecoverySet.SColon,o,this.parsingDeclareFile||(o&n.Modifiers.Ambient)!=n.Modifiers.None,!0),st=this.topStaticsList(),st&&h.nodeType==n.NodeType.VarDecl&&st.append(h),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(y=!0),e=h;break;case n.TokenID.FOR:l(),o!=n.Modifiers.None&&this.reportParseError("syntax error: for statement does not take modifiers"),s=this.scanner.startPos,this.chkNxtTok(n.TokenID.LParen,"Expected '('",r|n.ErrorRecoverySet.ExprStart|n.ErrorRecoverySet.Var),this.state=i.ForInit,lt=!0;switch(this.tok.tokenId){case n.TokenID.VAR:c=this.parseVarDecl(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.In,n.Modifiers.None,!1,!1,!1);break;case n.TokenID.SColon:c=null,this.state=i.ForCondStart;break;default:c=this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.In,n.OperatorPrecedence.No,!1,t.NoTypes)}this.state=i.ForInitAfterVar,this.tok.tokenId==n.TokenID.IN?c!=null&&lt?(this.tok=this.scanner.scan(),tt=new n.ForInStatement(c,this.parseExpr(n.ErrorRecoverySet.RParen|r,n.OperatorPrecedence.Cma,!1,t.NoTypes)),tt.limChar=this.scanner.pos,this.chkCurTok(n.TokenID.RParen,"Expected ')'",n.ErrorRecoverySet.StmtStart|r),this.pushStmt(tt,a),tt.body=this.parseStatement(r,u,f),this.popStmt(),tt.minChar=s,e=tt):(this.reportParseError("malformed for statement"),this.errorRecovery&&(this.skip(r|n.ErrorRecoverySet.StmtStart),e=new n.AST(n.NodeType.Empty),e.flags|=n.ASTFlags.Error)):(v=new n.ForStatement(c),v.minChar=s,this.chkCurTok(n.TokenID.SColon,"Expected ';'",r),this.tok.tokenId==n.TokenID.SColon?v.cond=null:(v.cond=this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes),this.tok.tokenId!=n.TokenID.SColon&&(this.skip(r|n.ErrorRecoverySet.StmtStart),e=v,e.flags|=n.ASTFlags.Error)),this.tok=this.scanner.scan(),v.incr=this.tok.tokenId==n.TokenID.RParen?null:this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes),this.chkCurTok(n.TokenID.RParen,"Expected ')'",r|n.ErrorRecoverySet.LCurly),this.pushStmt(v,a),v.body=this.parseStatement(r,u,f),this.popStmt(),v.limChar=v.body.limChar,e=v);break;case n.TokenID.WITH:n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("'with' statements are only available in ES5 codegen mode or better"),this.strictMode&&this.reportParseError("'with' statements are not available in strict mode"),l(),o!=n.Modifiers.None&&this.reportParseError("'with' statement does not take modifiers"),s=this.scanner.startPos,this.chkNxtTok(n.TokenID.LParen,"Expected '('",r|n.ErrorRecoverySet.ExprStart|n.ErrorRecoverySet.Var),ct=this.parseExpr(r|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.No,!0,t.NoTypes),this.chkCurTok(n.TokenID.RParen,"Expected ')'",r|n.ErrorRecoverySet.LCurly),it=new n.WithStatement(ct),it.body=this.parseStatement(r,u,f),it.minChar=s,it.limChar=it.body.limChar,e=it;break;case n.TokenID.SWITCH:for(l(),o!=n.Modifiers.None&&this.reportParseError("'switch' statement does not take modifiers"),this.chkNxtTok(n.TokenID.LParen,"Expected '('",r|n.ErrorRecoverySet.ExprStart),p=new n.SwitchStatement(this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes)),this.chkCurTok(n.TokenID.RParen,"Expected ')'",r|n.ErrorRecoverySet.LCurly),at=this.scanner.startPos,this.chkCurTok(n.TokenID.LCurly,"Expected '{'",r|n.ErrorRecoverySet.SCase),p.defaultCase=null,p.caseList=new n.ASTList,b=null,this.pushStmt(p,a);;)if(this.tok.tokenId==n.TokenID.CASE||this.tok.tokenId==n.TokenID.DEFAULT)ht=this.tok.tokenId==n.TokenID.DEFAULT,b=new n.CaseStatement,b.minChar=this.scanner.startPos,this.tok=this.scanner.scan(),ht?p.defaultCase=b:b.expr=this.parseExpr(r|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.No,!0,t.NoTypes),this.chkCurTok(n.TokenID.Colon,"Expected ':'",r|n.ErrorRecoverySet.StmtStart),b.body=new n.ASTList,this.parseStmtList(r|n.ErrorRecoverySet.RCurly,b.body,!1,!0,u,o),b.limChar=b.body.limChar,p.caseList.append(b);else break;p.caseList.minChar=at,p.caseList.limChar=this.scanner.pos,p.limChar=p.caseList.limChar,this.chkCurTok(n.TokenID.RCurly,"Expected '}'",r),this.popStmt(),e=p;break;case n.TokenID.WHILE:l(),o!=n.Modifiers.None&&this.reportParseError("'while' statement does not take modifiers"),s=this.scanner.startPos,this.chkNxtTok(n.TokenID.LParen,"Expected '('",n.ErrorRecoverySet.ExprStart|r),nt=new n.WhileStatement(this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes)),nt.minChar=s,this.chkCurTok(n.TokenID.RParen,"Expected ')'",r|n.ErrorRecoverySet.StmtStart),this.pushStmt(nt,a),nt.body=this.parseStatement(r,u,f),nt.limChar=nt.body.limChar,this.popStmt(),e=nt;break;case n.TokenID.DO:l(),o!=n.Modifiers.None&&this.reportParseError("'do' statement does not take modifiers"),s=this.scanner.startPos,this.tok=this.scanner.scan(),w=new n.DoWhileStatement,w.minChar=s,this.pushStmt(w,a),w.body=this.parseStatement(r|n.ErrorRecoverySet.While,u,f),this.popStmt(),w.whileAST=new n.Identifier("while"),w.whileAST.minChar=this.scanner.startPos,this.chkCurTok(n.TokenID.WHILE,"Expected 'while'",r|n.ErrorRecoverySet.LParen),w.whileAST.limChar=w.whileAST.minChar+5,this.chkCurTok(n.TokenID.LParen,"Expected '('",r|n.ErrorRecoverySet.ExprStart),w.cond=this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.No,!0,t.NoTypes),w.limChar=this.scanner.pos,this.chkCurTok(n.TokenID.RParen,"Expected ')'",r),e=w,this.tok.tokenId==n.TokenID.SColon&&(this.tok=this.scanner.scan());break;case n.TokenID.IF:l(),o!=n.Modifiers.None&&this.reportParseError("if statement does not take modifiers"),s=this.scanner.startPos,this.chkNxtTok(n.TokenID.LParen,"Expected '('",r|n.ErrorRecoverySet.ExprStart),d=new n.IfStatement(this.parseExpr(r|n.ErrorRecoverySet.LParen,n.OperatorPrecedence.No,!0,t.NoTypes)),d.minChar=s,this.chkCurTok(n.TokenID.RParen,"Expected ')'",r|n.ErrorRecoverySet.StmtStart),this.pushStmt(d,a),d.thenBod=this.parseStatement(n.ErrorRecoverySet.Else|r,u,f),d.limChar=d.thenBod.limChar,this.tok.tokenId==n.TokenID.ELSE&&(this.tok=this.scanner.scan(),d.elseBod=this.parseStatement(r,u,f),d.limChar=d.elseBod.limChar),this.popStmt(),e=d;break;case n.TokenID.TRY:l(),o!=n.Modifiers.None&&this.reportParseError("try statement does not take modifiers"),s=this.scanner.startPos,e=this.parseTryCatchFinally(r,n.AllowedElements.FunctionBody,f,a);break;case n.TokenID.LCurly:l(),o!=n.Modifiers.None&&this.reportParseError("block does not take modifiers"),s=this.scanner.startPos,this.tok=this.scanner.scan(),k=new n.Block(new n.ASTList,!0),this.pushStmt(k,a),this.parseStmtList(r|n.ErrorRecoverySet.RCurly,k.stmts,!1,!1,n.AllowedElements.Block,o),this.popStmt(),k.stmts.minChar=s,k.stmts.limChar=this.scanner.pos,k.minChar=k.stmts.minChar,k.limChar=k.stmts.limChar,this.chkCurTok(n.TokenID.RCurly,"Expected '}'",r),e=k;break;case n.TokenID.SColon:l(),o!=n.Modifiers.None&&this.reportParseError("modifier can not appear here"),e=new n.AST(n.NodeType.Empty),this.tok=this.scanner.scan();break;case n.TokenID.BREAK:case n.TokenID.CONTINUE:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before jump statement"),ft=new n.Jump(this.tok.tokenId==n.TokenID.BREAK?n.NodeType.Break:n.NodeType.Continue),this.tok=this.scanner.scan(),this.tok.tokenId!=n.TokenID.ID||this.scanner.lastTokenHadNewline()||(ft.target=this.tok.getText(),this.tok=this.scanner.scan()),this.resolveJumpTarget(ft),e=ft,y=!0;break;case n.TokenID.RETURN:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before return statement"),this.inFnc||this.reportParseError("return statement outside of function body"),s=this.scanner.startPos,this.tok=this.scanner.scan(),ut=new n.ReturnStatement,ut.minChar=s,this.tok.tokenId==n.TokenID.SColon||this.tok.tokenId==n.TokenID.RCurly||this.scanner.lastTokenHadNewline()||(ut.returnExpression=this.parseExpr(r|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.No,!0,t.NoTypes)),y=!0,ut.limChar=this.scanner.lastTokenLimChar(),e=ut;break;case n.TokenID.THROW:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before a throw statement"),s=this.scanner.startPos,this.tok=this.scanner.scan(),this.tok.tokenId==n.TokenID.SColon||this.tok.tokenId==n.TokenID.RCurly||this.scanner.lastTokenHadNewline()?(this.reportParseError("throw with no target"),c=null):c=this.parseExpr(r|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.No,!0,t.NoTypes),e=new n.UnaryExpression(n.NodeType.Throw,c),e.limChar=this.scanner.lastTokenLimChar(),y=!0;break;case n.TokenID.ENUM:this.tok=this.scanner.scan(),e=this.parseEnumDecl(r,o),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar(),(this.parsingDeclareFile||n.hasFlag(o,n.Modifiers.Ambient))&&(e.modFlags|=n.ModuleFlags.Ambient),n.hasFlag(o,n.Modifiers.Exported)&&(e.modFlags|=n.ModuleFlags.Exported);break;case n.TokenID.DEBUGGER:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before debugger statement"),s=this.scanner.startPos,this.tok=this.scanner.scan(),ot=new n.DebuggerStatement,ot.minChar=s,y=!0,ot.limChar=this.scanner.lastTokenLimChar(),e=ot;break;default:o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before an expression statement or label"),s=this.scanner.startPos,vt=this.scanner.pos,c=this.parseExpr(n.ErrorRecoverySet.Colon|n.ErrorRecoverySet.StmtStart|r,n.OperatorPrecedence.No,!0,t.NoTypes),this.scanner.pos==vt?(this.tok=this.scanner.scan(),e=c):this.tok.tokenId==n.TokenID.Colon&&!this.scanner.lastTokenHadNewline()&&c&&c.nodeType==n.NodeType.Name?(a==null&&(a=new n.ASTList),a.append(new n.Label(c)),this.tok=this.scanner.scan()):(e=c,y=!0)}if(e)break}if(y)switch(this.tok.tokenId){case n.TokenID.SColon:this.tok=this.scanner.scan(),e.flags|=n.ASTFlags.ExplicitSemicolon;break;case n.TokenID.EOF:case n.TokenID.RCurly:e.flags|=n.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon");break;default:this.scanner.lastTokenHadNewline()?(e.flags|=n.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon")):this.reportParseError("Expected ';'")}return a&&(e=new n.LabeledStatement(a,e)),e.minChar=s,e.limChar=n.max(e.limChar,this.scanner.lastTokenLimChar()),e.preComments=yt,this.ambientModule&&!this.okAmbientModuleMember(e)&&this.reportParseError("statement not permitted within ambient module"),e.flags|=n.ASTFlags.IsStatement,e},u.prototype.okAmbientModuleMember=function(t){var i=t.nodeType;return i==n.NodeType.Class||i==n.NodeType.Import||i==n.NodeType.Interface||i==n.NodeType.Module||i==n.NodeType.Empty||i==n.NodeType.VarDecl&&(n.hasFlag(t.varFlags,n.VarFlags.Property)||n.hasFlag(t.varFlags,n.VarFlags.Exported))||i==n.NodeType.FuncDecl&&t.isMethod()},u.prototype.parseStmtList=function(t,r,u,f,e,o){var h=u,l,s,a;r.minChar=this.scanner.startPos;var c=this.scanner.pos,v=(e&n.AllowedElements.ModuleDecls)==n.AllowedElements.None,y=(e&n.AllowedElements.ClassDecls)==n.AllowedElements.None;for(t|=n.ErrorRecoverySet.TypeScriptS|n.ErrorRecoverySet.RCurly,this.state=i.StartStmtList,l=this.strictMode,this.nestingLevel++;;){if(this.tok.tokenId==n.TokenID.RCurly||f&&(this.tok.tokenId==n.TokenID.CASE||this.tok.tokenId==n.TokenID.DEFAULT)||v&&this.tok.tokenId==n.TokenID.EXPORT||y&&this.tok.tokenId==n.TokenID.CLASS||this.tok.tokenId==n.TokenID.EOF){this.state=i.EndStmtList,r.limChar=c,r.members.length==0?r.preComments=this.parseComments():r.postComments=this.parseComments(),this.strictMode=l,this.nestingLevel--;return}s=this.parseStatement(t&~(n.ErrorRecoverySet.Else|n.ErrorRecoverySet.RParen|n.ErrorRecoverySet.Catch|n.ErrorRecoverySet.Colon),e,o),s&&(s.postComments=this.combineComments(s.postComments,this.parseCommentsForLine(this.scanner.prevLine)),r.append(s),c=s.limChar,h&&(s.nodeType==n.NodeType.QString?(a=s,a.text=="use strict"?(r.flags|=n.ASTFlags.StrictMode,this.strictMode=!0):h=!1):h=!1))}},u.prototype.quickParse=function(t,i,u){var e=n.moduleGenTarget,f;try{return n.moduleGenTarget=n.ModuleGenTarget.Local,f=this.parse(t,i,u,n.AllowedElements.QuickParse),new r(f,this.scanner.lexState)}finally{n.moduleGenTarget=e}},u.prototype.parse=function(t,r,u,f){var o,l,e,c,a,s;typeof f=="undefined"&&(f=n.AllowedElements.Global),this.ambientModule=!1,this.topLevel=!0,this.parseError=!1,this.hasTopLevelImportOrExport=!1,this.fname=r,this.currentUnitIndex=u,this.amdDependencies=[],this.scanner.resetComments(),this.scanner.setSourceText(t,n.LexMode.File);var v=this.scanner.leftCurlyCount,y=this.scanner.rightCurlyCount,h=this.scanner.pos;return this.tok=this.scanner.scan(),this.pushDeclLists(),o=new n.ASTList,o.minChar=h,this.state=i.StartScript,this.parsingDeclareFile=n.isDSTRFile(r)||n.isDTSFile(r),this.parseStmtList(n.ErrorRecoverySet.EOF|n.ErrorRecoverySet.Func,o,!0,!1,f,n.Modifiers.None),this.tok.tokenId!=n.TokenID.EOF&&(l=n.tokenTable[this.tok.tokenId],this.reportParseError("Unexpected statement block terminator '"+l.text+"'")),this.state=i.EndScript,o.limChar=this.scanner.pos,e=null,n.moduleGenTarget!=n.ModuleGenTarget.Local&&this.hasTopLevelImportOrExport&&(c=n.switchToForwardSlashes(r),a=new n.Identifier(c),e=new n.ModuleDecl(a,o,this.topVarList(),this.topScopeList()),e.modFlags|=n.ModuleFlags.IsDynamic,e.modFlags|=n.ModuleFlags.IsWholeFile,e.modFlags|=n.ModuleFlags.Exported,this.parsingDeclareFile&&(e.modFlags|=n.ModuleFlags.Ambient),e.minChar=h,e.limChar=this.scanner.pos,e.prettyName=n.getPrettyName(c),e.amdDependencies=this.amdDependencies,o=new n.ASTList,o.minChar=e.minChar,o.limChar=e.limChar,o.append(e)),s=new n.Script(this.topVarList(),this.topScopeList()),s.bod=o,this.popDeclLists(),s.minChar=h,s.limChar=this.scanner.pos,s.locationInfo=new n.LocationInfo(r,this.scanner.lineMap,u),s.leftCurlyCount=this.scanner.leftCurlyCount-v,s.rightCurlyCount=this.scanner.rightCurlyCount-y,s.isDeclareFile=this.parsingDeclareFile,s.topLevelMod=e,s},u}(),n.Parser=u,n.quickParse=f}(TypeScript||(TypeScript={})),function(n){function i(n,t,i){var r=i.state;return n.print(r),r.increaseIndent(),n}function r(n,t,i){var r=i.state;return r.decreaseIndent(),n}var t=function(){function t(n,t){this.outfile=n,this.parser=t,this.builder="",this.indent1="  ",this.indentStrings=[],this.indentAmt=0}return t.prototype.increaseIndent=function(){this.indentAmt++},t.prototype.decreaseIndent=function(){this.indentAmt--},t.prototype.startLine=function(){var t,i;if(this.builder.length>0&&n.CompilerDiagnostics.Alert(this.builder),t=this.indentStrings[this.indentAmt],t===undefined){for(t="",i=0;i<this.indentAmt;i++)t+=this.indent1;this.indentStrings[this.indentAmt]=t}this.builder+=t},t.prototype.write=function(n){this.builder+=n},t.prototype.writeLine=function(n){this.builder+=n,this.outfile.WriteLine(this.builder),this.builder=""},t}();n.PrintContext=t,n.prePrintAST=i,n.postPrintAST=r}(TypeScript||(TypeScript={})),function(n){function l(){var r,i;n.initializeStaticTokens(),t[n.LexCodeLPR]=n.staticTokens[n.TokenID.LParen],t[n.LexCodeRPR]=n.staticTokens[n.TokenID.RParen],t[n.LexCodeCMA]=n.staticTokens[n.TokenID.Comma],t[n.LexCodeSMC]=n.staticTokens[n.TokenID.SColon],t[n.LexCodeLBR]=n.staticTokens[n.TokenID.LBrack],t[n.LexCodeRBR]=n.staticTokens[n.TokenID.RBrack],t[n.LexCodeTIL]=n.staticTokens[n.TokenID.Tilde],t[n.LexCodeQUE]=n.staticTokens[n.TokenID.QMark],t[n.LexCodeLC]=n.staticTokens[n.TokenID.LCurly],t[n.LexCodeRC]=n.staticTokens[n.TokenID.RCurly],t[n.LexCodeCOL]=n.staticTokens[n.TokenID.Colon],n.LexKeywordTable=new n.StringHashTable;for(r in n.TokenID._map)r<=n.TokenID.LimKeyword&&n.LexKeywordTable.add(n.TokenID._map[r].toLowerCase(),r);for(i=0;i<128;i++)f[i]=v(i)?!0:!1}function it(t,i){return t==n.LexCodeLBR||t==n.LexCodeLC||t==n.LexCodeLPR?i+1:t==n.LexCodeRBR||t==n.LexCodeRC||t==n.LexCodeRPR?i-1:i}function v(t){return t>=97&&t<=122||t>=65&&t<=90||t==n.LexCodeDollar||t==n.LexCodeUnderscore}function e(n){return n>=48&&n<=57}function tt(n){return f[n]||e(n)}function nt(t){return t==n.LexCodeRBR?n.LexCodeLBR:t==n.LexCodeRC?n.LexCodeLC:t==n.LexCodeRPR?n.LexCodeLPR:0}function rt(n){return y(n,!0,!1)}function k(n,t){return y(n,!1,t)}function y(t,i,r){var u,f;if(t.tokenId<=n.TokenID.LimKeyword)if(u=n.lookupToken(t.tokenId),u!=undefined){if(f=n.Reservation.Javascript|n.Reservation.JavascriptFuture,r&&(f|=n.Reservation.JavascriptFutureStrict),i||!n.hasFlag(u.reservation,f))return!0}else return!1;else return!1}function s(n,t){var i,u,r;if(t===-1)return 0;for(i=0,u=n.length-1;i<u;)r=i+u>>1,t<n[r]?u=r-1:i=t<n[r+1]?u=r:r+1;return i}function a(n,t,i){var r=s(i,t);r>0&&(n.line=r,n.col=t-i[r])}function g(n,t){var i={line:-1,col:-1};return a(i,t,n.locationInfo.lineMap),i.col>=0&&i.col++,i}function ut(n,t,i){return n.locationInfo.lineMap[t]+(i-1)}var t,f,i,u,r,d,h,o,c,w,p,b;n.LexEOF=-1,n.LexCodeNWL=10,n.LexCodeRET=13,n.LexCodeTAB=9,n.LexCodeVTAB=11,n.LexCode_e="e".charCodeAt(0),n.LexCode_E="E".charCodeAt(0),n.LexCode_x="x".charCodeAt(0),n.LexCode_X="X".charCodeAt(0),n.LexCode_a="a".charCodeAt(0),n.LexCode_A="A".charCodeAt(0),n.LexCode_f="f".charCodeAt(0),n.LexCode_F="F".charCodeAt(0),n.LexCode_g="g".charCodeAt(0),n.LexCode_m="m".charCodeAt(0),n.LexCode_i="i".charCodeAt(0),n.LexCode_0="0".charCodeAt(0),n.LexCode_9="9".charCodeAt(0),n.LexCode_8="8".charCodeAt(0),n.LexCode_7="7".charCodeAt(0),n.LexCodeBSL="\\".charCodeAt(0),n.LexCodeSHP="#".charCodeAt(0),n.LexCodeBNG="!".charCodeAt(0),n.LexCodeQUO='"'.charCodeAt(0),n.LexCodeAPO="'".charCodeAt(0),n.LexCodePCT="%".charCodeAt(0),n.LexCodeAMP="&".charCodeAt(0),n.LexCodeLPR="(".charCodeAt(0),n.LexCodeRPR=")".charCodeAt(0),n.LexCodePLS="+".charCodeAt(0),n.LexCodeMIN="-".charCodeAt(0),n.LexCodeMUL="*".charCodeAt(0),n.LexCodeSLH="/".charCodeAt(0),n.LexCodeXOR="^".charCodeAt(0),n.LexCodeCMA=",".charCodeAt(0),n.LexCodeDOT=".".charCodeAt(0),n.LexCodeLT="<".charCodeAt(0),n.LexCodeEQ="=".charCodeAt(0),n.LexCodeGT=">".charCodeAt(0),n.LexCodeQUE="?".charCodeAt(0),n.LexCodeLBR="[".charCodeAt(0),n.LexCodeRBR="]".charCodeAt(0),n.LexCodeUSC="_".charCodeAt(0),n.LexCodeLC="{".charCodeAt(0),n.LexCodeRC="}".charCodeAt(0),n.LexCodeBAR="|".charCodeAt(0),n.LexCodeTIL="~".charCodeAt(0),n.LexCodeCOL=":".charCodeAt(0),n.LexCodeSMC=";".charCodeAt(0),n.LexCodeUnderscore="_".charCodeAt(0),n.LexCodeDollar="$".charCodeAt(0),n.LexCodeSpace=32,n.LexKeywordTable=undefined,t=new Array(128),f=new Array(128),n.LexInitialize=l,n.LexAdjustIndent=it,n.LexIsIdentifierStartChar=v,n.LexIsDigit=e,n.LexIsIdentifierChar=tt,n.LexMatchingOpen=nt,function(n){n._map=[],n._map[0]="Start",n.Start=0,n._map[1]="InFraction",n.InFraction=1,n._map[2]="InExponent",n.InExponent=2}(n.NumberScanState||(n.NumberScanState={})),i=n.NumberScanState,function(n){n._map=[],n._map[0]="Start",n.Start=0,n._map[1]="InMultilineComment",n.InMultilineComment=1}(n.LexState||(n.LexState={})),u=n.LexState,function(n){n._map=[],n._map[0]="Line",n.Line=0,n._map[1]="File",n.File=1}(n.LexMode||(n.LexMode={})),r=n.LexMode,function(n){n._map=[],n._map[0]="Line",n.Line=0,n._map[1]="Block",n.Block=1}(n.CommentStyle||(n.CommentStyle={})),d=n.CommentStyle,h=function(){function n(n){this.text=n}return n.prototype.getText=function(n,t){return this.text.substring(n,t)},n.prototype.getLength=function(){return this.text.length},n}(),n.StringSourceText=h,o=function(){function n(n,t,i){this.segmentStart=n,this.segmentEnd=t,this.segment=i}return n.prototype.charCodeAt=function(n){return this.segment.charCodeAt(n-this.segmentStart)},n.prototype.substring=function(n,t){return this.segment.substring(n-this.segmentStart,t-this.segmentStart)},n}(),n.SourceTextSegment=o,c=function(){function n(n,t){this.seg1=n,this.seg2=t}return n.prototype.charCodeAt=function(n){return this.seg1.segmentStart<=n&&n<this.seg1.segmentEnd?this.seg1.segment.charCodeAt(n-this.seg1.segmentStart):this.seg2.segment.charCodeAt(n-this.seg2.segmentStart)},n.prototype.substring=function(n,t){return this.seg1.segmentStart<=n&&t<=this.seg1.segmentEnd?this.seg1.segment.substring(n-this.seg1.segmentStart,t-this.seg1.segmentStart):this.seg2.segment.substring(n-this.seg2.segmentStart)+this.seg1.segment.substring(0,t-this.seg1.segmentStart)},n}(),n.AggerateSourceTextSegment=c,w=function(){function t(n){this.sourceText=n,this.agg=new c(t.emptySegment,t.emptySegment),this.len=this.sourceText.getLength()}return t.emptySegment=new o(0,0,""),t.prototype.max=function(n,t){return n>=t?n:t},t.prototype.min=function(n,t){return n<=t?n:t},t.prototype.fetchSegment=function(t,i){var e,s;if(this.agg.seg1.segmentStart<=t&&i<=this.agg.seg1.segmentEnd)return this.agg.seg1;if(this.agg.seg2.segmentStart<=t&&i<=this.agg.seg1.segmentEnd)return this.agg;var f=this.agg.seg1,u=f.segmentEnd,r=n.max(u+512,i);return r=n.min(r,this.len),e=this.sourceText.getText(u,r),s=new o(u,r,e),this.agg.seg2=f,this.agg.seg1=s,this.agg},t.prototype.charCodeAt=function(n){return this.fetchSegment(n,n+1).charCodeAt(n)},t.prototype.substring=function(n,t){return this.fetchSegment(n,t).substring(n,t)},t}(),n.ScannerTextStream=w,p=function(){function t(){this.prevToken=null,this.curSavedToken=null,this.prevSavedToken=null,this.prevToken=null,this.currentToken=0,this.tokens=[],this.prevLine=1,this.line=1,this.col=0,this.lexState=u.Start,this.commentStack=[]}return t.prototype.previousToken=function(){return this.prevToken},t.prototype.close=function(){this.currentToken=0},t.prototype.addToken=function(t,i){this.tokens[this.currentToken++]=new n.SavedToken(t,i.startPos,i.pos)},t.prototype.scan=function(){if(this.startLine=this.line,this.startPos=this.col,this.currentTokenIndex==this.currentTokens.length)if(this.line<this.lineMap.length)this.line++,this.col=0,this.currentTokenIndex=0,this.currentTokens=this.tokensByLine[this.line];else return n.staticTokens[n.TokenID.EOF];if(this.currentTokenIndex<this.currentTokens.length){this.prevToken=this.curSavedToken.tok,this.prevSavedToken=this.curSavedToken,this.curSavedToken=this.currentTokens[this.currentTokenIndex++];var t=this.curSavedToken.tok;return this.pos=this.curSavedToken.limChar,this.col+=this.curSavedToken.limChar-this.curSavedToken.minChar,this.startPos=this.curSavedToken.minChar,this.prevLine=this.line,t}return n.staticTokens[n.TokenID.EOF]},t.prototype.syncToTok=function(n){var t,i;for(this.line=s(this.lineMap,n),this.currentTokenIndex=0,t=n-this.lineMap[this.line];this.lexStateByLine[this.line]==u.InMultilineComment&&this.line>0;)this.line--,t=0;for(i=this.lineMap.length-1,this.currentTokens=this.tokensByLine[this.line];this.currentTokens.length==0&&this.line<i;)this.line++,this.currentTokens=this.tokensByLine[this.line],t=0;if(this.line<=i){while(this.currentTokenIndex<this.currentTokens.length&&t>this.currentTokens[this.currentTokenIndex].limChar)this.currentTokenIndex++;if(this.currentTokenIndex<this.currentTokens.length)return this.col=this.currentTokens[this.currentTokenIndex].minChar,this.col+this.lineMap[this.line]}return-1},t.prototype.lastTokenLimChar=function(){return this.prevSavedToken!==null?this.prevSavedToken.limChar:0},t.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},t.prototype.pushComment=function(n){this.commentStack.push(n)},t.prototype.getComments=function(){var n=this.commentStack;return this.commentStack=[],n},t.prototype.getCommentsForLine=function(n){for(var t=null;this.commentStack.length>0&&this.commentStack[0].line==n;)t=t==null?[this.commentStack.shift()]:t.concat([this.commentStack.shift()]);return t},t.prototype.resetComments=function(){this.commentStack=[]},t.prototype.setSourceText=function(){},t}(),n.SavedTokens=p,b=function(){function o(){this.prevLine=1,this.line=1,this.col=0,this.pos=0,this.startPos=0,this.len=0,this.lineMap=[],this.ch=n.LexEOF,this.lexState=u.Start,this.mode=r.File,this.scanComments=!0,this.interveningWhitespace=!1,this.interveningWhitespacePos=0,this.leftCurlyCount=0,this.rightCurlyCount=0,this.commentStack=[],this.saveScan=null,this.prevTok=n.staticTokens[n.TokenID.EOF],this.startCol=this.col,this.startLine=this.line,this.lineMap[1]=0,n.LexKeywordTable||l()}return o.prototype.previousToken=function(){return this.prevTok},o.prototype.setSourceText=function(n,t){this.mode=t,this.scanComments=this.mode===r.Line,this.pos=0,this.interveningWhitespacePos=0,this.startPos=0,this.line=1,this.col=0,this.startCol=this.col,this.startLine=this.line,this.len=0,this.src=n.getText(0,n.getLength()),this.len=this.src.length,this.lineMap=[],this.lineMap[1]=0,this.commentStack=[],this.leftCurlyCount=0,this.rightCurlyCount=0},o.prototype.setSaveScan=function(n){this.saveScan=n},o.prototype.setText=function(n,t){this.setSourceText(new h(n),t)},o.prototype.setScanComments=function(n){this.scanComments=n},o.prototype.getLexState=function(){return this.lexState},o.prototype.scanLine=function(t,i){var u,f;for(this.lexState=i,u=[],this.setText(t,r.Line),f=this.scan();f.tokenId!=n.TokenID.EOF;)u[u.length]=f,f=this.scan();return u},o.prototype.tokenStart=function(){this.startPos=this.pos,this.startLine=this.line,this.startCol=this.col,this.interveningWhitespace=!1},o.prototype.peekChar=function(){return this.pos<this.len?this.src.charCodeAt(this.pos):n.LexEOF},o.prototype.peekCharAt=function(t){return t<this.len?this.src.charCodeAt(t):n.LexEOF},o.prototype.IsHexDigit=function(t){return t>=n.LexCode_0&&t<=n.LexCode_9||t>=n.LexCode_A&&t<=n.LexCode_F||t>=n.LexCode_a&&t<=n.LexCode_f},o.prototype.IsOctalDigit=function(t){return t>=n.LexCode_0&&t<=n.LexCode_7||t>=n.LexCode_a&&t<=n.LexCode_f},o.prototype.scanHexDigits=function(){for(var t=!1;;)if(this.IsHexDigit(this.ch))this.nextChar(),t=!0;else return t?new n.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null},o.prototype.scanOctalDigits=function(){for(var t=!1;;)if(this.IsOctalDigit(this.ch))this.nextChar(),t=!0;else return t?new n.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null},o.prototype.scanDecimalNumber=function(t){for(var r=!1,u=this.pos,f=this.col;;)if(e(this.ch))r=!0,this.nextChar();else if(this.ch==n.LexCodeDOT)if(t==i.Start)this.nextChar(),t=i.InFraction;else return r?new n.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null);else if(this.ch==n.LexCode_e||this.ch==n.LexCode_E)if(t==i.Start)if(r)r=!1,this.nextChar(),t=i.InExponent;else return this.pos=u,this.col=f,null;else if(t==i.InFraction)this.nextChar(),t=i.InExponent,r=!1;else return r?new n.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null);else if(this.ch==n.LexCodePLS||this.ch==n.LexCodeMIN)if(t==i.InExponent){if(r)return this.pos=u,this.col=f,null;this.nextChar()}else return t==i.InFraction?new n.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):r?new n.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null);else return r?new n.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null)},o.prototype.scanNumber=function(){if(this.peekChar()==n.LexCode_0)switch(this.peekCharAt(this.pos+1)){case n.LexCode_x:case n.LexCode_X:return this.advanceChar(2),this.scanHexDigits();case n.LexCode_8:case n.LexCode_9:case n.LexCodeDOT:return this.scanDecimalNumber(i.Start);default:return this.scanOctalDigits()}else return this.scanDecimalNumber(i.Start)},o.prototype.scanFraction=function(){return this.scanDecimalNumber(i.InFraction)},o.prototype.newLine=function(){this.col=0,this.mode==r.File&&(this.line++,this.lineMap[this.line]=this.pos+1)},o.prototype.finishMultilineComment=function(){var t;for(this.lexState=u.InMultilineComment;this.pos<this.len;){if(this.ch==n.LexCodeMUL){if(t=this.peekCharAt(this.pos+1),t==n.LexCodeSLH)return this.advanceChar(2),this.mode==r.File&&this.tokenStart(),this.lexState=u.Start,!0}else if(this.ch==n.LexCodeNWL&&(this.newLine(),this.mode==r.Line))return this.nextChar(),!1;this.nextChar()}return!1},o.prototype.pushComment=function(n){this.commentStack.push(n)},o.prototype.getComments=function(){var n=this.commentStack;return this.commentStack=[],n},o.prototype.getCommentsForLine=function(n){for(var t=null;this.commentStack.length>0&&this.commentStack[0].line==n;)t=t==null?[this.commentStack.shift()]:t.concat([this.commentStack.shift()]);return t},o.prototype.resetComments=function(){this.commentStack=[]},o.prototype.endsLine=function(t){return t==n.LexCodeNWL||t==n.LexCodeRET||t==8232||t==8233},o.prototype.finishSinglelineComment=function(){while(this.pos<this.len){if(this.endsLine(this.ch))break;this.nextChar()}this.mode==r.File&&this.tokenStart()},o.prototype.tokenText=function(){return this.src.substring(this.startPos,this.pos)},o.prototype.findClosingSLH=function(){for(var t=this.pos,i=this.src.charCodeAt(t),u=0,r=!1;!this.endsLine(i)&&t<this.len;){if(i==n.LexCodeSLH&&!r)return t;u=i,t++,r=r?!1:u==n.LexCodeBSL,i=this.src.charCodeAt(t)}return-1},o.prototype.speculateRegex=function(){var o,r,u,t;if(n.noRegexTable[this.prevTok.tokenId]!=undefined)return null;var f=this.pos,e=this.col,i=this.findClosingSLH();if(i>0){for(o=this.src.substring(f,i),r="",this.pos=i+1,this.ch=this.peekChar(),u=this.pos;this.ch==n.LexCode_i||this.ch==n.LexCode_g||this.ch==n.LexCode_m;)this.nextChar();if(this.pos-u>3)return null;r=this.src.substring(u,this.pos),t=undefined;try{t=new RegExp(o,r)}catch(s){}if(t)return this.col=e+(this.pos-this.startPos),new n.RegexToken(t)}return this.pos=f,this.col=e,null},o.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},o.prototype.lastTokenLimChar=function(){return this.interveningWhitespace?this.interveningWhitespacePos:this.startPos},o.prototype.advanceChar=function(n){this.pos+=n,this.col+=n,this.ch=this.peekChar()},o.prototype.nextChar=function(){this.pos++,this.col++,this.ch=this.peekChar()},o.prototype.scan=function(){var t,i;return this.lexState==u.InMultilineComment&&this.scanComments?(this.ch=this.peekChar(),t=this.line,this.finishMultilineComment(),this.startPos<this.pos?(i=this.src.substring(this.startPos,this.pos),this.tokenStart(),new n.CommentToken(n.TokenID.Comment,i,!0,this.startPos,t,!0)):n.staticTokens[n.TokenID.EOF]):(this.prevLine=this.line,this.prevTok=this.innerScan(),this.saveScan&&this.saveScan.addToken(this.prevTok,this),this.prevTok)},o.prototype.innerScan=function(){var u,l,y,p,a,o,i,s,v,c,b;for(this.tokenStart(),this.ch=this.peekChar();this.pos<this.len;){if(f[this.ch]){do this.nextChar();while(f[this.ch]||e(this.ch));return l=this.src.substring(this.startPos,this.pos),(y=n.LexKeywordTable.lookup(l))!=null?n.staticTokens[y]:new n.StringToken(n.TokenID.ID,l)}if(this.ch==n.LexCodeSpace){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);do this.nextChar();while(this.ch==n.LexCodeSpace);if(this.mode==r.Line)return p=this.src.substring(this.startPos,this.pos),new n.WhitespaceToken(n.TokenID.Whitespace,p);this.tokenStart(),this.interveningWhitespace=!0}else if(this.ch==n.LexCodeSLH)if(this.nextChar(),this.ch==n.LexCodeSLH){if(this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1),i=this.pos-1,s=this.line,this.finishSinglelineComment(),a=this.src.substring(i,this.pos),o=new n.CommentToken(n.TokenID.Comment,a,!1,i,s,!1),this.scanComments)return this.startPos=i,o;this.pushComment(o),this.interveningWhitespace=!0}else if(this.ch==n.LexCodeMUL){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1),i=this.pos-1,s=this.line,this.nextChar(),this.finishMultilineComment();var a=this.src.substring(i,this.pos),k=this.peekChar()==n.LexCodeNWL||this.peekChar()==n.LexCodeRET,o=new n.CommentToken(n.TokenID.Comment,a,!0,i,s,k);if(this.scanComments)return this.startPos=i,o;this.pushComment(o),this.interveningWhitespace=!0}else return v=this.speculateRegex(),v?v:this.peekCharAt(this.pos)==n.LexCodeEQ?(this.nextChar(),n.staticTokens[n.TokenID.AsgDiv]):n.staticTokens[n.TokenID.Div];else{if(this.ch==n.LexCodeSMC)return this.nextChar(),n.staticTokens[n.TokenID.SColon];if(this.ch==n.LexCodeAPO||this.ch==n.LexCodeQUO){var d=this.ch,w=0,h=!1;do w=this.ch,h=h?!1:w==n.LexCodeBSL,this.nextChar();while(this.ch!=n.LexEOF&&(h||this.ch!=d));return this.ch!=n.LexEOF&&this.nextChar(),new n.StringToken(n.TokenID.QString,this.src.substring(this.startPos,this.pos))}if(t[this.ch])return c=t[this.ch],c.tokenId==n.TokenID.LCurly?this.leftCurlyCount++:c.tokenId==n.TokenID.RCurly&&this.rightCurlyCount++,this.nextChar(),c;if(this.ch>=n.LexCode_0&&this.ch<=n.LexCode_9)return u=this.scanNumber(),u?u:(this.nextChar(),n.staticTokens[n.TokenID.Error]);switch(this.ch){case n.LexCodeTAB:case n.LexCodeVTAB:if(this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.mode==r.Line){do this.nextChar();while(this.ch==n.LexCodeSpace||this.ch==9);return b=this.src.substring(this.startPos,this.pos),new n.WhitespaceToken(n.TokenID.Whitespace,b)}this.interveningWhitespace=!0;case 255:case 254:case 239:case 187:case 191:case 8232:case 8233:case n.LexCodeNWL:case n.LexCodeRET:if(this.ch==n.LexCodeNWL&&(this.newLine(),this.mode==r.Line))return n.staticTokens[n.TokenID.EOF];this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.nextChar(),this.tokenStart(),this.interveningWhitespace=!0;break;case n.LexCodeDOT:return this.peekCharAt(this.pos+1)==n.LexCodeDOT?this.peekCharAt(this.pos+2)==n.LexCodeDOT?(this.advanceChar(3),n.staticTokens[n.TokenID.Ellipsis]):(this.nextChar(),n.staticTokens[n.TokenID.Dot]):(this.nextChar(),u=this.scanFraction(),u?u:n.staticTokens[n.TokenID.Dot]);case n.LexCodeEQ:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.Eqv]):(this.advanceChar(2),n.staticTokens[n.TokenID.EQ]):this.peekCharAt(this.pos+1)==n.LexCodeGT?(this.advanceChar(2),n.staticTokens[n.TokenID.Arrow]):(this.nextChar(),n.staticTokens[n.TokenID.Asg]);case n.LexCodeBNG:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.NEqv]):(this.advanceChar(2),n.staticTokens[n.TokenID.NE]):(this.nextChar(),n.staticTokens[n.TokenID.Bang]);case n.LexCodePLS:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgAdd]):this.peekCharAt(this.pos+1)==n.LexCodePLS?(this.advanceChar(2),n.staticTokens[n.TokenID.Inc]):(this.nextChar(),n.staticTokens[n.TokenID.Add]);case n.LexCodeMIN:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgSub]):this.peekCharAt(this.pos+1)==n.LexCodeMIN?(this.advanceChar(2),n.staticTokens[n.TokenID.Dec]):(this.nextChar(),n.staticTokens[n.TokenID.Sub]);case n.LexCodeMUL:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgMul]):(this.nextChar(),n.staticTokens[n.TokenID.Mult]);case n.LexCodePCT:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgMod]):(this.nextChar(),n.staticTokens[n.TokenID.Pct]);case n.LexCodeLT:return this.peekCharAt(this.pos+1)==n.LexCodeLT?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.AsgLsh]):(this.advanceChar(2),n.staticTokens[n.TokenID.Lsh]):this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.LE]):(this.nextChar(),n.staticTokens[n.TokenID.LT]);case n.LexCodeGT:return this.peekCharAt(this.pos+1)==n.LexCodeGT?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.AsgRsh]):this.peekCharAt(this.pos+2)==n.LexCodeGT?this.peekCharAt(this.pos+3)==n.LexCodeEQ?(this.advanceChar(4),n.staticTokens[n.TokenID.AsgRs2]):(this.advanceChar(3),n.staticTokens[n.TokenID.Rs2]):(this.advanceChar(2),n.staticTokens[n.TokenID.Rsh]):this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.GE]):(this.nextChar(),n.staticTokens[n.TokenID.GT]);case n.LexCodeXOR:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgXor]):(this.nextChar(),n.staticTokens[n.TokenID.Xor]);case n.LexCodeBAR:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgOr]):this.peekCharAt(this.pos+1)==n.LexCodeBAR?(this.advanceChar(2),n.staticTokens[n.TokenID.LogOr]):(this.nextChar(),n.staticTokens[n.TokenID.Or]);case n.LexCodeAMP:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsgAnd]):this.peekCharAt(this.pos+1)==n.LexCodeAMP?(this.advanceChar(2),n.staticTokens[n.TokenID.LogAnd]):(this.nextChar(),n.staticTokens[n.TokenID.And]);default:return n.staticTokens[n.TokenID.EOF]}}}return n.staticTokens[n.TokenID.EOF]},o}(),n.Scanner=b,n.convertTokToIDName=rt,n.convertTokToID=k,n.getLineNumberFromPosition=s,n.getSourceLineColFromMap=a,n.getLineColumnFromPosition=g,n.getPositionFromLineColumn=ut}(TypeScript||(TypeScript={})),function(n){function t(t,i,r,u,f){var e=new n.ScopeChain(null,i.scopeChain,t);e.thisType=r,e.classType=u,e.fnc=f,i.scopeChain=e}function i(n){n.scopeChain=n.scopeChain.previous}function u(n,t){return n!=null&&n.isInstanceProperty()?n:t}function f(n){return n.isInstanceProperty()}function e(i,r){var f=i,o=null,e=null,u;(f.name&&f.mod&&(f.name.sym=f.mod.symbol),u=f.mod,u)&&(o=new n.SymbolTableScope(u.members,u.ambientMembers,u.enclosedTypes,u.ambientEnclosedTypes,u.symbol),u.memberScope=o,r.modDeclChain.push(f),r.typeFlow.checker.currentModDecl=f,e=new n.SymbolAggregateScope(u.symbol),e.addParentScope(o),e.addParentScope(r.scopeChain.scope),t(e,r,null,null,null),u.containedScope=e,u.symbol&&r.typeFlow.addLocalsFromScope(u.containedScope,u.symbol,f.vars,u.members.privateMembers,!0))}function o(i,r){var s=i,o=null,f=null,u,h,e;s.name&&s.type&&(s.name.sym=s.type.symbol),u=i.type,u?(h=u.symbol,o=r.typeFlow.checker.scopeOf(u),f=new n.SymbolAggregateScope(u.symbol),f.addParentScope(o),f.addParentScope(r.scopeChain.scope),u.containedScope=f,u.memberScope=o,e=u.instanceType,o=r.typeFlow.checker.scopeOf(e),e.memberScope=o,f=new n.SymbolAggregateScope(e.symbol),f.addParentScope(r.scopeChain.scope),t(f,r,e,u,null),e.containedScope=f):i.type=r.typeFlow.anyType}function s(i,r){var e=i,o=null,u=null,f;e.name&&e.type&&(e.name.sym=e.type.symbol),f=i.type,o=r.typeFlow.checker.scopeOf(f),f.memberScope=o,u=new n.SymbolAggregateScope(f.symbol),u.addParentScope(o),u.addParentScope(r.scopeChain.scope),t(u,r,null,null,null),f.containedScope=u}function h(i,r){var f=i,u=f.type,o=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),s=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u=new n.Type,h=new n.WithSymbol(f.minChar,r.typeFlow.checker.locationInfo.unitIndex,u),e;u.members=o,u.ambientMembers=s,u.symbol=h,u.setHasImplementation(),f.type=u,e=new n.SymbolScopeBuilder(u.members,u.ambientMembers,null,null,r.scopeChain.scope,u.symbol),t(e,r,null,null,null),u.containedScope=e}function c(i,r){var u=i,f=null,it=null,l,o,y,a,v,e,d,b,tt,g;u.type&&(it=i.type.symbol);var c=n.hasFlag(u.fncFlags,n.FncFlags.Static),ot=c&&r.scopeChain.fnc!=null,s=ot?r.scopeChain.fnc.type.memberScope:r.scopeChain.scope;if(r.scopeChain.thisType&&(!u.isConstructor||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod))?(l=r.scopeChain.thisType,s=l.typeFlags&n.TypeFlags.IsClass||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod)?r.scopeChain.previous.scope.container&&r.scopeChain.previous.scope.container.declAST&&r.scopeChain.previous.scope.container.declAST.nodeType==n.NodeType.FuncDecl&&r.scopeChain.previous.scope.container.declAST.isConstructor?l.constructorScope:c&&r.scopeChain.classType?r.scopeChain.classType.containedScope:l.containedScope:!u.isMethod()||c?l.constructorScope:l.containedScope,f=l.symbol):u.isConstructor&&r.scopeChain.thisType&&(f=r.scopeChain.thisType.symbol),u.type==null||n.hasFlag(u.type.symbol.flags,n.SymbolFlags.TypeSetDuringScopeAssignment)){r.scopeChain.fnc&&r.scopeChain.fnc.type&&(f=r.scopeChain.fnc.type.symbol);var h=null,p=r.scopeChain.fnc,w=u.name?u.name.text:null,e=null;c?(p.type.members==null&&f.getType().memberScope&&(p.type.members=f.type.memberScope.valueMembers),h=r.scopeChain.fnc.type.memberScope,p.innerStaticFuncs[p.innerStaticFuncs.length]=u):h=!u.isConstructor&&f&&f.declAST&&f.declAST.nodeType==n.NodeType.FuncDecl&&f.declAST.isConstructor&&!u.isMethod()?r.scopeChain.thisType.constructorScope:r.scopeChain.scope,w&&w!="__missing"&&!u.isAccessor()&&(e=c?h.findLocal(w,!1,!1):h.findLocal(w,!1,!1)),r.typeFlow.checker.createFunctionSignature(u,f,h,e,e==null),(!u.accessorSymbol&&u.fncFlags&n.FncFlags.ClassMethod&&f&&(!e||e.declAST.nodeType!=n.NodeType.FuncDecl)&&u.isAccessor()||e&&e.isAccessor())&&(u.accessorSymbol=r.typeFlow.checker.createAccessorSymbol(u,e,f.getType(),u.isMethod()&&c,!0,h,f)),u.type.symbol.flags|=n.SymbolFlags.TypeSetDuringScopeAssignment}if(u.name&&u.type&&(u.name.sym=u.type.symbol),u.scopeType=u.type,!u.isOverload){var k=new n.StringHashTable,ht=new n.ScopedMembers(new n.DualStringHashTable(k,new n.StringHashTable)),et=new n.StringHashTable,ft=new n.ScopedMembers(new n.DualStringHashTable(et,new n.StringHashTable)),nt=new n.StringHashTable,st=new n.ScopedMembers(new n.DualStringHashTable(nt,new n.StringHashTable)),rt=new n.StringHashTable,ut=new n.ScopedMembers(new n.DualStringHashTable(rt,new n.StringHashTable));if(u.unitIndex=r.typeFlow.checker.locationInfo.unitIndex,o=new n.SymbolScopeBuilder(ht,ft,null,null,s,it),y=new n.SymbolScopeBuilder(st,ut,null,null,s,null),u.isConstructor&&r.scopeChain.thisType&&(r.scopeChain.thisType.constructorScope=o),u.symbols=k,!u.isSpecialFn()){if(a=u.type,v=u.signature,u.isConstructor||(a.containedScope=o,o.container=a.symbol,a.memberScope=y,y.container=a.symbol),u.enclosingFnc=r.scopeChain.fnc,a.enclosingType=c?r.scopeChain.classType:r.scopeChain.thisType,e=i.type.symbol,(u.fncFlags&n.FncFlags.Signature)==n.FncFlags.None&&u.vars&&(r.typeFlow.addLocalsFromScope(o,e,u.vars,k,!1),r.typeFlow.addLocalsFromScope(y,e,u.statics,nt,!1)),v.parameters)for(d=v.parameters.length,b=0;b<d;b++)tt=v.parameters[b],r.typeFlow.checker.resolveTypeLink(o,tt.parameter.typeLink,!0);r.typeFlow.checker.resolveTypeLink(o,v.returnType,u.isSignature())}(!u.isConstructor||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod))&&(g=u.isConstructor&&n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod)?r.scopeChain.thisType:null,t(o,r,g,null,u))}}function l(i,r){var f=i,e,u;f.param&&(e=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u=new n.SymbolScopeBuilder(e,null,null,null,r.scopeChain.scope,r.scopeChain.scope.container),f.containedScope=u,t(u,r,r.scopeChain.thisType,r.scopeChain.classType,r.scopeChain.fnc))}function v(t,i,r){var u=r.state,f=!0,a;return t&&(t.nodeType==n.NodeType.List?(a=t,a.enclosingScope=u.scopeChain.scope):t.nodeType==n.NodeType.Module?e(t,u):t.nodeType==n.NodeType.Class?o(t,u):t.nodeType==n.NodeType.Interface?s(t,u):t.nodeType==n.NodeType.With?h(t,u):t.nodeType==n.NodeType.FuncDecl?c(t,u):t.nodeType==n.NodeType.Catch?l(t,u):t.nodeType==n.NodeType.TypeRef&&(f=!1)),r.options.goChildren=f,t}function y(t,r,u){var f=u.state,o=!0,h,e,s;return t&&(t.nodeType==n.NodeType.Module?(h=t,i(f),f.modDeclChain.pop(),f.modDeclChain.length>=1&&(f.typeFlow.checker.currentModDecl=f.modDeclChain[f.modDeclChain.length-1])):t.nodeType==n.NodeType.Class?i(f):t.nodeType==n.NodeType.Interface?i(f):t.nodeType==n.NodeType.With?i(f):t.nodeType==n.NodeType.FuncDecl?(e=t,e.isConstructor&&!n.hasFlag(e.fncFlags,n.FncFlags.ClassMethod)||e.isOverload||i(f)):t.nodeType==n.NodeType.Catch?(s=t,s.param&&i(f)):o=!1),u.options.goChildren=o,t}var a=function(){function n(n,t,i){this.scopeChain=n,this.typeFlow=t,this.modDeclChain=i}return n}(),r;n.AssignScopeContext=a,n.pushAssignScope=t,n.popAssignScope=i,n.instanceCompare=u,n.instanceFilterStop=f,r=function(){function n(n,t){this.select=n,this.stop=t,this.result=null}return n.prototype.reset=function(){this.result=null},n.prototype.update=function(n){return this.result=this.select(this.result,n),this.result?this.stop(this.result):!1},n}(),n.ScopeSearchFilter=r,n.instanceFilter=new r(u,f),n.preAssignModuleScopes=e,n.preAssignClassScopes=o,n.preAssignInterfaceScopes=s,n.preAssignWithScopes=h,n.preAssignFuncDeclScopes=c,n.preAssignCatchScopes=l,n.preAssignScopes=v,n.postAssignScopes=y}(TypeScript||(TypeScript={})),function(n){function f(t,i,r){var u=r.state;return n.hasFlag(t.flags,u.matchFlag)&&(u.pos<0||u.pos==t.limChar)&&(u.ast=t,t.type==null&&u.pos>=0&&u.flow.inScopeTypeCheck(t,u.scope),u.type=t.type,u.options.stopWalk()),t}function e(t,i,r,u,f,e,o,s,h){var l=new n.SymbolScopeBuilder(i,r,u,f,null,t),c=new n.ScopeChain(t,e.scopeChain,l);c.thisType=o,c.classType=s,c.moduleDecl=h,e.scopeChain=c}function o(n){n.scopeChain=n.scopeChain.previous}function r(t,i,r){var u=r.state,h=t.minChar,s=t.limChar,o,e,f;if(t.nodeType==n.NodeType.Script&&u.pos>s&&(s=u.pos),h<=u.pos&&s>=u.pos){switch(t.nodeType){case n.NodeType.Script:o=t,u.scopeGetter=function(){return o.bod===null?null:o.bod.enclosingScope},u.scopeStartAST=o;break;case n.NodeType.Class:u.scopeGetter=function(){return t.type===null||t.type.instanceType.containedScope===null?null:t.type.instanceType.containedScope},u.scopeStartAST=t,u.enclosingClassDecl=t;break;case n.NodeType.ObjectLit:e=t,e.targetType&&(u.scopeGetter=function(){return e.targetType.containedScope},u.objectLiteralScopeGetter=function(){return e.targetType.memberScope},u.enclosingObjectLit=e);break;case n.NodeType.Module:u.deepestModuleDecl=t,u.scopeGetter=function(){return t.type===null?null:t.type.containedScope},u.scopeStartAST=t;break;case n.NodeType.Interface:u.scopeGetter=function(){return t.type===null?null:t.type.containedScope},u.scopeStartAST=t;break;case n.NodeType.FuncDecl:f=t,u.skipNextFuncDeclForClass?u.skipNextFuncDeclForClass=!1:(u.scopeGetter=function(){return f.isConstructor&&n.hasFlag(f.fncFlags,n.FncFlags.ClassMethod)&&t.type&&t.type.enclosingType?t.type.enclosingType.constructorScope:f.scopeType?f.scopeType.containedScope:f.type?f.type.containedScope:null},u.scopeStartAST=t)}r.options.goChildren=!0}else r.options.goChildren=!1;return t}function s(i,u,f,e,o){var s=new t(i,u,f,e,o);return(n.getAstWalkerFactory().walk(u,r,null,null,s),s.scopeStartAST===null)?null:s}var u=function(){function n(n,t){this.scopeChain=n,this.checker=t,this.script=null}return n}(),i,t;n.TypeCollectionContext=u,i=function(){function t(t,i,r){this.flow=t,this.pos=i,this.matchFlag=r,this.type=null,this.ast=null,this.options=new n.AstWalkOptions}return t}(),n.MemberScopeContext=i,t=function(){function t(n,t,i,r,u){this.logger=n,this.script=t,this.text=i,this.pos=r,this.isMemberCompletion=u,this.scopeGetter=null,this.objectLiteralScopeGetter=null,this.scopeStartAST=null,this.skipNextFuncDeclForClass=!1,this.deepestModuleDecl=null,this.enclosingClassDecl=null,this.enclosingObjectLit=null,this.publicsOnly=!0,this.useFullAst=!1}return t.prototype.getScope=function(){return this.scopeGetter()},t.prototype.getObjectLiteralScope=function(){return this.objectLiteralScopeGetter()},t.prototype.getScopeAST=function(){return this.scopeStartAST},t.prototype.getScopePosition=function(){return this.scopeStartAST.minChar},t.prototype.getScriptFragmentStartAST=function(){return this.scopeStartAST},t.prototype.getScriptFragmentPosition=function(){return this.getScriptFragmentStartAST().minChar},t.prototype.getScriptFragment=function(){if(this.scriptFragment==null){var t=this.getScriptFragmentStartAST(),i=t.minChar,r=this.isMemberCompletion?this.pos:this.pos+1;this.scriptFragment=n.quickParse(this.logger,t,this.text,i,r,null).Script}return this.scriptFragment},t}(),n.EnclosingScopeContext=t,n.preFindMemberScope=f,n.pushTypeCollectionScope=e,n.popTypeCollectionScope=o,n.preFindEnclosingScope=r,n.findEnclosingScopeAt=s}(TypeScript||(TypeScript={})),function(n){var i=function(){function t(){this.hasVariableArgList=!1,this.parameters=null,this.declAST=null,this.typeCheckStatus=n.TypeCheckStatus.NotStarted,this.nonOptionalParameterCount=0}return t.prototype.specializeType=function(i,r,u){var f=new t,o,l,c;if(this.hasVariableArgList&&(f.hasVariableArgList=!0),f.returnType=new n.TypeLink,f.returnType.type=this.returnType.type?this.returnType.type.specializeType(i,r,u,!1):u.anyType,this.parameters)for(f.parameters=[],o=0,l=this.parameters.length;o<l;o++){var h=this.parameters[o],e=new n.ValueLocation,s=new n.ParameterSymbol(h.name,h.location,u.locationInfo.unitIndex,e);s.declAST=this.declAST,e.symbol=s,e.typeLink=new n.TypeLink,f.parameters[o]=s,c=h.getType(),c?(e.typeLink.type=c.specializeType(i,r,u,!1),s.declAST.type=e.typeLink.type):e.typeLink.type=u.anyType}return f.nonOptionalParameterCount=this.nonOptionalParameterCount,f.declAST=this.declAST,f},t.prototype.toString=function(){return this.toStringHelper(!1,!1,null)},t.prototype.toStringHelper=function(n,t,i){for(var r=t?"[":"(",f=this.parameters.length,u=0;u<f;u++)r+=this.parameters[u].name+(this.parameters[u].isOptional()?"?":"")+": ",r+=this.parameters[u].getType().getScopedTypeName(i),u<f-1&&(r+=",");return r+=n?t?"] => ":") => ":t?"]: ":"): ",r+=this.returnType.type?this.returnType.type.getScopedTypeName(i):"any"},t}(),t;n.Signature=i,t=function(){function t(){this.signatures=[],this.hasImplementation=!0,this.definitionSignature=null,this.hasBeenTypechecked=!1,this.flags=n.SignatureFlags.None}return t.prototype.addSignature=function(t){this.signatures==null&&(this.signatures=[]),this.signatures[this.signatures.length]=t,!t.declAST||t.declAST.isOverload||t.declAST.isSignature()||n.hasFlag(t.declAST.fncFlags,n.FncFlags.Ambient)||!n.hasFlag(t.declAST.fncFlags,n.FncFlags.Definition)||(this.definitionSignature=t)},t.prototype.toString=function(){return this.signatures.toString()},t.prototype.toStrings=function(t,i,r){var f=[],e=this.signatures.length,u;for(e>1&&(i=!1),u=0;u<e;u++)e>1&&this.signatures[u]==this.definitionSignature||(f[u]=this.flags&n.SignatureFlags.IsIndexer?this.signatures[u].toStringHelper(i,!0,r):t+this.signatures[u].toStringHelper(i,!1,r));return f},t.prototype.specializeType=function(n,i,r){var f=new t,u,e;if(this.signatures)for(u=0,e=this.signatures.length;u<e;u++)f.addSignature(this.signatures[u].specializeType(n,i,r));return f},t.prototype.verifySignatures=function(t){var u=0,i,r;if(this.signatures&&(u=this.signatures.length)>0)for(i=0;i<u;i++){for(r=i+1;r<u;r++)this.signatures[i].declAST&&this.signatures[r].declAST&&!n.hasFlag(this.signatures[i].declAST.fncFlags,n.FncFlags.Definition)&&!n.hasFlag(this.signatures[r].declAST.fncFlags,n.FncFlags.Definition)&&t.signaturesAreIdentical(this.signatures[i],this.signatures[r])&&t.errorReporter.simpleError(this.signatures[i].declAST,this.signatures[i].declAST&&this.signatures[i].declAST.name?"Signature for '"+this.signatures[i].declAST.name.text+"' is duplicated":"Signature is duplicated");this.definitionSignature&&(t.signatureIsAssignableToTarget(this.definitionSignature,this.signatures[i])||t.errorReporter.simpleError(this.signatures[i].declAST,"Overload signature is not compatible with function definition"))}},t.prototype.typeCheck=function(t,i,r){var f,u;if(!this.hasBeenTypechecked&&(this.hasBeenTypechecked=!0,f=0,this.signatures&&(f=this.signatures.length)>0)){for(u=0;u<f;u++)r||this.definitionSignature||!this.signatures[u].declAST||!this.signatures[u].declAST.isOverload||n.hasFlag(this.signatures[u].declAST.fncFlags,n.FncFlags.Ambient)||t.errorReporter.simpleError(this.signatures[u].declAST,"Overload declaration lacks definition"),this.signatures[u].declAST&&this.signatures[u].declAST.isConstructor&&this.signatures[u].declAST.classDecl&&this.signatures[u].declAST.classDecl.type.symbol.typeCheckStatus==n.TypeCheckStatus.NotStarted&&t.typeFlow.typeCheck(this.signatures[u].declAST.classDecl),t.typeFlow.typeCheck(this.signatures[u].declAST);this.verifySignatures(t)}},t}(),n.SignatureGroup=t}(TypeScript||(TypeScript={})),function(n){function o(t,i){return t.declAST&&i&&i.declAST&&t.declAST.nodeType==n.NodeType.FuncDecl?t.declAST.minChar<=i.declAST.minChar&&t.declAST.limChar>=i.declAST.limChar:!1}function i(n,t){while(n.container){if(n==t||o(n.container,t))return!0;n=n.container}return!1}var u,f,r,t,e,s,h,c,l;(function(n){n._map=[],n._map[0]="NotStarted",n.NotStarted=0,n._map[1]="Started",n.Started=1,n._map[2]="Finished",n.Finished=2})(n.TypeCheckStatus||(n.TypeCheckStatus={})),u=n.TypeCheckStatus,n.aLexicallyEnclosesB=o,n.aEnclosesB=i,f=function(){function t(t,i,r){this.name=t,this.location=i,this.unitIndex=r,this.bound=!1,this.flags=n.SymbolFlags.None,this.isObjectLitField=!1,this.declAST=null,this.declModule=null,this.passSymbolCreated=n.CompilerDiagnostics.analysisPass}return t.prototype.instanceScope=function(){return null},t.prototype.isVariable=function(){return!1},t.prototype.isMember=function(){return!1},t.prototype.isInferenceSymbol=function(){return!1},t.prototype.isWith=function(){return!1},t.prototype.writeable=function(){return!1},t.prototype.isType=function(){return!1},t.prototype.getType=function(){return null},t.prototype.isAccessor=function(){return!1},t.prototype.isInstanceProperty=function(){return n.hasFlag(this.flags,n.SymbolFlags.Property)&&!n.hasFlag(this.flags,n.SymbolFlags.ModuleMember)},t.prototype.getTypeName=function(){return this.toString()},t.prototype.getOptionalNameString=function(){return n.hasFlag(this.flags,n.SymbolFlags.Optional)?"?":""},t.prototype.pathToRoot=function(){for(var i=[],t=this;t&&t.name!=n.globalId;)i[i.length]=t,t=t.container;return i},t.prototype.findCommonAncestorPath=function(n){var t,u,i,r,e,o,f,s,h;if(this.container==null)return[];for(t=this.container.pathToRoot(),u=n?n.pathToRoot():[],i=-1,r=0,e=t.length;r<e;r++){for(o=t[r],f=0,s=u.length;f<s;f++)if(h=u[f],o==h){i=r;break}if(i>=0)break}return i>=0?t.slice(0,i):t},t.prototype.scopeRelativeName=function(n){var r,t,i,u;if(n==null)return this.name;for(r=this.findCommonAncestorPath(n.container),t="",i=0,u=r.length;i<u;i++)t=r[i].name+"."+t;return t+=this.name},t.prototype.fullName=function(){for(var i=this.name,t=this.container;t&&t.name!=n.globalId;)i=t.name+"."+i,t=t.container;return i},t.prototype.visible=function(t,r){if(r==null||this.container==r.gloMod)return!0;if(n.hasFlag(this.flags,n.SymbolFlags.ModuleMember))return n.hasFlag(this.flags,n.SymbolFlags.Exported)?n.hasFlag(this.flags,n.SymbolFlags.Private)?i(this,t.container):!0:r&&r.currentModDecl==this.declModule||r.currentModDecl&&r.currentModDecl.mod&&r.currentModDecl.mod.symbol&&this.declModule&&this.declModule.mod&&this.declModule.mod.symbol&&i(r.currentModDecl.mod.symbol,this.declModule.mod.symbol);var u=this.declAST&&this.declAST.nodeType==n.NodeType.FuncDecl,f=u&&this.declAST.isMethod(),e=u&&n.hasFlag(this.declAST.fncFlags,n.FncFlags.Static),o=f&&n.hasFlag(this.declAST.fncFlags,n.FncFlags.Private),s=this.isType()&&this.aliasLink;return this.isMember()||f||e||s?n.hasFlag(this.flags,n.SymbolFlags.Private)||o?t.container==null&&this.container!=t.container?!1:this.container==null?!0:i(t.container,this.container):!0:this.container?i(this,t.container):!0},t.prototype.addRef=function(n){this.refs||(this.refs=[]),this.refs[this.refs.length]=n},t.prototype.toString=function(){return this.name?this.name:"_anonymous"},t.prototype.print=function(n){n.Write(this.toString())},t.prototype.specializeType=function(){throw new Error("please implement in derived class");},t.prototype.setType=function(){throw new Error("please implement in derived class");},t.prototype.kind=function(){throw new Error("please implement in derived class");},t}(),n.Symbol=f,r=function(){function n(){}return n}(),n.ValueLocation=r,t=function(t){function i(n,i,r){t.call(this,n,i,r),this.typeCheckStatus=u.NotStarted}return __extends(i,t),i.prototype.isInferenceSymbol=function(){return!0},i.prototype.transferVarFlags=function(t){n.hasFlag(t,n.VarFlags.Ambient)&&(this.flags|=n.SymbolFlags.Ambient),n.hasFlag(t,n.VarFlags.Constant)&&(this.flags|=n.SymbolFlags.Constant),n.hasFlag(t,n.VarFlags.Static)&&(this.flags|=n.SymbolFlags.Static),n.hasFlag(t,n.VarFlags.Property)&&(this.flags|=n.SymbolFlags.Property),n.hasFlag(t,n.VarFlags.Private)&&(this.flags|=n.SymbolFlags.Private),n.hasFlag(t,n.VarFlags.Public)&&(this.flags|=n.SymbolFlags.Public),n.hasFlag(t,n.VarFlags.Readonly)&&(this.flags|=n.SymbolFlags.Readonly),n.hasFlag(t,n.VarFlags.Exported)&&(this.flags|=n.SymbolFlags.Exported)},i}(f),n.InferenceSymbol=t,e=function(t){function i(i,r,u,f){t.call(this,i,r,u),this.type=f,this.expansions=[],this.isMethod=!1,this.aliasLink=null,this.onlyReferencedAsTypeRef=n.optimizeModuleCodeGen,this.prettyName=this.name}return __extends(i,t),i.prototype.addLocation=function(n){this.additionalLocations==null&&(this.additionalLocations=[]),this.additionalLocations[this.additionalLocations.length]=n},i.prototype.kind=function(){return n.SymbolKind.Type},i.prototype.isType=function(){return!0},i.prototype.getType=function(){return this.type},i.prototype.getTypeName=function(n){return this.type.getMemberTypeName(this.name?this.name+this.getOptionalNameString():"",!1,!1,n)},i.prototype.instanceScope=function(){return this.type.typeFlags&n.TypeFlags.IsClass||!this.type.isClass()?this.type.containedScope:this.type.instanceType.constructorScope},i.prototype.toString=function(){var n=this.type.getTypeName();return this.name&&(n=this.name+":"+n),n},i.prototype.isClass=function(){return this.instanceType!=null},i.prototype.isFunction=function(){return this.declAST!=null&&this.declAST.nodeType==n.NodeType.FuncDecl},i.prototype.specializeType=function(n,t,r){var u,f;return this.type==n?t.symbol:(u=this.type.specializeType(n,t,r,!1),u!=this.type?f=new i(this.name,0,-1,u):this)},i.prototype.scopeRelativeName=function(t){var r,u,i,f,e;if(t==null)return this.prettyName+this.getOptionalNameString();for(r=this.findCommonAncestorPath(t.container),u="",i=0,f=r.length;i<f;i++)e=r[i].kind()==n.SymbolKind.Type?r[i].prettyName:r[i].name,u=e+"."+u;return u+=this.prettyName+this.getOptionalNameString()},i}(t),n.TypeSymbol=e,s=function(n){function t(t,i,r){n.call(this,"with",t,i,r)}return __extends(t,n),t.prototype.isWith=function(){return!0},t}(e),n.WithSymbol=s,h=function(t){function i(n,i,r,u,f){t.call(this,n,i,r),this.canWrite=u,this.field=f,this.getter=null,this.setter=null,this.hasBeenEmitted=!1,this.name=n,this.location=i}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Field},i.prototype.writeable=function(){return this.isAccessor()?this.setter!=null:this.canWrite},i.prototype.getType=function(){return this.field.typeLink.type},i.prototype.getTypeName=function(n){return this.name+this.getOptionalNameString()+": "+this.field.typeLink.type.getMemberTypeName("",!0,!1,n)},i.prototype.isMember=function(){return!0},i.prototype.setType=function(n){this.field.typeLink.type=n},i.prototype.isAccessor=function(){return this.getter!=null||this.setter!=null},i.prototype.isVariable=function(){return!0},i.prototype.toString=function(){return this.name+this.getOptionalNameString()+":"+this.field.typeLink.type.getTypeName()},i.prototype.specializeType=function(t,f,e){var h=this.field.typeLink.type.specializeType(t,f,e,!1),s,o;return h!=this.field.typeLink.type?(s=new r,o=new i(this.name,0,e.locationInfo.unitIndex,this.canWrite,s),o.flags=this.flags,s.symbol=o,s.typeLink=new n.TypeLink,o.setType(h),o.typeCheckStatus=u.Finished,o):this},i}(t),n.FieldSymbol=h,c=function(t){function i(n,i,r,u){t.call(this,n,i,r),this.parameter=u,this.argsOffset=-1,this.name=n,this.location=i}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Parameter},i.prototype.writeable=function(){return!0},i.prototype.getType=function(){return this.parameter.typeLink.type},i.prototype.setType=function(n){this.parameter.typeLink.type=n},i.prototype.isVariable=function(){return!0},i.prototype.isOptional=function(){return this.parameter&&this.parameter.symbol&&this.parameter.symbol.declAST?this.parameter.symbol.declAST.isOptional:!1},i.prototype.getTypeName=function(n){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getMemberTypeName("",!1,!1,n)},i.prototype.toString=function(){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getTypeName()},i.prototype.specializeType=function(n,t,u){var o=this.parameter.typeLink.type.specializeType(n,t,u,!1),e,f;return this.parameter.typeLink.type!=o?(e=new r,f=new i(this.name,0,u.locationInfo.unitIndex,e),e.symbol=f,f.setType(o),f):this},i}(t),n.ParameterSymbol=c,l=function(t){function i(n,i,r,u){t.call(this,n,i,r),this.variable=u}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Variable},i.prototype.writeable=function(){return!0},i.prototype.getType=function(){return this.variable.typeLink.type},i.prototype.getTypeName=function(n){return this.name+":"+this.getType().getMemberTypeName("",!1,!1,n)},i.prototype.setType=function(n){this.variable.typeLink.type=n},i.prototype.isVariable=function(){return!0},i}(t),n.VariableSymbol=l}(TypeScript||(TypeScript={})),function(n){var s=function(){function n(n){this.dualMembers=n,this.allMembers=this.dualMembers,this.publicMembers=this.dualMembers.primaryTable,this.privateMembers=this.dualMembers.secondaryTable}return n.prototype.addPublicMember=function(n,t){return this.dualMembers.primaryTable.add(n,t)},n.prototype.addPrivateMember=function(n,t){return this.dualMembers.secondaryTable.add(n,t)},n}(),i,t,u,f,r,e,o;n.ScopedMembers=s,function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="Type",n.Type=1,n._map[2]="Field",n.Field=2,n._map[3]="Parameter",n.Parameter=3,n._map[4]="Variable",n.Variable=4}(n.SymbolKind||(n.SymbolKind={})),i=n.SymbolKind,t=function(){function n(n){this.container=n}return n.prototype.printLabel=function(){return"base"},n.prototype.getAllSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.getAllTypeSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.getAllValueSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.search=function(){return null},n.prototype.findLocal=function(){return null},n.prototype.find=function(){return null},n.prototype.findImplementation=function(){return null},n.prototype.findAmbient=function(){return null},n.prototype.print=function(n){this.container?n.WriteLine(this.printLabel()+" scope with container: "+this.container.name+"..."):n.WriteLine(this.printLabel()+" scope...")},n.prototype.enter=function(){throw new Error("please implement in derived class");},n.prototype.getTable=function(){throw new Error("please implement in derived class");},n}(),n.SymbolScope=t,u=function(t){function i(n){t.call(this,n),this.valueCache=null,this.valueImplCache=null,this.valueAmbientCache=null,this.typeCache=null,this.typeImplCache=null,this.typeAmbientCache=null,this.parents=null,this.container=n}return __extends(i,t),i.prototype.printLabel=function(){return"agg"},i.prototype.search=function(n,t,i,r){var u,f;if(this.parents)for(u=0;u<this.parents.length;u++)if(f=this.parents[u].search(n,t,i,r),f&&n.update(f))return f;return n.result},i.prototype.getAllSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.getAllTypeSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllTypeSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.getAllValueSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllValueSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.print=function(n){if(t.prototype.print.call(this,n),this.parents)for(var i=0;i<this.parents.length;i++)this.parents[i].print(n)},i.prototype.findImplementation=function(t,i,r){var u=null,e=0,f=this.valueImplCache;if(r&&(f=this.typeImplCache),f&&(u=f.lookup(t))!=null&&(i?!(n.hasFlag(u.flags,n.SymbolFlags.Private)||u.declAST&&u.declAST.nodeType==n.NodeType.FuncDecl&&n.hasFlag(u.declAST.fncFlags,n.FncFlags.Private)):!0))return u;if(this.parents)for(e=0;e<this.parents.length;e++)if(u=this.parents[e].findImplementation(t,i,r),u)break;return f&&(r?(this.typeImplCache=new n.StringHashTable,f=this.typeImplCache):(this.valueImplCache=new n.StringHashTable,f=this.valueImplCache)),f.add(t,u),u},i.prototype.find=function(t,i,r){var u=null,e=0,f=this.valueCache;if(r&&(f=this.typeCache),f&&(u=f.lookup(t))!=null&&(i?!(n.hasFlag(u.flags,n.SymbolFlags.Private)||u.declAST&&u.declAST.nodeType==n.NodeType.FuncDecl&&n.hasFlag(u.declAST.fncFlags,n.FncFlags.Private)):!0))return u;if(this.parents)for(e=0;e<this.parents.length;e++)if(u=this.parents[e].find(t,i,r),u)break;return f==null&&(r?(this.typeCache=new n.StringHashTable,f=this.typeCache):(this.valueCache=new n.StringHashTable,f=this.valueCache)),f.add(t,u),u},i.prototype.findAmbient=function(t,i,r){var f=null,e=0,u=this.valueAmbientCache;if(r&&(u=this.typeAmbientCache),u&&(f=u.lookup(t))!=null)return f;if(this.parents)for(e=0;e<this.parents.length;e++)if(f=this.parents[e].findAmbient(t,i,r),f)break;return u==null&&(r?(this.typeAmbientCache=new n.StringHashTable,u=this.typeAmbientCache):(this.valueAmbientCache=new n.StringHashTable,u=this.valueAmbientCache)),u.add(t,f),f},i.prototype.addParentScope=function(n){this.parents==null&&(this.parents=[]),this.parents[this.parents.length]=n},i}(t),n.SymbolAggregateScope=u,f=function(n){function t(t,i,r,u,f){n.call(this,f),this.valueMembers=t,this.ambientValueMembers=i,this.enclosedTypes=r,this.ambientEnclosedTypes=u,this.container=f}return __extends(t,n),t.prototype.printLabel=function(){return"table"},t.prototype.getAllSymbolNames=function(n){var t=this.getAllTypeSymbolNames(n);return t.concat(this.getAllValueSymbolNames(n))},t.prototype.getAllTypeSymbolNames=function(){var t=[];return this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys())),t},t.prototype.getAllValueSymbolNames=function(){var t=[];return this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys())),t},t.prototype.search=function(n,t,i,r){var u=this.find(t,i,r);return n.update(u),n.result},t.prototype.find=function(n,t,i){var u=null,f=null,r;return(i?(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers):(u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers),f&&(r=f.lookup(n),r))?r:u&&(r=u.lookup(n),r)?r:null},t.prototype.findAmbient=function(n,t,i){var r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers,u;return(i&&(r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),r&&(u=r.lookup(n),u))?u:null},t.prototype.print=function(t){n.prototype.print.call(this,t),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(n){t.WriteLine("  "+n)},null)},t.prototype.findImplementation=function(n,t,r){var u=this.find(n,t,r),f,e;return u&&(u.kind()==i.Type?(f=u,f.type.hasImplementation()||(u=null)):u.container&&u.container.kind()==i.Type&&(e=u.container,e.type.hasImplementation()||(u=null))),u},t.prototype.getTable=function(){return this.valueMembers.publicMembers},t}(t),n.SymbolTableScope=f,r=function(t){function i(n,i,r,u,f,e){t.call(this,e),this.valueMembers=n,this.ambientValueMembers=i,this.enclosedTypes=r,this.ambientEnclosedTypes=u,this.parent=f,this.container=e}return __extends(i,t),i.prototype.printLabel=function(){return"builder"},i.prototype.getAllSymbolNames=function(n){var t=this.getAllTypeSymbolNames(n);return t.concat(this.getAllValueSymbolNames(n))},i.prototype.getAllTypeSymbolNames=function(n){var t=[],i;return this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys())),!n&&this.parent&&(i=this.parent.getAllTypeSymbolNames(n),i&&(t=t.concat(i))),t},i.prototype.getAllValueSymbolNames=function(n){var t=[],i;return this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys())),!n&&this.parent&&(i=this.parent.getAllValueSymbolNames(n),i&&(t=t.concat(i))),t},i.prototype.search=function(n,t,i,r){var u=null,f=this.valueMembers==null?null:i?this.valueMembers.publicMembers:this.valueMembers.allMembers,e=this.ambientValueMembers==null?null:i?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(r&&(f=this.enclosedTypes==null?null:i?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,e=this.ambientEnclosedTypes==null?null:i?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),e&&(u=e.lookup(t))!=null&&n.update(u))?u:f&&(u=f.lookup(t))!=null&&n.update(u)?u:this.parent&&(u=this.parent.search(n,t,i,r),u&&n.update(u))?u:n.result},i.prototype.print=function(n){t.prototype.print.call(this,n),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.parent&&this.parent.print(n)},i.prototype.find=function(n,t,i){var r=null,u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),f&&(r=f.lookup(n))!=null)?r:u&&(r=u.lookup(n))!=null?r:this.parent?this.parent.find(n,t,i):null},i.prototype.findAmbient=function(n,t,i){var u=null,r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),r&&(u=r.lookup(n))!=null)?u:this.parent?this.parent.findAmbient(n,t,i):null},i.prototype.findLocal=function(n,t,i){var r=null,u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),u&&(r=u.lookup(n))!=null&&r)?r:f&&(r=f.lookup(n))!=null&&r?r:null},i.prototype.enter=function(t,i,r,u,f,e,o){var s=null;s=o?e?this.ambientEnclosedTypes==null?null:f?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.privateMembers:this.ambientValueMembers==null?null:f?this.ambientValueMembers.publicMembers:this.ambientValueMembers.privateMembers:e?this.enclosedTypes==null?null:f?this.enclosedTypes.publicMembers:this.enclosedTypes.privateMembers:this.valueMembers==null?null:f?this.valueMembers.publicMembers:this.valueMembers.privateMembers,s?s.add(r.name,r)||u.duplicateIdentifier(i,r.name):n.CompilerDiagnostics.Alert("YYYYY"),r.container=t},i.prototype.getTable=function(){return this.valueMembers.allMembers},i}(t),n.SymbolScopeBuilder=r,e=function(n){function t(t,i,r){n.call(this,i),this.scope=t,this.filter=r}return __extends(t,n),t.prototype.print=function(n){this.scope.print(n)},t.prototype.find=function(n,t,i){return this.filter.reset(),this.scope.search(this.filter,n,t,i)},t.prototype.findLocal=function(n,t,i){return this.scope.findLocal(n,t,i)},t}(t),n.FilteredSymbolScope=e,o=function(n){function t(t,i,r,u){n.call(this,t,null,null,null,i,r),this.filter=u}return __extends(t,n),t.prototype.findLocal=function(t,i,r){var u=n.prototype.findLocal.call(this,t,i,r);return u&&!this.filter(u)?null:u},t.prototype.search=function(){throw new Error("please implement");},t.prototype.find=function(t,i,r){var u=n.prototype.findLocal.call(this,t,i,r);return u&&!this.filter(u)?null:n.prototype.find.call(this,t,i,r)},t}(r),n.FilteredSymbolScopeBuilder=o}(TypeScript||(TypeScript={})),function(n){function u(t,i,r,u,f,e,s,h){t!==undefined&&(n.tokenTable[t]=new o(t,i,r,u,f,e,s,h),u!=n.NodeType.None&&(n.nodeTypeTable[u]=s,n.nodeTypeToTokTable[u]=t),e!=n.NodeType.None&&(n.nodeTypeTable[e]=s))}function s(t){return n.tokenTable[t]}function p(){for(var t=0;t<=i.LimFixed;t++)n.staticTokens[t]=new e(t)}var i,t,r,o,f,h,e,c,l,a,v,y;(function(n){n._map=[],n._map[0]="ANY",n.ANY=0,n._map[1]="BOOL",n.BOOL=1,n._map[2]="BREAK",n.BREAK=2,n._map[3]="CASE",n.CASE=3,n._map[4]="CATCH",n.CATCH=4,n._map[5]="CLASS",n.CLASS=5,n._map[6]="CONST",n.CONST=6,n._map[7]="CONTINUE",n.CONTINUE=7,n._map[8]="DEBUGGER",n.DEBUGGER=8,n._map[9]="DEFAULT",n.DEFAULT=9,n._map[10]="DELETE",n.DELETE=10,n._map[11]="DO",n.DO=11,n._map[12]="ELSE",n.ELSE=12,n._map[13]="ENUM",n.ENUM=13,n._map[14]="EXPORT",n.EXPORT=14,n._map[15]="EXTENDS",n.EXTENDS=15,n._map[16]="DECLARE",n.DECLARE=16,n._map[17]="FALSE",n.FALSE=17,n._map[18]="FINALLY",n.FINALLY=18,n._map[19]="FOR",n.FOR=19,n._map[20]="FUNCTION",n.FUNCTION=20,n._map[21]="CONSTRUCTOR",n.CONSTRUCTOR=21,n._map[22]="GET",n.GET=22,n._map[23]="IF",n.IF=23,n._map[24]="IMPLEMENTS",n.IMPLEMENTS=24,n._map[25]="IMPORT",n.IMPORT=25,n._map[26]="IN",n.IN=26,n._map[27]="INSTANCEOF",n.INSTANCEOF=27,n._map[28]="INTERFACE",n.INTERFACE=28,n._map[29]="LET",n.LET=29,n._map[30]="MODULE",n.MODULE=30,n._map[31]="NEW",n.NEW=31,n._map[32]="NUMBER",n.NUMBER=32,n._map[33]="NULL",n.NULL=33,n._map[34]="PACKAGE",n.PACKAGE=34,n._map[35]="PRIVATE",n.PRIVATE=35,n._map[36]="PROTECTED",n.PROTECTED=36,n._map[37]="PUBLIC",n.PUBLIC=37,n._map[38]="RETURN",n.RETURN=38,n._map[39]="SET",n.SET=39,n._map[40]="STATIC",n.STATIC=40,n._map[41]="STRING",n.STRING=41,n._map[42]="SUPER",n.SUPER=42,n._map[43]="SWITCH",n.SWITCH=43,n._map[44]="THIS",n.THIS=44,n._map[45]="THROW",n.THROW=45,n._map[46]="TRUE",n.TRUE=46,n._map[47]="TRY",n.TRY=47,n._map[48]="TYPEOF",n.TYPEOF=48,n._map[49]="VAR",n.VAR=49,n._map[50]="VOID",n.VOID=50,n._map[51]="WITH",n.WITH=51,n._map[52]="WHILE",n.WHILE=52,n._map[53]="YIELD",n.YIELD=53,n._map[54]="SColon",n.SColon=54,n._map[55]="LParen",n.LParen=55,n._map[56]="RParen",n.RParen=56,n._map[57]="LBrack",n.LBrack=57,n._map[58]="RBrack",n.RBrack=58,n._map[59]="LCurly",n.LCurly=59,n._map[60]="RCurly",n.RCurly=60,n._map[61]="Comma",n.Comma=61,n._map[62]="Asg",n.Asg=62,n._map[63]="AsgAdd",n.AsgAdd=63,n._map[64]="AsgSub",n.AsgSub=64,n._map[65]="AsgMul",n.AsgMul=65,n._map[66]="AsgDiv",n.AsgDiv=66,n._map[67]="AsgMod",n.AsgMod=67,n._map[68]="AsgAnd",n.AsgAnd=68,n._map[69]="AsgXor",n.AsgXor=69,n._map[70]="AsgOr",n.AsgOr=70,n._map[71]="AsgLsh",n.AsgLsh=71,n._map[72]="AsgRsh",n.AsgRsh=72,n._map[73]="AsgRs2",n.AsgRs2=73,n._map[74]="QMark",n.QMark=74,n._map[75]="Colon",n.Colon=75,n._map[76]="LogOr",n.LogOr=76,n._map[77]="LogAnd",n.LogAnd=77,n._map[78]="Or",n.Or=78,n._map[79]="Xor",n.Xor=79,n._map[80]="And",n.And=80,n._map[81]="EQ",n.EQ=81,n._map[82]="NE",n.NE=82,n._map[83]="Eqv",n.Eqv=83,n._map[84]="NEqv",n.NEqv=84,n._map[85]="LT",n.LT=85,n._map[86]="LE",n.LE=86,n._map[87]="GT",n.GT=87,n._map[88]="GE",n.GE=88,n._map[89]="Lsh",n.Lsh=89,n._map[90]="Rsh",n.Rsh=90,n._map[91]="Rs2",n.Rs2=91,n._map[92]="Add",n.Add=92,n._map[93]="Sub",n.Sub=93,n._map[94]="Mult",n.Mult=94,n._map[95]="Div",n.Div=95,n._map[96]="Pct",n.Pct=96,n._map[97]="Tilde",n.Tilde=97,n._map[98]="Bang",n.Bang=98,n._map[99]="Inc",n.Inc=99,n._map[100]="Dec",n.Dec=100,n._map[101]="Dot",n.Dot=101,n._map[102]="Ellipsis",n.Ellipsis=102,n._map[103]="Error",n.Error=103,n._map[104]="EOF",n.EOF=104,n._map[105]="Arrow",n.Arrow=105,n._map[106]="ID",n.ID=106,n._map[107]="QString",n.QString=107,n._map[108]="Regex",n.Regex=108,n._map[109]="NumberLit",n.NumberLit=109,n._map[110]="Whitespace",n.Whitespace=110,n._map[111]="Comment",n.Comment=111,n._map[112]="Lim",n.Lim=112,n.LimFixed=n.Arrow,n.LimKeyword=n.YIELD})(n.TokenID||(n.TokenID={})),i=n.TokenID,n.tokenTable=[],n.nodeTypeTable=[],n.nodeTypeToTokTable=[],n.noRegexTable=[],n.noRegexTable[i.ID]=!0,n.noRegexTable[i.QString]=!0,n.noRegexTable[i.NumberLit]=!0,n.noRegexTable[i.Regex]=!0,n.noRegexTable[i.THIS]=!0,n.noRegexTable[i.Inc]=!0,n.noRegexTable[i.Dec]=!0,n.noRegexTable[i.RParen]=!0,n.noRegexTable[i.RBrack]=!0,n.noRegexTable[i.RCurly]=!0,n.noRegexTable[i.TRUE]=!0,n.noRegexTable[i.FALSE]=!0,function(n){n._map=[],n._map[0]="No",n.No=0,n._map[1]="Cma",n.Cma=1,n._map[2]="Asg",n.Asg=2,n._map[3]="Que",n.Que=3,n._map[4]="Lor",n.Lor=4,n._map[5]="Lan",n.Lan=5,n._map[6]="Bor",n.Bor=6,n._map[7]="Xor",n.Xor=7,n._map[8]="Ban",n.Ban=8,n._map[9]="Equ",n.Equ=9,n._map[10]="Cmp",n.Cmp=10,n._map[11]="Shf",n.Shf=11,n._map[12]="Add",n.Add=12,n._map[13]="Mul",n.Mul=13,n._map[14]="Uni",n.Uni=14,n._map[15]="Lim",n.Lim=15}(n.OperatorPrecedence||(n.OperatorPrecedence={})),t=n.OperatorPrecedence,function(n){n._map=[],n.None=0,n.Javascript=1,n.JavascriptFuture=2,n.TypeScript=4,n.JavascriptFutureStrict=8,n.TypeScriptAndJS=n.Javascript|n.TypeScript,n.TypeScriptAndJSFuture=n.JavascriptFuture|n.TypeScript,n.TypeScriptAndJSFutureStrict=n.JavascriptFutureStrict|n.TypeScript}(n.Reservation||(n.Reservation={})),r=n.Reservation,o=function(){function n(n,t,i,r,u,f,e,o){this.tokenId=n,this.reservation=t,this.binopPrecedence=i,this.binopNodeType=r,this.unopPrecedence=u,this.unopNodeType=f,this.text=e,this.ers=o}return n}(),n.TokenInfo=o,u(i.ANY,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"any",n.ErrorRecoverySet.PrimType),u(i.BOOL,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"bool",n.ErrorRecoverySet.PrimType),u(i.BREAK,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"break",n.ErrorRecoverySet.Stmt),u(i.CASE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"case",n.ErrorRecoverySet.SCase),u(i.CATCH,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"catch",n.ErrorRecoverySet.Catch),u(i.CLASS,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"class",n.ErrorRecoverySet.TypeScriptS),u(i.CONST,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"const",n.ErrorRecoverySet.Var),u(i.CONTINUE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"continue",n.ErrorRecoverySet.Stmt),u(i.DEBUGGER,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.Debugger,"debugger",n.ErrorRecoverySet.Stmt),u(i.DEFAULT,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"default",n.ErrorRecoverySet.SCase),u(i.DELETE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.Uni,n.NodeType.Delete,"delete",n.ErrorRecoverySet.Prefix),u(i.DO,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"do",n.ErrorRecoverySet.Stmt),u(i.ELSE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"else",n.ErrorRecoverySet.Else),u(i.ENUM,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"enum",n.ErrorRecoverySet.TypeScriptS),u(i.EXPORT,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"export",n.ErrorRecoverySet.TypeScriptS),u(i.EXTENDS,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"extends",n.ErrorRecoverySet.None),u(i.DECLARE,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"declare",n.ErrorRecoverySet.Stmt),u(i.FALSE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"false",n.ErrorRecoverySet.RLit),u(i.FINALLY,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"finally",n.ErrorRecoverySet.Catch),u(i.FOR,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"for",n.ErrorRecoverySet.Stmt),u(i.FUNCTION,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"function",n.ErrorRecoverySet.Func),u(i.CONSTRUCTOR,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"constructor",n.ErrorRecoverySet.Func),u(i.GET,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"get",n.ErrorRecoverySet.Func),u(i.SET,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"set",n.ErrorRecoverySet.Func),u(i.IF,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"if",n.ErrorRecoverySet.Stmt),u(i.IMPLEMENTS,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"implements",n.ErrorRecoverySet.None),u(i.IMPORT,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"import",n.ErrorRecoverySet.TypeScriptS),u(i.IN,r.TypeScriptAndJS,t.Cmp,n.NodeType.In,t.No,n.NodeType.None,"in",n.ErrorRecoverySet.None),u(i.INSTANCEOF,r.TypeScriptAndJS,t.Cmp,n.NodeType.InstOf,t.No,n.NodeType.None,"instanceof",n.ErrorRecoverySet.BinOp),u(i.INTERFACE,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"interface",n.ErrorRecoverySet.TypeScriptS),u(i.LET,r.JavascriptFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"let",n.ErrorRecoverySet.None),u(i.MODULE,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"module",n.ErrorRecoverySet.TypeScriptS),u(i.NEW,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"new",n.ErrorRecoverySet.PreOp),u(i.NUMBER,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"number",n.ErrorRecoverySet.PrimType),u(i.NULL,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"null",n.ErrorRecoverySet.RLit),u(i.PACKAGE,r.JavascriptFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"package",n.ErrorRecoverySet.None),u(i.PRIVATE,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"private",n.ErrorRecoverySet.TypeScriptS),u(i.PROTECTED,r.JavascriptFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"protected",n.ErrorRecoverySet.None),u(i.PUBLIC,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"public",n.ErrorRecoverySet.TypeScriptS),u(i.RETURN,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"return",n.ErrorRecoverySet.Stmt),u(i.STATIC,r.TypeScriptAndJSFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"static",n.ErrorRecoverySet.None),u(i.STRING,r.TypeScript,t.No,n.NodeType.None,t.No,n.NodeType.None,"string",n.ErrorRecoverySet.PrimType),u(i.SUPER,r.TypeScriptAndJSFuture,t.No,n.NodeType.None,t.No,n.NodeType.None,"super",n.ErrorRecoverySet.RLit),u(i.SWITCH,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"switch",n.ErrorRecoverySet.Stmt),u(i.THIS,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"this",n.ErrorRecoverySet.RLit),u(i.THROW,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"throw",n.ErrorRecoverySet.Stmt),u(i.TRUE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"true",n.ErrorRecoverySet.RLit),u(i.TRY,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"try",n.ErrorRecoverySet.Stmt),u(i.TYPEOF,r.TypeScriptAndJS,t.No,n.NodeType.None,t.Uni,n.NodeType.Typeof,"typeof",n.ErrorRecoverySet.Prefix),u(i.VAR,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"var",n.ErrorRecoverySet.Var),u(i.VOID,r.TypeScriptAndJS,t.No,n.NodeType.None,t.Uni,n.NodeType.Void,"void",n.ErrorRecoverySet.Prefix),u(i.WITH,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.With,"with",n.ErrorRecoverySet.Stmt),u(i.WHILE,r.TypeScriptAndJS,t.No,n.NodeType.None,t.No,n.NodeType.None,"while",n.ErrorRecoverySet.While),u(i.YIELD,r.JavascriptFutureStrict,t.No,n.NodeType.None,t.No,n.NodeType.None,"yield",n.ErrorRecoverySet.None),u(i.ID,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"identifier",n.ErrorRecoverySet.ID),u(i.NumberLit,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"numberLiteral",n.ErrorRecoverySet.Literal),u(i.Regex,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"regex",n.ErrorRecoverySet.RegExp),u(i.QString,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"qstring",n.ErrorRecoverySet.Literal),u(i.SColon,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,";",n.ErrorRecoverySet.SColon),u(i.RParen,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,")",n.ErrorRecoverySet.RParen),u(i.RBrack,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"]",n.ErrorRecoverySet.RBrack),u(i.LCurly,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"{",n.ErrorRecoverySet.LCurly),u(i.RCurly,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"}",n.ErrorRecoverySet.RCurly),u(i.Ellipsis,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"...",n.ErrorRecoverySet.None),u(i.Comma,r.None,t.Cma,n.NodeType.Comma,t.No,n.NodeType.None,",",n.ErrorRecoverySet.Comma),u(i.Asg,r.None,t.Asg,n.NodeType.Asg,t.No,n.NodeType.None,"=",n.ErrorRecoverySet.Asg),u(i.AsgAdd,r.None,t.Asg,n.NodeType.AsgAdd,t.No,n.NodeType.None,"+=",n.ErrorRecoverySet.BinOp),u(i.AsgSub,r.None,t.Asg,n.NodeType.AsgSub,t.No,n.NodeType.None,"-=",n.ErrorRecoverySet.BinOp),u(i.AsgMul,r.None,t.Asg,n.NodeType.AsgMul,t.No,n.NodeType.None,"*=",n.ErrorRecoverySet.BinOp),u(i.AsgDiv,r.None,t.Asg,n.NodeType.AsgDiv,t.No,n.NodeType.None,"/=",n.ErrorRecoverySet.BinOp),u(i.AsgMod,r.None,t.Asg,n.NodeType.AsgMod,t.No,n.NodeType.None,"%=",n.ErrorRecoverySet.BinOp),u(i.AsgAnd,r.None,t.Asg,n.NodeType.AsgAnd,t.No,n.NodeType.None,"&=",n.ErrorRecoverySet.BinOp),u(i.AsgXor,r.None,t.Asg,n.NodeType.AsgXor,t.No,n.NodeType.None,"^=",n.ErrorRecoverySet.BinOp),u(i.AsgOr,r.None,t.Asg,n.NodeType.AsgOr,t.No,n.NodeType.None,"|=",n.ErrorRecoverySet.BinOp),u(i.AsgLsh,r.None,t.Asg,n.NodeType.AsgLsh,t.No,n.NodeType.None,"<<=",n.ErrorRecoverySet.BinOp),u(i.AsgRsh,r.None,t.Asg,n.NodeType.AsgRsh,t.No,n.NodeType.None,">>=",n.ErrorRecoverySet.BinOp),u(i.AsgRs2,r.None,t.Asg,n.NodeType.AsgRs2,t.No,n.NodeType.None,">>>=",n.ErrorRecoverySet.BinOp),u(i.QMark,r.None,t.Que,n.NodeType.QMark,t.No,n.NodeType.None,"?",n.ErrorRecoverySet.BinOp),u(i.Colon,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,":",n.ErrorRecoverySet.Colon),u(i.LogOr,r.None,t.Lor,n.NodeType.LogOr,t.No,n.NodeType.None,"||",n.ErrorRecoverySet.BinOp),u(i.LogAnd,r.None,t.Lan,n.NodeType.LogAnd,t.No,n.NodeType.None,"&&",n.ErrorRecoverySet.BinOp),u(i.Or,r.None,t.Bor,n.NodeType.Or,t.No,n.NodeType.None,"|",n.ErrorRecoverySet.BinOp),u(i.Xor,r.None,t.Xor,n.NodeType.Xor,t.No,n.NodeType.None,"^",n.ErrorRecoverySet.BinOp),u(i.And,r.None,t.Ban,n.NodeType.And,t.No,n.NodeType.None,"&",n.ErrorRecoverySet.BinOp),u(i.EQ,r.None,t.Equ,n.NodeType.Eq,t.No,n.NodeType.None,"==",n.ErrorRecoverySet.BinOp),u(i.NE,r.None,t.Equ,n.NodeType.Ne,t.No,n.NodeType.None,"!=",n.ErrorRecoverySet.BinOp),u(i.Eqv,r.None,t.Equ,n.NodeType.Eqv,t.No,n.NodeType.None,"===",n.ErrorRecoverySet.BinOp),u(i.NEqv,r.None,t.Equ,n.NodeType.NEqv,t.No,n.NodeType.None,"!==",n.ErrorRecoverySet.BinOp),u(i.LT,r.None,t.Cmp,n.NodeType.Lt,t.No,n.NodeType.None,"<",n.ErrorRecoverySet.BinOp),u(i.LE,r.None,t.Cmp,n.NodeType.Le,t.No,n.NodeType.None,"<=",n.ErrorRecoverySet.BinOp),u(i.GT,r.None,t.Cmp,n.NodeType.Gt,t.No,n.NodeType.None,">",n.ErrorRecoverySet.BinOp),u(i.GE,r.None,t.Cmp,n.NodeType.Ge,t.No,n.NodeType.None,">=",n.ErrorRecoverySet.BinOp),u(i.Lsh,r.None,t.Shf,n.NodeType.Lsh,t.No,n.NodeType.None,"<<",n.ErrorRecoverySet.BinOp),u(i.Rsh,r.None,t.Shf,n.NodeType.Rsh,t.No,n.NodeType.None,">>",n.ErrorRecoverySet.BinOp),u(i.Rs2,r.None,t.Shf,n.NodeType.Rs2,t.No,n.NodeType.None,">>>",n.ErrorRecoverySet.BinOp),u(i.Add,r.None,t.Add,n.NodeType.Add,t.Uni,n.NodeType.Pos,"+",n.ErrorRecoverySet.AddOp),u(i.Sub,r.None,t.Add,n.NodeType.Sub,t.Uni,n.NodeType.Neg,"-",n.ErrorRecoverySet.AddOp),u(i.Mult,r.None,t.Mul,n.NodeType.Mul,t.No,n.NodeType.None,"*",n.ErrorRecoverySet.BinOp),u(i.Div,r.None,t.Mul,n.NodeType.Div,t.No,n.NodeType.None,"/",n.ErrorRecoverySet.BinOp),u(i.Pct,r.None,t.Mul,n.NodeType.Mod,t.No,n.NodeType.None,"%",n.ErrorRecoverySet.BinOp),u(i.Tilde,r.None,t.No,n.NodeType.None,t.Uni,n.NodeType.Not,"~",n.ErrorRecoverySet.PreOp),u(i.Bang,r.None,t.No,n.NodeType.None,t.Uni,n.NodeType.LogNot,"!",n.ErrorRecoverySet.PreOp),u(i.Inc,r.None,t.No,n.NodeType.None,t.Uni,n.NodeType.IncPre,"++",n.ErrorRecoverySet.PreOp),u(i.Dec,r.None,t.No,n.NodeType.None,t.Uni,n.NodeType.DecPre,"--",n.ErrorRecoverySet.PreOp),u(i.LParen,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"(",n.ErrorRecoverySet.LParen),u(i.LBrack,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"[",n.ErrorRecoverySet.LBrack),u(i.Dot,r.None,t.Uni,n.NodeType.None,t.No,n.NodeType.None,".",n.ErrorRecoverySet.Dot),u(i.EOF,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"<EOF>",n.ErrorRecoverySet.EOF),u(i.Arrow,r.None,t.No,n.NodeType.None,t.No,n.NodeType.None,"=>",n.ErrorRecoverySet.None),n.lookupToken=s,function(n){n._map=[],n._map[0]="Punctuation",n.Punctuation=0,n._map[1]="Keyword",n.Keyword=1,n._map[2]="Operator",n.Operator=2,n._map[3]="Comment",n.Comment=3,n._map[4]="Whitespace",n.Whitespace=4,n._map[5]="Identifier",n.Identifier=5,n._map[6]="Literal",n.Literal=6}(n.TokenClass||(n.TokenClass={})),f=n.TokenClass,h=function(){function n(n,t,i){this.tok=n,this.minChar=t,this.limChar=i}return n}(),n.SavedToken=h,e=function(){function t(n){this.tokenId=n}return t.prototype.toString=function(){return"token: "+this.tokenId+" "+this.getText()+" ("+i._map[this.tokenId]+")"},t.prototype.print=function(n,t){t.WriteLine(this.toString()+",on line"+n)},t.prototype.getText=function(){return n.tokenTable[this.tokenId].text},t.prototype.classification=function(){if(this.tokenId<=i.LimKeyword)return f.Keyword;var t=s(this.tokenId);return t!=undefined&&(t.unopNodeType!=n.NodeType.None||t.binopNodeType!=n.NodeType.None)?f.Operator:f.Punctuation},t}(),n.Token=e,c=function(n){function t(t){n.call(this,i.NumberLit),this.value=t}return __extends(t,n),t.prototype.getText=function(){return this.value.toString()},t.prototype.classification=function(){return f.Literal},t}(e),n.NumberToken=c,l=function(n){function t(t,i){n.call(this,t),this.value=i,this.tokenId=t}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return this.tokenId==i.ID?f.Identifier:f.Literal},t}(e),n.StringToken=l,a=function(n){function t(t,i){n.call(this,t),this.value=i,this.tokenId=t}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.Whitespace},t}(e),n.WhitespaceToken=a,v=function(n){function t(t,i,r,u,f,e){n.call(this,t),this.value=i,this.isBlock=r,this.startPos=u,this.line=f,this.endsLine=e,this.tokenID=t}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.Comment},t}(e),n.CommentToken=v,y=function(n){function t(t){n.call(this,i.Regex),this.regex=t}return __extends(t,n),t.prototype.getText=function(){return this.regex.toString()},t.prototype.classification=function(){return f.Literal},t}(e),n.RegexToken=y,n.staticTokens=[],n.initializeStaticTokens=p}(TypeScript||(TypeScript={})),function(n){var u=function(){function n(){this.arrayBase=null}return n.prototype.specialize=function(n,t){return this.arrayBase==null&&(this.arrayBase=n.specializeType(t.wildElm.type,this.arrayType.elementType,t,!0)),this.arrayBase},n}(),f,t,e,i,r,o;n.ArrayCache=u,f=function(){function t(){this.onlyCaptureFirstError=!1,this.flags=n.TypeRelationshipFlags.SuccessfulComparison,this.message=""}return t.prototype.addMessageToFront=function(n){this.onlyCaptureFirstError?this.setMessage(n):this.message=this.message?n+":\n\t"+this.message:n},t.prototype.setMessage=function(n){this.message=n},t}(),n.TypeComparisonInfo=f,function(n){n._map=[],n._map[0]="Resident",n.Resident=0,n._map[1]="Transient",n.Transient=1}(n.TypeCheckCollectionMode||(n.TypeCheckCollectionMode={})),t=n.TypeCheckCollectionMode,e=function(){function i(i){this.errorReporter=i,this.importedGlobalsTable=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.importedGlobalsTypeTable=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.globals=null,this.globalTypes=null,this.ambientGlobals=null,this.ambientGlobalTypes=null,this.residentGlobalValues=new n.StringHashTable,this.residentGlobalTypes=new n.StringHashTable,this.residentGlobalAmbientValues=new n.StringHashTable,this.residentGlobalAmbientTypes=new n.StringHashTable,this.residentTypeCheck=!0,this.mod=null,this.gloMod=null,this.wildElm=null,this.importedGlobals=new n.SymbolScopeBuilder(null,this.importedGlobalsTable,null,this.importedGlobalsTypeTable,null,null),this.dualGlobalValues=new n.DualStringHashTable(this.residentGlobalValues,new n.StringHashTable),this.dualGlobalTypes=new n.DualStringHashTable(this.residentGlobalTypes,new n.StringHashTable),this.dualAmbientGlobalValues=new n.DualStringHashTable(this.residentGlobalAmbientValues,new n.StringHashTable),this.dualAmbientGlobalTypes=new n.DualStringHashTable(this.residentGlobalAmbientTypes,new n.StringHashTable);var r=new n.ScopedMembers(new n.DualStringHashTable(this.dualGlobalValues,new n.StringHashTable)),u=new n.ScopedMembers(new n.DualStringHashTable(this.dualAmbientGlobalValues,new n.StringHashTable)),f=new n.ScopedMembers(new n.DualStringHashTable(this.dualGlobalTypes,new n.StringHashTable)),e=new n.ScopedMembers(new n.DualStringHashTable(this.dualAmbientGlobalTypes,new n.StringHashTable));this.globalScope=new n.SymbolScopeBuilder(r,u,f,e,this.importedGlobals,null),this.voidType=this.enterPrimitive(n.Primitive.Void,"void"),this.booleanType=this.enterPrimitive(n.Primitive.Boolean,"bool"),this.doubleType=this.enterPrimitive(n.Primitive.Double,"number"),this.importedGlobals.ambientEnclosedTypes.addPublicMember("number",this.doubleType.symbol),this.stringType=this.enterPrimitive(n.Primitive.String,"string"),this.anyType=this.enterPrimitive(n.Primitive.Any,"any"),this.nullType=this.enterPrimitive(n.Primitive.Null,"null"),this.undefinedType=this.enterPrimitive(n.Primitive.Undefined,"undefined"),this.setCollectionMode(t.Resident),this.wildElm=new n.TypeSymbol("_element",0,-1,new n.Type),this.importedGlobalsTypeTable.addPublicMember(this.wildElm.name,this.wildElm),this.mod=new n.ModuleType(f,e),this.mod.members=r,this.mod.ambientMembers=u,this.mod.containedScope=this.globalScope,this.gloMod=new n.TypeSymbol(n.globalId,0,-1,this.mod),this.mod.members.addPublicMember(this.gloMod.name,this.gloMod),this.defineGlobalValue("undefined",this.undefinedType)}return i.prototype.enterPrimitive=function(t,i){var r=new n.Type,u;return r.primitiveTypeClass=t,u=new n.TypeSymbol(i,0,-1,r),u.typeCheckStatus=n.TypeCheckStatus.Finished,r.symbol=u,this.importedGlobals.enter(null,null,u,this.errorReporter,!0,!0,!0),r},i.prototype.setCollectionMode=function(n){this.residentTypeCheck=this.dualGlobalValues.insertPrimary=this.dualGlobalTypes.insertPrimary=this.dualAmbientGlobalValues.insertPrimary=this.dualAmbientGlobalTypes.insertPrimary=n==t.Resident},i.prototype.refreshPersistentState=function(){this.globals=new n.StringHashTable,this.globalTypes=new n.StringHashTable,this.ambientGlobals=new n.StringHashTable,this.ambientGlobalTypes=new n.StringHashTable,this.dualGlobalValues.secondaryTable=this.globals,this.dualGlobalTypes.secondaryTable=this.globalTypes,this.dualAmbientGlobalValues.secondaryTable=this.ambientGlobals,this.dualAmbientGlobalTypes.secondaryTable=this.ambientGlobalTypes},i.prototype.defineGlobalValue=function(t,i){var u=new n.ValueLocation,r;u.typeLink=new n.TypeLink,r=new n.VariableSymbol(t,0,-1,u),r.setType(i),r.typeCheckStatus=n.TypeCheckStatus.Finished,r.container=this.gloMod,this.importedGlobalsTable.addPublicMember(t,r)},i}(),n.PersistentGlobalTypeState=e,i=function(){function n(n,t,i){this.contextualType=n,this.provisional=t,this.contextID=i,this.targetSig=null,this.targetThis=null,this.targetAccessorType=null}return n}(),n.ContextualTypeContext=i,r=function(){function t(n){this.checker=n,this.contextStack=[],this.hadProvisionalErrors=!1}return t.contextID=n.TypeCheckStatus.Finished+1,t.prototype.pushContextualType=function(n,r){this.contextStack.push(new i(n,r,t.contextID++)),this.checker.errorReporter.pushToErrorSink=r},t.prototype.popContextualType=function(){var n=this.contextStack.pop();return this.checker.errorReporter.pushToErrorSink=this.isProvisional(),this.hadProvisionalErrors=this.hadProvisionalErrors||n.provisional&&this.checker.errorReporter.getCapturedErrors().length,this.checker.errorReporter.freeCapturedErrors(),n},t.prototype.getContextualType=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1]:null},t.prototype.getContextID=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].contextID:n.TypeCheckStatus.Finished},t.prototype.isProvisional=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].provisional:!1},t}(),n.ContextualTypingContextStack=r,o=function(){function t(n){this.persistentState=n,this.errorReporter=null,this.checkControlFlow=!1,this.printControlFlowGraph=!1,this.checkControlFlowUseDef=!1,this.styleSettings=null,this.units=null,this.anon="_anonymous",this.locationInfo=null,this.typeFlow=null,this.currentCompareA=null,this.currentCompareB=null,this.currentModDecl=null,this.inBind=!1,this.inWith=!1,this.errorsOnWith=!0,this.currentContextualTypeContext=null,this.resolvingBases=!1,this.canCallDefinitionSignature=!1,this.assignableCache={},this.subtypeCache={},this.identicalCache={},this.provisionalStartedTypecheckObjects=[],this.voidType=this.persistentState.voidType,this.booleanType=this.persistentState.booleanType,this.numberType=this.persistentState.doubleType,this.stringType=this.persistentState.stringType,this.anyType=this.persistentState.anyType,this.nullType=this.persistentState.nullType,this.undefinedType=this.persistentState.undefinedType,this.globals=this.persistentState.dualGlobalValues,this.globalTypes=this.persistentState.dualGlobalTypes,this.ambientGlobals=this.persistentState.dualAmbientGlobalValues,this.ambientGlobalTypes=this.persistentState.dualAmbientGlobalTypes,this.gloModType=this.persistentState.mod,this.gloMod=this.persistentState.gloMod,this.wildElm=this.persistentState.wildElm,this.globalScope=this.persistentState.globalScope,this.typingContextStack=new r(this)}return t.prototype.setStyleOptions=function(n){this.styleSettings=n},t.prototype.setContextualType=function(n,t){this.typingContextStack.pushContextualType(n,t),this.currentContextualTypeContext=this.typingContextStack.getContextualType()},t.prototype.unsetContextualType=function(){var n=this.typingContextStack.popContextualType();return this.currentContextualTypeContext=this.typingContextStack.getContextualType(),n},t.prototype.hadProvisionalErrors=function(){return this.typingContextStack.hadProvisionalErrors},t.prototype.resetProvisionalErrors=function(){this.typingContextStack.getContextualType()||(this.typingContextStack.hadProvisionalErrors=!1)},t.prototype.typeCheckWithContextualType=function(n,t,i,r){i&&this.setContextualType(n,this.typingContextStack.isProvisional()||t),this.typeFlow.typeCheck(r),i&&this.unsetContextualType()},t.prototype.resetTargetType=function(){this.currentContextualTypeContext=this.typingContextStack.getContextualType()},t.prototype.killTargetType=function(){this.currentContextualTypeContext=null,this.errorReporter.pushToErrorSink=!1},t.prototype.hasTargetType=function(){return this.currentContextualTypeContext&&this.currentContextualTypeContext.contextualType},t.prototype.getTargetTypeContext=function(){return this.currentContextualTypeContext},t.prototype.inProvisionalTypecheckMode=function(){return this.typingContextStack.isProvisional()},t.prototype.getTypeCheckFinishedStatus=function(){return this.inProvisionalTypecheckMode()?this.typingContextStack.getContextID():n.TypeCheckStatus.Finished},t.prototype.typeStatusIsFinished=function(t){return t==n.TypeCheckStatus.Finished||this.inProvisionalTypecheckMode()&&t==this.typingContextStack.getContextID()},t.prototype.addStartedPTO=function(n){this.inProvisionalTypecheckMode()&&(this.provisionalStartedTypecheckObjects[this.provisionalStartedTypecheckObjects.length]=n)},t.prototype.cleanStartedPTO=function(){for(var t=0;t<this.provisionalStartedTypecheckObjects.length;t++)this.provisionalStartedTypecheckObjects[t].typeCheckStatus=n.TypeCheckStatus.NotStarted;this.provisionalStartedTypecheckObjects=[]},t.prototype.collectTypes=function(t){var i,r,u;t.nodeType==n.NodeType.Script&&(i=t,this.locationInfo=i.locationInfo),r=new n.ScopeChain(this.gloMod,null,this.globalScope),u=new n.TypeCollectionContext(r,this),n.getAstWalkerFactory().walk(t,n.preCollectTypes,n.postCollectTypes,null,u)},t.prototype.makeArrayType=function(t){return t.arrayCache==null&&(t.arrayCache=new u,t.arrayCache.arrayType=new n.Type,t.arrayCache.arrayType.elementType=t,t.arrayCache.arrayType.symbol=t.symbol),t.arrayCache.arrayType},t.prototype.getParameterList=function(t,i){var s=null,h=null,c=t.members.length,l=0,e=[],f;if(c>0)for(s=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),h=new n.SymbolScopeBuilder(s,null,null,null,null,i),f=0;f<c;f++){var r=t.members[f],o=new n.ValueLocation,u=new n.ParameterSymbol(r.id.text,r.minChar,this.locationInfo.unitIndex,o);u.declAST=r,r.id.sym=u,r.sym=u,o.symbol=u,o.typeLink=n.getTypeLink(r.typeExpr,this,!1),h.enter(null,r,u,this.errorReporter,!0,!1,!1),e[e.length]=u,r.isOptionalArg()||l++}return{parameters:e,nonOptionalParameterCount:l}},t.prototype.createFunctionSignature=function(t,i,r,u,f){var tt=n.hasFlag(t.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)||i==this.gloMod,a=n.hasFlag(t.fncFlags,n.FncFlags.Static),b=n.hasFlag(t.fncFlags,n.FncFlags.Private),d=n.hasFlag(t.fncFlags,n.FncFlags.Definition),y=n.hasFlag(t.fncFlags,n.FncFlags.Ambient),k=t.isConstructMember()||t.isConstructor,g=i==this.gloMod,h=new n.Signature,nt=t.fncFlags&n.FncFlags.IsFunctionExpression,p,v,e,l,w,o,s,c;return t.returnTypeAnnotation||d?h.returnType=n.getTypeLink(t.returnTypeAnnotation,this,!1):(h.returnType=new n.TypeLink,h.returnType.type=this.anyType),h.hasVariableArgList=t.variableArgList,p=this.getParameterList(t.args,i),h.parameters=p.parameters,h.nonOptionalParameterCount=p.nonOptionalParameterCount,t.signature=h,h.declAST=t,v=u&&u.getType()&&!u.isAccessor()&&(t.isSignature()||y==n.hasFlag(u.flags,n.SymbolFlags.Ambient)),v&&b!=n.hasFlag(u.flags,n.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Public/Private visibility of overloads does not agree"),e=v?u.getType():new n.Type,k?(e.construct==null&&(e.construct=new n.SignatureGroup),e.construct.addSignature(h),e.construct.hasImplementation=!t.isSignature(),e.construct.hasImplementation&&e.setHasImplementation()):t.isIndexerMember()?(e.index==null&&(e.index=new n.SignatureGroup,e.index.flags|=n.SignatureFlags.IsIndexer),e.index.addSignature(h),e.index.hasImplementation=!t.isSignature(),e.index.hasImplementation&&e.setHasImplementation()):(e.call==null&&(e.call=new n.SignatureGroup),e.call.addSignature(h),e.call.hasImplementation=!t.isSignature(),e.call.hasImplementation&&e.setHasImplementation()),c=e.instanceType,c&&!a&&(c.call==null?c.call=e.call:e.call&&c.call.signatures.concat(e.call.signatures)),l=null,w=!1,t.name&&!t.name.isMissing()?l=t.name.text:t.hint&&(l=t.hint,w=!0),e.symbol==null&&(e.symbol=new n.TypeSymbol(l?l:this.anon,t.minChar,this.locationInfo.unitIndex,e),v||(e.symbol.declAST=t)),a&&(e.symbol.flags|=n.SymbolFlags.Static),y&&(e.symbol.flags|=n.SymbolFlags.Ambient),b&&(e.symbol.flags|=n.SymbolFlags.Private),e.symbol.isMethod=t.isMethod(),e.symbol.isMethod&&(e.symbol.flags|=n.SymbolFlags.Property),t.type=e,k||(!l||nt||t.isAccessor()||w?t.isSpecialFn()||(e.symbol.container=i):f?t.isMethod()&&a?(i.type.members.publicMembers.add(l,e.symbol)||this.errorReporter.duplicateIdentifier(t,l),e.symbol.container=i):(u==null||u.declAST&&!u.declAST.isOverload&&i.isType())&&r.enter(i,t,e.symbol,this.errorReporter,!b&&(tt||a||g),!1,y):t.isSpecialFn()||(e.symbol.container=i)),v&&(o=u?u.getType():null,s=e,s!=o&&(s.construct==null?s.construct=o&&o.construct?o.construct:new n.SignatureGroup:o&&o.construct&&s.construct.signatures.concat(o.construct.signatures),o&&(s.call==null?s.call=o.call:o.call&&s.call.signatures.concat(o.call.signatures),a||(s.instanceType==null&&(s.instanceType=o.instanceType),c=s.instanceType,c&&(c.call==null?c.call=o.call:o.call&&c.call.signatures.concat(o.call.signatures))),s.index==null?s.index=o.index:o.index&&s.index.signatures.concat(o.index.signatures)))),h},t.prototype.createAccessorSymbol=function(t,i,r,u,f,e,o){var s=null,l=t.signature,a=t.name.text,v=n.hasFlag(t.fncFlags,n.FncFlags.Static),c=n.hasFlag(t.fncFlags,n.FncFlags.Private),h;return i==null?(h=new n.ValueLocation,s=new n.FieldSymbol(a,t.minChar,this.locationInfo.unitIndex,!1,h),h.symbol=s,s.declAST=t,n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?(s.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),s.getter=l.declAST.type.symbol):(s.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),s.setter=l.declAST.type.symbol),h.typeLink=n.getTypeLink(null,this,!1),u?r?(r.members.publicMembers.add(a,s)||this.errorReporter.duplicateIdentifier(t,s.name),s.container=r.symbol):this.errorReporter.simpleError(t,"Accessor property may not be added in this context"):e.enter(o,t,s,this.errorReporter,!c||v,!1,!1),f&&(s.flags|=n.SymbolFlags.Property),v&&(s.flags|=n.SymbolFlags.Static),s.flags|=c?n.SymbolFlags.Private:n.SymbolFlags.Public):(s=i,c!=n.hasFlag(s.flags,n.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Getter and setter accessors do not agree in visibility"),n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?(s.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),s.getter=t.type.symbol):(s.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),s.setter=t.type.symbol)),s},t.prototype.addBases=function(t,i,r){var f,u,e;if(t.addParentScope(new n.SymbolTableScope(i.members,i.ambientMembers,i.getAllEnclosedTypes(),i.getAllAmbientEnclosedTypes(),i.symbol)),f=0,i.extendsList)for(e=i.extendsList.length;f<e;f++){if(u=i.extendsList[f],r.baseId==u.typeID){this.errorReporter.reportErrorFromSym(u.symbol,"Type '"+r.base+"' is recursively referenced as a base class of itself"),u.symbol.flags|=n.SymbolFlags.RecursivelyReferenced;break}this.addBases(t,u,r)}},t.prototype.scopeOf=function(t){var i=new n.SymbolAggregateScope(t.symbol),r={base:t.symbol&&t.symbol.name?t.symbol.name:"{}",baseId:t.typeID};return this.addBases(i,t,r),i},t.prototype.lookupMemberType=function(n,t){var i=null,r,u;return n.containedScope?i=n.containedScope.find(t,!1,!0):n.members&&(i=n.members.allMembers.lookup(t),i==null&&n.ambientMembers&&(i=n.ambientMembers.allMembers.lookup(t))),i==null&&(r=n.getAllEnclosedTypes(),u=n.getAllAmbientEnclosedTypes(),r&&(i=r.allMembers.lookup(t),i==null&&u&&(i=u.allMembers.lookup(t)))),i&&i.isType()?i.getType():null},t.prototype.findSymbolForDynamicModule=function(t,i,r){var e=t,u=r(t),o,f;if(u==null&&(u||(t=n.swapQuotes(e),u=r(t)),u||(t=n.stripQuotes(e)+".ts",u=r(t)),u||(t=n.stripQuotes(e)+".str",u=r(t)),u||(t=n.stripQuotes(e)+".d.ts",u=r(t)),u||(t=n.stripQuotes(e)+".d.str",u=r(t)),!u&&!n.isRelative(e)))for(t=e,o=n.stripQuotes(t),f=n.getRootFilePath(n.switchToForwardSlashes(i));u==null&&f!=""&&f!="/";)t=n.normalizePath(f+o+".ts"),u=r(t),u==null&&(t=n.changePathToSTR(t),u=r(t)),u==null&&(t=n.changePathToDTS(t),u=r(t)),u==null&&(t=n.changePathToDSTR(t),u=r(t)),u==null&&(f=n.normalizePath(f+".."),f=f&&f!="/"?f+"/":f);return u},t.prototype.resolveTypeMember=function(t,i){var e=i.operand1,h=i.operand2,r=this.anyType,o=this.anyType,s,u,f,y,c,l,a,v;return e&&h&&h.nodeType==n.NodeType.Name&&(e.nodeType==n.NodeType.Dot?o=this.resolveTypeMember(t,e):e.nodeType==n.NodeType.Name&&(s=e,u=t.find(s.text,!1,!0),u==null?this.errorReporter.unresolvedSymbol(s,s.text):u.isType()?(f=u,f.aliasLink&&!f.type&&f.aliasLink.alias.nodeType==n.NodeType.Name&&(y=f.aliasLink.alias.text,c=this.findSymbolForDynamicModule(y,this.locationInfo.filename,function(n){return t.find(n,!1,!0)}),c&&(f.type=c.getType())),n.optimizeModuleCodeGen&&u&&(l=u.getType(),l&&f.aliasLink&&f.onlyReferencedAsTypeRef&&(a=l.symbol.declAST,a&&n.hasFlag(a.modFlags,n.ModuleFlags.IsDynamic)&&(f.onlyReferencedAsTypeRef=!this.resolvingBases))),u.visible(t,this)||this.errorReporter.simpleError(e,"The symbol '"+s.text+"' is not visible at this point"),o=u.getType(),s.sym=u):this.errorReporter.simpleError(e,"Expected type")),o||(o=this.anyType),o!=this.anyType&&(v=h,r=this.lookupMemberType(o,v.text),r==null?(r=this.anyType,this.errorReporter.simpleError(i,"Expected type")):r.symbol.visible(t,this)||this.errorReporter.simpleError(e,"The symbol '"+h.text+"' is not visible at this point"),v.sym=r.symbol)),r.isClass()&&(r=r.instanceType),r},t.prototype.resolveFuncDecl=function(n,t,i){for(var e=this.createFunctionSignature(n,t.container,t,i,!1).declAST.type.symbol,s,f=n.isConstructMember()?e.type.construct.signatures:n.isIndexerMember()?e.type.getInstanceType().index.signatures:e.type.call.signatures,r=f[f.length-1],u=r.parameters.length,o=0;o<u;o++)s=r.parameters[o],this.resolveTypeLink(t,s.parameter.typeLink,!0);return u&&n.variableArgList&&(r.parameters[u-1].parameter.typeLink.type.elementType||(this.errorReporter.simpleErrorFromSym(r.parameters[u-1].parameter.symbol,"... parameter must have array type"),r.parameters[u-1].parameter.typeLink.type.elementType=this.makeArrayType(r.parameters[u-1].parameter.typeLink.type))),this.resolveTypeLink(t,r.returnType,n.isSignature()),e},t.prototype.resolveVarDecl=function(t,i){var r=new n.ValueLocation,u=new n.FieldSymbol(t.id.text,t.minChar,this.locationInfo.unitIndex,(t.varFlags&n.VarFlags.Readonly)==n.VarFlags.None,r);return u.transferVarFlags(t.varFlags),r.symbol=u,u.declAST=t,r.typeLink=n.getTypeLink(t.typeExpr,this,t.init==null),this.resolveTypeLink(i,r.typeLink,!0),t.sym=u,t.type=r.typeLink.type,u},t.prototype.resolveTypeLink=function(t,i,r){var d=0,u,s,h,p,a,o,b,w;if(i.type==null){if(u=i.ast,u)while(i.type==null)switch(u.nodeType){case n.NodeType.Name:s=u,h=t.find(s.text,!1,!0),h==null?(i.type=this.anyType,this.errorReporter.unresolvedSymbol(s,s.text)):h.isType()?(h.visible(t,this)||this.errorReporter.simpleError(u,"The symbol '"+s.text+"' is not visible at this point"),s.sym=h,i.type=h.getType(),i.type?i.type.isClass()&&(i.type=i.type.instanceType):i.type=this.anyType):(i.type=this.anyType,this.errorReporter.simpleError(u,"Expected type"));break;case n.NodeType.Dot:i.type=this.resolveTypeMember(t,u);break;case n.NodeType.TypeRef:p=u,d=p.arrayCount,u=p.term,u==null&&(i.type=this.anyType);break;case n.NodeType.Interface:var k=u,f=new n.Type,v=new n.TypeSymbol(k.name.text,u.minChar,this.locationInfo.unitIndex,f);f.symbol=v,f.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.containedScope=new n.SymbolTableScope(f.members,null,null,null,v),f.containedScope.container=v,f.memberScope=f.containedScope;var tt=k.members,g=tt.members,nt=g.length;for(a=0;a<nt;a++){var l=g[a],e=null,y=!0,c=null;l.nodeType==n.NodeType.FuncDecl?(o=l,c=o.name,e=f.members.allMembers.lookup(o.getNameText()),y=e==null,o.isSpecialFn()?(y=!1,e=this.resolveFuncDecl(o,t,v)):e=this.resolveFuncDecl(o,t,e),o.type=e.type):(c=l.id,e=this.resolveVarDecl(l,t)),y&&(c&&n.hasFlag(c.flags,n.ASTFlags.OptionalName)&&(e.flags|=n.SymbolFlags.Optional),f.members.allMembers.add(e.name,e)||this.errorReporter.duplicateIdentifier(u,e.name))}u.type=f,i.type=f;break;case n.NodeType.FuncDecl:b=this.resolveFuncDecl(u,t,null),i.type=b.type;break;default:i.type=this.anyType,this.errorReporter.simpleError(u,"Expected type")}for(w=d;w>0;w--)i.type=this.makeArrayType(i.type);r&&i.type==null&&(i.type=this.anyType),i.ast&&(i.ast.type=i.type)}},t.prototype.findMostApplicableSignature=function(n,t){var o,u,c,l;if(n.length==1)return{sig:n[0].signature,ambiguous:!1};var i=n[0],r=null,s=null,f=null,e=null,h=!1;for(o=1;o<n.length;o++){for(r=n[o],u=0,u=0;t&&u<t.members.length;u++)if(s=t.members[u].type,f=u<i.signature.parameters.length?i.signature.parameters[u].getType():i.signature.parameters[i.signature.parameters.length-1].getType().elementType,e=u<r.signature.parameters.length?r.signature.parameters[u].getType():r.signature.parameters[r.signature.parameters.length-1].getType().elementType,this.typesAreIdentical(f,e))continue;else if(this.typesAreIdentical(s,f))break;else if(this.typesAreIdentical(s,e)){i=r;break}else if(this.sourceIsSubtypeOfTarget(f,e))break;else if(this.sourceIsSubtypeOfTarget(e,f)){i=r;break}else if(r.hadProvisionalErrors)break;else if(i.hadProvisionalErrors){i=r;break}t&&u!=t.members.length?h=!1:(c={getLength:function(){return 2},setTypeAtIndex:function(){},getTypeAtIndex:function(n){return n?r.signature.returnType.type:i.signature.returnType.type}},l=this.findBestCommonType(i.signature.returnType.type,null,c),h=!l)}return{sig:i.signature,ambiguous:h}},t.prototype.getApplicableSignatures=function(t,i,r){for(var h=[],f=null,e=!1,c=null,o=!1,u,s=0;s<t.length;s++){for(e=!1,u=0;u<i.members.length;u++)if(!(u>=t[s].parameters.length))if(f=t[s].parameters[u].getType(),t[s].declAST.variableArgList&&u>=t[s].nonOptionalParameterCount-1&&f.isArray()&&(f=f.elementType),f==this.anyType)continue;else if(i.members[u].nodeType==n.NodeType.FuncDecl){if(this.typeFlow.functionInterfaceType&&f==this.typeFlow.functionInterfaceType)continue;if(this.canContextuallyTypeFunction(f,i.members[u],!0)){if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),o=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(i.members[u].type,f,r)||(r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'"),e=!0),o&&(c=this.currentContextualTypeContext,this.typeCheckWithContextualType(null,!0,!0,i.members[u]),this.sourceIsAssignableToTarget(i.members[u].type,f)||(e=!0),this.cleanStartedPTO()),this.resetProvisionalErrors(),e)break}else if(this.canContextuallyTypeFunction(f,i.members[u],!1)){if(this.typeFlow.typeCheck(i.members[u]),!this.sourceIsAssignableToTarget(i.members[u].type,f,r))break}else break}else if(i.members[u].nodeType==n.NodeType.ObjectLit){if(this.typeFlow.objectInterfaceType&&f==this.typeFlow.objectInterfaceType)continue;if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),o=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(i.members[u].type,f,r)||(r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'"),e=!0),o&&(this.typeCheckWithContextualType(null,!0,!0,i.members[u]),this.sourceIsAssignableToTarget(i.members[u].type,f)||(e=!0),this.cleanStartedPTO()),this.resetProvisionalErrors(),e)break}else if(i.members[u].nodeType==n.NodeType.ArrayLit){if(this.typeFlow.arrayInterfaceType&&f==this.typeFlow.arrayInterfaceType)continue;if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),o=this.hadProvisionalErrors(),!this.sourceIsAssignableToTarget(i.members[u].type,f,r)){r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'");break}if(o&&(this.typeCheckWithContextualType(null,!0,!0,i.members[u]),this.sourceIsAssignableToTarget(i.members[u].type,f)||(e=!0),this.cleanStartedPTO()),this.resetProvisionalErrors(),e)break}u==i.members.length&&(h[h.length]={signature:t[s],hadProvisionalErrors:o}),o=!1}return h},t.prototype.canContextuallyTypeFunction=function(n,t,i){var u,e,r,f;if(t.isParenthesized||t.isMethod()||i&&t.returnTypeAnnotation||t.isInlineCallLiteral)return!1;if(i=i||this.typeFlow.functionInterfaceType==n,!i)return!0;for(t.signature||(this.createFunctionSignature(t,this.typeFlow.scope.container,this.typeFlow.scope,null,null),this.typeFlow.typeCheck(t)),u=t.signature,e=u.parameters.length,r=0;r<e;r++){var o=u.parameters[r],s=o,h=s.declAST;if(i&&h.typeExpr)return!1}return n.construct&&n.call?!1:(f=n.construct?n.construct:n.call,!f||f.signatures.length>1)?!1:!0},t.prototype.canContextuallyTypeObjectLiteral=function(t,i){var f,s,o,r,l,a;if(t==this.typeFlow.objectInterfaceType)return!0;if(f=i.operand,!(f&&t.memberScope))return!1;var u=null,h=null,e="",c={};for(r=0;r<f.members.length;r++){if(u=f.members[r].operand1,u.nodeType==n.NodeType.Name)e=u.text;else if(u.nodeType==n.NodeType.QString)s=u.text,e=s.substring(1,s.length-1);else return!1;if(h=t.memberScope.find(e,!0,!1),!h)return!1;c[e]=!0}for(o=t.memberScope.getAllValueSymbolNames(!0),r=0;r<o.length;r++)if(l=o[r],a=t.memberScope.find(l,!0,!1),!c[o[r]]&&!n.hasFlag(a.flags,n.SymbolFlags.Optional))return!1;return!0},t.prototype.widenType=function(n){return n==this.undefinedType||n==this.nullType?this.anyType:n},t.prototype.isNullOrUndefinedType=function(n){return n==this.undefinedType||n==this.nullType},t.prototype.findBestCommonType=function(n,t,i,r){var f=0,s=i.getLength(),o=0,u=n,e;for(t&&(u=u?u.mergeOrdered(t,this):t),e=u;o<s;){for(f=0;f<s;f++)if(f!=o)if(e&&(u=e.mergeOrdered(i.getTypeAtIndex(f),this,r))&&(e=u),u==this.anyType||u==null)break;else t&&i.setTypeAtIndex(f,t);if(e&&u)break;o++,o<s&&(e=i.getTypeAtIndex(o))}return u},t.prototype.typesAreIdentical=function(t,i){var r,h,f,e,u;if(t==i)return!0;if(!t||!i)return!1;if(r=i.typeID<<16|t.typeID,this.identicalCache[r])return!0;if(t.typeFlags&n.TypeFlags.IsEnum||i.typeFlags&n.TypeFlags.IsEnum)return!1;if(t.isArray()||i.isArray())return t.isArray()&&i.isArray()?(this.identicalCache[r]=!1,h=this.typesAreIdentical(t.elementType,i.elementType),this.subtypeCache[r]=h?!0:undefined,h):!1;if(t.primitiveTypeClass!=i.primitiveTypeClass)return!1;if(this.identicalCache[r]=!1,t.memberScope&&i.memberScope){if(f=t.memberScope.getAllValueSymbolNames(!0).sort(),e=i.memberScope.getAllValueSymbolNames(!0).sort(),f.length!=e.length)return this.identicalCache[r]=undefined,!1;var c=null,l=null,o=null,s=null;for(u=0;u<f.length;u++){if(f[u]!=e[u]||(c=t.memberScope.find(f[u],!1,!1),l=i.memberScope.find(e[u],!1,!1),(c.flags&n.SymbolFlags.Optional)!=(l.flags&n.SymbolFlags.Optional)))return this.identicalCache[r]=undefined,!1;if((o=c.getType(),s=l.getType(),!o||!s||this.identicalCache[s.typeID<<16|o.typeID]==undefined)&&!this.typesAreIdentical(o,s))return this.identicalCache[r]=undefined,!1}}else if(t.memberScope||i.memberScope)return this.identicalCache[r]=undefined,!1;return this.signatureGroupsAreIdentical(t.call,i.call)?this.signatureGroupsAreIdentical(t.construct,i.construct)?this.signatureGroupsAreIdentical(t.index,i.index)?(this.identicalCache[r]=!0,!0):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1)},t.prototype.signatureGroupsAreIdentical=function(n,t){var i,r;if(n==t)return!0;if(!n||!t||n.signatures.length!=t.signatures.length)return!1;var f=null,e=null,u=!1;for(i=0;i<n.signatures.length;i++){for(f=n.signatures[i],r=0;r<t.signatures.length;r++)if(e=t.signatures[r],this.signaturesAreIdentical(f,e)){u=!0;break}if(u){u=!1;continue}return!1}return!0},t.prototype.signaturesAreIdentical=function(n,t){if(n.hasVariableArgList!=t.hasVariableArgList||n.nonOptionalParameterCount!=t.nonOptionalParameterCount||n.parameters.length!=t.parameters.length||!this.typesAreIdentical(n.returnType.type,t.returnType.type))return!1;for(var i=0;i<n.parameters.length;i++)if(!this.typesAreIdentical(n.parameters[i].parameter.typeLink.type,t.parameters[i].parameter.typeLink.type))return!1;return!0},t.prototype.sourceIsSubtypeOfTarget=function(n,t,i){return this.sourceIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.signatureGroupIsSubtypeOfTarget=function(n,t,i){return this.signatureGroupIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.signatureIsSubtypeOfTarget=function(n,t,i){return this.signatureIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.sourceIsAssignableToTarget=function(n,t,i){return this.sourceIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.signatureGroupIsAssignableToTarget=function(n,t,i){return this.signatureGroupIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.signatureIsAssignableToTarget=function(n,t,i){return this.signatureIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.sourceIsRelatableToTarget=function(t,i,r,u,f){var e,w,h,y,p,b,k;if(t==i||!(t&&i)||(e=t.typeID<<16|i.typeID,u[e]))return!0;if(r){if(t==this.anyType||i==this.anyType)return!0}else if(i==this.anyType)return!0;if(t==this.undefinedType||t==this.nullType&&i!=this.undefinedType&&i!=this.voidType||i==this.numberType&&t.typeFlags&n.TypeFlags.IsEnum||t==this.numberType&&i.typeFlags&n.TypeFlags.IsEnum)return!0;if(t.typeFlags&n.TypeFlags.IsEnum||i.typeFlags&n.TypeFlags.IsEnum)return!1;if(t.isArray()||i.isArray())return t.isArray()&&i.isArray()?(u[e]=!1,w=this.sourceIsRelatableToTarget(t.elementType,i.elementType,r,u,f),u[e]=w?!0:undefined,w):!1;if(t.primitiveTypeClass!=i.primitiveTypeClass)if(i.primitiveTypeClass==n.Primitive.None)if(t==this.numberType&&this.typeFlow.numberInterfaceType)t=this.typeFlow.numberInterfaceType;else if(t==this.stringType&&this.typeFlow.stringInterfaceType)t=this.typeFlow.stringInterfaceType;else if(t==this.booleanType&&this.typeFlow.booleanInterfaceType)t=this.typeFlow.booleanInterfaceType;else return!1;else return!1;if(u[e]=!1,t.hasBase(i))return u[e]=!0,!0;if(this.typeFlow.objectInterfaceType&&i==this.typeFlow.objectInterfaceType||this.typeFlow.functionInterfaceType&&(t.call||t.construct)&&i==this.typeFlow.functionInterfaceType)return!0;if(i.isClass()||i.isClassInstance())return u[e]=undefined,!1;if(i.memberScope&&t.memberScope){var c=i.memberScope.getAllValueSymbolNames(!0),o=null,s=null,l=null,a=null,v=null;for(h=0;h<c.length;h++)if(o=i.memberScope.find(c[h],!1,!1),s=t.memberScope.find(c[h],!1,!1),o.kind()!=n.SymbolKind.Variable||!o.variable.typeLink.ast||o.variable.typeLink.ast.nodeType!=n.NodeType.Name||o.variable.typeLink.ast.text!="IArguments"){if(o.isInferenceSymbol()&&(v=o,v.typeCheckStatus==n.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(o.declAST)),l=o.getType(),!s&&(this.typeFlow.objectInterfaceType&&(s=this.typeFlow.objectInterfaceType.memberScope.find(c[h],!1,!1)),!s&&(this.typeFlow.functionInterfaceType&&(l.call||l.construct)&&(s=this.typeFlow.functionInterfaceType.memberScope.find(c[h],!1,!1)),!s)))if(o.flags&n.SymbolFlags.Optional)continue;else return u[e]=undefined,f&&(f.flags|=n.TypeRelationshipFlags.RequiredPropertyIsMissing,f.addMessageToFront("Type '"+t.getTypeName()+"' is missing property '"+c[h]+"' from type '"+i.getTypeName()+"'")),!1;if((s.isInferenceSymbol()&&(v=s,v.typeCheckStatus==n.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(s.declAST)),a=s.getType(),!l||!a||u[a.typeID<<16|l.typeID]==undefined)&&!this.sourceIsRelatableToTarget(a,l,r,u,f))return u[e]=undefined,f&&(f.flags|=n.TypeRelationshipFlags.IncompatiblePropertyTypes,f.addMessageToFront("Types of property '"+o.name+"' of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible")),!1}}return(t.call||i.call)&&!this.signatureGroupIsRelatableToTarget(t.call,i.call,r,u,f)?(f&&(t.call&&i.call?f.addMessageToFront("Call signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"):(y=i.call?i.getTypeName():t.getTypeName(),p=i.call?t.getTypeName():i.getTypeName(),f.setMessage("Type '"+y+"' requires a call signature, but Type '"+p+"' lacks one")),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):(t.construct||i.construct)&&!this.signatureGroupIsRelatableToTarget(t.construct,i.construct,r,u,f)?(f&&(t.construct&&i.construct?f.addMessageToFront("Construct signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"):(y=i.construct?i.getTypeName():t.getTypeName(),p=i.construct?t.getTypeName():i.getTypeName(),f.setMessage("Type '"+y+"' requires a construct signature, but Type '"+p+"' lacks one")),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):i.index&&(b=!i.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:i.index,k=!t.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:t.index,!this.signatureGroupIsRelatableToTarget(k,b,r,u,f))?(f&&(f.addMessageToFront("Index signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):(u[e]=!0,!0)},t.prototype.signatureGroupIsRelatableToTarget=function(n,t,i,r,u){var f,e;if(n==t)return!0;if(!(n&&t))return!1;var s=null,h=null,o=!1;for(f=0;f<t.signatures.length;f++){for(s=t.signatures[f],e=0;e<n.signatures.length;e++)if(h=n.signatures[e],this.signatureIsRelatableToTarget(h,s,i,r,u)){o=!0;break}if(o){o=!1;continue}return!1}return!0},t.prototype.signatureIsRelatableToTarget=function(t,i,r,u,f){var s,l,v,a,e,o;if(!t.parameters||!i.parameters)return!1;if(s=i.hasVariableArgList?i.nonOptionalParameterCount-1:i.nonOptionalParameterCount,l=t.hasVariableArgList?t.nonOptionalParameterCount-1:t.nonOptionalParameterCount,l>s&&!i.hasVariableArgList)return f&&(f.flags|=n.TypeRelationshipFlags.SourceSignatureHasTooManyParameters,f.addMessageToFront("Call signature expects "+s+" or fewer parameters")),!1;if(v=t.returnType.type,a=i.returnType.type,a!=this.voidType&&!this.sourceIsRelatableToTarget(v,a,r,u,f))return f&&(f.flags|=n.TypeRelationshipFlags.IncompatibleReturnTypes),!1;var w=l<s&&t.hasVariableArgList?s:l,h=null,c=null,y="",p="";for(e=0,o=0;e<w;e++,o++)if(!t.hasVariableArgList||e<l?(h=t.parameters[e].parameter.typeLink.type,y=t.parameters[e].parameter.symbol.name):e==l&&(h=t.parameters[e].parameter.typeLink.type,h.elementType&&(h=h.elementType),y=t.parameters[e].parameter.symbol.name),o<i.parameters.length&&o<s?(c=i.parameters[o].parameter.typeLink.type,p=i.parameters[o].parameter.symbol.name):i.hasVariableArgList&&o==s&&(c=i.parameters[o].parameter.typeLink.type,c.elementType&&(c=c.elementType),p=i.parameters[o].parameter.symbol.name),!(this.sourceIsRelatableToTarget(h,c,r,u,f)||this.sourceIsRelatableToTarget(c,h,r,u,f)))return f&&(f.flags|=n.TypeRelationshipFlags.IncompatibleParameterTypes),!1;return!0},t}(),n.TypeChecker=o}(TypeScript||(TypeScript={})),function(n){function a(t,i){var e,u,o,r,f;if(t)for(e=t.members.length,i==null&&(i=[]),u=0;u<e;u++)o=t.members[u],r=o,r.nodeType==n.NodeType.Call&&(r=r.target),f=new n.TypeLink,f.ast=r,i[i.length]=f;return i}function r(n,t){n.extendsTypeLinks=a(t.extendsList,n.extendsTypeLinks),n.implementsTypeLinks=a(t.implementsList,n.implementsTypeLinks)}function v(t,i,r){var u=new n.ValueLocation,f;u.typeLink=new n.TypeLink,u.typeLink.ast=i,u.typeLink.type=t.instanceType,f=new n.FieldSymbol("prototype",i.minChar,r.checker.locationInfo.unitIndex,!0,u),f.flags|=n.SymbolFlags.Property|n.SymbolFlags.BuiltIn,u.symbol=f,f.declAST=i,t.members.addPublicMember("prototype",f)}function t(t){var i=new n.Signature;i.returnType=new n.TypeLink,i.returnType.type=t.instanceType,i.parameters=[],t.construct=new n.SignatureGroup,t.construct.addSignature(i)}function p(i,r){var u,f;for(i.construct=new n.SignatureGroup,u=null,r.construct||t(r),f=0;f<r.construct.signatures.length;f++)u=new n.Signature,u.parameters=r.construct.signatures[f].parameters,u.nonOptionalParameterCount=r.construct.signatures[f].nonOptionalParameterCount,u.typeCheckStatus=r.construct.signatures[f].typeCheckStatus,u.declAST=r.construct.signatures[f].declAST,u.returnType=new n.TypeLink,u.returnType.type=i.instanceType,i.construct.addSignature(u)}function u(n,t){var i=t.scope.find(n,!1,!0);return i==null&&t.previous&&(i=u(n,t.previous)),i}function i(t,r){var f=null,o,s,h,c;switch(t.nodeType){case n.NodeType.Name:var e=t.text,a=n.isQuoted(e),l=function(){return r.members?r.members.lookup(e):u(e,r.topLevelScope)};f=a?r.tcContext.checker.findSymbolForDynamicModule(e,r.tcContext.script.locationInfo.filename,l):l(e);break;case n.NodeType.Dot:o=t,s=i(o.operand1,r),s&&s.getType()&&(f=i(o.operand2,r))}return f&&(h=f.getType(),h?(c=h.members,c&&(r.members=c.publicMembers)):r.tcContext.checker.errorReporter.simpleError(t,"Potentially circular alias reference - could not obtain type of alias")),f}function f(t,r,u){var o=u.scopeChain,f=null,h=null,e=t,c=n.hasFlag(e.varFlags,n.VarFlags.Exported),l=i(e.alias,{topLevelScope:o,members:null,tcContext:u}),a=u.scopeChain.container==u.checker.gloMod,s;return l&&(s=l.getType(),s&&(h=s)),f=new n.TypeSymbol(e.id.text,e.minChar,u.checker.locationInfo.unitIndex,h),f.aliasLink=e,u.scopeChain.moduleDecl&&(f.declModule=u.scopeChain.moduleDecl),f.declAST=e,e.id.sym=f,o.scope.enter(o.container,t,f,u.checker.errorReporter,c||a,!0,!1),o.scope.enter(o.container,t,f,u.checker.errorReporter,c||a,!1,!1),!0}function e(t,i,r){var s=r.scopeChain,e=t,b=n.hasFlag(e.modFlags,n.ModuleFlags.Ambient),d=n.hasFlag(e.modFlags,n.ModuleFlags.IsEnum),k=r.scopeChain.container==r.checker.gloMod,l=n.hasFlag(e.modFlags,n.ModuleFlags.Exported),h=e.name.text,ft=n.isQuoted(h),o=s.scope.findLocal(h,!1,!1),f=null,u=null,a,c;if(o==null||o.kind()!=n.SymbolKind.Type)u==null&&(a=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),c=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u=new n.ModuleType(a,c),d&&(u.typeFlags|=n.TypeFlags.IsEnum),u.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u.setHasImplementation()),f=new n.TypeSymbol(h,e.minChar,r.checker.locationInfo.unitIndex,u),r.scopeChain.moduleDecl&&(f.declModule=r.scopeChain.moduleDecl),f.declAST=e,f.prettyName=e.prettyName,s.scope.enter(s.container,t,f,r.checker.errorReporter,l||k,!0,b),s.scope.enter(s.container,t,f,r.checker.errorReporter,l||k,!1,b),u.symbol=f;else{o&&o.declAST&&o.declAST.nodeType!=n.NodeType.Module&&r.checker.errorReporter.simpleError(e,"Conflicting symbol name for module '"+h+"'"),f=o;var w=f.type.getAllEnclosedTypes().publicMembers,g=w==null?new n.StringHashTable:w,a=new n.ScopedMembers(new n.DualStringHashTable(g,new n.StringHashTable)),p=f.type.getAllAmbientEnclosedTypes().publicMembers,nt=p==null?new n.StringHashTable:p,c=new n.ScopedMembers(new n.DualStringHashTable(nt,new n.StringHashTable)),y=f.type.members.publicMembers,tt=y==null?new n.StringHashTable:y,it=new n.ScopedMembers(new n.DualStringHashTable(tt,new n.StringHashTable)),v=f.type.ambientMembers.publicMembers,rt=v==null?new n.StringHashTable:v,ut=new n.ScopedMembers(new n.DualStringHashTable(rt,new n.StringHashTable));u=new n.ModuleType(a,c),d&&(u.typeFlags|=n.TypeFlags.IsEnum),u.members=it,u.ambientMembers=ut,u.setHasImplementation(),u.symbol=f,f.addLocation(e.minChar),f.expansions.push(u)}return r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface(),l&&(f.flags|=n.SymbolFlags.Exported),(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)&&(f.flags|=n.SymbolFlags.ModuleMember),e.mod=u,n.pushTypeCollectionScope(f,u.members,u.ambientMembers,u.enclosedTypes,u.ambientEnclosedTypes,r,null,null,e),!0}function o(i,u,f){var p=f.scopeChain,h=i,o,s,e=null,y=h.name.text,g=!1,a=n.hasFlag(h.varFlags,n.VarFlags.Ambient),l=n.hasFlag(h.varFlags,n.VarFlags.Exported),w=f.scopeChain.container==f.checker.gloMod,d=p.container,b=!1,c,k;return e=p.scope.findLocal(y,!1,!0),e||(c=p.scope.findLocal(y,!1,!1),c&&c.isType()&&c.declAST&&c.declAST.nodeType==n.NodeType.FuncDecl&&c.declAST.isSignature()&&(e=c,b=!0,l&&(e.flags|=n.SymbolFlags.Exported),a&&(e.flags|=n.SymbolFlags.Ambient),f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,l||w,!0,a))),!e||b||e.declAST==h||e.declAST.isOverload||(e=null),e==null?(k=p.scope.findLocal(y,!1,!1),o=new n.Type,o.setHasImplementation(),s=new n.Type,s.setHasImplementation(),o.instanceType=s,o.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),v(o,h,f),s.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),s.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),e=new n.TypeSymbol(y,h.minChar,f.checker.locationInfo.unitIndex,o),e.declAST=h,e.instanceType=s,o.symbol=e,s.symbol=e,f.scopeChain.moduleDecl&&(f.scopeChain.moduleDecl.recordNonInterface(),e.declModule=f.scopeChain.moduleDecl,e.flags|=n.SymbolFlags.ModuleMember),l&&(e.flags|=n.SymbolFlags.Exported),a&&(e.flags|=n.SymbolFlags.Ambient),i.type=o,f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,l||w,!0,a),k==null&&f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,l||w,!1,a)):(o=e.type,o.instanceType==null&&(o.instanceType=new n.Type,o.instanceType.setHasImplementation(),o.instanceType.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.instanceType.symbol=o.symbol,o.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable))),s=o.instanceType,i.type=o),h.constructorDecl||(e&&e.declAST&&e.declAST.type&&e.declAST.type.call&&!e.declAST.isOverload&&f.checker.errorReporter.duplicateIdentifier(e.declAST,e.name),t(h.type)),o.typeFlags|=n.TypeFlags.IsClass,s.typeFlags|=n.TypeFlags.IsClass,r(s,h),n.pushTypeCollectionScope(e,s.members,s.ambientMembers,null,null,f,s,o,null),!0}function s(t,i,u){var l=u.scopeChain,o=t,e=null,f=null,c=n.hasFlag(o.varFlags,n.VarFlags.Exported),a=u.scopeChain.container==u.checker.gloMod,s=!0,h;return s=!1,h=o.name.text,e=l.scope.findLocal(h,!1,!0),e==null?(f=new n.Type,e=new n.TypeSymbol(h,t.minChar,u.checker.locationInfo.unitIndex,f),f.symbol=e,f.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),e.declAST=o,e.declModule=u.scopeChain.moduleDecl):(s=!0,f=e.type),f||(f=u.checker.anyType),t.type=f,r(f,o),c&&(e.flags|=n.SymbolFlags.Exported),u.scopeChain.moduleDecl&&(e.flags|=n.SymbolFlags.ModuleMember),s||u.scopeChain.scope.enter(u.scopeChain.container,t,e,u.checker.errorReporter,a||c,!0,!1),n.pushTypeCollectionScope(e,f.members,f.ambientMembers,null,null,u,f,null,null),!0}function h(t,i,r){var s=r.scopeChain,u=t;if(n.hasFlag(u.varFlags,n.VarFlags.Public|n.VarFlags.Private)){var e=new n.ValueLocation,o=n.hasFlag(u.varFlags,n.VarFlags.Private),f=new n.FieldSymbol(u.id.text,u.minChar,r.checker.locationInfo.unitIndex,!n.hasFlag(u.varFlags,n.VarFlags.Readonly),e);f.transferVarFlags(u.varFlags),e.symbol=f,f.declAST=t,u.parameterPropertySym=f,r.scopeChain.scope.enter(r.scopeChain.container,t,f,r.checker.errorReporter,!o,!1,!1),e.typeLink=n.getTypeLink(u.typeExpr,r.checker,u.init==null),u.sym=f}return!1}function c(t,i,r){var a=r.scopeChain,u=t,s=n.hasFlag(u.varFlags,n.VarFlags.Ambient),h=n.hasFlag(u.varFlags,n.VarFlags.Exported),v=r.scopeChain.container==r.checker.gloMod,c=n.hasFlag(u.varFlags,n.VarFlags.Property),l=n.hasFlag(u.varFlags,n.VarFlags.Static),y=n.hasFlag(u.varFlags,n.VarFlags.Private),p=n.hasFlag(u.id.flags,n.ASTFlags.OptionalName),o,e,f;if(r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface(),c||h||r.scopeChain.container==r.checker.gloMod||r.scopeChain.moduleDecl){if(s&&(o=a.scope.findLocal(u.id.text,!1,!1),o))return u.sym=o,!1;if(u.id==null)return r.checker.errorReporter.simpleError(u,"Expected variable identifier at this location"),!1;e=new n.ValueLocation,f=new n.FieldSymbol(u.id.text,u.minChar,r.checker.locationInfo.unitIndex,(u.varFlags&n.VarFlags.Readonly)==n.VarFlags.None,e),f.transferVarFlags(u.varFlags),p&&(f.flags|=n.SymbolFlags.Optional),e.symbol=f,f.declAST=t,(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)&&(f.flags|=n.SymbolFlags.ModuleMember,f.declModule=r.scopeChain.moduleDecl),n.hasFlag(u.varFlags,n.VarFlags.Property)&&l&&r.scopeChain.classType?(r.scopeChain.classType.members.publicMembers.add(u.id.text,f)||r.checker.errorReporter.duplicateIdentifier(t,f.name),f.container=r.scopeChain.classType.symbol):r.scopeChain.scope.enter(r.scopeChain.container,t,f,r.checker.errorReporter,!y&&(c||h||v||l),!1,s),n.hasFlag(u.varFlags,n.VarFlags.Exported)&&(f.flags|=n.SymbolFlags.Exported),e.typeLink=n.getTypeLink(u.typeExpr,r.checker,u.init==null),u.sym=f}return!1}function l(t,i,r){var b=r.scopeChain,a,p;r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface();var f=t,u=null,o=f.getNameText(),w=n.hasFlag(f.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported),c=n.hasFlag(f.fncFlags,n.FncFlags.Static),d=n.hasFlag(f.fncFlags,n.FncFlags.Private),v=f.isConstructMember()||f.isConstructor,e=(f.isMethod()&&c||f.isAccessor())&&r.scopeChain.classType?r.scopeChain.classType.symbol:r.scopeChain.container,s=r.scopeChain.scope,k=e==r.checker.gloMod,y=f.name&&n.hasFlag(f.name.flags,n.ASTFlags.OptionalName),l=!1,h=!1;return(v&&n.hasFlag(f.fncFlags,n.FncFlags.ClassMethod)&&(e=e.container,s=b.previous.scope),f.unitIndex=r.checker.locationInfo.unitIndex,!f.isConstructor&&e&&e.declAST&&e.declAST.nodeType==n.NodeType.FuncDecl&&e.declAST.isConstructor&&!f.isMethod())?l:(n.hasFlag(f.fncFlags,n.FncFlags.Signature)?(a=r.scopeChain.thisType,o&&o!="__missing"&&(c?u=e.type.members.allMembers.lookup(o):(u=s.findLocal(o,!1,!1),u==null&&(u=s.findLocal(o,!1,!0))),u&&(h=!0,f.isSignature()||n.hasFlag(f.fncFlags,n.FncFlags.Ambient)==n.hasFlag(u.flags,n.SymbolFlags.Ambient)||(u=null))),u==null?(u=f.isSpecialFn()?r.checker.createFunctionSignature(f,e,s,e,!1).declAST.type.symbol:r.checker.createFunctionSignature(f,e,s,null,!h).declAST.type.symbol,u.declAST!=null&&f.isSpecialFn()||(u.declAST=t)):u.kind()==n.SymbolKind.Type?u=r.checker.createFunctionSignature(f,e,s,u,!1).declAST.type.symbol:r.checker.errorReporter.simpleError(f,"Function or method '"+f.name.text+"' already declared as a property"),f.type=f.isSpecialFn()&&!c?a?a:u.type:u.type):(o&&(c?u=e.type.members.allMembers.lookup(o):(f.isConstructor&&r.scopeChain.previous&&(u=r.scopeChain.previous.scope.findLocal(o,!1,!1)),u==null&&(u=s.findLocal(o,!1,!1))),u&&(h=!0,v||u.declAST.nodeType!=n.NodeType.FuncDecl||u.declAST.isAccessor()||u.declAST.isSignature()||(u=null,h=!1))),u&&!u.isAccessor()&&u.type&&u.type.construct&&u.type.construct.signatures!=[]&&(u.type.construct.signatures[0].declAST==null||!n.hasFlag(u.type.construct.signatures[0].declAST.fncFlags,n.FncFlags.Ambient))&&!f.isConstructor&&r.checker.errorReporter.simpleError(f,"Functions may not have class overloads"),!u||u.kind()==n.SymbolKind.Type||!f.isMethod()||f.isAccessor()||f.isConstructor||(r.checker.errorReporter.simpleError(f,"Function or method '"+f.name.text+"' already declared as a property"),u.type=r.checker.anyType),p=r.checker.createFunctionSignature(f,e,s,u,!h),((!u||u.declAST.nodeType!=n.NodeType.FuncDecl)&&f.isAccessor()||u&&u.isAccessor())&&(f.accessorSymbol=r.checker.createAccessorSymbol(f,u,e.type,f.isMethod()&&c,!0,s,e)),f.type.symbol.declAST=t,f.isConstructor&&(l=!0)),w&&(f.type.call&&(f.type.symbol.flags|=n.SymbolFlags.Exported),u&&!u.isAccessor()&&u.type.call&&(u.flags|=n.SymbolFlags.Exported)),r.scopeChain.moduleDecl&&!f.isSpecialFn()&&(f.type.symbol.flags|=n.SymbolFlags.ModuleMember,f.type.symbol.declModule=r.scopeChain.moduleDecl),u&&y&&(u.flags|=n.SymbolFlags.Optional),l)}function w(t,i,r){var a=r.state,u=!1,y=a.scopeChain,v;return t.nodeType==n.NodeType.Script?(v=t,a.script=v,u=!0):t.nodeType==n.NodeType.List?u=!0:t.nodeType==n.NodeType.Import?u=f(t,i,a):t.nodeType==n.NodeType.With?u=!1:t.nodeType==n.NodeType.Module?u=e(t,i,a):t.nodeType==n.NodeType.Class?u=o(t,i,a):t.nodeType==n.NodeType.Block?u=!0:t.nodeType==n.NodeType.Interface?u=s(t,i,a):t.nodeType==n.NodeType.ArgDecl?u=h(t,i,a):t.nodeType==n.NodeType.VarDecl?u=c(t,i,a):t.nodeType==n.NodeType.FuncDecl?u=l(t,i,a):t.isStatementOrExpression()&&a.scopeChain.moduleDecl&&a.scopeChain.moduleDecl.recordNonInterface(),r.options.goChildren=u,t}function b(t,i,r){var u=r.state;return t.nodeType==n.NodeType.Module?n.popTypeCollectionScope(u):t.nodeType==n.NodeType.Class?n.popTypeCollectionScope(u):t.nodeType==n.NodeType.Interface&&n.popTypeCollectionScope(u),t}var y=function(){function n(n){this.normalBlock=n,this.exceptionBlock=-1}return n}();n.Continuation=y,n.createNewConstructGroupForType=t,n.cloneParentConstructGroupForChildType=p,n.globalId="__GLO",n.preCollectImportTypes=f,n.preCollectModuleTypes=e,n.preCollectClassTypes=o,n.preCollectInterfaceTypes=s,n.preCollectArgDeclTypes=h,n.preCollectVarDeclTypes=c,n.preCollectFuncDeclTypes=l,n.preCollectTypes=w,n.postCollectTypes=b}(TypeScript||(TypeScript={})),function(n){var f=function(){function n(n,t,i){this.container=n,this.previous=t,this.scope=i}return n}(),i,r,t,e,o,u,s;n.ScopeChain=f,i=function(){function i(n){this.bb=n,this.defsBySymbol=[],this.useIndexBySymbol=[]}return i.prototype.updateTop=function(){for(var n=new t(this.top.bitCount),r,f,i=0,u=this.bb.successors.length;i<u;i++)r=this.bb.successors[i],r.useDef&&n.union(r.useDef.top);return n.difference(this.kill),n.union(this.gen),f=n.notEq(this.top),this.top=n,f},i.prototype.initialize=function(t){function e(t,i,u){var h=u.state,o,c,e,s;if(t==null&&(t=null),t.nodeType==n.NodeType.VarDecl)o=t,(o.init||n.hasFlag(o.varFlags,n.VarFlags.AutoInit))&&r(o.sym,h);else if(t.nodeType==n.NodeType.Name){if(i)if(i.nodeType==n.NodeType.Asg){if(e=i,e.operand1==t)return t}else if(i.nodeType==n.NodeType.VarDecl&&(c=i,c.id==t))return t;s=t,f(s.sym,h,t)}else t.nodeType>=n.NodeType.Asg&&t.nodeType<=n.NodeType.LastAsg?(e=t,e.operand1&&e.operand1.nodeType==n.NodeType.Name&&(s=e.operand1,r(s.sym,h))):t.nodeType==n.NodeType.FuncDecl&&(u.options.goChildren=!1);return t}var i=this,r=function(n,t){if(t.isLocalSym(n)){var r=t.getSymbolIndex(n);i.useIndexBySymbol[r]=[],i.defsBySymbol[r]=!0}},f=function(n,t,r){var u,e,f;t.isLocalSym(n)&&(u=t.getSymbolIndex(n),i.useIndexBySymbol[u]==undefined&&(i.useIndexBySymbol[u]=[]),e=i.useIndexBySymbol[u],f=t.getUseIndex(r),t.addUse(u,f),e.push(f))},u=new n.AstWalkOptions;u.reverseSiblings=!0,n.getAstWalkerFactory().walk(this.bb.content,e,null,u,t)},i.prototype.initializeGen=function(n){var e=this.useIndexBySymbol.length,o=n.uses.length,r,i,u,f;for(this.gen=new t(o),r=0;r<e;r++)if(i=this.useIndexBySymbol[r],i!=undefined&&i.length>0)for(u=0,f=i.length;u<f;u++)this.gen.set(i[u],!0);this.top=this.gen},i.prototype.initializeKill=function(n){var i,f,r,u,e;for(this.kill=new t(this.gen.bitCount),i=0,f=this.defsBySymbol.length;i<f;i++)if(this.defsBySymbol[i]&&(r=n.useIndexBySymbol[i],r))for(u=0,e=r.length;u<e;u++)this.kill.set(r[u],!0)},i}(),n.BBUseDefInfo=i,r=function(){function t(){this.useIndexBySymbol=[],this.uses=[],this.symbols=[],this.symbolMap=new n.StringHashTable,this.symbolCount=0}return t.prototype.getSymbolIndex=function(n){var i=n.name,t=this.symbolMap.lookup(i);return t==null&&(t=this.symbolCount++,this.symbols[t]=n,this.symbolMap.add(i,t)),t},t.prototype.addUse=function(n,t){var i=this.useIndexBySymbol[n];i==undefined&&(i=[],this.useIndexBySymbol[n]=i),i[i.length]=t},t.prototype.getUseIndex=function(n){return this.uses[this.uses.length]=n,this.uses.length-1},t.prototype.isLocalSym=function(t){return t&&t.container==this.func&&t.kind()==n.SymbolKind.Variable},t.prototype.killSymbol=function(n,t){for(var f=this.symbolMap.lookup(n.name),r=this.useIndexBySymbol[f],i=0,u=r.length;i<u;i++)t.set(r[i],!0)},t}(),n.UseDefContext=r,t=function(){function n(t){var r,i;if(this.bitCount=t,this.firstBits=0,this.restOfBits=null,this.bitCount>n.packBits)for(this.restOfBits=[],r=Math.floor(this.bitCount/n.packBits),i=0;i<r;i++)this.restOfBits[i]=0}return n.packBits=30,n.prototype.set=function(t,i){if(t<n.packBits)i?this.firstBits|=1<<t:this.firstBits&=~(1<<t);else{var r=Math.floor(t/n.packBits)-1,u=t%n.packBits;i?this.restOfBits[r]|=1<<u:this.restOfBits[r]&=~(1<<u)}},n.prototype.map=function(t){for(var f,r,e,u,i=0;i<n.packBits;i++){if(i==this.bitCount)return;(1<<i&this.firstBits)!=0&&t(i)}if(this.restOfBits)for(r=n.packBits,i=0,f=this.restOfBits.length;i<f;i++)for(e=this.restOfBits[i],u=0;u<n.packBits;u++)if((1<<u&e)!=0&&t(r),r++,r==this.bitCount)return},n.prototype.union=function(n){var t,i,r,u;if(this.firstBits|=n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)r=this.restOfBits[t],u=n.restOfBits[t],this.restOfBits[t]=r|u},n.prototype.intersection=function(n){var t,i,r,u;if(this.firstBits&=n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)r=this.restOfBits[t],u=n.restOfBits[t],this.restOfBits[t]=r&u},n.prototype.notEq=function(n){var t,i,r,u;if(this.firstBits!=n.firstBits)return!0;if(this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)if(r=this.restOfBits[t],u=n.restOfBits[t],r!=u)return!0;return!1},n.prototype.difference=function(n){var f=this.firstBits,t,i,u,r;if(this.firstBits&=~n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)u=this.restOfBits[t],r=n.restOfBits[t],this.restOfBits[t]&=~r},n}(),n.BitVector=t,e=function(){function t(){this.predecessors=[],this.index=-1,this.markValue=0,this.successors=[],this.useDef=null,this.content=new n.ASTList}return t.prototype.marked=function(n){return this.markValue>n},t.prototype.mark=function(){this.markValue++},t.prototype.addSuccessor=function(n){this.successors[this.successors.length]=n,n.predecessors[n.predecessors.length]=this},t}(),n.BasicBlock=e,o=function(){function t(n,t){this.current=n,this.exit=t,this.entry=null,this.unreachable=null,this.noContinuation=!1,this.statementStack=[],this.currentSwitch=[],this.markBase=0,this.linearBBs=[],this.entry=this.current}return t.prototype.walk=function(n,t){return this.walker.walk(n,t)},t.prototype.pushSwitch=function(n){this.currentSwitch.push(n)},t.prototype.popSwitch=function(){return this.currentSwitch.pop()},t.prototype.reportUnreachable=function(t){var u,i,r;if(this.unreachable&&this.unreachable.length>0)for(u=this.unreachable.length,i=0;i<u;i++)r=this.unreachable[i],r.nodeType!=n.NodeType.EndCode&&t.simpleError(r,"unreachable code")},t.prototype.printAST=function(t,i){var r=new n.PrintContext(i,null);r.increaseIndent(),n.getAstWalkerFactory().walk(t,n.prePrintAST,n.postPrintAST,null,r),r.decreaseIndent()},t.prototype.printBlockContent=function(n,t){for(var r=n.content,f,i=0,u=r.members.length;i<u;i++)f=r.members[i],this.printAST(f,t)},t.prototype.bfs=function(n,t,i,r){var h=this.markBase++,f=[],u,s,e,o;for(f[f.length]=this.entry;f.length>0;)if(u=f.pop(),!u.marked(h)&&(u.mark(),n&&n(u),s=u.successors.length,s>0)){for(i&&i(),e=s-1;e>=0;e--)o=u.successors[e],o.marked(this.markBase)||(t&&t(u,o),f[f.length]=o);r&&r()}},t.prototype.useDef=function(n,t){var s=this,f=new r,h,u,o,e,c;for(f.func=t,h=function(n){n.useDef=new i(n),n.useDef.initialize(f),s.linearBBs[s.linearBBs.length]=n},this.bfs(h,null,null,null),u=0,o=this.linearBBs.length;u<o;u++)this.linearBBs[u].useDef.initializeGen(f),this.linearBBs[u].useDef.initializeKill(f);for(e=!0;e;)for(e=!1,u=0;u<o;u++)e=this.linearBBs[u].useDef.updateTop()||e;c=this.entry.useDef.top,c.map(function(t){var i=f.uses[t];n.simpleError(i,"use of variable '"+i.text+"' that is not definitely assigned")})},t.prototype.print=function(n){function e(){n.Write("  Branches to ")}function o(){n.WriteLine("")}function s(t,i){i.index<0&&(i.index=r++),n.Write(i.index+" ")}var i=this,r=0,f=function(t){t.index<0&&(t.index=r++),t==i.exit?n.WriteLine("Exit block with index "+t.index):(n.WriteLine("Basic block with index "+t.index),i.printBlockContent(t,n))},t,u;if(this.bfs(f,s,e,o),this.unreachable!=null)for(t=0,u=this.unreachable.length;t<u;t++)n.WriteLine("Unreachable basic block ..."),this.printAST(this.unreachable[t],n)},t.prototype.pushStatement=function(n,t,i){this.statementStack.push({stmt:n,continueBB:t,breakBB:i})},t.prototype.popStatement=function(){return this.statementStack.pop()},t.prototype.returnStmt=function(){this.current.addSuccessor(this.exit),this.setUnreachable()},t.prototype.setUnreachable=function(){this.current=null,this.noContinuation=!0},t.prototype.addUnreachable=function(n){this.unreachable===null&&(this.unreachable=[]),this.unreachable[this.unreachable.length]=n},t.prototype.unconditionalBranch=function(n,t){for(var i=null,u,r=0,f=this.statementStack.length;r<f;r++)if(u=this.statementStack[r],u.stmt==n){i=t?u.continueBB:u.breakBB;break}i&&this.current.addSuccessor(i),this.setUnreachable()},t.prototype.addContent=function(n){this.current&&this.current.content.append(n)},t}(),n.ControlFlowContext=o,u=function(){function n(){this.cacheSize=16,this.rdCache=[],this.nextUp=0;for(var n=0;n<this.cacheSize;n++)this.rdCache[n]={actuals:[],exactCandidates:[],conversionCandidates:[],id:n}}return n.prototype.getResolutionData=function(){var n=null;return this.nextUp<this.cacheSize&&(n=this.rdCache[this.nextUp]),n==null&&(this.cacheSize++,n={actuals:[],exactCandidates:[],conversionCandidates:[],id:this.cacheSize},this.rdCache[this.cacheSize]=n),this.nextUp++,n},n.prototype.returnResolutionData=function(n){n.actuals.length=0,n.exactCandidates.length=0,n.conversionCandidates.length=0,this.nextUp=n.id},n}(),n.ResolutionDataCache=u,s=function(){function t(n,t,i,r){this.logger=n,this.initScope=t,this.parser=i,this.checker=r,this.thisFnc=null,this.thisClassNode=null,this.enclosingFncIsMethod=!1,this.arrayInterfaceType=null,this.stringInterfaceType=null,this.objectInterfaceType=null,this.functionInterfaceType=null,this.numberInterfaceType=null,this.booleanInterfaceType=null,this.currentScript=null,this.inNewTargetTypeCheck=!1,this.inImportTypeCheck=!1,this.inTypeRefTypeCheck=!1,this.inArrayElementTypeCheck=!1,this.resolutionDataCache=new u,this.nestingLevel=0,this.inBoundPropTypeCheck=!1,this.inSuperCall=!1,this.checker.typeFlow=this,this.scope=this.initScope,this.globalScope=this.initScope,this.doubleType=this.checker.numberType,this.booleanType=this.checker.booleanType,this.stringType=this.checker.stringType,this.anyType=this.checker.anyType,this.regexType=this.anyType,this.nullType=this.checker.nullType,this.voidType=this.checker.voidType,this.arrayAnyType=this.checker.makeArrayType(this.anyType)}return t.prototype.initLibs=function(){var o=this.globalScope.find("Array",!1,!0),t,i,r,u,f,e;o&&o.kind()==n.SymbolKind.Type&&(this.arrayInterfaceType=o.type),t=this.globalScope.find("String",!1,!0),t&&t.kind()==n.SymbolKind.Type&&(this.stringInterfaceType=t.type),i=this.globalScope.find("Object",!1,!0),i&&i.kind()==n.SymbolKind.Type&&(this.objectInterfaceType=i.type),r=this.globalScope.find("Function",!1,!0),r&&r.kind()==n.SymbolKind.Type&&(this.functionInterfaceType=r.type),u=this.globalScope.find("Number",!1,!0),u&&u.kind()==n.SymbolKind.Type&&(this.numberInterfaceType=u.type),f=this.globalScope.find("Boolean",!1,!0),f&&f.kind()==n.SymbolKind.Type&&(this.booleanInterfaceType=f.type),e=this.globalScope.find("RegExp",!1,!0),e&&e.kind()==n.SymbolKind.Type&&(this.regexType=e.type)},t.prototype.cast=function(n,t){return this.castWithCoercion(n,t,!0,!1)},t.prototype.castWithCoercion=function(t,i,r,u){var f=new n.TypeComparisonInfo;return this.checker.sourceIsAssignableToTarget(t.type,i,f)||u&&this.checker.sourceIsAssignableToTarget(i,t.type,f)?(r&&(t.type=i==null?this.anyType:i.isClass()?i.instanceType:i),t):(this.checker.errorReporter.incompatibleTypes(t,t.type,i,null,this.scope,f),t)},t.prototype.inScopeTypeCheck=function(t,i){var s=this.scope,r,f,o;this.scope=i;for(var h=this.thisFnc,c=this.thisType,l=this.thisClassNode,a=this.checker.currentModDecl,v=this.enclosingFncIsMethod,u=this.scope.container,e=null;u;){if(u.kind()==n.SymbolKind.Type){if(r=u,f=r.type,f.call&&e==null&&(this.enclosingFncIsMethod=r.isMethod,e=u.declAST),f.isClass()){this.thisType=f.instanceType,r.declAST&&r.declAST.nodeType==n.NodeType.Class&&(this.thisClassNode=r.declAST);break}if(f.isModuleType()){this.checker.currentModDecl=r.declAST;break}}u=u.container}return this.thisFnc=e,o=this.typeCheck(t),this.thisFnc=h,this.thisType=c,this.thisClassNode=l,this.checker.currentModDecl=a,this.enclosingFncIsMethod=v,this.scope=s,o},t.prototype.typeCheck=function(n){return n?n.typeCheck(this):null},t.prototype.inScopeTypeCheckDecl=function(t){if(t.nodeType==n.NodeType.VarDecl||t.nodeType==n.NodeType.ArgDecl)this.inScopeTypeCheckBoundDecl(t);else if(t.nodeType==n.NodeType.FuncDecl){var i=t;i.isAccessor()&&this.typeCheckFunction(i)}},t.prototype.inScopeTypeCheckBoundDecl=function(t){var i=t.sym,s=this.thisFnc,h=this.thisType,c=this.enclosingFncIsMethod,l=this.checker.locationInfo,f,o,r,e,u;if(i&&i.container&&(f=n.hasFlag(t.varFlags,n.VarFlags.ClassConstructorProperty)?i.container.getType().constructorScope:i.container.instanceScope(),n.hasFlag(t.varFlags,n.VarFlags.Property)&&i.container.declAST.nodeType==n.NodeType.FuncDecl&&(this.thisFnc=i.container.declAST),f)){for(o=this.scope,this.scope=f,r=i.container,this.checker.locationInfo=this.checker.units&&i.unitIndex>=0&&i.unitIndex<this.checker.units.length?this.checker.units[i.unitIndex]:n.unknownLocationInfo;r;){if(r.kind()==n.SymbolKind.Type&&(e=r,u=e.type,u.call&&(this.enclosingFncIsMethod=e.isMethod),u.isClass())){this.thisType=u.instanceType;break}r=r.container}this.typeCheckBoundDecl(t),this.scope=o}this.thisFnc=s,this.thisType=h,this.checker.locationInfo=l,this.enclosingFncIsMethod=c},t.prototype.resolveBoundDecl=function(n){if(n.typeExpr)(n.typeExpr.type==null||n.typeExpr.type&&n.typeExpr.type==this.anyType&&this.scope||n.typeExpr.type.symbol==null||!this.checker.typeStatusIsFinished(n.typeExpr.type.symbol.typeCheckStatus))&&this.typeCheck(n.typeExpr),n.type=n.typeExpr.type,n.sym&&n.sym.setType(n.type);else if(n.init==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(n,"type implicitly set to 'any'"),n.type=this.anyType,n.sym)){if(n.sym.isType()){var t=n.sym;if(t.isMethod){this.checker.errorReporter.simpleError(n,"Cannot bind method group to variable.  (Did you mean to use 'declare function' instead of 'declare var'?)");return}this.checker.errorReporter.simpleError(n,"Cannot bind type to variable");return}n.sym.setType(n.type)}},t.prototype.typeCheckBoundDecl=function(t){var i=t.sym,r,u,f;if(i==null)t.init?(t.init=this.typeCheck(t.init),t.type=this.checker.widenType(t.init.type)):(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType);else if(i.typeCheckStatus==n.TypeCheckStatus.Started)this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType,i.setType(this.anyType);else if(i.typeCheckStatus==n.TypeCheckStatus.NotStarted){if(i.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(i),r=!1,t.type==null&&t.typeExpr&&(this.resolveBoundDecl(t),r=!0,t.type=t.typeExpr.type,i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()),t.init){n.hasFlag(t.varFlags,n.VarFlags.Ambient)&&this.checker.errorReporter.simpleError(t,"Ambient variable can not have an initializer");var o=n.hasFlag(t.varFlags,n.VarFlags.LocalStatic),s=this.scope,e=!t.init.isParenthesized;o&&(this.scope=t.sym.container.getType().memberScope),t.varFlags&n.VarFlags.Property&&(this.inBoundPropTypeCheck=!0),this.checker.typeCheckWithContextualType(t.type,this.checker.inProvisionalTypecheckMode(),e,t.init),this.inBoundPropTypeCheck&&(this.inBoundPropTypeCheck=!1),this.scope=s,t.type?(u=!1,f=null,t.init.type&&(f=t.init.type.containedScope,u=!0,t.init.type==this.voidType&&this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.text+"'")),t.init=this.castWithCoercion(t.init,t.type,e,!1),u&&t.init.type.containedScope==null&&(t.init.type.containedScope=f)):(t.type=this.checker.widenType(t.init.type),t.type==this.voidType&&(this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.text+"'"),t.type=this.anyType)),i.setType(t.type)}else r||this.resolveBoundDecl(t);i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.checker.typeStatusIsFinished(i.typeCheckStatus)&&i.declAST!=t&&t.init&&(t.init=this.typeCheck(t.init),t.type=i.getType(),t.init=this.cast(t.init,t.type));return t.id&&t.sym&&(t.id.sym=t.sym),t},t.prototype.typeCheckSuper=function(n){return this.thisType&&this.enclosingFncIsMethod&&!this.thisFnc.isStatic()&&this.thisType.baseClass()?n.type=this.thisType.baseClass():(n.type=this.anyType,this.checker.errorReporter.invalidSuperReference(n)),n},t.prototype.typeCheckThis=function(t){var r=!1,u;if(this.thisFnc==null?this.thisType?this.thisClassNode&&this.thisClassNode.nty==n.NodeType.Class?(r=!0,t.type=this.anyType):t.type=this.thisType:(this.checker.currentModDecl&&this.checker.errorReporter.simpleError(t,"'this' may not be referenced within module bodies"),t.type=this.anyType):((this.inBoundPropTypeCheck||this.inSuperCall)&&this.thisClassNode&&this.thisClassNode.nty==n.NodeType.Class&&(r=!0),t.type=this.thisFnc.isMethod()||this.thisFnc.isConstructor||this.thisFnc.isTargetTypedAsMethod?!this.thisType||this.thisFnc.fncFlags&n.FncFlags.Static?this.anyType:this.thisType:this.anyType),!this.enclosingFncIsMethod&&this.thisFnc&&n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.IsFatArrowFunction))if(this.thisFnc.boundToProperty)u=this.thisFnc.boundToProperty.sym.container,u.declAST.nodeType==n.NodeType.FuncDecl&&u.declAST.setHasSelfReference();else{for(var i=this.thisFnc.enclosingFnc,e=i,f=!1;i;){if(i.isMethod()||i.isConstructor||i.hasSelfReference()){i.setHasSelfReference(),f=!0;break}i=i.enclosingFnc}!f&&e&&e.setHasSelfReference(),f&&this.thisType&&(t.type=this.thisType)}return r&&this.checker.errorReporter.simpleError(t,"Keyword 'this' cannot be referenced in initializers in a class body, or in super constructor calls"),t},t.prototype.setTypeFromSymbol=function(t,i){if(i.isVariable()){if(i.isInferenceSymbol()){var r=i;r.declAST&&!this.checker.typeStatusIsFinished(r.typeCheckStatus)&&this.inScopeTypeCheckDecl(r.declAST),this.checker.styleSettings.innerScopeDeclEscape||r.declAST&&r.declAST.nodeType==n.NodeType.VarDecl&&this.nestingLevel<r.declAST.nestingLevel&&this.checker.errorReporter.styleError(t,"Illegal reference to a variable defined in more nested scope")}t.type=i.getType(),i.writeable()||(t.flags=t.flags&~n.ASTFlags.Writeable)}else i.isType()?(t.type=i.getType(),t.flags=t.flags&~n.ASTFlags.Writeable):(t.type=this.anyType,this.checker.errorReporter.symbolDoesNotReferToAValue(t,i.name))},t.prototype.typeCheckName=function(t){var s=this,r=t,f,e;if(this.checker.inWith)r.type=this.anyType;else{var o=!1,u=r.text,c=u,h=n.isQuoted(r.text),i=this.scope.find(u,!1,o);i==null&&h&&(i=this.checker.findSymbolForDynamicModule(u,this.currentScript.locationInfo.filename,function(n){return s.scope.find(n,!1,o)})),i?(this.inNewTargetTypeCheck&&i.isInferenceSymbol()&&!this.checker.typeStatusIsFinished(i.typeCheckStatus)&&this.checker.errorReporter.simpleError(t,"Symbol '"+r.text+"' is referenced before its declaration"),n.optimizeModuleCodeGen&&i&&i.isType()&&(f=i.getType(),f&&i.aliasLink&&i.onlyReferencedAsTypeRef&&(e=f.symbol.declAST,e&&n.hasFlag(e.modFlags,n.ModuleFlags.IsDynamic)&&(i.onlyReferencedAsTypeRef=this.inTypeRefTypeCheck))),i.declAST&&i.declAST.nodeType==n.NodeType.FuncDecl&&!i.declAST.returnTypeAnnotation&&i.declAST.signature.typeCheckStatus==n.TypeCheckStatus.Started&&(i.declAST.type.symbol.flags|=n.SymbolFlags.RecursivelyReferenced,i.declAST.signature.returnType.type=this.anyType),this.setTypeFromSymbol(t,i),r.sym=i,this.thisFnc&&this.thisFnc.type&&i.container!=this.thisFnc.type.symbol&&(this.thisFnc.freeVariables[this.thisFnc.freeVariables.length]=i)):(r.isMissing()||this.checker.errorReporter.unresolvedSymbol(r,r.text),r.type=this.anyType)}return t},t.prototype.typeCheckScript=function(n){return this.checker.locationInfo=n.locationInfo,this.scope=this.checker.globalScope,n.topLevelMod||this.addLocalsFromScope(this.scope,this.checker.gloMod,n.vars,this.checker.globals,!0),this.currentScript=n,n.bod=this.typeCheck(n.bod),this.currentScript=null,n},t.prototype.typeCheckBitNot=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,t},t.prototype.typeCheckUnaryNumberOperator=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,n},t.prototype.typeCheckLogNot=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.booleanType,t},t.prototype.astIsWriteable=function(t){return n.hasFlag(t.flags,n.ASTFlags.Writeable)},t.prototype.typeCheckIncOrDec=function(t){var i=t,r=i.operand;return this.astIsWriteable(i)?(i=this.typeCheckUnaryNumberOperator(t),i.operand.type==this.checker.numberType||i.operand.type==this.checker.anyType||i.operand.type.typeFlags&n.TypeFlags.IsEnum||this.checker.errorReporter.simpleError(t,"'++' and '--' may only be applied to operands of type 'number' or 'any'")):(this.checker.errorReporter.valueCannotBeModified(i),i.type=this.doubleType),i},t.prototype.typeCheckBitwiseOperator=function(t,i){var r=t,e=null,u,f;return r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2),u=r.operand1.type,f=r.operand2.type,i&&!this.astIsWriteable(r)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&this.checker.errorReporter.styleError(t,"use of "+n.nodeTypeTable[r.nodeType]),this.checker.sourceIsSubtypeOfTarget(u,this.doubleType)&&this.checker.sourceIsSubtypeOfTarget(f,this.doubleType)?e=this.doubleType:u==this.booleanType&&f==this.booleanType?e=this.booleanType:u==this.anyType?(f==this.anyType||f==this.doubleType||f==this.booleanType)&&(e=this.anyType):f==this.anyType&&(u==this.anyType||u==this.doubleType||u==this.booleanType)&&(e=this.anyType),e==null&&(e=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)),r.type=e,r},t.prototype.typeCheckArithmeticOperator=function(t,i){var r=t,u,f,e;return(r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2),u=r.operand1.type,f=r.operand2.type,i&&!this.astIsWriteable(r)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&(r.nodeType==n.NodeType.And||r.nodeType==n.NodeType.Or||r.nodeType==n.NodeType.AsgAnd||r.nodeType==n.NodeType.AsgOr)&&this.checker.errorReporter.styleError(t,"use of "+n.nodeTypeTable[r.nodeType]),u==null||f==null)?(this.checker.errorReporter.simpleError(r,"Could not typecheck arithmetic operation.  Possible recursive typecheck error?"),r.type=this.anyType,r):(e=r.nodeType,this.checker.isNullOrUndefinedType(u)&&(u=f),this.checker.isNullOrUndefinedType(f)&&(f=u),u=this.checker.widenType(u),f=this.checker.widenType(f),e==n.NodeType.Add||e==n.NodeType.AsgAdd?u==this.checker.stringType||f==this.checker.stringType?r.type=this.checker.stringType:u==this.checker.numberType&&f==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(u,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?r.type=this.checker.numberType:u==this.checker.anyType||f==this.checker.anyType?r.type=this.checker.anyType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)):u==this.checker.numberType&&f==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(u,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?r.type=this.checker.numberType:u==this.checker.anyType||f==this.checker.anyType?r.type=this.checker.numberType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)),r)},t.prototype.typeCheckDotOperator=function(n){var t=n,h=!1,i,u,o,e;if(t.operand1=this.typeCheck(t.operand1),i=t.operand1.type,u=null,i){if(i==this.anyType)return t.type=this.anyType,t;if(i==this.stringType)if(this.stringInterfaceType)u=this.stringInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i==this.doubleType)if(this.numberInterfaceType)u=this.numberInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i==this.booleanType)if(this.booleanInterfaceType)u=this.booleanInterfaceType.memberScope;else return t.type=this.anyType,t;else if((i.call||i.construct)&&i.members==null)if(this.functionInterfaceType)u=this.functionInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i.elementType)if(this.arrayInterfaceType)o=i.elementType.getArrayBase(this.arrayInterfaceType,this.checker),u=o.memberScope;else return t.type=this.anyType,t;else u=i.memberScope}if(u==null)this.checker.errorReporter.expectedClassOrInterface(t),t.type=this.anyType;else{var f=t.operand2,s=this.thisClassNode&&t.operand1.type==this.thisClassNode.type.instanceType,r=u.find(f.text,!s,!1);r||this.objectInterfaceType&&i&&(i.isReferenceType()&&(r=this.objectInterfaceType.memberScope.find(f.text,!1,!1)),r||this.functionInterfaceType&&(i.call||i.construct)&&(r=this.functionInterfaceType.memberScope.find(f.text,!1,!1))),r&&r.visible(u,this.checker)?(r.isVariable()&&r.isInferenceSymbol()&&(e=r,e.declAST&&!this.checker.typeStatusIsFinished(e.typeCheckStatus)&&this.inScopeTypeCheckDecl(e.declAST)),f.sym=r,t.type=r.getType()):(t.type=this.anyType,r==null?this.checker.errorReporter.simpleError(f,"The property '"+f.text+"' does not exist on value of type '"+i.getScopedTypeName(this.scope)+"'"):this.checker.errorReporter.simpleError(t,"The property '"+f.text+" on type '"+i.getScopedTypeName(this.scope)+"' is not visible"))}return t.type==null&&(t.type=this.anyType),t},t.prototype.typeCheckBooleanOperator=function(n){var t=n,i,r;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),i=t.operand1.type,r=t.operand2.type,this.checker.sourceIsAssignableToTarget(i,r)||this.checker.sourceIsAssignableToTarget(r,i)||this.checker.errorReporter.incompatibleTypes(t,i,r,t.printLabel(),this.scope),t.type=this.booleanType,t},t.prototype.typeCheckAsgOperator=function(t){var i=t,f=!i.operand2.isParenthesized,e,o,s,r,u;return i.operand1=this.typeCheck(i.operand1),this.checker.typeCheckWithContextualType(i.operand1.type,this.checker.inProvisionalTypecheckMode(),f,i.operand2),e=i.operand1.type,o=i.operand2.type,this.astIsWriteable(i.operand1)||this.checker.errorReporter.valueCannotBeModified(i),i.operand1.nodeType==n.NodeType.Call&&(s=i.operand1),r=!1,u=null,i.operand2.type&&(u=i.operand2.type.containedScope,r=!0),i.operand2=this.castWithCoercion(i.operand2,e,f,!1),r&&i.operand2.type.containedScope==null&&(i.operand2.type.containedScope=u),i.type=o,i},t.prototype.typeCheckIndex=function(t){var i=t,r,u,f;return i.operand1=this.typeCheck(i.operand1),i.operand2=this.typeCheck(i.operand2),this.checker.styleSettings.literalSubscript||i.operand2.nodeType==n.NodeType.QString&&this.checker.errorReporter.styleError(t,"use literal subscript ('.') notation instead)"),r=i.operand1.type,u=i.operand2.type,r.elementType?u==this.checker.anyType||u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum)?i.type=r.elementType:u==this.checker.stringType?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType):r.index?u==this.checker.anyType||!(r.index.flags&n.SignatureFlags.IsStringIndexer||r.index.flags&n.SignatureFlags.IsNumberIndexer)||r.index.flags&n.SignatureFlags.IsStringIndexer&&u==this.checker.stringType||r.index.flags&n.SignatureFlags.IsNumberIndexer&&(u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum))?(f=this.resolveOverload(t,r.index),i.type=f?f.returnType.type:this.checker.anyType):u==this.checker.stringType?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType):(r==this.checker.anyType||r==this.checker.stringType||r==this.checker.numberType||r==this.checker.booleanType||r.isReferenceType())&&(u==this.checker.anyType||u==this.checker.stringType||u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum))?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType),i},t.prototype.typeCheckInOperator=function(n){return n.operand1=this.cast(this.typeCheck(n.operand1),this.stringType),n.operand2=this.typeCheck(n.operand2),(n.operand1.type==this.checker.anyType||n.operand1.type==this.checker.stringType)&&(n.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(n.operand2.type,this.objectInterfaceType))||this.checker.errorReporter.simpleError(n,"The in operator requires the left operand to be of type Any or the String primitive type, and the right operand to be of type Any or an object type"),n.type=this.booleanType,n},t.prototype.typeCheckShift=function(n,t){return n.operand1=this.cast(this.typeCheck(n.operand1),this.doubleType),n.operand2=this.cast(this.typeCheck(n.operand2),this.doubleType),t&&!this.astIsWriteable(n.operand1)&&this.checker.errorReporter.valueCannotBeModified(n),n.type=this.doubleType,n},t.prototype.typeCheckQMark=function(n){n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2),n.operand3=this.typeCheck(n.operand3);var t=n.operand2.type,i=n.operand3.type;return t==i?n.type=t:this.checker.sourceIsSubtypeOfTarget(t,i)?n.type=i:this.checker.sourceIsSubtypeOfTarget(i,t)?n.type=t:(n.type=this.anyType,this.checker.errorReporter.incompatibleTypes(n,t,i,n.printLabel(),this.scope)),n},t.prototype.addFormals=function(n,t,i){for(var f=t.parameters.length,u,r=0;r<f;r++)u=t.parameters[r],u.container=n,i.add(u.name,u)},t.prototype.addLocalsFromScope=function(t,i,r,u,f){for(var y=r.members.length,a=!1,e,l,o,s,h,v,c=0;c<y;c++)e=r.members[c],(e.sym==null||e.sym.kind()!=n.SymbolKind.Field)&&(l=null,(l=u.lookup(e.id.text))==null?(o=new n.ValueLocation,o.typeLink=new n.TypeLink,s=null,n.hasFlag(e.varFlags,n.VarFlags.Static)?(e.varFlags|=n.VarFlags.LocalStatic,s=new n.FieldSymbol(e.id.text,e.minChar,this.checker.locationInfo.unitIndex,!0,o)):s=new n.VariableSymbol(e.id.text,e.minChar,this.checker.locationInfo.unitIndex,o),s.transferVarFlags(e.varFlags),o.symbol=s,s.declAST=e,o.typeLink.ast=e.typeExpr,this.checker.resolveTypeLink(t,o.typeLink,!1),e.type==null&&e.init==null&&(e.type=this.anyType),o.typeLink.type=e.type,o.symbol.container=i,e.sym=o.symbol,u.add(e.id.text,s),e.id.text=="arguments"&&(a=!0)):(e.type=l.getType(),e.sym=l));f||a||(h=new n.ValueLocation,h.typeLink=new n.TypeLink,v=new n.VariableSymbol("arguments",r.minChar,this.checker.locationInfo.unitIndex,h),h.typeLink.ast=new n.Identifier("IArguments"),this.checker.resolveTypeLink(t,h.typeLink,!1),u.add("arguments",v))},t.prototype.addConstructorLocalArgs=function(t,i,r,u){var c,o,f,s,e,h;if(i)for(c=i.members.length,o=0;o<c;o++)f=i.members[o],(f.sym==null||u||f.sym.kind()!=n.SymbolKind.Field)&&(s=null,(s=r.lookup(f.id.text))==null?(this.resolveBoundDecl(f),e=new n.ValueLocation,e.typeLink=new n.TypeLink,h=new n.ParameterSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,e),h.declAST=f,e.symbol=h,e.typeLink.type=f.type,e.symbol.container=t,f.sym=e.symbol,r.add(f.id.text,h)):(f.type=s.getType(),f.sym=s))},t.prototype.checkInitSelf=function(n){var r,t,f,e,u,o,i,s;if(!n.isMethod())for(r=n.freeVariables,t=0,f=r.length;t<f;t++)if(e=r[t],e.isInstanceProperty())return!0;for(u=n.scopes,o=u.members.length,i=0;i<o;i++)if(s=u.members[i],this.checkInitSelf(s))return!0;return!1},t.prototype.checkPromoteFreeVars=function(t,i){for(var f=t.freeVariables,r,u=0,e=f.length;u<e;u++)r=f[u],r.isInstanceProperty()||r.container!=i||(n.instanceFilter.reset(),this.scope.search(n.instanceFilter,r.name,!1,!1)&&this.checker.errorReporter.simpleError(t,"Constructor-local variable shadows class property '"+r.name+"'. To access the class property, use 'self."+r.name+"'"),this.checker.errorReporter.simpleError(t,"Constructor-local variables may not be accessed from instance method bodies. Consider changing local variable '"+r.name+"' to a class property"))},t.prototype.allReturnsAreVoid=function(t){var i=!0,r;return t.signature.returnType.type==null&&(r=function(t,r,u){var f=!0,e;switch(t.nodeType){case n.NodeType.FuncDecl:f=!1;break;case n.NodeType.Return:e=t,e.returnExpression&&(i=!1,f=!1)}return u.options.goChildren=f,u.options.goNextSibling=f,t},n.getAstWalkerFactory().walk(t.bod,r)),i},t.prototype.classConstructorHasSuperCall=function(t){var i=!1,r=function(t,r,u){var f=!0,e;switch(t.nodeType){case n.NodeType.FuncDecl:f=!1;break;case n.NodeType.Call:if(e=t,e.target.nodeType==n.NodeType.Super){f=!1,i=!0;break}}return u.options.goChildren=f,t};return n.getAstWalkerFactory().walk(t.bod,r),i},t.prototype.typeCheckFunction=function(t){var w,e,b,yt,o,p,c,kt,ct,ft,f,ot,r,et,at,dt,d,y,wt,v,g,lt,s;this.nestingLevel=0;var u=t.type,it=u.symbol,i=t.signature;if(this.checker.typeStatusIsFinished(i.typeCheckStatus))return t;if(i.typeCheckStatus==n.TypeCheckStatus.Started)return t.returnTypeAnnotation||!t.bod||t.isSignature()||t.isConstructor||!this.allReturnsAreVoid(t)?(t.returnTypeAnnotation==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType,it.flags|=n.SymbolFlags.RecursivelyReferenced),t):(i.returnType.type=this.voidType,t);i.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(i);var k=this.scope,oi=this.thisFnc,ti=this.enclosingFncIsMethod,ii=this.thisClassNode;this.enclosingFncIsMethod=t.isMethod()||t.isConstructor,this.thisFnc=t;var tt=t.type.symbol,vt=this.thisType,ri=this.checker.locationInfo,a=null,pt=!1,l=null,rt=null,si=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor),st=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.SetAccessor),s=(si||st)&&t.accessorSymbol?t.accessorSymbol.getType():null,ei=this.checker.currentModDecl;if(t.isConstructor&&!t.isOverload){if(u.instanceType==null)return this.checker.errorReporter.simpleError(t,"Malformed function body (is this a class named the same as an existing interface?)"),t;this.scope=u.instanceType.constructorScope,o=this.scope,a=o.valueMembers.allMembers}else t.isOverload?(a=t.symbols,!n.hasFlag(t.fncFlags,n.FncFlags.Static)&&u.containedScope&&(this.scope=u.containedScope)):(t.bod&&(this.scope=u.containedScope),o=this.scope,o&&o.valueMembers&&(a=o.valueMembers.allMembers));if(t.isConstructor&&t.bod&&n.hasFlag(t.fncFlags,n.FncFlags.ClassMethod)){var bt=n.hasFlag(t.classDecl.type.instanceType.typeFlags,n.TypeFlags.HasBaseType),fi=!bt||n.hasFlag(t.classDecl.type.instanceType.typeFlags,n.TypeFlags.HasBaseTypeOfObject),ui=n.hasFlag(t.classDecl.varFlags,n.VarFlags.ClassSuperMustBeFirstCallInConstructor);fi&&this.classConstructorHasSuperCall(t)?this.checker.errorReporter.simpleError(t,"Calls to 'super' constructor are not allowed in classes that either inherit directly from 'Object' or have no base class"):bt&&(ui?t.bod&&t.bod.members.length&&t.bod.members[0].nodeType==n.NodeType.Call&&t.bod.members[0].target.nodeType==n.NodeType.Super||this.checker.errorReporter.simpleError(t,"If a derived class contains initialized properties or constructor parameter properties, the first statement in the constructor body must be a call to the super constructor"):this.classConstructorHasSuperCall(t)||this.checker.errorReporter.simpleError(t,"Constructors for derived classes must contain a call to the class's 'super' constructor"))}if(t.isMethod()&&t.type.enclosingType&&(w=null,t.type.enclosingType.symbol.declAST.nodeType==n.NodeType.FuncDecl?w=t.type.enclosingType.symbol.declAST.classDecl:t.type.enclosingType.symbol.declAST.nodeType==n.NodeType.Class&&(w=t.type.enclosingType.symbol.declAST),w&&(this.thisClassNode=w)),u.enclosingType&&(e=u.symbol.container,e&&e.isType()&&e.getType().isClass()&&(e=e.container),e&&e.declAST&&e.declAST.nodeType==n.NodeType.Module&&(this.checker.currentModDecl=e.declAST)),this.checker.locationInfo=this.checker.units&&t.unitIndex>=0&&t.unitIndex<this.checker.units.length?this.checker.units[t.unitIndex]:n.unknownLocationInfo,this.thisType=u.enclosingType?u.enclosingType:vt,b=i.parameters.length,t.isConstructor||!t.bod||t.isSignature()){for(this.typeCheck(t.args),r=0;r<b;r++)i.parameters[r].parameter.typeLink.type=t.args.members[r].type,t.args.members[r].parameterPropertySym&&t.args.members[r].parameterPropertySym.setType(t.args.members[r].type);t.fncFlags&n.FncFlags.IndexerMember&&(!b||b>1?this.checker.errorReporter.simpleError(t,"Index signatures may take only one parameter"):t.args.members[0].type==this.checker.numberType?u.index.flags|=n.SignatureFlags.IsNumberIndexer:t.args.members[0].type==this.checker.stringType?u.index.flags|=n.SignatureFlags.IsStringIndexer:this.checker.errorReporter.simpleError(t,"Index signatures may only take 'string' or 'number' as their parameter"))}else{for(yt=this.scope,o=this.scope,t.isMethod()||t.returnTypeAnnotation!=null||(k&&t.name&&!t.name.isMissing()&&(p=k.findAmbient(t.name.text,!1,!1),p&&p.declAST&&p.declAST.type&&(this.checker.setContextualType(p.declAST.type,!1),pt=!0)),this.checker.hasTargetType()&&(f=this.checker.getTargetTypeContext(),c=f.contextualType,this.checker.canContextuallyTypeFunction(c,t,!0)?(kt=c.construct?c.construct:c.call,f.targetSig=kt.signatures[0],ct=f.targetSig.parameters,l=ct,rt=f.targetSig.returnType.type,f.targetSig.declAST&&(f.targetSig.declAST.isConstructor?t.isTargetTypedAsMethod=!0:f.targetSig.declAST.isMethod()&&(t.isTargetTypedAsMethod=!0)),it.type=f.contextualType):c&&t.isAccessor()?(s=c,f.targetAccessorType=s):this.checker.killTargetType())),ft=o.valueMembers,this.scope=new n.SymbolScopeBuilder(ft,null,null,null,k,tt),r=0;r<b;r++){var ni=i.parameters[r],nt=ni,h=nt.declAST;this.checker.hasTargetType()&&l&&(this.checker.getTargetTypeContext().targetSig.hasVariableArgList||r<l.length)?(f=this.checker.getTargetTypeContext(),ot=f.targetSig.hasVariableArgList,h.type=ot&&r>=l.length-1?l[l.length-1].getType().elementType:l[r].getType(),h.sym.setType(h.type),h.sym.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()):this.typeCheck(h),st&&s&&(h=this.cast(h,s)),nt.container=tt,ft.publicMembers.add(nt.name,nt)}this.scope=yt}if(t.bod&&!t.isSignature()&&(t.isConstructor?(this.addConstructorLocalArgs(t.type.symbol,t.args,a,n.hasFlag(t.fncFlags,n.FncFlags.ClassMethod)),this.thisClassNode&&this.thisClassNode.extendsList&&(et=this.scope,at=new n.ScopedMembers(a),this.scope=new n.FilteredSymbolScopeBuilder(at,k,t.type.symbol,function(t){return t.kind()==n.SymbolKind.Parameter}),this.typeCheckBaseCalls(this.thisClassNode.extendsList),this.scope=et)):this.addFormals(tt,i,a),dt=this.checker.currentModDecl,t.type&&t.type.symbol&&!t.isMethod()&&t.type.symbol.declModule&&(this.checker.currentModDecl=t.type.symbol.declModule),this.typeCheck(t.bod),this.checker.currentModDecl=dt,this.checker.checkControlFlow&&(d=t.buildControlFlow(),this.checker.printControlFlowGraph&&d.print(this.checker.errorReporter.outfile),d.reportUnreachable(this.checker.errorReporter),this.checker.checkControlFlowUseDef&&d.useDef(this.checker.errorReporter,t.type.symbol)),t.isConstructor))for(var ht=t.scopes,gt=ht.members.length,hi,ci,ut=0;ut<gt;ut++)y=ht.members[ut],y.isSignature()||n.hasFlag(y.fncFlags,n.FncFlags.Method)&&!n.hasFlag(y.fncFlags,n.FncFlags.Static)&&this.checkPromoteFreeVars(y,t.type.symbol);if(this.scope=k,this.thisFnc=oi,this.thisClassNode=ii,this.enclosingFncIsMethod=ti,this.thisType=vt,this.checker.locationInfo=ri,this.checker.currentModDecl=ei,i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),t.returnTypeAnnotation?(this.checkForVoidConstructor(t.returnTypeAnnotation.type,t.returnTypeAnnotation),i.returnType.type==null&&this.checker.resolveTypeLink(this.scope,i.returnType,!1)):rt&&(i.returnType.type=rt),!(it.flags&n.SymbolFlags.RecursivelyReferenced)&&t.returnStatementsWithExpressions.length>0)if(wt={getLength:function(){return t.returnStatementsWithExpressions.length},setTypeAtIndex:function(n,i){t.returnStatementsWithExpressions[n].type=i},getTypeAtIndex:function(n){return t.returnStatementsWithExpressions[n].type}},v=t.returnStatementsWithExpressions[0].type,v=this.checker.findBestCommonType(v,null,wt),v)i.returnType.type=this.checker.widenType(v);else{for(g=0;g<t.returnStatementsWithExpressions.length;g++)this.checker.errorReporter.simpleError(t.returnStatementsWithExpressions[g],"Incompatible return type");i.returnType.type=this.anyType}return i.returnType.type==null?n.hasFlag(t.fncFlags,n.FncFlags.HasReturnExpression)?(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType):i.returnType.type=this.voidType:i.returnType.type==this.nullType||i.returnType.type==this.checker.undefinedType?i.returnType.type=this.anyType:i.returnType.type!=this.voidType&&i.returnType.type!=this.checker.undefinedType&&i.returnType.type!=this.anyType&&t.returnTypeAnnotation&&(t.isSignature()||t.isConstructor||n.hasFlag(t.fncFlags,n.FncFlags.HasReturnExpression)||n.hasFlag(t.fncFlags,n.FncFlags.IsFatArrowFunction)||(lt=t.bod.members.length>0&&t.bod.members[0].nodeType==n.NodeType.Throw,lt||this.checker.errorReporter.simpleError(t,"Function declared a non-void return type, but has no return expression"))),pt&&this.checker.unsetContextualType(),t.accessorSymbol&&(s=t.accessorSymbol.getType(),s?(n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)&&s!=i.returnType.type||t.args.members.length>0&&s!=t.args.members[0].type)&&this.checker.errorReporter.simpleError(t,"Getter and setter types do not agree"):n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?t.accessorSymbol.setType(i.returnType.type):t.args.members.length!=1?this.checker.errorReporter.simpleError(t,"Setters may have one and only one argument"):t.accessorSymbol.setType(t.args.members[0].type)),this.typeCheckOverloadSignatures(u,t),t},t.prototype.typeCheckBases=function(t){var u=!1,f=t.extendsList,e,r,i,o;if(f){for(e=f.length,this.inNewTargetTypeCheck=!0,e>0&&(t.typeFlags|=n.TypeFlags.HasBaseType),r=0;r<e;r++)if(i=f[r],o=i.symbol&&i.symbol.name=="Object"&&i.symbol.container==this.checker.gloMod,o&&(t.typeFlags|=n.TypeFlags.HasBaseTypeOfObject),i.isClassInstance())t.isClassInstance()&&!this.checker.typeStatusIsFinished(i.symbol.typeCheckStatus)&&i.symbol.declAST&&(this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Base type '"+i.symbol.name+"' is referenced before its declaration"),this.typeCheck(i.symbol.declAST)),this.currentScript&&(this.currentScript.requiresInherits=!0),t.isClassInstance()?u&&this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Class may not follow interface as base type"):this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Interface base type must be interface");else if(i.isModuleType())this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Types may not be derived from module types");else if(i.members)u||(u=!0);else{t.isClassInstance()?this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Base type must be interface or class"):this.checker.errorReporter.simpleErrorFromSym(i.symbol,"Interface base type must be interface");break}this.inNewTargetTypeCheck=!1}},t.prototype.checkMembersImplementInterfaces=function(t){var i=t.getInstanceType(),o,r,f,u,e;if(i.implementsList){for(o=i.implementsList.length,this.inNewTargetTypeCheck=!0,r=0;r<o;r++)f=i.implementsList[r],u=new n.TypeComparisonInfo,this.checker.sourceIsSubtypeOfTarget(i,f,u)||(e="Class '"+i.getTypeName()+"' declares interface '"+f.getTypeName()+"' but does not implement it",u.message?this.checker.errorReporter.simpleErrorFromSym(i.symbol,e+": "+u.message):this.checker.errorReporter.simpleErrorFromSym(i.symbol,e));this.inNewTargetTypeCheck=!1}},t.prototype.typeCheckBaseCalls=function(t){var u,i,r,f;if(t!=null)for(u=t.members.length,i=0;i<u;i++)r=t.members[i],f=null,r.nodeType==n.NodeType.Call&&this.typeCheckNew(r)},t.prototype.assertUniqueNamesInBaseTypes=function(t,i,r,u){var o=this,e,f;if(i&&(i.members&&i.members.publicMembers.map(function(n,f){var s=f,h=t.lookup(s.name);h?u&&o.checker.errorReporter.simpleError(r,"duplicate member name in bases for "+r.name.text+": "+i.symbol.name+" and "+h.container.name+" both contain member with name "+s.name):t.add(s.name,s)},null),i.extendsList))for(e=i.extendsList.length,f=0;f<e;f++)i.extendsList[f].symbol.flags&n.SymbolFlags.RecursivelyReferenced||this.assertUniqueNamesInBaseTypes(t,i.extendsList[f],r,u)},t.prototype.checkBaseTypeMemberInheritance=function(t,i){var f=this,r=t.getInstanceType(),e,o,u;if(r.extendsList!=null&&(e=r.extendsList.length,e>0)){if(o=new n.StringHashTable,r.isClassInstance())for(u=0;u<e;u++)this.assertUniqueNamesInBaseTypes(o,r.extendsList[u],i,u>0);r.members&&r.members.publicMembers.map(function(t,u){for(var s=u,l,h,a,v,c=0;c<e;c++)l=r.extendsList[c],l.memberScope==null?f.checker.errorReporter.simpleError(i,"Base type '"+l.symbol.name+"' lacks an implementation."):(h=l.memberScope.find(s.name,!1,!1),h&&(a=s.getType(),v=h.getType(),f.checker.sourceIsSubtypeOfTarget(a,v)?s.kind()==n.SymbolKind.Type&&h.kind()==n.SymbolKind.Field&&f.checker.errorReporter.simpleErrorFromSym(s,"Cannot override field '"+s.name+"' with method"):f.checker.errorReporter.simpleErrorFromSym(s,"Type of overridden member '"+s.name+"' is not subtype of original member defined by type '"+h.container.name+"'")))},null)}},t.prototype.typeCheckClass=function(t){var r=t.type.symbol,u,f,i,e,o,s;return r.typeCheckStatus==n.TypeCheckStatus.Finished?t:r.typeCheckStatus==n.TypeCheckStatus.Started?t:(r.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(r),u=this.scope,f=this.thisClassNode,this.thisClassNode=t,i=t.type,this.typeCheckBases(i.instanceType),e=this.thisType,this.thisType=i.instanceType,this.scope=i.instanceType.containedScope,t.constructorDecl&&(this.scope=i.instanceType.constructorScope,o=this.scope,s=o.valueMembers.allMembers,this.addConstructorLocalArgs(t.constructorDecl.type.symbol,t.constructorDecl.args,s,!0)),this.typeCheck(t.members),r.typeCheckStatus=n.TypeCheckStatus.Finished,this.checkBaseTypeMemberInheritance(i,t),this.checkMembersImplementInterfaces(i),this.typeCheckOverloadSignatures(i,t),this.typeCheckOverloadSignatures(i.instanceType,t),t.constructorDecl||t.baseClass&&t.baseClass.members.length&&t.baseClass.members[0].type&&t.baseClass.members[0].type.symbol.type.isClass()&&n.cloneParentConstructGroupForChildType(t.type,t.baseClass.members[0].type.symbol.type),this.thisType=e,this.thisClassNode=f,this.scope=u,t)},t.prototype.typeCheckOverloadSignatures=function(n,t){n.call&&n.call.typeCheck(this.checker,t,n.construct!=null),n.construct&&n.construct.typeCheck(this.checker,t,!1),n.index&&n.index.typeCheck(this.checker,t,!1)},t.prototype.typeCheckInterface=function(n){if(this.typeCheckBases(n.type),this.typeCheck(n.members),this.checkBaseTypeMemberInheritance(n.type,n),n.extendsList)for(var t=0;t<n.extendsList.members.length;t++)n.extendsList.members[t].type.call&&(n.type.call?n.type.call.signatures=n.type.call.signatures.concat(n.extendsList.members[t].type.call.signatures):n.type.call=n.extendsList.members[t].type.call),n.extendsList.members[t].type.construct&&(n.type.construct?n.type.construct.signatures=n.type.construct.signatures.concat(n.extendsList.members[t].type.construct.signatures):n.type.construct=n.extendsList.members[t].type.construct),n.extendsList.members[t].type.index&&(n.type.index?n.type.index.signatures=n.type.index.signatures.concat(n.extendsList.members[t].type.index.signatures):n.type.index=n.extendsList.members[t].type.index);return n},t.prototype.typeCheckImportDecl=function(t){var i=t.alias.type,r=null,u=this.inImportTypeCheck;return this.inImportTypeCheck=!0,this.typeCheck(t.alias),i=t.alias.type,i==null&&(this.checker.errorReporter.simpleError(t.alias,"Could not resolve module alias '"+t.id.text+"'"),i=this.checker.anyType,t.id.sym.type=i),t.id.type=i,r=i.symbol,i.isModuleType()?(r.type=i,this.checker.currentModDecl&&this.checker.currentModDecl.mod&&this.checker.currentModDecl.mod.importedModules.push(t),t.id.sym.type=i,i.symbol&&i.symbol.declAST&&(i.symbol.declAST.modFlags&=~n.ModuleFlags.ShouldEmitModuleDecl)):this.checker.errorReporter.simpleError(t.alias,"A module cannot be aliased to a non-module type"),this.inImportTypeCheck=u,t},t.prototype.typeCheckModule=function(t){if(!t.mod)return t;this.currentScript&&(this.currentScript.requiresGlobal=!0);var i=t.mod,r=null,f=this.scope,e=this.thisType,u=this.checker.currentModDecl;return this.checker.currentModDecl=t,!this.inImportTypeCheck&&u&&n.hasFlag(t.modFlags,n.ModuleFlags.IsDynamic)&&!n.hasFlag(t.modFlags,n.ModuleFlags.Ambient)&&this.checker.errorReporter.simpleError(t,"Dynamic modules may not be nested within other modules"),this.thisType=null,this.scope=i.containedScope,this.typeCheck(t.members),r=i.symbol,this.checker.currentModDecl=u,this.thisType=e,this.scope=f,t.type=i,r&&(r.typeCheckStatus=n.TypeCheckStatus.Finished),t},t.prototype.typeCheckFor=function(n){return n.init=this.typeCheck(n.init),this.nestingLevel++,n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.incr=this.typeCheck(n.incr),this.nestingLevel--,n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"for statement"),n.type=this.voidType,n},t.prototype.typeCheckWith=function(n){return this.checker.errorsOnWith&&this.checker.errorReporter.simpleError(n.expr,"All symbols within a 'with' block will be typed as 'any'"),n.expr=this.typeCheck(n.expr),this.checker.inWith=!0,n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"with statement"),this.checker.inWith=!1,n},t.prototype.typeCheckForIn=function(t){if(t.obj=this.typeCheck(t.obj),t.lval=this.cast(this.typeCheck(t.lval),this.checker.stringType),t.lval.nodeType==n.NodeType.VarDecl){var i=t.lval;i.typeExpr&&this.checker.errorReporter.simpleError(i,"Variable declarations for for/in expressions may not contain a type annotation"),i.sym&&i.sym.setType(this.checker.stringType)}return t.body=this.typeCheck(t.body),this.typeCheckCompoundStmtBlock(t.body,"for in statement"),t},t.prototype.typeCheckWhile=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"while statement"),n.type=this.voidType,n},t.prototype.typeCheckDoWhile=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"do while statement"),n.type=this.voidType,n},t.prototype.typeCheckCondExpr=function(t){this.checker.styleSettings.assignmentInCond&&t!==null&&t.nodeType>=n.NodeType.Asg&&t.nodeType<=n.NodeType.LastAsg&&this.checker.errorReporter.simpleError(t,"top-level assignment statement in conditional expression")},t.prototype.typeCheckCompoundStmtBlock=function(t,i){this.checker.styleSettings.blockInCompoundStmt&&t&&t.nodeType!=n.NodeType.Block&&this.checker.errorReporter.styleError(t,i+" requires a block")},t.prototype.typeCheckIf=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.thenBod=this.typeCheck(n.thenBod),n.elseBod=this.typeCheck(n.elseBod),this.typeCheckCompoundStmtBlock(n.thenBod,"if statement"),this.typeCheckCompoundStmtBlock(n.elseBod,"if statement"),n.type=this.voidType,n},t.prototype.typeFromAccessorFuncDecl=function(t){return t.isAccessor()?n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?t.type.call.signatures[0].returnType.type:t.type.call.signatures[0].parameters[0].getType():null},t.prototype.typeCheckObjectLit=function(t){var r=new n.Type,v,a,b,y,p,s,k,c;r.symbol=new n.TypeSymbol(this.checker.anon,t.minChar,this.checker.locationInfo.unitIndex,r),r.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),r.memberScope=new n.SymbolTableScope(r.members,null,null,null,null),v=new n.SymbolAggregateScope(r.symbol),v.addParentScope(r.memberScope),v.addParentScope(this.scope),r.containedScope=v;var w=t.operand,d=this.thisType,l=!1,u=null;if(this.checker.hasTargetType()&&(u=this.checker.getTargetTypeContext().contextualType,u&&u.symbol&&!this.checker.typeStatusIsFinished(u.symbol.typeCheckStatus)&&u.symbol.declAST&&this.typeCheck(u.symbol.declAST),l=!0),w)for(a=0,b=w.members.length;a<b;a++){var i=w.members[a],e=i.operand1,h,o=null,f=null;if(e.nodeType==n.NodeType.Name)h=e.text;else if(e.nodeType==n.NodeType.QString)y=e.text,h=y.substring(1,y.length-1);else{this.checker.errorReporter.simpleError(t,"malformed object literal"),r=this.anyType;break}l&&u.memberScope&&(o=u.memberScope.find(h,!1,!1)),i.operand2.nodeType==n.NodeType.FuncDecl&&i.operand2.isAccessor()&&(p=i.operand2,s=r.members.publicMembers.lookup(h),s=this.checker.createAccessorSymbol(p,s,r,!0,!1,r.memberScope,null),p.accessorSymbol=s,f=s,e.nodeType==n.NodeType.Name&&(e.sym=s)),this.checker.typeCheckWithContextualType(l&&o?o.getType():null,!1,l,i.operand2),l&&o?(i.operand2.type==this.anyType||this.checker.sourceIsAssignableToTarget(i.operand2.type,o.getType())||i.operand2.nodeType==n.NodeType.FuncDecl&&i.operand2.isAccessor()&&this.typeFromAccessorFuncDecl(i.operand2)==o.getType())&&(i.operand1.type=o.getType()):i.operand2.type=i.operand2.type==this.checker.undefinedType?this.anyType:i.operand2.type,f==null&&(k=i.operand2.type,c=new n.ValueLocation,f=new n.FieldSymbol(h,e.minChar,this.checker.locationInfo.unitIndex,!0,c),f.flags|=n.SymbolFlags.Property,c.symbol=f,f.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),c.typeLink=new n.TypeLink,c.typeLink.type=k,r.members.publicMembers.add(h,f)),f.isObjectLitField=!0}this.thisType=d,t.type=r,u&&(t.targetType=u)},t.prototype.typeCheckArrayLit=function(t){var u=t.operand,i=this.anyType,r=null,f=new n.TypeComparisonInfo,e,o,h,s;f.onlyCaptureFirstError=!0,this.checker.hasTargetType()&&(e=this.checker.getTargetTypeContext().contextualType,e.elementType&&(r=e.elementType)),u&&(o=this.inArrayElementTypeCheck,this.inArrayElementTypeCheck=!0,this.checker.typeCheckWithContextualType(r,this.checker.inProvisionalTypecheckMode(),r!=null,u),this.inArrayElementTypeCheck=o,i=u.members[0].type,h={getLength:function(){return u.members.length},setTypeAtIndex:function(n,t){u.members[n].type=t},getTypeAtIndex:function(n){return u.members[n].type}},i=this.checker.findBestCommonType(i,r,h,f),i!=this.checker.undefinedType&&(o||i!=this.nullType)||(i=this.anyType)),i?r&&this.checker.sourceIsAssignableToTarget(i,r)&&(i=r):(s="Incompatible types in array literal expression",f.message?this.checker.errorReporter.simpleError(t,s+": "+f.message):this.checker.errorReporter.simpleError(t,s),i=this.anyType),t.type=this.checker.makeArrayType(i)},t.prototype.checkForVoidConstructor=function(n,t){if(n&&n.construct&&n.construct.signatures.length>0)for(var i=0;i<n.construct.signatures.length;i++)if(n.construct.signatures[i].returnType.type==this.checker.voidType){this.checker.errorReporter.simpleError(t,"Constructors may not have a return type of 'void'");break}},t.prototype.typeCheckReturn=function(t){var i,e,f,u,r;return this.thisFnc&&(i=null,this.checker.hasTargetType()&&(e=this.checker.getTargetTypeContext(),f=e.targetAccessorType,f?i=f:(u=this.checker.getTargetTypeContext().targetSig,u&&u.returnType.type!=this.voidType&&(i=u.returnType.type))),t.returnExpression?(this.thisFnc.fncFlags|=n.FncFlags.HasReturnExpression,i==null&&this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type&&this.thisFnc.returnTypeAnnotation.type!=this.voidType&&(i=this.thisFnc.returnTypeAnnotation.type),this.checker.typeCheckWithContextualType(i,this.checker.inProvisionalTypecheckMode(),i!=null,t.returnExpression),r=this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type?this.thisFnc.returnTypeAnnotation.type:i,r?r==this.voidType&&t.returnExpression.type!=this.voidType?(this.checker.errorReporter.simpleError(t,"Return with value expression in void function"),t.type=t.returnExpression.type):(t.returnExpression=this.cast(t.returnExpression,r),t.type=r):(i&&(t.returnExpression.type!=this.voidType?t.returnExpression=this.cast(t.returnExpression,i):t.returnExpression.type=i),t.type=t.returnExpression.type),this.thisFnc.returnStatementsWithExpressions[this.thisFnc.returnStatementsWithExpressions.length]=t):t.type=i==null?this.checker.voidType:i),t},t.prototype.typeCheckInstOf=function(n){var t=n;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),(t.operand1.type==this.checker.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand1.type,this.objectInterfaceType))&&(t.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand2.type,this.functionInterfaceType))||this.checker.errorReporter.simpleError(n,"The instanceof operator requires the left operand to be of type Any or an object type, and the right operand to be of type Any or a subtype of the Function interface type"),t.type=this.booleanType,t},t.prototype.typeCheckCommaOperator=function(n){var t=n;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),t.type=t.operand2.type,t},t.prototype.typeCheckLogOr=function(n){n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2);var t=n.operand1.type,i=n.operand2.type;return n.type=t==this.checker.anyType||i==this.checker.anyType?this.checker.anyType:t==this.checker.booleanType?i==this.checker.booleanType?this.checker.booleanType:this.checker.anyType:t==this.checker.numberType?i==this.checker.numberType?this.checker.numberType:this.checker.anyType:t==this.checker.stringType?i==this.checker.stringType?this.checker.stringType:this.checker.anyType:this.checker.sourceIsSubtypeOfTarget(t,i)?i:this.checker.sourceIsSubtypeOfTarget(i,t)?t:this.checker.anyType,n},t.prototype.typeCheckLogAnd=function(n){return n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2),n.type=n.operand2.type,n},t.prototype.tryAddCandidates=function(n,t,i,r,u){var v=n.nonOptionalParameterCount,y=n.parameters.length,e=v,o=!1,s,f,h,c;if(t.length>=v&&(n.hasVariableArgList||t.length<=y)&&(e=n.hasVariableArgList?n.parameters.length:t.length,o=!0),s=null,o||n.hasVariableArgList){n.hasVariableArgList&&(e-=1,s=n.parameters[e].parameter.typeLink.type,s=s.elementType,o=t.length>=e);var p=t.length,l=o,a=o;for(f=0;f<p;f++)if(h=f<e?n.parameters[f].parameter.typeLink.type:s,c=t[f],h&&c&&this.checker.typesAreIdentical(h,c)||(l=!1),this.checker.sourceIsAssignableToTarget(c,h,u)||(a=!1),!(l||a))break;l?i[i.length]=n:a&&i.length==0&&(r[r.length]=n)}},t.prototype.resolveOverload=function(t,i){var y=this.resolutionDataCache.getResolutionData(),w=y.actuals,h=y.exactCandidates,d=y.conversionCandidates,l=null,tt=i.signatures.length>1,c=new n.TypeComparisonInfo,o=null,s=null,e,g,a,v,nt,u,b,p,k,r,f;if(t.nodeType==n.NodeType.Call||t.nodeType==n.NodeType.New){if(e=t,o=e.args,s=e.target,e.args)for(g=e.args.members.length,r=0;r<g;r++)w[r]=e.args.members[r].type}else t.nodeType==n.NodeType.Index&&(a=t,s=a.operand1,o=new n.ASTList,o.members[0]=a.operand2,w[0]=a.operand2.type);for(v=0,nt=i.signatures.length;v<nt;v++)(u=i.signatures[v],!tt||u!=i.definitionSignature||this.checker.canCallDefinitionSignature)&&(!u.returnType.type&&u.declAST&&u.typeCheckStatus!=n.TypeCheckStatus.Finished&&this.typeCheckFunction(u.declAST),this.tryAddCandidates(u,w,h,d,c));if(h.length==0)b=this.checker.getApplicableSignatures(d,o,c),b.length>0?(f=this.checker.findMostApplicableSignature(b,o),f.ambiguous&&this.checker.errorReporter.simpleError(s,"Ambiguous call expression - could not choose overload"),l=f.sig):(p="Supplied parameters do not match any signature of call target",c.message?this.checker.errorReporter.simpleError(s,p+":\n\t"+c.message):this.checker.errorReporter.simpleError(s,p));else if(h.length>1){for(k=[],r=0;r<h.length;r++)k[r]={signature:h[r],hadProvisionalErrors:!1};f=this.checker.findMostApplicableSignature(k,o),f.ambiguous&&this.checker.errorReporter.simpleError(s,"Ambiguous call expression - could not choose overload"),l=f.sig}else l=h[0];return this.resolutionDataCache.returnResolutionData(y),l},t.prototype.typeCheckNew=function(n){var t=n,r,i;return t.target=this.typeCheck(t.target),r=t.target,r.type.construct||r.type.call?this.preTypeCheckCallArgs(t.args):t.args=this.typeCheck(t.args),r.type==this.anyType?(t.type=this.anyType,t.args=this.typeCheck(t.args)):r.type.construct?(i=this.resolveOverload(t,r.type.construct),i==null?t.type=this.anyType:i.returnType.type==this.voidType?(t.type=this.anyType,t.signature=i):(t.type=i.returnType.type,t.signature=i)):r.type.call?(i=this.resolveOverload(t,r.type.call),i==null?t.type=this.anyType:i.returnType.type==this.voidType||i.returnType.type==this.anyType?(t.type=this.anyType,t.signature=i):this.checker.errorReporter.simpleError(t.target,"new expression only valid on constructors")):r.type.elementType?t.type=r.type:(this.checker.errorReporter.invalidCall(t,t.nodeType,this.scope),t.type=this.anyType),this.postTypeCheckCallArgs(t),t},t.prototype.preTypeCheckCallArgs=function(t){if(t)for(var i=0;i<t.members.length;i++)switch(t.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:continue;default:this.typeCheck(t.members[i])}},t.prototype.postTypeCheckCallArgs=function(t){var f=!1,i=0,r,u,e;if(t.target&&t.target.type&&t.signature&&t.args&&(r=t.signature,r&&t.args.members.length>=r.nonOptionalParameterCount))for(f=!0,u=null,e=t.args.members.length<r.parameters.length?t.args.members.length:r.parameters.length,i=0;i<e;i++){u=r.parameters[i].getType(),u&&r.hasVariableArgList&&i>=r.nonOptionalParameterCount-1&&(u=u.elementType);switch(t.args.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:this.checker.typeCheckWithContextualType(u,this.checker.inProvisionalTypecheckMode(),!r.parameters[i].declAST.isParenthesized,t.args.members[i]);break;default:continue}}if(!f&&t.args)for(this.checker.killTargetType(),i=0;i<t.args.members.length;i++)switch(t.args.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:this.typeCheck(t.args.members[i]);break;default:continue}},t.prototype.typeCheckCall=function(t){var i=t,e,u,f,r;return this.checker.styleSettings.newMustBeUsed&&t.nodeType==n.NodeType.New?n.hasFlag(t.flags,n.ASTFlags.IsStatement)&&this.checker.errorReporter.styleError(t,"use of new expression as a statement"):this.checker.styleSettings.evalOK||t.nodeType!=n.NodeType.Call||i.target.nodeType==n.NodeType.Name&&i.target.text=="eval"&&this.checker.errorReporter.styleError(i,"eval not permitted"),i.target.nodeType==n.NodeType.FuncDecl&&(i.target.isInlineCallLiteral=!0),e=this.inSuperCall,i.target.nodeType==n.NodeType.Super&&(this.inSuperCall=!0),i.target=this.typeCheck(i.target),this.preTypeCheckCallArgs(i.args),u=i.target,u.type==null||u.type==this.anyType||this.functionInterfaceType&&u.type==this.functionInterfaceType?i.type=this.anyType:(f=u.type,f.call?(r=this.resolveOverload(i,f.call),r==null?i.type=this.anyType:(i.type=r.returnType.type,i.signature=r)):i.target.nodeType==n.NodeType.Super&&this.thisFnc&&this.thisFnc.isConstructor&&n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.ClassMethod)?(r=f.symbol.type.construct?this.resolveOverload(i,f.symbol.type.construct):null,r==null?i.type=this.anyType:(i.flags|=n.ASTFlags.ClassBaseConstructorCall,i.type=r.returnType.type,i.signature=r)):(i.type=this.anyType,this.checker.errorReporter.invalidCall(i,i.nodeType,this.scope))),this.postTypeCheckCallArgs(i),this.inSuperCall=e,i},t.prototype.assignScopes=function(t){var u=t,i,r;this.checker.locationInfo=u.locationInfo,i=new f(null,null,this.globalScope),r=new n.AssignScopeContext(i,this,[this.checker.currentModDecl]),n.getAstWalkerFactory().walk(t,n.preAssignScopes,n.postAssignScopes,null,r)},t.prototype.findMemberScope=function(t,i){var f=t.getScope(),e=t.pos-t.getScriptFragmentPosition(),u=t.getScriptFragment(),r=new n.MemberScopeContext(this,e,i);return r.scope=f,u.nodeType==n.NodeType.Name?u.type.getMemberScope(this):(n.getAstWalkerFactory().walk(u,n.preFindMemberScope,null,null,r),r.ast&&t.enclosingClassDecl&&r.ast.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),r.type?r.type.getMemberScope(this):null)},t.prototype.findMemberScopeAt=function(t){return this.findMemberScope(t,n.ASTFlags.DotLHS)},t.prototype.findMemberScopeAtFullAst=function(t){var u=n.ASTFlags.DotLHS,i=t.pos,r=null,f=function(t,f,e){return n.isValidAstNode(t)&&(n.hasFlag(t.flags,u)&&(i==t.limChar||i-1==t.limChar)&&(r=t,e.options.stopWalk()),e.options.goChildren=t.minChar<=i&&i<=t.limChar),t},e=function(t,f,e){return n.isValidAstNode(t)&&(n.hasFlag(t.flags,u)&&t.minChar<i&&i<=t.limChar&&(r=t),e.options.goChildren=t.minChar<=i&&i<=t.limChar),t};return n.getAstWalkerFactory().walk(t.script,f),r==null&&n.getAstWalkerFactory().walk(t.script,e),r&&t.enclosingClassDecl&&r.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),r&&r.type?r.type.getMemberScope(this):null},t}(),n.TypeFlow=s}(TypeScript||(TypeScript={})),function(n){function h(n,t,i){var r=new e;return r.ast=n,r.type=n==null&&i?t.anyType:null,r}var i,t,u,r,o,f,s,e;(function(n){n._map=[],n.None=0,n.Void=1,n.Double=2,n.String=4,n.Boolean=8,n.Any=16,n.Null=32,n.Undefined=64})(n.Primitive||(n.Primitive={})),i=n.Primitive,t=function(){function n(){this.prefix="",this.suffix=""}return n.prototype.isString=function(){return!1},n.prototype.isArray=function(){return!1},n.prototype.toString=function(){return n.memberNameToString(this)},n.memberNameToString=function(t){var i=t.prefix,r,u;if(t.isString())i+=t.text;else for(r=t,u=0;u<r.entries.length;u++)i+=n.memberNameToString(r.entries[u]),i+=r.delim;return i+=t.suffix},n.create=function(n,t,i){if(typeof n=="string")return new u(n);var f=new r;return t&&(f.prefix=t),i&&(f.suffix=i),f.entries.push(n),f},n}(),n.MemberName=t,u=function(n){function t(t){n.call(this),this.text=t}return __extends(t,n),t.prototype.isString=function(){return!0},t}(t),n.MemberNameString=u,r=function(n){function t(){n.apply(this,arguments),this.delim="",this.entries=[]}return __extends(t,n),t.prototype.isArray=function(){return!0},t.prototype.add=function(n){this.entries.push(n)},t.prototype.addAll=function(n){for(var t=0;t<n.length;t++)this.entries.push(n[t])},t}(t),n.MemberNameArray=r,o=-1,f=function(){function u(){this.typeID=o++,this.construct=null,this.call=null,this.index=null,this.passTypeCreated=n.CompilerDiagnostics.analysisPass,this.primitiveTypeClass=i.None,this.typeFlags=n.TypeFlags.None}return u.prototype.baseClass=function(){return this.extendsList&&this.extendsList.length>0?this.extendsList[0]:null},u.prototype.getArrayBase=function(n,t){return this.arrayCache.specialize(n,t)},u.prototype.isClass=function(){return this.instanceType!=null},u.prototype.isArray=function(){return this.elementType!=null},u.prototype.isClassInstance=function(){return this.symbol&&!this.elementType&&this.symbol.type.isClass()},u.prototype.getInstanceType=function(){return this.isClass()?this.instanceType:this},u.prototype.hasImplementation=function(){return n.hasFlag(this.typeFlags,n.TypeFlags.HasImplementation)},u.prototype.setHasImplementation=function(){this.typeFlags|=n.TypeFlags.HasImplementation},u.prototype.isDouble=function(){return n.hasFlag(this.primitiveTypeClass,i.Double)},u.prototype.isString=function(){return n.hasFlag(this.primitiveTypeClass,i.String)},u.prototype.isBoolean=function(){return n.hasFlag(this.primitiveTypeClass,i.Boolean)},u.prototype.isNull=function(){return n.hasFlag(this.primitiveTypeClass,i.Null)},u.prototype.getTypeName=function(){return this.getMemberTypeName("",!0,!1,null)},u.prototype.getScopedTypeName=function(n){return this.getMemberTypeName("",!0,!1,n)},u.prototype.getScopedTypeNameEx=function(n){return this.getMemberTypeNameEx("",!0,!1,n)},u.prototype.callCount=function(){var n=0;return this.call&&(n+=this.call.signatures.length),this.construct&&(n+=this.construct.signatures.length),this.index&&(n+=this.index.signatures.length),n},u.prototype.getMemberTypeName=function(n,t,i,r){var u=this.getMemberTypeNameEx(n,t,i,r);return u.toString()},u.prototype.getMemberTypeNameEx=function(i,u,f,e){var y,s,o,c,v;if(this.elementType)return t.create(this.elementType.getMemberTypeNameEx(i,!1,!0,e),"","[]");if(this.symbol&&this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||n.hasFlag(this.typeFlags,n.TypeFlags.BuildingName)||this.members&&!this.isClass()))return y=this.symbol.scopeRelativeName(e),t.create(y=="null"?"any":y);if(this.members||this.call||this.construct){if(n.hasFlag(this.typeFlags,n.TypeFlags.BuildingName))return t.create("this");this.typeFlags|=n.TypeFlags.BuildingName;var b="",h=new r,p=f,l=0,w=0,a="; ";if(this.members&&this.members.allMembers.map(function(i,r){var o=r,f,s;n.hasFlag(o.flags,n.SymbolFlags.BuiltIn)||(f=o.getTypeName(e),f.length>=a.length&&f.substring(f.length-a.length)==a&&(f=f.substring(0,f.length-a.length)),h.add(t.create(f)),w++,o.kind()==n.SymbolKind.Type?(s=o.type,s.callCount()>1&&(p=!0)):p=!0)},null),c=0,v=w==0&&this.callCount()==1&&u,v||(h.delim=a),this.call)for(s=this.call.toStrings(i,v,e),o=0,c=s.length;o<c;o++)h.add(t.create(s[o])),l++;if(this.construct)for(s=this.construct.toStrings("new",v,e),o=0,c=s.length;o<c;o++)h.add(t.create(s[o])),l++;if(this.index)for(s=this.index.toStrings("",v,e),o=0,c=s.length;o<c;o++)h.add(t.create(s[o])),l++;return(p||l>1&&u)&&(h.prefix="{ ",h.suffix="}"),this.typeFlags&=~n.TypeFlags.BuildingName,l==0&&w==0?t.create("{}"):h}return t.create("{}")},u.prototype.checkDecl=function(n){(this.isClassInstance()||this.isClass())&&this.symbol.declAST&&n.typeFlow.inScopeTypeCheckDecl(this.symbol.declAST)},u.prototype.getMemberScope=function(n){if(this==n.anyType)return null;if(this.isDouble())return n.numberInterfaceType?n.numberInterfaceType.memberScope:null;if(this.isBoolean())return n.booleanInterfaceType?n.booleanInterfaceType.memberScope:null;if(this==n.stringType)return n.stringInterfaceType?n.stringInterfaceType.memberScope:null;if(this.elementType){if(n.arrayInterfaceType){var t=this.elementType.getArrayBase(n.arrayInterfaceType,n.checker);return t.memberScope}return null}return this.memberScope},u.prototype.isReferenceType=function(){return this.members||this.extendsList||this.construct||this.call||this.index||this.elementType},u.prototype.specializeType=function(t,i,r,f){if(t==this)return i;var e=this;return f?this.isReferenceType()&&(e=new u,this.members&&(e.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.members.publicMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.members.addPublicMember(o.name,o)},null),this.members.privateMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.members.addPrivateMember(o.name,o)},null)),this.ambientMembers&&(e.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.ambientMembers.publicMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.ambientMembers.addPublicMember(o.name,o)},null),this.ambientMembers.privateMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.ambientMembers.addPrivateMember(o.name,o)},null)),e.containedScope=r.scopeOf(e),e.memberScope=e.containedScope):this.elementType?this.elementType==t?e=r.makeArrayType(i):this.elementType.elementType==t&&(e=r.makeArrayType(r.makeArrayType(i))):this.call&&(e=new u,e.call=this.call.specializeType(t,i,r)),e},u.prototype.hasBase=function(n){if(n==this)return!0;if(this.extendsList)for(var t=0,i=this.extendsList.length;t<i;t++)if(this.extendsList[t].hasBase(n))return!0;return!1},u.prototype.mergeOrdered=function(n,t,i){if(this==t.anyType||n==t.anyType)return t.anyType;if(this==n||n==t.nullType&&this!=t.nullType)return this;if(this==t.nullType&&n!=t.nullType)return n;if(n==t.voidType&&this!=t.voidType)return this;if(this==t.voidType&&n!=t.voidType)return n;if(n==t.undefinedType&&this!=t.undefinedType)return this;if(this==t.undefinedType&&n!=t.undefinedType)return n;if(this.elementType&&n.elementType){if(this.elementType==n.elementType)return this;var r=this.elementType.mergeOrdered(n.elementType,t,i);return r==null?t.makeArrayType(t.anyType):t.makeArrayType(r)}return t.sourceIsSubtypeOfTarget(this,n,i)?n:t.sourceIsSubtypeOfTarget(n,this,i)?this:null},u.prototype.isModuleType=function(){return!1},u.prototype.hasMembers=function(){return this.members!=null},u.prototype.getAllEnclosedTypes=function(){return null},u.prototype.getAllAmbientEnclosedTypes=function(){return null},u.prototype.getPublicEnclosedTypes=function(){return null},u.prototype.getpublicAmbientEnclosedTypes=function(){return null},u}(),n.Type=f,s=function(n){function t(t,i){n.call(this),this.enclosedTypes=t,this.ambientEnclosedTypes=i,this.importedModules=[]}return __extends(t,n),t.prototype.isModuleType=function(){return!0},t.prototype.hasMembers=function(){return this.members!=null||this.enclosedTypes!=null},t.prototype.getAllEnclosedTypes=function(){return this.enclosedTypes},t.prototype.getAllAmbientEnclosedTypes=function(){return this.ambientEnclosedTypes},t.prototype.getPublicEnclosedTypes=function(){return null},t.prototype.getpublicAmbientEnclosedTypes=function(){return null},t}(f),n.ModuleType=s,e=function(){function n(){this.type=null,this.ast=null}return n}(),n.TypeLink=e,n.getTypeLink=h}(TypeScript||(TypeScript={})),function(n){function t(n){return n.replace('"',"").replace("'","").replace("'","").replace('"',"")}function nt(n){return n.indexOf('"')!=-1||n.indexOf("'")!=-1||n.indexOf("'")!=-1||n.indexOf('"')!=-1}function f(n){return'"'+n+'"'}function g(n){return n.indexOf('"')!=-1?(n=n.replace('"',"'"),n=n.replace('"',"'")):(n=n.replace("'",'"'),n=n.replace("'",'"')),n}function r(n){return n.replace(/\\/g,"/")}function i(n){return n.length>6&&n.substring(n.length-6,n.length)==".d.str"?n.substring(0,n.length-6):n.length>4&&n.substring(n.length-4,n.length)==".str"?n.substring(0,n.length-4):n.length>5&&n.substring(n.length-5,n.length)==".d.ts"?n.substring(0,n.length-5):n.length>3&&n.substring(n.length-3,n.length)==".ts"?n.substring(0,n.length-3):n.length>3&&n.substring(n.length-3,n.length)==".js"?n.substring(0,n.length-3):n}function d(n){return n.length>4&&n.substring(n.length-4,n.length)==".str"}function k(n){return n.length>3&&n.substring(n.length-3,n.length)==".ts"}function b(n){return n.length>6&&n.substring(n.length-6,n.length)==".d.str"}function w(n){return n.length>5&&n.substring(n.length-5,n.length)==".d.ts"}function y(n,u,e){typeof u=="undefined"&&(u=!0),typeof e=="undefined"&&(e=!1);var s=e?r(n):i(t(n)),o=s.split("/");return o.length?u?f(o[o.length-1]):o[o.length-1]:n}function p(n){var u=i(t(n)),e=o(u),r,s;return e==""?n:(r=u.split(e),s=r.length>1?1:0,f(r[s]))}function tt(n){return i(t(n))+".str"}function v(n){return i(t(n))+".d.str"}function a(n){return i(t(n))+".ts"}function l(n){return i(t(n))+".d.ts"}function c(n){return n.charAt(0)=="."}function h(n){return n.charAt(0)=="\\"||n.charAt(0)=="/"||n.indexOf(":\\")!=-1||n.indexOf(":/")!=-1}function o(n){if(n=="")return n;var t=n.indexOf("/")!=-1;return t?e(n):""}function e(n){n=r(n);var t=n.split("/"),i=t.slice(0,t.length-1);return i.join("/")+"/"}function s(n){var f=/^(https?:\/\/[\-\w\.]+(:\d+)?\/)(.*)$/i,t=f.exec(n),i,r;return t?(i=t[1],r=t[3],i+u(r)):u(n)}function u(n){var u,i,t;for(n=r(n),u=n.charAt(0)==="/",i=n.split("/"),t=0;t<i.length;t++)(i[t]==="."||i[t]==="")&&(i.splice(t,1),t--),t>0&&i[t]===".."&&i[t-1]!==".."&&(i.splice(t-1,2),t-=2);return(u?"/":"")+i.join("/")}function it(n){return u(n)}n.stripQuotes=t,n.isQuoted=nt,n.quoteStr=f,n.swapQuotes=g,n.switchToForwardSlashes=r,n.trimModName=i,n.isSTRFile=d,n.isTSFile=k,n.isDSTRFile=b,n.isDTSFile=w,n.getPrettyName=y,n.quoteBaseName=p,n.changePathToSTR=tt,n.changePathToDSTR=v,n.changePathToTS=a,n.changePathToDTS=l,n.isRelative=c,n.isRooted=h,n.getRootFilePath=o,n.filePath=e,n.normalizeURL=s,n.pathNormalizeRegExp=/\//g,n.normalizePath=u,n.normalizeImportPath=it}(TypeScript||(TypeScript={})),function(n){var t=function(){function n(n,t){this.path=n,this.content=t}return n.prototype.getText=function(n,t){return this.content.substring(n,t)},n.prototype.getLength=function(){return this.content.length},n}(),i,r;n.SourceUnit=t,i=function(){function n(n,t){this.compilationSettings=n,this.ioHost=t,this.residentCode=[],this.code=[]}return n}(),n.CompilationEnvironment=i,r=function(){function i(n){this.environment=n,this.visited={}}return i.prototype.resolveCode=function(i,r,u,f){var o={content:"",path:i},s=this.environment.ioHost,v=n.isRelative(i),w=v?!1:n.isRooted(i),e=v?s.resolvePath(r+"/"+i):w||!r||u?i:r+"/"+i,l,c,h;if(n.isSTRFile(e)||n.isTSFile(e)||(e+=".ts"),e=n.switchToForwardSlashes(n.stripQuotes(e)),l=this.environment.compilationSettings.useCaseSensitiveFileResolution?e:e.toLocaleUpperCase(),!this.visited[l]){if(v||w||!u)try{n.CompilerDiagnostics.debugPrint("   Reading code from "+e);try{o.content=s.readFile(e)}catch(b){try{n.isSTRFile(e)?e=n.changePathToTS(e):n.isTSFile(e)&&(e=n.changePathToSTR(e)),n.CompilerDiagnostics.debugPrint("   Reading code from "+e),o.content=s.readFile(e)}catch(b){e=n.changePathToDSTR(e),n.CompilerDiagnostics.debugPrint("   Reading code from "+e);try{o.content=s.readFile(e)}catch(b){e=n.changePathToDTS(e),n.CompilerDiagnostics.debugPrint("   Reading code from "+e),o.content=s.readFile(e)}}}n.CompilerDiagnostics.debugPrint("   Found code at "+e),o.path=e,this.visited[l]=!0}catch(b){n.CompilerDiagnostics.debugPrint("   Did not find code for "+i)}else o=s.findFile(r,e),o||(n.isSTRFile(e)?e=n.changePathToTS(e):n.isTSFile(e)&&(e=n.changePathToSTR(e)),o=s.findFile(r,e)),o||(e=n.changePathToDTS(e),o=s.findFile(r,e),o||(e=n.changePathToDSTR(e),o=s.findFile(r,e))),o?(o.path=n.switchToForwardSlashes(n.stripQuotes(o.path)),n.CompilerDiagnostics.debugPrint(i+" resolved to: "+o.path),o.content=o.content,this.visited[l]=!0):n.CompilerDiagnostics.debugPrint("Could not find "+i);if(o&&o.content){var y=s.dirName(o.path),p=new t(o.path,o.content),a=n.preProcessFile(p,this.environment.compilationSettings);for(h=0;h<a.referencedFiles.length;h++){if(c=a.referencedFiles[h],e=n.isRooted(c.path)?c.path:y+"/"+c.path,e=s.resolvePath(e),i==e){f.postResolutionError(e,"File contains reference to itself",null);continue}this.resolveCode(c.path,y,!1,f)}for(h=0;h<a.importedFiles.length;h++)this.resolveCode(a.importedFiles[h].path,y,!0,f);f.postResolution(p.path,p)}}},i}(),n.CodeResolver=r}(TypeScript||(TypeScript={})),function(n){function u(t){var f=/^(\/\/\/\s*<reference\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,i=f.exec(t);if(i){var r=n.normalizePath(i[3]),e=n.normalizePath(r),u=i.length>=7&&i[6]=="true";return u&&n.CompilerDiagnostics.debugPrint(r+" is resident"),{minChar:0,limChar:0,path:n.switchToForwardSlashes(e),isResident:u}}return null}function f(n){var r=/^(\/\/\/\s*<amd-dependency\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,t=r.exec(n),i;return t?i=t[3]:null}function r(n,t){var o=/^(\/\/\/\s*<style\s+)(([a-zA-Z])+=('|").+('|"))\s*\/>/igm,u=o.exec(n),e,f,i,r;if(u&&(e=/^([a-zA-Z]+=['"]on['|"])/igm,u=e.exec(u[2]),u))for(f=0;f<u.length;f++){i=u[f].split("="),r='"on"';switch(i[0]){case"blockInCompoundStmt":t.blockInCompoundStmt=i[1]==r;break;case"eqeqeq":t.eqeqeq=i[1]==r;break;case"forin":t.forin=i[1]==r;break;case"emptyBlocks":t.emptyBlocks=i[1]==r;break;case"newMustBeUsed":t.newMustBeUsed=i[1]==r;break;case"requireSemi":t.requireSemi=i[1]==r;break;case"assignmentInCond":t.assignmentInCond=i[1]==r;break;case"eqnull":t.eqnull=i[1]==r;break;case"evalOK":t.evalOK=i[1]==r;break;case"innerScopeDeclEscape":t.innerScopeDeclEscape=i[1]==r;break;case"funcInLoop":t.funcInLoop=i[1]==r;break;case"reDeclareLocal":t.reDeclareLocal=i[1]==r;break;case"literalSubscript":t.literalSubscript=i[1]==r;break;case"implicitAny":t.implicitAny=i[1]==r}}}function e(i,f){var o,k,c,h,d,a;typeof f=="undefined"&&(f=new t),o=new n.Scanner,o.resetComments(),o.setSourceText(i,n.LexMode.File);for(var e=o.scan(),l=[],s=null,v=[],y=f,p=[],w=[],b=!1;e.tokenId!=n.TokenID.EOF;)e.tokenId==n.TokenID.IMPORT&&(e=o.scan(),(e.tokenId==n.TokenID.ID||n.convertTokToID(e,!1))&&(e=o.scan(),e.tokenId==n.TokenID.Asg&&(e=o.scan(),e.tokenId==n.TokenID.MODULE&&(e=o.scan(),e.tokenId==n.TokenID.LParen&&(e=o.scan(),e.tokenId==n.TokenID.QString&&(k={minChar:o.startPos,limChar:o.pos,path:n.stripQuotes(n.switchToForwardSlashes(e.getText())),isResident:!1},w.push(k))))))),e.tokenId==n.TokenID.LCurly&&v.push(e),e.tokenId==n.TokenID.RCurly&&v.pop(),e=o.scan();for(l=o.getComments(),c=0;c<l.length;c++)s=l[c],s.isBlock||(h=u(s.getText()),h&&(h.minChar=s.startPos,h.limChar=h.minChar+s.value.length,p.push(h)),r(s.getText(),y.styleSettings),d=/^(\/\/\/\s*<reference\s+no-default-lib=)('|")(.+?)\2\s*\/>/igm,a=d.exec(s.getText()),a&&(b=a[3]=="true"));return{settings:y,referencedFiles:p,importedFiles:w,isLibFile:b}}var i=function(){function n(){this.bitwise=!1,this.blockInCompoundStmt=!1,this.eqeqeq=!1,this.forin=!1,this.emptyBlocks=!0,this.newMustBeUsed=!1,this.requireSemi=!1,this.assignmentInCond=!1,this.eqnull=!1,this.evalOK=!0,this.innerScopeDeclEscape=!0,this.funcInLoop=!0,this.reDeclareLocal=!0,this.literalSubscript=!0,this.implicitAny=!1}return n.prototype.setOption=function(n,t){var i=this[n];return i!==undefined?(this[n]=t,!0):!1},n.prototype.parseOptions=function(n){for(var u=n.split(";"),o,i=0,f=u.length;i<f;i++){var t=u[i],e=!0,r=t.lastIndexOf(":");if(r>=0&&(o=t.substring(r+1),t=t.substring(0,r),o=="off"&&(e=!1)),!this.setOption(t,e))return!1}return!0},n}(),t;n.StyleSettings=i,t=function(){function t(){this.styleSettings=new i,this.propagateConstants=!1,this.minWhitespace=!1,this.parseOnly=!1,this.outputMany=!0,this.errorRecovery=!1,this.emitComments=!1,this.watch=!1,this.exec=!1,this.resolve=!0,this.controlFlow=!1,this.printControlFlow=!1,this.controlFlowUseDef=!1,this.errorOnWith=!0,this.preprocess=!0,this.canCallDefinitionSignature=!1,this.inferPropertiesFromThisAssignment=!1,this.useDefaultLib=!0,this.codeGenTarget=n.CodeGenTarget.ES3,this.moduleGenTarget=n.ModuleGenTarget.Synchronous,this.outputFileName="",this.errorFileName="",this.mapSourceFiles=!1,this.generateDeclarationFiles=!1,this.useCaseSensitiveFileResolution=!1}return t.prototype.setStyleOptions=function(n){this.styleSettings.parseOptions(n)},t.prototype.outputOne=function(n){this.outputFileName=n,this.outputMany=!1},t}(),n.CompilationSettings=t,n.getAdditionalDependencyPath=f,n.getStyleSettings=r,n.preProcessFile=e}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(t){this.logger=t,this.astLogger=new n.AstLogger(this.logger)}return t.prototype.getEnclosingScopeContextIfSingleScopeEdit=function(t,i,r,u){var f,e,o;if(this.logger.log('checkEditsInsideSingleScope("'+i+'")'),u===null)throw new Error("editRange should be valid");return u.isUnknown()?(this.logger.log("  Bailing out because edit range is unknown"),null):(f=n.findEnclosingScopeAt(this.logger,t,r,u.minChar,!1),e=n.findEnclosingScopeAt(this.logger,t,r,u.limChar,!1),f==null||e==null)?(this.logger.log("  Bailing out because containing scopes cannot be determined"),null):f.scopeStartAST!==e.scopeStartAST?(this.logger.log("  Bailing out because edit overlaps 2 disctint scopes"),null):(o=f.scopeStartAST.limChar-f.scopeStartAST.minChar+u.delta,o<=0)?(this.logger.log("  Bailing out because scope has been entirely removed from new source text"),null):f},t.prototype.attemptIncrementalUpdateUnit=function(t,i,r,u){var f,s,h,e,o;if(this.logger.log('attemptIncrementalUpdateUnit("'+i+'")'),u===null)throw new Error("editRange should be valid");if(f=this.getEnclosingScopeContextIfSingleScopeEdit(t,i,r,u),f===null)return null;if(s=f.scopeStartAST.limChar-f.scopeStartAST.minChar+u.delta,s>=r.getLength()/2)return this.logger.log("  Bailing out because range of scope to reparse ("+s+" characters) is greater than half the size of the source text"),null;var c=[],a=function(t,i,r,u){c.push(new n.ErrorEntry(u,t,t+i,r))},l=n.quickParse(this.logger,f.scopeStartAST,r,f.scopeStartAST.minChar,f.scopeStartAST.minChar+s,a);return l.endLexState!=n.LexState.Start?(this.logger.log("  Bailing out because scope contains unterminated comment"),null):(h=l.Script,h.vars.members.length!==0)?(this.logger.log("  Bailing out because new source text defines variables"),null):h.bod.members.length!==1?(this.logger.log("  Bailing out because new source text defines more than one scope (or none)"),null):(e=f.scopeStartAST,o=h.bod.members[0],e.nodeType!=o.nodeType)?(this.logger.log("  Bailing out because new source text does not define the same scope type as the existing scope"),null):!e.leftCurlyCount||!e.rightCurlyCount?(this.logger.log("  Bailing out because sopce doesn't have left/right curly count"),null):e.leftCurlyCount!==o.leftCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) left curly braces"),null):e.rightCurlyCount!==o.rightCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) right curly braces"),null):o.minChar!==0?(this.logger.log("  Bailing out because new function declaration does not start at position 0"),null):o.limChar!==s?(this.logger.log("  Bailing out because new function declaration does not end at the new end position"),null):n.UpdateUnitResult.singleScopeEdits(t,h,e,o,u,c)},t.prototype.mergeTrees=function(t){var i=this;n.timeFunction(this.logger,"mergeTrees()",function(){var r=new n.ScriptEditRange(t.scope1.minChar,t.scope1.limChar,t.editRange.delta);i.applyDeltaPosition(t.script1,r.limChar,r.delta),i.applyDeltaPosition(t.script2,0,r.minChar),i.mergeLocationInfo(t.script1,t.script2,r),i.replaceAST(t.script1,t.scope1,t.scope2)})},t.prototype.replaceAST=function(t,i,r){var u=this,f=function(t,f,e){return t===i?(r.preComments=t.preComments,r.postComments=t.postComments,u.logger.log("replaced old AST node with new one in script AST"),e.options.stopWalk(),r):(n.isValidAstNode(t)&&(t.limChar<i.minChar||t.minChar>i.limChar)&&(e.options.goChildren=!1),t)};n.getAstWalkerFactory().walk(t,f)},t.prototype.mergeLocationInfo=function(n,t,i){var u=n.locationInfo.lineMap,e=t.locationInfo.lineMap;this.logger.information()&&(this.logger.log("lineMap1 (before):"),this.astLogger.logLinemap(u),this.logger.log("lineMap2 (quick parse):"),this.astLogger.logLinemap(e),this.logger.log("EditRange="+i));for(var r=2,f=2,o=u.length,s=e.length;r<o||f<s;)r<o?u[r]<=i.minChar?r++:u[r]>=i.limChar?(u[r]+=i.delta,r++):f<s?(u.splice(r,0,e[f]+i.minChar),r++,o++,f++):(u.splice(r,1),o--):(u.push(e[f]+i.minChar),f++);this.logger.information()&&(this.logger.log("lineMap1 (after merge):"),this.astLogger.logLinemap(u))},t.prototype.applyDeltaPosition=function(t,i,r){var u=function(n){n.minChar!==-1&&n.minChar>=i&&(n.minChar+=r),n.limChar!==-1&&n.limChar>=i&&(n.limChar+=r)},f=function(n){if(n&&n.length>0)for(var t=0;t<n.length;t++)u(n[t])},e=function(n,t,r){return n.limChar!==-1&&n.limChar<i&&(r.options.goChildren=!1),u(n),f(n.preComments),f(n.postComments),n};n.getAstWalkerFactory().walk(t,e)},t}();n.IncrementalParser=t}(TypeScript||(TypeScript={})),function(n){var t,f,i,u,e,r,o;(function(n){n._map=[],n._map[0]="Unknown",n.Unknown=0,n._map[1]="NoEdits",n.NoEdits=1,n._map[2]="EditsInsideSingleScope",n.EditsInsideSingleScope=2})(n.UpdateUnitKind||(n.UpdateUnitKind={})),t=n.UpdateUnitKind,f=function(){function n(n,t,i){this.minChar=n,this.limChar=t,this.delta=i}return n.unknown=function(){return new n(-1,-1,-1)},n.prototype.isUnknown=function(){return this.minChar===-1&&this.limChar===-1&&this.delta===-1},n.prototype.containsPosition=function(n){return this.minChar<=n&&n<this.limChar||this.minChar<=n&&n<this.limChar+this.delta},n.prototype.toString=function(){return"editRange(minChar="+this.minChar+", limChar="+this.limChar+", delta="+this.delta+")"},n}(),n.ScriptEditRange=f,i=function(){function n(n,t,i,r){this.kind=n,this.unitIndex=t,this.script1=i,this.script2=r,this.scope1=null,this.scope2=null,this.editRange=null,this.parseErrors=[]}return n.noEdits=function(i){return new n(t.NoEdits,i,null,null)},n.unknownEdits=function(i,r,u){var f=new n(t.Unknown,i.locationInfo.unitIndex,i,r);return f.parseErrors=u,f},n.singleScopeEdits=function(i,r,u,f,e,o){var s=new n(t.EditsInsideSingleScope,i.locationInfo.unitIndex,i,r);return s.scope1=u,s.scope2=f,s.editRange=e,s.parseErrors=o,s},n}(),n.UpdateUnitResult=i,u=function(){function n(n,t,i,r){this.unitIndex=n,this.minChar=t,this.limChar=i,this.message=r}return n}(),n.ErrorEntry=u,n.defaultSettings=new n.CompilationSettings,e=function(){function r(t,i,r,u){typeof r=="undefined"&&(r=new n.NullLogger),typeof u=="undefined"&&(u=n.defaultSettings),this.outfile=t,this.errorOutput=i,this.logger=r,this.settings=u,this.parser=new n.Parser,this.typeFlow=null,this.scripts=new n.ASTList,this.units=[],this.errorReporter=new n.ErrorReporter(this.outfile),this.persistentTypeState=new n.PersistentGlobalTypeState(this.errorReporter),this.errorReporter.parser=this.parser,this.initTypeChecker(this.errorOutput),this.parser.style_requireSemi=this.settings.styleSettings.requireSemi,this.parser.style_funcInLoop=this.settings.styleSettings.funcInLoop,this.parser.inferPropertiesFromThisAssignment=this.settings.inferPropertiesFromThisAssignment,this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany},n.codeGenTarget=u.codeGenTarget}return r.prototype.timeFunction=function(t,i){return n.timeFunction(this.logger,t,i)},r.prototype.initTypeChecker=function(){this.persistentTypeState.refreshPersistentState(),this.typeChecker=new n.TypeChecker(this.persistentTypeState),this.typeChecker.errorReporter=this.errorReporter,this.typeChecker.checkControlFlow=this.settings.controlFlow,this.typeChecker.checkControlFlowUseDef=this.settings.controlFlowUseDef,this.typeChecker.printControlFlowGraph=this.settings.printControlFlow,this.typeChecker.errorsOnWith=this.settings.errorOnWith,this.typeChecker.styleSettings=this.settings.styleSettings,this.typeChecker.canCallDefinitionSignature=this.settings.canCallDefinitionSignature,this.errorReporter.checker=this.typeChecker,this.setErrorOutput(this.errorOutput)},r.prototype.setErrorOutput=function(n){this.errorOutput=n,this.errorReporter.setErrOut(n),this.parser.outfile=n},r.prototype.emitCommentsToOutput=function(){this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany}},r.prototype.setErrorCallback=function(n){this.parser.errorCallback=n},r.prototype.updateUnit=function(t,i,r){return this.updateSourceUnit(new n.StringSourceText(t),i,r)},r.prototype.updateSourceUnit=function(n,t,i){var r=this;return this.timeFunction("updateSourceUnit("+t+")",function(){var u=r.partialUpdateUnit(n,t,i);return r.applyUpdateResult(u)})},r.prototype.applyUpdateResult=function(i){var u,f,r;switch(i.kind){case t.NoEdits:return!1;case t.Unknown:for(this.scripts.members[i.unitIndex]=i.script2,this.units[i.unitIndex]=i.script2.locationInfo,u=0,f=i.parseErrors.length;u<f;u++)r=i.parseErrors[u],this.parser.errorCallback&&this.parser.errorCallback(r.minChar,r.limChar-r.minChar,r.message,r.unitIndex);return!0;case t.EditsInsideSingleScope:return new n.IncrementalParser(this.logger).mergeTrees(i),!0}},r.prototype.partialUpdateUnit=function(n,t,r){var f=this;return this.timeFunction("partialUpdateUnit("+t+")",function(){for(var l,a,e=0,s=f.units.length;e<s;e++)if(f.units[e].filename==t){if(f.scripts.members[e].isResident)return i.noEdits(e);r&&f.parser.setErrorRecovery(null,0,0);var h,c=[],v=function(n,t,i,r){c.push(new u(r,n,n+t,i))},o=f.parser.errorCallback;return o&&(f.parser.errorCallback=v),l=f.scripts.members[e],a=f.parser.parse(n,t,e),o&&(f.parser.errorCallback=o),h=i.unknownEdits(l,a,c)}throw new Error('Unknown file "'+t+'"');})},r.prototype.addUnit=function(t,i,r){return typeof r=="undefined"&&(r=!1),this.addSourceUnit(new n.StringSourceText(t),i,r)},r.prototype.addSourceUnit=function(t,i,r){typeof r=="undefined"&&(r=!1);var u=this;return this.timeFunction("addSourceUnit("+i+", "+r+")",function(){var f=u.parser.parse(t,i,u.units.length,n.AllowedElements.Global),e;return f.isResident=r,u.persistentTypeState.setCollectionMode(r?n.TypeCheckCollectionMode.Resident:n.TypeCheckCollectionMode.Transient),e=u.units.length,u.units[e]=f.locationInfo,u.typeChecker.collectTypes(f),u.scripts.append(f),f})},r.prototype.parseUnit=function(t,i){return this.parseSourceUnit(new n.StringSourceText(t),i)},r.prototype.parseSourceUnit=function(t,i){this.parser.setErrorRecovery(this.outfile,-1,-1);var r=this.parser.parse(t,i,0),u=new n.PrintContext(this.outfile,this.parser);n.getAstWalkerFactory().walk(r,n.prePrintAST,n.postPrintAST,null,u)},r.prototype.typeCheck=function(){var t=this;return this.timeFunction("typeCheck()",function(){var f=new n.Binder(t.typeChecker);t.typeChecker.units=t.units,f.bind(t.typeChecker.globalScope,t.typeChecker.globals),f.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobals),f.bind(t.typeChecker.globalScope,t.typeChecker.globalTypes),f.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobalTypes),t.typeFlow=new n.TypeFlow(t.logger,t.typeChecker.globalScope,t.parser,t.typeChecker);var i=0,r=null,u=t.scripts.members.length;for(t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Resident),i=0;i<u;i++)(r=t.scripts.members[i],r.isResident&&!r.hasBeenTypeChecked)&&(t.typeFlow.assignScopes(r),t.typeFlow.initLibs());for(i=0;i<u;i++)(r=t.scripts.members[i],r.isResident&&!r.hasBeenTypeChecked)&&(t.typeFlow.typeCheck(r),r.hasBeenTypeChecked=!0);for(t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Transient),u=t.scripts.members.length,i=0;i<u;i++)(r=t.scripts.members[i],r.isResident)||(t.typeFlow.assignScopes(r),t.typeFlow.initLibs());for(i=0;i<u;i++)(r=t.scripts.members[i],r.isResident)||t.typeFlow.typeCheck(r);return null})},r.prototype.cleanASTTypesForReTypeCheck=function(t){function i(t){var u,f,e,r,o;return t.type=null,t.nodeType==n.NodeType.VarDecl?(u=t,u.sym=null):t.nodeType==n.NodeType.ArgDecl?(f=t,f.sym=null):t.nodeType==n.NodeType.Name?(e=t,e.sym=null):t.nodeType==n.NodeType.FuncDecl?(r=t,r.signature=null,r.freeVariables=[],r.symbols=null,r.accessorSymbol=null,r.scopeType=null):t.nodeType==n.NodeType.Module?(o=t,o.mod=null):t.nodeType==n.NodeType.With?t.withSym=null:t.nodeType==n.NodeType.Catch&&(t.containedScope=null),t}n.getAstWalkerFactory().walk(t,i)},r.prototype.cleanTypesForReTypeCheck=function(){var n=this;return this.timeFunction("cleanTypesForReTypeCheck()",function(){for(var i,t=0,r=n.scripts.members.length;t<r;t++)(i=n.scripts.members[t],i.isResident)||(n.cleanASTTypesForReTypeCheck(i),n.typeChecker.collectTypes(i));return null})},r.prototype.attemptIncrementalTypeCheck=function(){return this.timeFunction("attemptIncrementalTypeCheck()",function(){return!1})},r.prototype.reTypeCheck=function(){var t=this;return this.timeFunction("reTypeCheck()",function(){return n.CompilerDiagnostics.analysisPass++,t.initTypeChecker(t.errorOutput),t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Transient),t.cleanTypesForReTypeCheck(),t.typeCheck()})},r.prototype.emit=function(t,i){var r=null,o,l,e,s,u,c,a,h,v,f;for(this.emitSettings.createFile=i,o=0,l=this.scripts.members.length;o<l;o++)(e=this.scripts.members[o],e.emitRequired())&&(s=this.outfile,t?(u=this.units[o].filename,c=u.split("."),c.pop(),a=c.join("."),h=a+".js",this.emitSettings.path=h,s=i(h),r=new n.Emitter(this.typeChecker,s,this.emitSettings),this.settings.mapSourceFiles&&r.setSourceMappings(new n.SourceMapper(u,h,s,i(h+n.SourceMapper.MapFileExtension))),this.settings.generateDeclarationFiles&&(v=n.isSTRFile(u)?n.changePathToDSTR(u):n.isTSFile(u)?n.changePathToDTS(u):n.changePathToDTS(u),r.setDeclarationFile(i(v)))):r==null?(r=new n.Emitter(this.typeChecker,this.outfile,this.emitSettings),this.settings.mapSourceFiles&&r.setSourceMappings(new n.SourceMapper(e.locationInfo.filename,this.settings.outputFileName,this.outfile,i(this.settings.outputFileName+n.SourceMapper.MapFileExtension))),this.settings.generateDeclarationFiles&&(f=this.settings.outputFileName,f=n.isSTRFile(f)?n.changePathToDSTR(f):n.isTSFile(f)?n.changePathToDTS(f):n.changePathToDTS(f),r.setDeclarationFile(i(f)))):this.settings.mapSourceFiles&&r.setSourceMappings(new n.SourceMapper(e.locationInfo.filename,r.sourceMapper.jsFileName,this.outfile,r.sourceMapper.sourceMapOut)),this.typeChecker.locationInfo=e.locationInfo,r.emitJavascript(e,n.TokenID.Comma,!1,r.canWriteDeclFile()),t&&(this.settings.mapSourceFiles&&r.emitSourceMappings(),this.settings.generateDeclarationFiles&&r.declFile.Close(),s.Close()));t||(this.settings.mapSourceFiles&&r.emitSourceMappings(),this.settings.generateDeclarationFiles&&r.declFile.Close())},r.prototype.emitToOutfile=function(){var i=null,t,u,r;if(this.settings.mapSourceFiles)throw Error("Cannot generate source map");if(this.settings.generateDeclarationFiles)throw Error("Cannot generate declaration files");for(t=0,u=this.scripts.members.length;t<u;t++)i==null&&(i=new n.Emitter(this.typeChecker,this.outfile,this.emitSettings)),r=this.scripts.members[t],this.typeChecker.locationInfo=r.locationInfo,i.emitJavascript(r,n.TokenID.Comma,!1)},r}(),n.TypeScriptCompiler=e,r=function(){function n(n,t,i){this.name=n,this.type=t,this.sym=i}return n}(),n.ScopeEntry=r,o=function(){function t(n){this.compiler=n}return t.prototype.getScope=function(n){return n.enclosingObjectLit&&n.isMemberCompletion?n.getObjectLiteralScope():n.isMemberCompletion?n.useFullAst?this.compiler.typeFlow.findMemberScopeAtFullAst(n):this.compiler.typeFlow.findMemberScopeAt(n):n.getScope()},t.prototype.getScopeEntries=function(t){var u=this.getScope(t),f,e,r,i,o,s;if(u==null)return[];for(f=new n.StringHashTable,e=u.getAllSymbolNames(t.isMemberCompletion),r=0;r<e.length;r++)(i=e[r],i!=n.globalId&&i!="_Core"&&i!="_element")&&f.add(i,"");return o=this.compiler.typeChecker.currentModDecl,this.compiler.typeChecker.currentModDecl=t.deepestModuleDecl,s=this.getTypeNamesForNames(t,f.getAllKeys(),u),this.compiler.typeChecker.currentModDecl=o,s},t.prototype.getTypeNamesForNames=function(t,i,u){for(var s=[],a=t.getScope(),c,l,o=0;o<i.length;o++){var e=i[o],h=t.publicsOnly&&t.isMemberCompletion,f=u.find(e,h,!1);f==null&&(f=u.find(e,h,!0)),c=f&&f.flags&n.SymbolFlags.Private?f.container==u.container:!0,f?!c||n.isQuoted(f.name)||n.isRelative(f.name)||(l=f.getType().getScopedTypeName(a),s.push(new r(e,l,f))):(e=="true"||e=="false")&&s.push(new r(e,"bool",this.compiler.typeChecker.booleanType.symbol))}return s},t}(),n.ScopeTraversal=o}(TypeScript||(TypeScript={})),function(n){function f(n,t,i){var r=+new Date,u=i(),f=+new Date;return n.log(t+" completed in "+(f-r)+" msec"),u}function e(n,t){var r="",u=function(t){var i=n.charCodeAt(t);switch(i){case 9:r+="\\t";break;case 10:r+="\\n";break;case 11:r+="\\v";break;case 12:r+="\\f";break;case 13:r+="\\r";break;case 34:r+='\\"';break;case 39:r+="\\'";break;case 92:r+="\\";break;default:r+=n.charAt(t)}},e=n.length>t,f,i;if(e){for(f=t>>1,i=0;i<f;i++)u(i);for(r+="(...)",i=n.length-f;i<n.length;i++)u(i)}else for(t=n.length,i=0;i<t;i++)u(i);return r}var u,t,i,r;(function(n){function t(t){n.diagnosticWriter&&n.diagnosticWriter.Alert(t)}function i(i){n.debug&&t(i)}function r(i,r){n.debug&&(i||t(r))}n.debug=!1,n.diagnosticWriter=null,n.analysisPass=0,n.Alert=t,n.debugPrint=i,n.assert=r})(n.CompilerDiagnostics||(n.CompilerDiagnostics={})),u=n.CompilerDiagnostics,t=function(){function n(){}return n.prototype.information=function(){return!1},n.prototype.debug=function(){return!1},n.prototype.warning=function(){return!1},n.prototype.error=function(){return!1},n.prototype.fatal=function(){return!1},n.prototype.log=function(){},n}(),n.NullLogger=t,i=function(){function n(n){this.logger=n,this._information=this.logger.information(),this._debug=this.logger.debug(),this._warning=this.logger.warning(),this._error=this.logger.error(),this._fatal=this.logger.fatal()}return n.prototype.information=function(){return this._information},n.prototype.debug=function(){return this._debug},n.prototype.warning=function(){return this._warning},n.prototype.error=function(){return this._error},n.prototype.fatal=function(){return this._fatal},n.prototype.log=function(n){this.logger.log(n)},n}(),n.LoggerAdapter=i,r=function(){function n(){this.logContents=[]}return n.prototype.information=function(){return!1},n.prototype.debug=function(){return!1},n.prototype.warning=function(){return!1},n.prototype.error=function(){return!1},n.prototype.fatal=function(){return!1},n.prototype.log=function(n){this.logContents.push(n)},n}(),n.BufferedLogger=r,n.timeFunction=f,n.stringToLiteral=e}(TypeScript||(TypeScript={}));