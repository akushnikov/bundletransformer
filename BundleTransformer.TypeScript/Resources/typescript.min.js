var __extends,JSON2,TypeScript;(function(n){function r(n,t){return(n&t)!=0}function y(n){return n}function b(n,t){for(var r="",u,i=1;i<-2147483648;i=i<<1)if((t&i)!=0)for(u in n)if(n[u]==i){r.length>0&&(r+="|"),r+=u;break}return r}var u,f,e,o,s,h,c,l,a,v,p,w,t,i;n.hasFlag=r,function(n){n._map=[],n.None=0,n.Comma=1,n.SColon=2,n.Asg=4,n.BinOp=8,n.RBrack=16,n.RCurly=32,n.RParen=64,n.Dot=128,n.Colon=256,n.PrimType=512,n.AddOp=1024,n.LCurly=2048,n.PreOp=4096,n.RegExp=8192,n.LParen=16384,n.LBrack=32768,n.Scope=65536,n.In=131072,n.SCase=262144,n.Else=524288,n.Catch=1048576,n.Var=2097152,n.Stmt=4194304,n.While=8388608,n.ID=16777216,n.Prefix=33554432,n.Literal=67108864,n.RLit=134217728,n.Func=268435456,n.EOF=536870912,n.TypeScriptS=1073741824,n.ExprStart=n.SColon|n.AddOp|n.LCurly|n.PreOp|n.RegExp|n.LParen|n.LBrack|n.ID|n.Prefix|n.RLit|n.Func|n.Literal,n.StmtStart=n.ExprStart|n.SColon|n.Var|n.Stmt|n.While|n.TypeScriptS,n.Postfix=n.Dot|n.LParen|n.LBrack}(n.ErrorRecoverySet||(n.ErrorRecoverySet={})),u=n.ErrorRecoverySet,function(n){n._map=[],n.None=0,n.ModuleDeclarations=4,n.ClassDeclarations=8,n.InterfaceDeclarations=16,n.AmbientDeclarations=1024,n.Properties=2048,n.Global=n.ModuleDeclarations|n.ClassDeclarations|n.InterfaceDeclarations|n.AmbientDeclarations,n.QuickParse=n.Global|n.Properties}(n.AllowedElements||(n.AllowedElements={})),f=n.AllowedElements,function(n){n._map=[],n.None=0,n.Private=1,n.Public=2,n.Readonly=4,n.Ambient=8,n.Exported=16,n.Getter=32,n.Setter=64,n.Static=128}(n.Modifiers||(n.Modifiers={})),e=n.Modifiers,function(n){n._map=[],n.None=0,n.ExplicitSemicolon=1,n.AutomaticSemicolon=2,n.Writeable=4,n.Error=8,n.DotLHSPartial=16,n.DotLHS=32,n.IsStatement=64,n.StrictMode=128,n.PossibleOptionalParameter=256,n.ClassBaseConstructorCall=512,n.OptionalName=1024,n.SkipNextRParen=2048}(n.ASTFlags||(n.ASTFlags={})),o=n.ASTFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128}(n.DeclFlags||(n.DeclFlags={})),s=n.DeclFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.IsEnum=256,n.ShouldEmitModuleDecl=512,n.IsWholeFile=1024,n.IsDynamic=2048,n.MustCaptureThis=4096}(n.ModuleFlags||(n.ModuleFlags={})),h=n.ModuleFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.Property=256,n.Readonly=512,n.ModuleMember=1024,n.InterfaceMember=2048,n.ClassMember=4096,n.BuiltIn=8192,n.TypeSetDuringScopeAssignment=16384,n.Constant=32768,n.Optional=65536,n.RecursivelyReferenced=131072,n.Bound=262144,n.CompilerGenerated=524288}(n.SymbolFlags||(n.SymbolFlags={})),c=n.SymbolFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.AutoInit=256,n.Property=512,n.Readonly=1024,n.Class=2048,n.ClassProperty=4096,n.ClassBodyProperty=8192,n.ClassConstructorProperty=16384,n.ClassSuperMustBeFirstCallInConstructor=32768,n.Constant=65536,n.MustCaptureThis=131072}(n.VarFlags||(n.VarFlags={})),l=n.VarFlags,function(n){n._map=[],n.None=0,n.Exported=1,n.Private=2,n.Public=4,n.Ambient=8,n.Static=16,n.LocalStatic=32,n.GetAccessor=64,n.SetAccessor=128,n.Definition=256,n.Signature=512,n.Method=1024,n.HasReturnExpression=2048,n.CallMember=4096,n.ConstructMember=8192,n.HasSelfReference=16384,n.IsFatArrowFunction=32768,n.IndexerMember=65536,n.IsFunctionExpression=131072,n.ClassMethod=262144,n.ClassPropertyMethodExported=524288,n.HasSuperReferenceInFatArrowFunction=1048576,n.IsPropertyBound=2097152}(n.FncFlags||(n.FncFlags={})),a=n.FncFlags,function(n){n._map=[],n.None=0,n.IsIndexer=1,n.IsStringIndexer=2,n.IsNumberIndexer=4}(n.SignatureFlags||(n.SignatureFlags={})),v=n.SignatureFlags,n.ToDeclFlags=y,function(n){n._map=[],n.None=0,n.HasImplementation=1,n.HasSelfReference=2,n.MergeResult=4,n.IsEnum=8,n.BuildingName=16,n.HasBaseType=32,n.HasBaseTypeOfObject=64,n.IsClass=128}(n.TypeFlags||(n.TypeFlags={})),p=n.TypeFlags,function(n){n._map=[],n.SuccessfulComparison=0,n.SourceIsNullTargetIsVoidOrUndefined=1,n.RequiredPropertyIsMissing=2,n.IncompatibleSignatures=4,n.SourceSignatureHasTooManyParameters=3,n.IncompatibleReturnTypes=16,n.IncompatiblePropertyTypes=32,n.IncompatibleParameterTypes=64}(n.TypeRelationshipFlags||(n.TypeRelationshipFlags={})),w=n.TypeRelationshipFlags,function(n){n._map=[],n.ES3=0,n.ES5=1}(n.CodeGenTarget||(n.CodeGenTarget={})),t=n.CodeGenTarget,function(n){n._map=[],n.Synchronous=0,n.Asynchronous=1,n.Local=2}(n.ModuleGenTarget||(n.ModuleGenTarget={})),i=n.ModuleGenTarget,n.codeGenTarget=t.ES3,n.moduleGenTarget=i.Synchronous,n.optimizeModuleCodeGen=!0,n.flagsToString=b})(TypeScript||(TypeScript={})),function(n){(function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="Empty",n.Empty=1,n._map[2]="EmptyExpr",n.EmptyExpr=2,n._map[3]="True",n.True=3,n._map[4]="False",n.False=4,n._map[5]="This",n.This=5,n._map[6]="Super",n.Super=6,n._map[7]="QString",n.QString=7,n._map[8]="Regex",n.Regex=8,n._map[9]="Null",n.Null=9,n._map[10]="ArrayLit",n.ArrayLit=10,n._map[11]="ObjectLit",n.ObjectLit=11,n._map[12]="Void",n.Void=12,n._map[13]="Comma",n.Comma=13,n._map[14]="Pos",n.Pos=14,n._map[15]="Neg",n.Neg=15,n._map[16]="Delete",n.Delete=16,n._map[17]="Await",n.Await=17,n._map[18]="In",n.In=18,n._map[19]="Dot",n.Dot=19,n._map[20]="From",n.From=20,n._map[21]="Is",n.Is=21,n._map[22]="InstOf",n.InstOf=22,n._map[23]="Typeof",n.Typeof=23,n._map[24]="NumberLit",n.NumberLit=24,n._map[25]="Name",n.Name=25,n._map[26]="TypeRef",n.TypeRef=26,n._map[27]="Index",n.Index=27,n._map[28]="Call",n.Call=28,n._map[29]="New",n.New=29,n._map[30]="Asg",n.Asg=30,n._map[31]="AsgAdd",n.AsgAdd=31,n._map[32]="AsgSub",n.AsgSub=32,n._map[33]="AsgDiv",n.AsgDiv=33,n._map[34]="AsgMul",n.AsgMul=34,n._map[35]="AsgMod",n.AsgMod=35,n._map[36]="AsgAnd",n.AsgAnd=36,n._map[37]="AsgXor",n.AsgXor=37,n._map[38]="AsgOr",n.AsgOr=38,n._map[39]="AsgLsh",n.AsgLsh=39,n._map[40]="AsgRsh",n.AsgRsh=40,n._map[41]="AsgRs2",n.AsgRs2=41,n._map[42]="ConditionalExpression",n.ConditionalExpression=42,n._map[43]="LogOr",n.LogOr=43,n._map[44]="LogAnd",n.LogAnd=44,n._map[45]="Or",n.Or=45,n._map[46]="Xor",n.Xor=46,n._map[47]="And",n.And=47,n._map[48]="Eq",n.Eq=48,n._map[49]="Ne",n.Ne=49,n._map[50]="Eqv",n.Eqv=50,n._map[51]="NEqv",n.NEqv=51,n._map[52]="Lt",n.Lt=52,n._map[53]="Le",n.Le=53,n._map[54]="Gt",n.Gt=54,n._map[55]="Ge",n.Ge=55,n._map[56]="Add",n.Add=56,n._map[57]="Sub",n.Sub=57,n._map[58]="Mul",n.Mul=58,n._map[59]="Div",n.Div=59,n._map[60]="Mod",n.Mod=60,n._map[61]="Lsh",n.Lsh=61,n._map[62]="Rsh",n.Rsh=62,n._map[63]="Rs2",n.Rs2=63,n._map[64]="Not",n.Not=64,n._map[65]="LogNot",n.LogNot=65,n._map[66]="IncPre",n.IncPre=66,n._map[67]="DecPre",n.DecPre=67,n._map[68]="IncPost",n.IncPost=68,n._map[69]="DecPost",n.DecPost=69,n._map[70]="TypeAssertion",n.TypeAssertion=70,n._map[71]="FuncDecl",n.FuncDecl=71,n._map[72]="Member",n.Member=72,n._map[73]="VarDecl",n.VarDecl=73,n._map[74]="ArgDecl",n.ArgDecl=74,n._map[75]="Return",n.Return=75,n._map[76]="Break",n.Break=76,n._map[77]="Continue",n.Continue=77,n._map[78]="Throw",n.Throw=78,n._map[79]="For",n.For=79,n._map[80]="ForIn",n.ForIn=80,n._map[81]="If",n.If=81,n._map[82]="While",n.While=82,n._map[83]="DoWhile",n.DoWhile=83,n._map[84]="Block",n.Block=84,n._map[85]="Case",n.Case=85,n._map[86]="Switch",n.Switch=86,n._map[87]="Try",n.Try=87,n._map[88]="TryCatch",n.TryCatch=88,n._map[89]="TryFinally",n.TryFinally=89,n._map[90]="Finally",n.Finally=90,n._map[91]="Catch",n.Catch=91,n._map[92]="List",n.List=92,n._map[93]="Script",n.Script=93,n._map[94]="ClassDeclaration",n.ClassDeclaration=94,n._map[95]="InterfaceDeclaration",n.InterfaceDeclaration=95,n._map[96]="ModuleDeclaration",n.ModuleDeclaration=96,n._map[97]="ImportDeclaration",n.ImportDeclaration=97,n._map[98]="With",n.With=98,n._map[99]="Label",n.Label=99,n._map[100]="LabeledStatement",n.LabeledStatement=100,n._map[101]="EBStart",n.EBStart=101,n._map[102]="GotoEB",n.GotoEB=102,n._map[103]="EndCode",n.EndCode=103,n._map[104]="Error",n.Error=104,n._map[105]="Comment",n.Comment=105,n._map[106]="Debugger",n.Debugger=106,n.GeneralNode=n.FuncDecl,n.LastAsg=n.AsgRs2})(n.NodeType||(n.NodeType={}));var t=n.NodeType}(TypeScript||(TypeScript={})),function(n){function o(n){var t=668265261;return n=n^61^n>>>16,n=n+(n<<3),n=n^n>>>4,n=n*t,n=n^n>>>15}function s(n,t){return t^(n>>5)+n}var i=function(){function n(){this.prototype=undefined,this.toString=undefined,this.toLocaleString=undefined,this.valueOf=undefined,this.hasOwnProperty=undefined,this.propertyIsEnumerable=undefined,this.isPrototypeOf=undefined,this.constructor=undefined}return n}(),r,u,t,f,e;n.BlockIntrinsics=i,r=function(){function n(){this.itemCount=0,this.table=new i}return n.prototype.getAllKeys=function(){var n=[],t;for(t in this.table)this.table[t]!=undefined&&(n[n.length]=t);return n},n.prototype.add=function(n,t){return this.table[n]!=undefined?!1:(this.table[n]=t,this.itemCount++,!0)},n.prototype.addOrUpdate=function(n,t){return this.table[n]!=undefined?(this.table[n]=t,!1):(this.table[n]=t,this.itemCount++,!0)},n.prototype.map=function(n,t){var i,r;for(i in this.table)r=this.table[i],r!=undefined&&n(i,this.table[i],t)},n.prototype.every=function(n,t){var i,r;for(i in this.table)if(r=this.table[i],r!=undefined&&!n(i,this.table[i],t))return!1;return!0},n.prototype.some=function(n,t){var i,r;for(i in this.table)if(r=this.table[i],r!=undefined&&n(i,this.table[i],t))return!0;return!1},n.prototype.count=function(){return this.itemCount},n.prototype.lookup=function(n){var t=this.table[n];return t!=undefined?t:null},n}(),n.StringHashTable=r,u=function(){function n(n,t){this.primaryTable=n,this.secondaryTable=t,this.insertPrimary=!0}return n.prototype.getAllKeys=function(){return this.primaryTable.getAllKeys().concat(this.secondaryTable.getAllKeys())},n.prototype.add=function(n,t){return this.insertPrimary?this.primaryTable.add(n,t):this.secondaryTable.add(n,t)},n.prototype.addOrUpdate=function(n,t){return this.insertPrimary?this.primaryTable.addOrUpdate(n,t):this.secondaryTable.addOrUpdate(n,t)},n.prototype.map=function(n,t){this.primaryTable.map(n,t),this.secondaryTable.map(n,t)},n.prototype.every=function(n,t){return this.primaryTable.every(n,t)&&this.secondaryTable.every(n,t)},n.prototype.some=function(n,t){return this.primaryTable.some(n,t)||this.secondaryTable.some(n,t)},n.prototype.count=function(){return this.primaryTable.count()+this.secondaryTable.count()},n.prototype.lookup=function(n){var t=this.primaryTable.lookup(n);return t!=undefined?t:this.secondaryTable.lookup(n)},n}(),n.DualStringHashTable=u,n.numberHashFn=o,n.combineHashes=s,t=function(){function n(n,t){this.key=n,this.data=t}return n}(),n.HashEntry=t,f=function(){function n(n,t,i){this.size=n,this.hashFn=t,this.equalsFn=i,this.itemCount=0,this.table=[];for(var r=0;r<this.size;r++)this.table[r]=null}return n.prototype.add=function(n,i){for(var f=new t(n,i),r=this.hashFn(n),r=r%this.size,u=this.table[r];u!=null;u=u.next)if(this.equalsFn(n,u.key))return!1;return f.next=this.table[r],this.table[r]=f,this.itemCount++,!0},n.prototype.remove=function(n){var t,i=this.hashFn(n),u,r;for(i=i%this.size,u=null,r=null,t=this.table[i];t!=null;t=t.next){if(this.equalsFn(n,t.key)){u=t.data,this.itemCount--,r?r.next=t.next:this.table[i]=t.next;break}r=t}return u},n.prototype.count=function(){return this.itemCount},n.prototype.lookup=function(n){for(var i=this.hashFn(n),i=i%this.size,t=this.table[i];t!=null;t=t.next)if(this.equalsFn(n,t.key))return t.data;return null},n}(),n.HashTable=f,e=function(){function n(){this.keys=[],this.values=[]}return n.prototype.lookup=function(n,t){var r=this.keys,i;for(t&&(r=this.values),i=0;i<r.length;i++)if(r[i]==n)return{key:this.keys[i],data:this.values[i]};return null},n.prototype.add=function(n,t){var i=this.lookup(n);return i?!1:(this.keys[this.keys.length]=n,this.values[this.values.length]=t,!0)},n}(),n.SimpleHashTable=e}(TypeScript||(TypeScript={})),__extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},function(n){var u=function(){function n(){this.minChar=-1,this.limChar=-1}return n}(),i,a,v,f,y,p,r,w,b,k,d,g,nt,tt,e,it,o,rt,ut,ft,c,l,et,s,ot,h,st,ht,t,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi;n.ASTSpan=u,i=function(t){function i(i){t.call(this),this.nodeType=i,this.type=null,this.flags=n.ASTFlags.Writeable,this.passCreated=n.CompilerDiagnostics.analysisPass,this.preComments=null,this.postComments=null,this.docComments=null,this.isParenthesized=!1}return __extends(i,t),i.prototype.isExpression=function(){return!1},i.prototype.isStatementOrExpression=function(){return!1},i.prototype.isCompoundStatement=function(){return!1},i.prototype.isLeaf=function(){return this.isStatementOrExpression()&&!this.isCompoundStatement()},i.prototype.isDeclaration=function(){return!1},i.prototype.typeCheck=function(t){switch(this.nodeType){case n.NodeType.Error:case n.NodeType.EmptyExpr:this.type=t.anyType;break;case n.NodeType.This:return t.typeCheckThis(this);case n.NodeType.Null:this.type=t.nullType;break;case n.NodeType.False:case n.NodeType.True:this.type=t.booleanType;break;case n.NodeType.Super:return t.typeCheckSuper(this);case n.NodeType.EndCode:case n.NodeType.Empty:case n.NodeType.Void:this.type=t.voidType;break;default:throw new Error("please implement in derived class");}return this},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0);switch(this.nodeType){case n.NodeType.This:t.recordSourceMappingStart(this),t.thisFnc&&n.hasFlag(t.thisFnc.fncFlags,n.FncFlags.IsFatArrowFunction)?t.writeToOutput("_this"):t.writeToOutput("this"),t.recordSourceMappingEnd(this);break;case n.NodeType.Null:t.recordSourceMappingStart(this),t.writeToOutput("null"),t.recordSourceMappingEnd(this);break;case n.NodeType.False:t.recordSourceMappingStart(this),t.writeToOutput("false"),t.recordSourceMappingEnd(this);break;case n.NodeType.True:t.recordSourceMappingStart(this),t.writeToOutput("true"),t.recordSourceMappingEnd(this);break;case n.NodeType.Super:t.recordSourceMappingStart(this),t.emitSuperReference(),t.recordSourceMappingEnd(this);break;case n.NodeType.EndCode:case n.NodeType.Error:case n.NodeType.EmptyExpr:break;case n.NodeType.Empty:t.recordSourceMappingStart(this),t.recordSourceMappingEnd(this);break;case n.NodeType.Void:t.recordSourceMappingStart(this),t.writeToOutput("void "),t.recordSourceMappingEnd(this);break;default:throw new Error("please implement in derived class");}t.emitParensAndCommentsInPlace(this,!1)},i.prototype.print=function(t){var i,r,u;t.startLine(),i={line:-1,col:-1},r={line:-1,col:-1},t.parser!==null&&(t.parser.getSourceLineCol(i,this.minChar),t.parser.getSourceLineCol(r,this.limChar),t.write("("+i.line+","+i.col+")--("+r.line+","+r.col+"): ")),u=this.printLabel(),n.hasFlag(this.flags,n.ASTFlags.Error)&&(u+=" (Error)"),t.writeLine(u)},i.prototype.printLabel=function(){return n.nodeTypeTable[this.nodeType]!==undefined?n.nodeTypeTable[this.nodeType]:n.NodeType._map[this.nodeType]},i.prototype.addToControlFlow=function(n){n.walker.options.goChildren=!1,n.addContent(this)},i.prototype.netFreeUses=function(){},i.prototype.treeViewLabel=function(){return n.NodeType._map[this.nodeType]},i.getResolvedIdentifierName=function(n){var u;if(!n)return"";for(var i="",r=0,t=0;t<=n.length-6;){if(n.charAt(t)=="\\"&&n.charAt(t+1)=="u"){u=parseInt(n.substr(t+2,4),16),i+=n.substr(r,t-r),i+=String.fromCharCode(u),t+=6,r=t;continue}t++}return i+=n.substring(r)},i.prototype.getDocComments=function(){var r,t,n,i;if(!this.isDeclaration()||!this.preComments||this.preComments.length==0)return[];if(!this.docComments){for(r=this.preComments.length,t=[],n=r-1;n>=0;n--){if(this.preComments[n].isDocComment()&&(i=t.length>0?t[t.length-1]:null,i==null||this.preComments[n].limLine==i.minLine||this.preComments[n].limLine+1==i.minLine)){t.push(this.preComments[n]);continue}break}this.docComments=t.reverse()}return this.docComments},i}(u),n.AST=i,a=function(t){function i(i,r){t.call(this,n.NodeType.Error),this.minChar=i,this.limChar=r}return __extends(i,t),i}(i),n.IncompleteAST=a,v=function(t){function i(){t.call(this,n.NodeType.List),this.enclosingScope=null,this.members=[]}return __extends(i,t),i.prototype.addToControlFlow=function(n){for(var i=this.members.length,t=0;t<i;t++)if(n.noContinuation){n.addUnreachable(this.members[t]);break}else this.members[t]=n.walk(this.members[t],this);n.walker.options.goChildren=!1},i.prototype.append=function(n){return this.members[this.members.length]=n,this},i.prototype.appendAll=function(t){var r,i,u;if(t.nodeType==n.NodeType.List)for(r=t,i=0,u=r.members.length;i<u;i++)this.append(r.members[i]);else this.append(t);return this},i.prototype.emit=function(t,i,r){t.recordSourceMappingStart(this),t.emitJavascriptList(this,null,n.TokenID.Semicolon,r,!1,!1),t.recordSourceMappingEnd(this)},i.prototype.typeCheck=function(n){var i=this.members.length,t;for(n.nestingLevel++,t=0;t<i;t++)this.members[t]&&(this.members[t]=this.members[t].typeCheck(n));return n.nestingLevel--,this},i}(i),n.ASTList=v,f=function(t){function r(i,r){t.call(this,n.NodeType.Name),this.actualText=i,this.hasEscapeSequence=r,this.sym=null,this.cloId=-1,this.setText(i,r)}return __extends(r,t),r.prototype.setText=function(n,t){this.actualText=n,this.text=t?i.getResolvedIdentifierName(n):n},r.prototype.isMissing=function(){return!1},r.prototype.isLeaf=function(){return!0},r.prototype.treeViewLabel=function(){return"id: "+this.actualText},r.prototype.printLabel=function(){return this.actualText?"id: "+this.actualText:"name node"},r.prototype.typeCheck=function(n){return n.typeCheckName(this)},r.prototype.emit=function(n){n.emitJavascriptName(this,!0)},r.fromToken=function(n){return new r(n.getText(),n.hasEscapeSequence)},r}(i),n.Identifier=f,y=function(n){function t(){n.call(this,"__missing")}return __extends(t,n),t.prototype.isMissing=function(){return!0},t.prototype.emit=function(){},t}(f),n.MissingIdentifier=y,p=function(t){function i(i){t.call(this,n.NodeType.Label),this.id=i}return __extends(i,t),i.prototype.printLabel=function(){return this.id.actualText+":"},i.prototype.typeCheck=function(n){return this.type=n.voidType,this},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.recordSourceMappingStart(this.id),n.writeToOutput(this.id.actualText),n.recordSourceMappingEnd(this.id),n.writeLineToOutput(":"),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(i),n.Label=p,r=function(n){function t(t){n.call(this,t)}return __extends(t,n),t.prototype.isExpression=function(){return!0},t.prototype.isStatementOrExpression=function(){return!0},t}(i),n.Expression=r,w=function(t){function i(n,i){t.call(this,n),this.operand=i,this.targetType=null,this.castTerm=null}return __extends(i,t),i.prototype.addToControlFlow=function(i){t.prototype.addToControlFlow.call(this,i),this.nodeType==n.NodeType.Throw&&i.returnStmt()},i.prototype.typeCheck=function(t){switch(this.nodeType){case n.NodeType.Not:return t.typeCheckBitNot(this);case n.NodeType.LogNot:return t.typeCheckLogNot(this);case n.NodeType.Pos:case n.NodeType.Neg:return t.typeCheckUnaryNumberOperator(this);case n.NodeType.IncPost:case n.NodeType.IncPre:case n.NodeType.DecPost:case n.NodeType.DecPre:return t.typeCheckIncOrDec(this);case n.NodeType.ArrayLit:return t.typeCheckArrayLit(this),this;case n.NodeType.ObjectLit:return t.typeCheckObjectLit(this),this;case n.NodeType.Throw:return this.operand=t.typeCheck(this.operand),this.type=t.voidType,this;case n.NodeType.Typeof:return this.operand=t.typeCheck(this.operand),this.type=t.stringType,this;case n.NodeType.Delete:this.operand=t.typeCheck(this.operand),this.type=t.booleanType;break;case n.NodeType.TypeAssertion:this.castTerm=t.typeCheck(this.castTerm);var i=!this.operand.isParenthesized,r=i?this.castTerm.type:null;return t.checker.typeCheckWithContextualType(r,t.checker.inProvisionalTypecheckMode(),!0,this.operand),t.castWithCoercion(this.operand,this.castTerm.type,!1,!0),this.type=this.castTerm.type,this;case n.NodeType.Void:this.operand=t.typeCheck(this.operand),this.type=t.checker.undefinedType;break;default:throw new Error("please implement in derived class");}return this},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);switch(this.nodeType){case n.NodeType.IncPost:t.emitJavascript(this.operand,n.TokenID.PlusPlus,!1),t.writeToOutput("++");break;case n.NodeType.LogNot:t.writeToOutput("!"),t.emitJavascript(this.operand,n.TokenID.Exclamation,!1);break;case n.NodeType.DecPost:t.emitJavascript(this.operand,n.TokenID.MinusMinus,!1),t.writeToOutput("--");break;case n.NodeType.ObjectLit:t.emitObjectLiteral(this.operand);break;case n.NodeType.ArrayLit:t.emitArrayLiteral(this.operand);break;case n.NodeType.Not:t.writeToOutput("~"),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Neg:t.writeToOutput("-"),this.operand.nodeType==n.NodeType.Neg&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,n.TokenID.Minus,!1);break;case n.NodeType.Pos:t.writeToOutput("+"),this.operand.nodeType==n.NodeType.Pos&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,n.TokenID.Plus,!1);break;case n.NodeType.IncPre:t.writeToOutput("++"),t.emitJavascript(this.operand,n.TokenID.PlusPlus,!1);break;case n.NodeType.DecPre:t.writeToOutput("--"),t.emitJavascript(this.operand,n.TokenID.MinusMinus,!1);break;case n.NodeType.Throw:t.writeToOutput("throw "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1),t.writeToOutput(";");break;case n.NodeType.Typeof:t.writeToOutput("typeof "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Delete:t.writeToOutput("delete "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.Void:t.writeToOutput("void "),t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;case n.NodeType.TypeAssertion:t.emitJavascript(this.operand,n.TokenID.Tilde,!1);break;default:throw new Error("please implement in derived class");}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(r),n.UnaryExpression=w,b=function(t){function i(n,i,r){t.call(this,n),this.target=i,this.arguments=r,this.signature=null,this.minChar=this.target.minChar}return __extends(i,t),i.prototype.typeCheck=function(t){return this.nodeType==n.NodeType.New?t.typeCheckNew(this):t.typeCheckCall(this)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nodeType==n.NodeType.New?t.emitNew(this.target,this.arguments):t.emitCall(this,this.target,this.arguments),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(r),n.CallExpression=b,k=function(t){function i(n,i,r){t.call(this,n),this.operand1=i,this.operand2=r}return __extends(i,t),i.prototype.typeCheck=function(t){switch(this.nodeType){case n.NodeType.Dot:return t.typeCheckDotOperator(this);case n.NodeType.Asg:return t.typeCheckAsgOperator(this);case n.NodeType.Add:case n.NodeType.Sub:case n.NodeType.Mul:case n.NodeType.Div:case n.NodeType.Mod:case n.NodeType.Or:case n.NodeType.And:return t.typeCheckArithmeticOperator(this,!1);case n.NodeType.Xor:return t.typeCheckBitwiseOperator(this,!1);case n.NodeType.Ne:case n.NodeType.Eq:var i;t.checker.styleSettings.eqeqeq?(i=n.nodeTypeTable[this.nodeType],t.checker.errorReporter.styleError(this,"use of "+i)):t.checker.styleSettings.eqnull&&(i=n.nodeTypeTable[this.nodeType],this.operand2!==null&&this.operand2.nodeType==n.NodeType.Null&&t.checker.errorReporter.styleError(this,"use of "+i+" to compare with null"));case n.NodeType.Eqv:case n.NodeType.NEqv:case n.NodeType.Lt:case n.NodeType.Le:case n.NodeType.Ge:case n.NodeType.Gt:return t.typeCheckBooleanOperator(this);case n.NodeType.Index:return t.typeCheckIndex(this);case n.NodeType.Member:return this.type=t.voidType,this;case n.NodeType.LogOr:return t.typeCheckLogOr(this);case n.NodeType.LogAnd:return t.typeCheckLogAnd(this);case n.NodeType.AsgAdd:case n.NodeType.AsgSub:case n.NodeType.AsgMul:case n.NodeType.AsgDiv:case n.NodeType.AsgMod:case n.NodeType.AsgOr:case n.NodeType.AsgAnd:return t.typeCheckArithmeticOperator(this,!0);case n.NodeType.AsgXor:return t.typeCheckBitwiseOperator(this,!0);case n.NodeType.Lsh:case n.NodeType.Rsh:case n.NodeType.Rs2:return t.typeCheckShift(this,!1);case n.NodeType.AsgLsh:case n.NodeType.AsgRsh:case n.NodeType.AsgRs2:return t.typeCheckShift(this,!0);case n.NodeType.Comma:return t.typeCheckCommaOperator(this);case n.NodeType.InstOf:return t.typeCheckInstOf(this);case n.NodeType.In:return t.typeCheckInOperator(this);case n.NodeType.From:t.checker.errorReporter.simpleError(this,"Illegal use of 'from' keyword in binary expression");break;default:throw new Error("please implement in derived class");}return this},i.prototype.emit=function(t){var u=n.nodeTypeToTokTable[this.nodeType],f;if(t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),u!=undefined)t.emitJavascript(this.operand1,u,!1),n.tokenTable[u].text=="instanceof"?t.writeToOutput(" instanceof "):n.tokenTable[u].text=="in"?t.writeToOutput(" in "):t.writeToOutputTrimmable(" "+n.tokenTable[u].text+" "),t.emitJavascript(this.operand2,u,!1);else switch(this.nodeType){case n.NodeType.Dot:t.tryEmitConstant(this)||(t.emitJavascript(this.operand1,n.TokenID.Dot,!1),t.writeToOutput("."),t.emitJavascriptName(this.operand2,!1));break;case n.NodeType.Index:t.emitIndex(this.operand1,this.operand2);break;case n.NodeType.Member:this.operand2.nodeType==n.NodeType.FuncDecl&&this.operand2.isAccessor()?(f=this.operand2,n.hasFlag(f.fncFlags,n.FncFlags.GetAccessor)?t.writeToOutput("get "):t.writeToOutput("set "),t.emitJavascript(this.operand1,n.TokenID.Colon,!1)):(t.emitJavascript(this.operand1,n.TokenID.Colon,!1),t.writeToOutputTrimmable(": ")),t.emitJavascript(this.operand2,n.TokenID.Comma,!1);break;case n.NodeType.Comma:t.emitJavascript(this.operand1,n.TokenID.Comma,!1),t.emitState.inObjectLiteral?t.writeLineToOutput(", "):t.writeToOutput(","),t.emitJavascript(this.operand2,n.TokenID.Comma,!1);break;case n.NodeType.Is:throw new Error("should be de-sugared during type check");default:throw new Error("please implement in derived class");}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(r),n.BinaryExpression=k,d=function(t){function i(i,r,u){t.call(this,n.NodeType.ConditionalExpression),this.operand1=i,this.operand2=r,this.operand3=u}return __extends(i,t),i.prototype.typeCheck=function(n){return n.typeCheckQMark(this)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.operand1,n.TokenID.Question,!1),t.writeToOutput(" ? "),t.emitJavascript(this.operand2,n.TokenID.Question,!1),t.writeToOutput(" : "),t.emitJavascript(this.operand3,n.TokenID.Question,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i}(r),n.ConditionalExpression=d,g=function(t){function i(i,r){t.call(this,n.NodeType.NumberLit),this.value=i,this.hasEmptyFraction=r,this.isNegativeZero=!1}return __extends(i,t),i.prototype.typeCheck=function(n){return this.type=n.doubleType,this},i.prototype.treeViewLabel=function(){return"num: "+this.printLabel()},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),this.isNegativeZero&&n.writeToOutput("-"),n.writeToOutput(this.value.toString()),this.hasEmptyFraction&&n.writeToOutput(".0"),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.printLabel=function(){return Math.floor(this.value)!=this.value?this.value.toFixed(2).toString():this.hasEmptyFraction?this.value.toString()+".0":this.value.toString()},i}(r),n.NumberLiteral=g,nt=function(t){function i(i){t.call(this,n.NodeType.Regex),this.regex=i}return __extends(i,t),i.prototype.typeCheck=function(n){return this.type=n.regexType,this},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeToOutput(this.regex.toString()),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(r),n.RegexLiteral=nt,tt=function(t){function i(i){t.call(this,n.NodeType.QString),this.text=i}return __extends(i,t),i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.emitStringLiteral(this.text),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.type=n.stringType,this},i.prototype.treeViewLabel=function(){return"st: "+this.text},i.prototype.printLabel=function(){return this.text},i}(r),n.StringLiteral=tt,e=function(n){function t(t){n.call(this,t)}return __extends(t,n),t}(i),n.ModuleElement=e,it=function(t){function i(i,r){t.call(this,n.NodeType.ImportDeclaration),this.id=i,this.alias=r,this.varFlags=n.VarFlags.None,this.isDynamicImport=!1}return __extends(i,t),i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isDeclaration=function(){return!0},i.prototype.emit=function(t){var e=this.alias.type,u,f;this.isDynamicImport&&(!this.id.sym||this.id.sym.onlyReferencedAsTypeRef)||(u=t.modAliasId,f=t.firstModAlias,t.recordSourceMappingStart(this),t.emitParensAndCommentsInPlace(this,!0),t.writeToOutput("var "+this.id.actualText+" = "),t.modAliasId=this.id.actualText,t.firstModAlias=this.firstAliasedModToString(),t.emitJavascript(this.alias,n.TokenID.Tilde,!1),this.isDynamicImport||t.writeToOutput(";"),t.emitParensAndCommentsInPlace(this,!1),t.recordSourceMappingEnd(this),t.modAliasId=u,t.firstModAlias=f)},i.prototype.typeCheck=function(n){return n.typeCheckImportDecl(this)},i.prototype.getAliasName=function(t){if(typeof t=="undefined"&&(t=this.alias),t.nodeType==n.NodeType.Name)return t.actualText;var i=t;return this.getAliasName(i.operand1)+"."+this.getAliasName(i.operand2)},i.prototype.firstAliasedModToString=function(){if(this.alias.nodeType==n.NodeType.Name)return this.alias.actualText;var t=this.alias,i=t.operand1;return i.actualText},i}(e),n.ImportDeclaration=it,o=function(t){function i(i,r,u){t.call(this,r),this.id=i,this.nestingLevel=u,this.init=null,this.typeExpr=null,this.varFlags=n.VarFlags.None,this.sym=null}return __extends(i,t),i.prototype.isDeclaration=function(){return!0},i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isPrivate=function(){return n.hasFlag(this.varFlags,n.VarFlags.Private)},i.prototype.isPublic=function(){return n.hasFlag(this.varFlags,n.VarFlags.Public)},i.prototype.isProperty=function(){return n.hasFlag(this.varFlags,n.VarFlags.Property)},i.prototype.typeCheck=function(n){return n.typeCheckBoundDecl(this)},i.prototype.printLabel=function(){return this.treeViewLabel()},i}(i),n.BoundDecl=o,rt=function(t){function i(i,r){t.call(this,i,n.NodeType.VarDecl,r)}return __extends(i,t),i.prototype.isAmbient=function(){return n.hasFlag(this.varFlags,n.VarFlags.Ambient)},i.prototype.isExported=function(){return n.hasFlag(this.varFlags,n.VarFlags.Exported)},i.prototype.isStatic=function(){return n.hasFlag(this.varFlags,n.VarFlags.Static)},i.prototype.emit=function(n,t){n.emitJavascriptVarDecl(this,t)},i.prototype.treeViewLabel=function(){return"var "+this.id.actualText},i}(o),n.VarDecl=rt,ut=function(t){function i(i){t.call(this,i,n.NodeType.ArgDecl,0),this.isOptional=!1,this.parameterPropertySym=null}return __extends(i,t),i.prototype.isOptionalArg=function(){return this.isOptional||this.init},i.prototype.treeViewLabel=function(){return"arg: "+this.id.actualText},i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeToOutput(this.id.actualText),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(o),n.ArgDecl=ut,ft=0,c=function(t){function i(i,r,u,f,e,o,s,h){t.call(this,h),this.name=i,this.bod=r,this.isConstructor=u,this.arguments=f,this.vars=e,this.scopes=o,this.statics=s,this.hint=null,this.fncFlags=n.FncFlags.None,this.returnTypeAnnotation=null,this.variableArgList=!1,this.jumpRefs=null,this.internalNameCache=null,this.tmp1Declared=!1,this.enclosingFnc=null,this.freeVariables=[],this.unitIndex=-1,this.classDecl=null,this.boundToProperty=null,this.isOverload=!1,this.innerStaticFuncs=[],this.isTargetTypedAsMethod=!1,this.isInlineCallLiteral=!1,this.accessorSymbol=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.returnStatementsWithExpressions=[],this.scopeType=null,this.endingToken=null}return __extends(i,t),i.prototype.isDeclaration=function(){return!0},i.prototype.internalName=function(){if(this.internalNameCache==null){var n=this.getNameText();this.internalNameCache=n?"_internal_"+n:"_internal_"+ft++}return this.internalNameCache},i.prototype.hasSelfReference=function(){return n.hasFlag(this.fncFlags,n.FncFlags.HasSelfReference)},i.prototype.setHasSelfReference=function(){this.fncFlags|=n.FncFlags.HasSelfReference},i.prototype.hasSuperReferenceInFatArrowFunction=function(){return n.hasFlag(this.fncFlags,n.FncFlags.HasSuperReferenceInFatArrowFunction)},i.prototype.setHasSuperReferenceInFatArrowFunction=function(){this.fncFlags|=n.FncFlags.HasSuperReferenceInFatArrowFunction},i.prototype.addCloRef=function(n,t){this.envids==null&&(this.envids=[]),this.envids[this.envids.length]=n;var i=this.enclosingFnc;if(t)while(i&&i.type.symbol!=t.container)i.addJumpRef(t),i=i.enclosingFnc;return this.envids.length-1},i.prototype.addJumpRef=function(n){this.jumpRefs==null&&(this.jumpRefs=[]);var t=new f(n.name);this.jumpRefs[this.jumpRefs.length]=t,t.sym=n,t.cloId=this.addCloRef(t,null)},i.prototype.buildControlFlow=function(){var r=new n.BasicBlock,u=new n.BasicBlock,t=new n.ControlFlowContext(r,u),f=function(n,t,i){return n.addToControlFlow(i.state),n},i=n.getAstWalkerFactory().getWalker(f,null,null,t);return t.walker=i,i.walk(this.bod,this),t},i.prototype.typeCheck=function(n){return n.typeCheckFunction(this)},i.prototype.emit=function(n){n.emitJavascriptFunction(this)},i.prototype.getNameText=function(){return this.name?this.name.actualText:this.hint},i.prototype.isMethod=function(){return(this.fncFlags&n.FncFlags.Method)!=n.FncFlags.None},i.prototype.isCallMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.CallMember)},i.prototype.isConstructMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.ConstructMember)},i.prototype.isIndexerMember=function(){return n.hasFlag(this.fncFlags,n.FncFlags.IndexerMember)},i.prototype.isSpecialFn=function(){return this.isCallMember()||this.isIndexerMember()||this.isConstructMember()},i.prototype.isAnonymousFn=function(){return this.name===null},i.prototype.isAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.GetAccessor)||n.hasFlag(this.fncFlags,n.FncFlags.SetAccessor)},i.prototype.isGetAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.GetAccessor)},i.prototype.isSetAccessor=function(){return n.hasFlag(this.fncFlags,n.FncFlags.SetAccessor)},i.prototype.isAmbient=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Ambient)},i.prototype.isExported=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Exported)},i.prototype.isPrivate=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Private)},i.prototype.isPublic=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Public)},i.prototype.isStatic=function(){return n.hasFlag(this.fncFlags,n.FncFlags.Static)},i.prototype.treeViewLabel=function(){return this.name==null?"funcExpr":"func: "+this.name.actualText},i.prototype.ClearFlags=function(){this.fncFlags=n.FncFlags.None},i.prototype.isSignature=function(){return(this.fncFlags&n.FncFlags.Signature)!=n.FncFlags.None},i}(i),n.FuncDecl=c,l=function(){function n(n,t,i){this.filename=n,this.lineMap=t,this.unitIndex=i}return n}(),n.LocationInfo=l,n.unknownLocationInfo=new l("unknown",null,-1),et=function(t){function i(i,r){t.call(this,new f("script"),null,!1,null,i,r,null,n.NodeType.Script),this.locationInfo=null,this.referencedFiles=[],this.requiresGlobal=!1,this.requiresExtendsBlock=!1,this.isResident=!1,this.isDeclareFile=!1,this.hasBeenTypeChecked=!1,this.topLevelMod=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.containsUnicodeChar=!1,this.containsUnicodeCharInComment=!1,this.externallyVisibleImportedSymbols=[],this.vars=i,this.scopes=r}return __extends(i,t),i.prototype.setCachedEmitRequired=function(n){return this.cachedEmitRequired=n},i.prototype.typeCheck=function(n){return n.typeCheckScript(this)},i.prototype.treeViewLabel=function(){return"Script"},i.prototype.emitRequired=function(t){var r,u,i;if(this.cachedEmitRequired!=undefined)return this.cachedEmitRequired;if(!this.isDeclareFile&&!this.isResident&&this.bod){for(r=0,u=this.bod.members.length;r<u;r++)if(i=this.bod.members[r],i.nodeType==n.NodeType.ModuleDeclaration){if(!n.hasFlag(i.modFlags,n.ModuleFlags.ShouldEmitModuleDecl|n.ModuleFlags.Ambient))return this.setCachedEmitRequired(!0)}else if(i.nodeType==n.NodeType.ClassDeclaration){if(!n.hasFlag(i.varFlags,n.VarFlags.Ambient))return this.setCachedEmitRequired(!0)}else if(i.nodeType==n.NodeType.VarDecl){if(!n.hasFlag(i.varFlags,n.VarFlags.Ambient))return this.setCachedEmitRequired(!0)}else if(i.nodeType==n.NodeType.FuncDecl){if(!i.isSignature())return this.setCachedEmitRequired(!0)}else if(i.nodeType!=n.NodeType.InterfaceDeclaration&&i.nodeType!=n.NodeType.Empty)return this.setCachedEmitRequired(!0);if(t.emitComments&&(this.bod.preComments&&this.bod.preComments.length>0||this.bod.postComments&&this.bod.postComments.length>0))return this.setCachedEmitRequired(!0)}return this.setCachedEmitRequired(!1)},i.prototype.emit=function(t){this.emitRequired(t.emitOptions)&&(t.emitParensAndCommentsInPlace(this.bod,!0),t.emitJavascriptList(this.bod,null,n.TokenID.Semicolon,!0,!1,!1,!0,this.requiresExtendsBlock),t.emitParensAndCommentsInPlace(this.bod,!1))},i.prototype.AddExternallyVisibleImportedSymbol=function(t,i){if(!this.isExternallyVisibleSymbol(t)){if(!t.getType().symbol.isExternallyVisible(i)){var r="",u=t.getType().symbol.prettyName;n.isQuoted(u)||(r="'"),i.errorReporter.simpleError(t.declAST,"Externally visible import statement uses non exported module "+r+u+r)}this.externallyVisibleImportedSymbols.push(t)}},i.prototype.isExternallyVisibleSymbol=function(n){for(var t=0;t<this.externallyVisibleImportedSymbols.length;t++)if(this.externallyVisibleImportedSymbols[t]==n)return!0;return!1},i}(c),n.Script=et,s=function(n){function t(t,i,r){n.call(this,t),this.name=i,this.members=r,this.leftCurlyCount=0,this.rightCurlyCount=0}return __extends(t,n),t.prototype.isDeclaration=function(){return!0},t}(e),n.NamedDeclaration=s,ot=function(t){function i(i,r,u,f,e){t.call(this,n.NodeType.ModuleDeclaration,i,r),this.endingToken=e,this.modFlags=n.ModuleFlags.ShouldEmitModuleDecl,this.amdDependencies=[],this.containsUnicodeChar=!1,this.containsUnicodeCharInComment=!1,this.vars=u,this.scopes=f,this.prettyName=this.name.actualText}return __extends(i,t),i.prototype.isExported=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.Exported)},i.prototype.isAmbient=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.Ambient)},i.prototype.isEnum=function(){return n.hasFlag(this.modFlags,n.ModuleFlags.IsEnum)},i.prototype.recordNonInterface=function(){this.modFlags&=~n.ModuleFlags.ShouldEmitModuleDecl},i.prototype.typeCheck=function(n){return n.typeCheckModule(this)},i.prototype.emit=function(t){n.hasFlag(this.modFlags,n.ModuleFlags.ShouldEmitModuleDecl)||(t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascriptModule(this),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1))},i}(s),n.ModuleDeclaration=ot,h=function(t){function i(i,r,u,f,e){t.call(this,i,r,e),this.extendsList=u,this.implementsList=f,this.varFlags=n.VarFlags.None}return __extends(i,t),i.prototype.isExported=function(){return n.hasFlag(this.varFlags,n.VarFlags.Exported)},i.prototype.isAmbient=function(){return n.hasFlag(this.varFlags,n.VarFlags.Ambient)},i}(s),n.TypeDeclaration=h,st=function(t){function i(i,r,u,f){t.call(this,n.NodeType.ClassDeclaration,i,u,f,r),this.knownMemberNames={},this.constructorDecl=null,this.constructorNestingLevel=0,this.endingToken=null}return __extends(i,t),i.prototype.typeCheck=function(n){return n.typeCheckClass(this)},i.prototype.emit=function(n){n.emitJavascriptClass(this)},i}(h),n.ClassDeclaration=st,ht=function(t){function i(i,r,u,f){t.call(this,n.NodeType.InterfaceDeclaration,i,u,f,r)}return __extends(i,t),i.prototype.typeCheck=function(n){return n.typeCheckInterface(this)},i.prototype.emit=function(){},i}(h),n.InterfaceDeclaration=ht,t=function(t){function i(i){t.call(this,i),this.flags|=n.ASTFlags.IsStatement}return __extends(i,t),i.prototype.isLoop=function(){return!1},i.prototype.isStatementOrExpression=function(){return!0},i.prototype.isCompoundStatement=function(){return this.isLoop()},i.prototype.typeCheck=function(n){return this.type=n.voidType,this},i}(e),n.Statement=t,ct=function(t){function i(i,r){t.call(this,n.NodeType.LabeledStatement),this.labels=i,this.stmt=r}return __extends(i,t),i.prototype.emit=function(n,t,i){var u,r;if(n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),this.labels)for(u=this.labels.members.length,r=0;r<u;r++)this.labels.members[r].emit(n,t,i);this.stmt.emit(n,t,!0),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheck(this.labels),this.stmt=this.stmt.typeCheck(n),this},i.prototype.addToControlFlow=function(t){var r=t.current,i=new n.BasicBlock;t.current=i,r.addSuccessor(i)},i}(t),n.LabeledStatement=ct,lt=function(t){function i(i,r){t.call(this,n.NodeType.Block),this.statements=i,this.isStatementBlock=r}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.isStatementBlock?(t.writeLineToOutput(" {"),t.indenter.increaseIndent()):t.setInVarBlock(this.statements.members.length);var u=t.setInObjectLiteral(!1);this.statements&&t.emitJavascriptList(this.statements,null,n.TokenID.Semicolon,!0,!1,!1),this.isStatementBlock&&(t.indenter.decreaseIndent(),t.emitIndent(),t.writeToOutput("}")),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){var i=new n.BasicBlock;t.pushStatement(this,t.current,i),this.statements&&t.walk(this.statements,this),t.walker.options.goChildren=!1,t.popStatement(),i.predecessors.length>0&&(t.current.addSuccessor(i),t.current=i)},i.prototype.typeCheck=function(n){return n.checker.styleSettings.emptyBlocks||(this.statements===null||this.statements.members.length==0)&&n.checker.errorReporter.styleError(this,"empty block"),n.typeCheck(this.statements),this},i}(t),n.Block=lt,at=function(t){function i(n){t.call(this,n),this.target=null,this.resolvedTarget=null}return __extends(i,t),i.prototype.hasExplicitTarget=function(){return this.target},i.prototype.setResolvedTarget=function(t,i){return i.isLoop()?(this.resolvedTarget=i,!0):this.nodeType===n.NodeType.Continue?(t.reportParseError("continue statement applies only to loops"),!1):i.nodeType==n.NodeType.Switch||this.hasExplicitTarget()?(this.resolvedTarget=i,!0):(t.reportParseError("break statement with no label can apply only to a loop or switch statement"),!1)},i.prototype.addToControlFlow=function(i){t.prototype.addToControlFlow.call(this,i),i.unconditionalBranch(this.resolvedTarget,this.nodeType==n.NodeType.Continue)},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nodeType==n.NodeType.Break?t.writeToOutput("break"):t.writeToOutput("continue"),this.hasExplicitTarget()&&t.writeToOutput(" "+this.target),t.recordSourceMappingEnd(this),t.writeToOutput(";"),t.emitParensAndCommentsInPlace(this,!1)},i}(t),n.Jump=at,vt=function(t){function i(i){t.call(this,n.NodeType.While),this.cond=i,this.body=null}return __extends(i,t),i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);t.writeToOutput("while("),t.emitJavascript(this.cond,n.TokenID.While,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!1),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckWhile(this)},i.prototype.addToControlFlow=function(t){var o=t.current,i=new n.BasicBlock,r=new n.BasicBlock,u,f,e;o.addSuccessor(i),t.current=i,t.addContent(this.cond),u=t.current,f=null,this.body&&(t.current=new n.BasicBlock,u.addSuccessor(t.current),t.pushStatement(this,i,r),t.walk(this.body,this),f=t.popStatement()),t.noContinuation||(e=t.current,e.addSuccessor(i)),t.current=r,u.addSuccessor(r),t.noContinuation=!1,t.walker.options.goChildren=!1},i}(t),n.WhileStatement=vt,yt=function(t){function i(){t.call(this,n.NodeType.DoWhile),this.body=null,this.whileAST=null,this.cond=null}return __extends(i,t),i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);t.writeToOutput("do"),t.emitJavascriptStatements(this.body,!0),t.recordSourceMappingStart(this.whileAST),t.writeToOutput("while"),t.recordSourceMappingEnd(this.whileAST),t.writeToOutput("("),t.emitJavascript(this.cond,n.TokenID.CloseParen,!1),t.writeToOutput(")"),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.writeToOutput(";"),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckDoWhile(this)},i.prototype.addToControlFlow=function(t){var e=t.current,i=new n.BasicBlock,r=new n.BasicBlock,f,u;e.addSuccessor(i),t.current=i,f=null,this.body&&(t.pushStatement(this,i,r),t.walk(this.body,this),f=t.popStatement()),t.noContinuation?t.addUnreachable(this.cond):(u=t.current,u.addSuccessor(i),t.addContent(this.cond),t.current=r,u.addSuccessor(r)),t.walker.options.goChildren=!1},i}(t),n.DoWhileStatement=yt,pt=function(t){function i(i){t.call(this,n.NodeType.If),this.cond=i,this.elseBod=null,this.statement=new u}return __extends(i,t),i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);t.recordSourceMappingStart(this.statement),t.writeToOutput("if("),t.emitJavascript(this.cond,n.TokenID.If,!1),t.writeToOutput(")"),t.recordSourceMappingEnd(this.statement),t.emitJavascriptStatements(this.thenBod,!0),this.elseBod&&(this.elseBod.nodeType===n.NodeType.If?(t.writeToOutput(" else "),this.elseBod.emit(t,i,!1)):(t.writeToOutput(" else"),t.emitJavascriptStatements(this.elseBod,!0))),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckIf(this)},i.prototype.addToControlFlow=function(t){var i,u,r,f;this.cond.addToControlFlow(t),i=new n.BasicBlock,u=t.current,t.pushStatement(this,u,i),r=!1,t.current=new n.BasicBlock,u.addSuccessor(t.current),t.walk(this.thenBod,this),t.noContinuation||(r=!0,t.current.addSuccessor(i)),this.elseBod?(t.current=new n.BasicBlock,t.noContinuation=!1,u.addSuccessor(t.current),t.walk(this.elseBod,this),t.noContinuation?r&&(t.noContinuation=!1):(r=!0,t.current.addSuccessor(i))):(u.addSuccessor(i),t.noContinuation=!1,r=!0),f=t.popStatement(),i.predecessors.length>0&&(t.noContinuation=!1,r=!0),r&&(t.current=i),t.walker.options.goChildren=!1},i}(t),n.IfStatement=pt,wt=function(t){function i(){t.call(this,n.NodeType.Return),this.returnExpression=null}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);this.returnExpression?(t.writeToOutput("return "),t.emitJavascript(this.returnExpression,n.TokenID.Semicolon,!1),this.returnExpression.nodeType===n.NodeType.FuncDecl&&t.writeToOutput(";")):t.writeToOutput("return;"),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n),n.returnStmt()},i.prototype.typeCheck=function(n){return n.typeCheckReturn(this)},i}(t),n.ReturnStatement=wt,bt=function(t){function i(){t.call(this,n.NodeType.EndCode)}return __extends(i,t),i}(i),n.EndCode=bt,kt=function(t){function i(i,r){t.call(this,n.NodeType.ForIn),this.lval=i,this.obj=r,this.statement=new u,this.lval&&this.lval.nodeType==n.NodeType.VarDecl&&(this.lval.varFlags|=n.VarFlags.AutoInit)}return __extends(i,t),i.prototype.isLoop=function(){return!0},i.prototype.isFiltered=function(){var t,e,i,r,o,u,h,f,s;return this.body&&(t=null,this.body.nodeType==n.NodeType.List?(e=this.body,e.members.length==1&&(t=e.members[0])):t=this.body,t!==null&&(t.nodeType==n.NodeType.Block&&(i=t,i.statements!==null&&i.statements.members.length==1&&(t=i.statements.members[0])),t.nodeType==n.NodeType.If&&(r=t.cond,r.nodeType==n.NodeType.Call&&(o=r.target,o.nodeType==n.NodeType.Dot&&(u=o,u.operand1.nodeType==n.NodeType.Name&&this.obj.nodeType==n.NodeType.Name&&u.operand1.actualText==this.obj.actualText&&(h=u.operand2,h.actualText=="hasOwnProperty"&&(f=r.arguments,f!==null&&f.members.length==1&&(s=f.members[0],s.nodeType==n.NodeType.Name&&this.lval.nodeType==n.NodeType.Name&&this.lval.actualText==s.actualText))))))))?!0:!1},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);t.recordSourceMappingStart(this.statement),t.writeToOutput("for("),t.emitJavascript(this.lval,n.TokenID.For,!1),t.writeToOutput(" in "),t.emitJavascript(this.obj,n.TokenID.For,!1),t.writeToOutput(")"),t.recordSourceMappingEnd(this.statement),t.emitJavascriptStatements(this.body,!0),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.checker.styleSettings.forin&&(this.isFiltered()||n.checker.errorReporter.styleError(this,"no hasOwnProperty filter")),n.typeCheckForIn(this)},i.prototype.addToControlFlow=function(t){var f;this.lval&&t.addContent(this.lval),this.obj&&t.addContent(this.obj);var u=t.current,i=new n.BasicBlock,r=new n.BasicBlock;u.addSuccessor(i),t.current=i,this.body&&(t.pushStatement(this,i,r),t.walk(this.body,this),t.popStatement()),t.noContinuation||(f=t.current,f.addSuccessor(i)),t.current=r,t.noContinuation=!1,u.addSuccessor(r),t.walker.options.goChildren=!1},i}(t),n.ForInStatement=kt,dt=function(t){function i(i){t.call(this,n.NodeType.For),this.init=i}return __extends(i,t),i.prototype.isLoop=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var u=t.setInObjectLiteral(!1);t.writeToOutput("for("),this.init&&(this.init.nodeType!=n.NodeType.List?t.emitJavascript(this.init,n.TokenID.For,!1):(t.setInVarBlock(this.init.members.length),t.emitJavascriptList(this.init,null,n.TokenID.For,!1,!1,!1))),t.writeToOutput("; "),t.emitJavascript(this.cond,n.TokenID.For,!1),t.writeToOutput("; "),t.emitJavascript(this.incr,n.TokenID.For,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0),t.setInObjectLiteral(u),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckFor(this)},i.prototype.addToControlFlow=function(t){var o,s;this.init&&t.addContent(this.init);var h=t.current,r=new n.BasicBlock,u=new n.BasicBlock;h.addSuccessor(r),t.current=r;var f=null,e=r,i=null;this.incr&&(i=new n.BasicBlock,e=i),this.cond&&(f=t.current,t.addContent(this.cond),t.current=new n.BasicBlock,f.addSuccessor(t.current)),o=null,this.body&&(t.pushStatement(this,e,u),t.walk(this.body,this),o=t.popStatement()),this.incr&&(t.noContinuation?i.predecessors.length==0&&t.addUnreachable(this.incr):(t.current.addSuccessor(i),t.current=i,t.addContent(this.incr))),s=t.current,t.noContinuation||s.addSuccessor(r),f&&(f.addSuccessor(u),t.noContinuation=!1),u.predecessors.length>0&&(t.noContinuation=!1,t.current=u),t.walker.options.goChildren=!1},i}(t),n.ForStatement=dt,gt=function(t){function i(i){t.call(this,n.NodeType.With),this.expr=i,this.withSym=null}return __extends(i,t),i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("with ("),this.expr&&t.emitJavascript(this.expr,n.TokenID.With,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return n.typeCheckWith(this)},i}(t),n.WithStatement=gt,ni=function(t){function i(i){t.call(this,n.NodeType.Switch),this.val=i,this.defaultCase=null,this.statement=new u}return __extends(i,t),i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){var f,e,u,o;for(t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),f=t.setInObjectLiteral(!1),t.recordSourceMappingStart(this.statement),t.writeToOutput("switch("),t.emitJavascript(this.val,n.TokenID.Identifier,!1),t.writeToOutput(")"),t.recordSourceMappingEnd(this.statement),t.writeLineToOutput(" {"),t.indenter.increaseIndent(),e=this.caseList.members.length,u=0;u<e;u++)o=this.caseList.members[u],t.emitJavascript(o,n.TokenID.Case,!0);t.indenter.decreaseIndent(),t.emitIndent(),t.writeToOutput("}"),t.setInObjectLiteral(f),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){var i=this.caseList.members.length,t;for(this.val=n.typeCheck(this.val),t=0;t<i;t++)this.caseList.members[t]=n.typeCheck(this.caseList.members[t]);return this.defaultCase=n.typeCheck(this.defaultCase),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var u=t.current,i,r,f,e;t.addContent(this.val),i=new n.BasicBlock,r=new n.BasicBlock,u.addSuccessor(i),t.pushSwitch(i),t.current=i,t.pushStatement(this,i,r),t.walk(this.caseList,this),t.popSwitch(),f=t.popStatement(),e=this.defaultCase==null,this.defaultCase==null&&u.addSuccessor(r),r.predecessors.length>0?(t.noContinuation=!1,t.current=r):t.noContinuation=!0,t.walker.options.goChildren=!1},i}(t),n.SwitchStatement=ni,ti=function(t){function i(){t.call(this,n.NodeType.Case),this.expr=null}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.expr?(t.writeToOutput("case "),t.emitJavascript(this.expr,n.TokenID.Identifier,!1)):t.writeToOutput("default"),t.writeToOutput(":"),this.body.members.length==1&&this.body.members[0].nodeType==n.NodeType.Block?t.emitJavascriptStatements(this.body,!1):(t.writeLineToOutput(""),t.indenter.increaseIndent(),t.emitBareJavascriptStatements(this.body),t.indenter.decreaseIndent()),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.expr=n.typeCheck(this.expr),n.typeCheck(this.body),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var r=new n.BasicBlock,u=t.currentSwitch[t.currentSwitch.length-1],i;this.expr?(i=new n.BasicBlock,t.current=i,u.addSuccessor(i),t.addContent(this.expr),i.addSuccessor(r)):u.addSuccessor(r),t.current=r,this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},i}(t),n.CaseStatement=ti,ii=function(t){function i(i,r){t.call(this,n.NodeType.TypeRef),this.term=i,this.arrayCount=r}return __extends(i,t),i.prototype.emit=function(){throw new Error("should not emit a type ref");},i.prototype.typeCheck=function(t){var r=t.inTypeRefTypeCheck,i;return t.inTypeRefTypeCheck=!0,i=n.getTypeLink(this,t.checker,!0),t.checker.resolveTypeLink(t.scope,i,!1),this.term&&t.typeCheck(this.term),t.checkForVoidConstructor(i.type,this),this.type=i.type,this.term&&(this.term.type=this.type),t.inTypeRefTypeCheck=r,this},i}(i),n.TypeReference=ii,ri=function(t){function i(i,r){t.call(this,n.NodeType.TryFinally),this.tryNode=i,this.finallyNode=r}return __extends(i,t),i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,n.TokenID.Try,!1),t.emitJavascript(this.finallyNode,n.TokenID.Finally,!1),t.recordSourceMappingEnd(this)},i.prototype.typeCheck=function(n){return this.tryNode=n.typeCheck(this.tryNode),this.finallyNode=n.typeCheck(this.finallyNode),this.type=n.voidType,this},i.prototype.addToControlFlow=function(t){var i=new n.BasicBlock,r;t.walk(this.tryNode,this),r=new n.BasicBlock,t.current&&t.current.addSuccessor(r),t.current=r,t.pushStatement(this,null,i),t.walk(this.finallyNode,this),!t.noContinuation&&t.current&&t.current.addSuccessor(i),i.predecessors.length>0?t.current=i:t.noContinuation=!0,t.popStatement(),t.walker.options.goChildren=!1},i}(t),n.TryFinally=ri,ui=function(t){function i(i,r){t.call(this,n.NodeType.TryCatch),this.tryNode=i,this.catchNode=r}return __extends(i,t),i.prototype.isCompoundStatement=function(){return!0},i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,n.TokenID.Try,!1),t.emitJavascript(this.catchNode,n.TokenID.Catch,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){var r=t.current,u=new n.BasicBlock,i;r.addSuccessor(u),t.current=u,i=new n.BasicBlock,t.pushStatement(this,null,i),t.walk(this.tryNode,this),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=new n.BasicBlock,r.addSuccessor(t.current),t.walk(this.catchNode,this),t.popStatement(),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=i,t.walker.options.goChildren=!1},i.prototype.typeCheck=function(n){return this.tryNode=n.typeCheck(this.tryNode),this.catchNode=n.typeCheck(this.catchNode),this.type=n.voidType,this},i}(t),n.TryCatch=ui,fi=function(t){function i(i){t.call(this,n.NodeType.Try),this.body=i}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("try "),t.emitJavascript(this.body,n.TokenID.Try,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.typeCheck=function(n){return this.body=n.typeCheck(this.body),this},i.prototype.addToControlFlow=function(n){this.body&&n.walk(this.body,this),n.walker.options.goChildren=!1,n.noContinuation=!1},i}(t),n.Try=fi,ei=function(t){function i(i,r){t.call(this,n.NodeType.Catch),this.param=i,this.body=r,this.statement=new u,this.containedScope=null,this.param&&(this.param.varFlags|=n.VarFlags.AutoInit)}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput(" "),t.recordSourceMappingStart(this.statement),t.writeToOutput("catch ("),t.emitJavascript(this.param,n.TokenID.OpenParen,!1),t.writeToOutput(")"),t.recordSourceMappingEnd(this.statement),t.emitJavascript(this.body,n.TokenID.Catch,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(t){if(this.param){t.addContent(this.param);var i=new n.BasicBlock;t.current.addSuccessor(i),t.current=i}this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},i.prototype.typeCheck=function(t){var e=t.scope,i,u,r,f;return t.scope=this.containedScope,this.param=t.typeCheck(this.param),i=new n.ValueLocation,u=new n.VariableSymbol(this.param.id.text,this.param.minChar,t.checker.locationInfo.unitIndex,i),i.symbol=u,i.typeLink=new n.TypeLink,i.typeLink.type=t.anyType,r=t.thisFnc,i.symbol.container=r&&r.type?r.type.symbol:null,this.param.sym=i.symbol,t.scope.enter(i.symbol.container,this.param,i.symbol,t.checker.errorReporter,!1,!1,!1),this.body=t.typeCheck(this.body),t.checker.inProvisionalTypecheckMode()&&(f=t.scope.getTable(),f.secondaryTable.table[i.symbol.name]=undefined),this.type=t.voidType,t.scope=e,this},i}(t),n.Catch=ei,oi=function(t){function i(i){t.call(this,n.NodeType.Finally),this.body=i}return __extends(i,t),i.prototype.emit=function(t){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("finally"),t.emitJavascript(this.body,n.TokenID.Finally,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},i.prototype.addToControlFlow=function(n){this.body&&n.walk(this.body,this),n.walker.options.goChildren=!1,n.noContinuation=!1},i.prototype.typeCheck=function(n){return this.body=n.typeCheck(this.body),this},i}(t),n.Finally=oi,si=function(t){function i(i,r,u){t.call(this,n.NodeType.Comment),this.content=i,this.isBlockComment=r,this.endsLine=u,this.text=null,this.docCommentText=null}return __extends(i,t),i.prototype.getText=function(){if(this.text==null)if(this.isBlockComment){this.text=this.content.split("\n");for(var n=0;n<this.text.length;n++)this.text[n]=this.text[n].replace(/^\s+|\s+$/g,"")}else this.text=[this.content.replace(/^\s+|\s+$/g,"")];return this.text},i.prototype.isDocComment=function(){return this.isBlockComment?this.content.charAt(2)=="*":!1},i.prototype.getDocCommentText=function(){return this.docCommentText==null&&(this.docCommentText=i.cleanJSDocComment(this.content)),this.docCommentText},i.consumeLeadingSpace=function(t,i,r){var u=t.length,f;for(r!=undefined&&(u=n.min(i+r,u));i<u;i++)if(f=t.charCodeAt(i),f!=n.LexCodeSpace&&f!=n.LexCodeTAB)return i;return u!=t.length?u:-1},i.isSpaceChar=function(t,i){var u=t.length,r;return i<u?(r=t.charCodeAt(i),r==n.LexCodeSpace||r==n.LexCodeTAB):i==u},i.cleanDocCommentLine=function(n,t,r){var u=i.consumeLeadingSpace(n,0),f,e;if(u!=-1){if(f=u,t&&n.charAt(u)=="*")if(e=u+1,u=i.consumeLeadingSpace(n,e,r),u!=-1)f=u-e;else return null;return{minChar:u,limChar:n.charAt(n.length-1)=="\r"?n.length-1:n.length,jsDocSpacesRemoved:f}}return null},i.cleanJSDocComment=function(n,t){var a=[],c,e,h,u,f,o,s,r,l,v;for(n=n.replace("/**",""),n.length>=2&&n.charAt(n.length-1)=="/"&&n.charAt(n.length-2)=="*"&&(n=n.substring(0,n.length-2)),c=n.split("\n"),e=!1,h=0;h<c.length;h++)if(u=c[h],f=i.cleanDocCommentLine(u,!0,t),f){for(o="",s=f.minChar,r=u.indexOf("@",f.minChar);0<=r&&r<f.limChar;r=u.indexOf("@",r+1))l=e,u.indexOf("param",r+1)==r+1&&i.isSpaceChar(u,r+6)?(l||(o+=u.substring(s,r)),s=r,e=!0):l&&(s=r,e=!1);e||(o+=u.substring(s,f.limChar)),v=i.cleanDocCommentLine(o,!1),v&&(t==undefined&&(t=f.jsDocSpacesRemoved),a.push(o))}return a.join("\n")},i.getDocCommentText=function(n){for(var r=[],i,t=0;t<n.length;t++)i=n[t].getDocCommentText(),i!=""&&r.push(i);return r.join("\n")},i.getParameterDocCommentText=function(t,r){var s,f,u,e,h,c;if(r.length==0||!r[0].isBlockComment)return"";for(s=0;s<r.length;s++)for(f=r[s].content,u=f.indexOf("@param",0);0<=u;u=f.indexOf("@param",u))if(u+=6,i.isSpaceChar(f,u)){if(u=i.consumeLeadingSpace(f,u),u==-1)break;if(f.charCodeAt(u)==n.LexCodeLC){for(u++,e=0,h=1;u<f.length;u++){if(e=f.charCodeAt(u),e==n.LexCodeLC){h++;continue}if(e==n.LexCodeRC)if(h--,h==0)break;else continue;if(e==n.LexCodeAtSign)break}if(u==f.length)break;if(e==n.LexCodeAtSign)continue;if(u=i.consumeLeadingSpace(f,u+1),u==-1)break}if(t==f.substr(u,t.length)&&i.isSpaceChar(f,u+t.length)){if(u=i.consumeLeadingSpace(f,u+t.length),u==-1)return"";var l=f.indexOf("@",u),v=f.substring(u,l<0?f.length:l),a=undefined,o=f.substring(0,u).lastIndexOf("\n")+1;return o!=0&&o<u&&f.charAt(o+1)=="\r"&&o++,c=i.consumeLeadingSpace(f,o),c!=u&&f.charAt(c)=="*"&&(a=u-c-1),i.cleanJSDocComment(v,a)}}return""},i.getDocCommentTextOfSignatures=function(t){for(var u=[],r,i=0;i<t.length;i++)r=n.Comment.getDocCommentText(t[i].declAST.getDocComments()),r!=""&&u.push(r);return u.join("\n")},i}(i),n.Comment=si,hi=function(t){function i(){t.call(this,n.NodeType.Debugger)}return __extends(i,t),i.prototype.emit=function(n){n.emitParensAndCommentsInPlace(this,!0),n.recordSourceMappingStart(this),n.writeLineToOutput("debugger;"),n.recordSourceMappingEnd(this),n.emitParensAndCommentsInPlace(this,!1)},i}(t),n.DebuggerStatement=hi}(TypeScript||(TypeScript={})),function(n){function e(){return r||(r=new i),r}var u=function(){function n(){this.goChildren=!0,this.goNextSibling=!0,this.reverseSiblings=!1}return n.prototype.stopWalk=function(n){typeof n=="undefined"&&(n=!0),this.goChildren=!n,this.goNextSibling=!n},n}(),f,i,r,t;n.AstWalkOptions=u,f=function(){function n(n,t,i,r,u){this.childrenWalkers=n,this.pre=t,this.post=i,this.options=r,this.state=u}return n.prototype.walk=function(n,t){var i=this.pre(n,t,this),u,r;return i===undefined&&(i=n),this.options.goChildren?(u=this.options.goNextSibling,this.options.goNextSibling=!0,this.childrenWalkers[n.nodeType](n,t,this),this.options.goNextSibling=u):this.options.goChildren=!0,this.post?(r=this.post(i,t,this),r===undefined&&(r=i),r):i},n}(),i=function(){function i(){this.childrenWalkers=[],this.initChildrenWalkers()}return i.prototype.walk=function(n,t,i,r,u){return this.getWalker(t,i,r,u).walk(n,null)},i.prototype.getWalker=function(n,t,i,r){return this.getSlowWalker(n,t,i,r)},i.prototype.getSlowWalker=function(n,t,i,r){return i||(i=new u),new f(this.childrenWalkers,n,t,i,r)},i.prototype.initChildrenWalkers=function(){this.childrenWalkers[n.NodeType.None]=t.walkNone,this.childrenWalkers[n.NodeType.Empty]=t.walkNone,this.childrenWalkers[n.NodeType.EmptyExpr]=t.walkNone,this.childrenWalkers[n.NodeType.True]=t.walkNone,this.childrenWalkers[n.NodeType.False]=t.walkNone,this.childrenWalkers[n.NodeType.This]=t.walkNone,this.childrenWalkers[n.NodeType.Super]=t.walkNone,this.childrenWalkers[n.NodeType.QString]=t.walkNone,this.childrenWalkers[n.NodeType.Regex]=t.walkNone,this.childrenWalkers[n.NodeType.Null]=t.walkNone,this.childrenWalkers[n.NodeType.ArrayLit]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.ObjectLit]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Void]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Comma]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Pos]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Neg]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Delete]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.Await]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.In]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Dot]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.From]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Is]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.InstOf]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Typeof]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.NumberLit]=t.walkNone,this.childrenWalkers[n.NodeType.Name]=t.walkNone,this.childrenWalkers[n.NodeType.TypeRef]=t.walkTypeReferenceChildren,this.childrenWalkers[n.NodeType.Index]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Call]=t.walkCallExpressionChildren,this.childrenWalkers[n.NodeType.New]=t.walkCallExpressionChildren,this.childrenWalkers[n.NodeType.Asg]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgAdd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgSub]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgDiv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgMul]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgMod]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgAnd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgXor]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgOr]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgLsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgRsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.AsgRs2]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.ConditionalExpression]=t.walkTrinaryExpressionChildren,this.childrenWalkers[n.NodeType.LogOr]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.LogAnd]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Or]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Xor]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.And]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Eq]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Ne]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Eqv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.NEqv]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Lt]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Le]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Gt]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Ge]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Add]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Sub]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Mul]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Div]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Mod]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Lsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Rsh]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Rs2]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.Not]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.LogNot]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.IncPre]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.DecPre]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.IncPost]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.DecPost]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.TypeAssertion]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.FuncDecl]=t.walkFuncDeclChildren,this.childrenWalkers[n.NodeType.Member]=t.walkBinaryExpressionChildren,this.childrenWalkers[n.NodeType.VarDecl]=t.walkBoundDeclChildren,this.childrenWalkers[n.NodeType.ArgDecl]=t.walkBoundDeclChildren,this.childrenWalkers[n.NodeType.Return]=t.walkReturnStatementChildren,this.childrenWalkers[n.NodeType.Break]=t.walkNone,this.childrenWalkers[n.NodeType.Continue]=t.walkNone,this.childrenWalkers[n.NodeType.Throw]=t.walkUnaryExpressionChildren,this.childrenWalkers[n.NodeType.For]=t.walkForStatementChildren,this.childrenWalkers[n.NodeType.ForIn]=t.walkForInStatementChildren,this.childrenWalkers[n.NodeType.If]=t.walkIfStatementChildren,this.childrenWalkers[n.NodeType.While]=t.walkWhileStatementChildren,this.childrenWalkers[n.NodeType.DoWhile]=t.walkDoWhileStatementChildren,this.childrenWalkers[n.NodeType.Block]=t.walkBlockChildren,this.childrenWalkers[n.NodeType.Case]=t.walkCaseStatementChildren,this.childrenWalkers[n.NodeType.Switch]=t.walkSwitchStatementChildren,this.childrenWalkers[n.NodeType.Try]=t.walkTryChildren,this.childrenWalkers[n.NodeType.TryCatch]=t.walkTryCatchChildren,this.childrenWalkers[n.NodeType.TryFinally]=t.walkTryFinallyChildren,this.childrenWalkers[n.NodeType.Finally]=t.walkFinallyChildren,this.childrenWalkers[n.NodeType.Catch]=t.walkCatchChildren,this.childrenWalkers[n.NodeType.List]=t.walkListChildren,this.childrenWalkers[n.NodeType.Script]=t.walkScriptChildren,this.childrenWalkers[n.NodeType.ClassDeclaration]=t.walkClassDeclChildren,this.childrenWalkers[n.NodeType.InterfaceDeclaration]=t.walkTypeDeclChildren,this.childrenWalkers[n.NodeType.ModuleDeclaration]=t.walkModuleDeclChildren,this.childrenWalkers[n.NodeType.ImportDeclaration]=t.walkImportDeclChildren,this.childrenWalkers[n.NodeType.With]=t.walkWithStatementChildren,this.childrenWalkers[n.NodeType.Label]=t.walkLabelChildren,this.childrenWalkers[n.NodeType.LabeledStatement]=t.walkLabeledStatementChildren,this.childrenWalkers[n.NodeType.EBStart]=t.walkNone,this.childrenWalkers[n.NodeType.GotoEB]=t.walkNone,this.childrenWalkers[n.NodeType.EndCode]=t.walkNone,this.childrenWalkers[n.NodeType.Error]=t.walkNone,this.childrenWalkers[n.NodeType.Comment]=t.walkNone,this.childrenWalkers[n.NodeType.Debugger]=t.walkNone;for(var i in n.NodeType._map)if(this.childrenWalkers[i]===undefined)throw new Error("initWalkers function is not up to date with enum content!");},i}(),n.AstWalkerFactory=i,n.getAstWalkerFactory=e,function(n){function r(){}function u(n,t,i){var u=n.members.length,r;if(i.options.reverseSiblings)for(r=u-1;r>=0;r--)i.options.goNextSibling&&(n.members[r]=i.walk(n.members[r],n));else for(r=0;r<u;r++)i.options.goNextSibling&&(n.members[r]=i.walk(n.members[r],n))}function f(n,t,i){n.castTerm&&(n.castTerm=i.walk(n.castTerm,n)),n.operand&&(n.operand=i.walk(n.operand,n))}function e(n,t,i){i.options.reverseSiblings?(n.operand2&&(n.operand2=i.walk(n.operand2,n)),n.operand1&&i.options.goNextSibling&&(n.operand1=i.walk(n.operand1,n))):(n.operand1&&(n.operand1=i.walk(n.operand1,n)),n.operand2&&i.options.goNextSibling&&(n.operand2=i.walk(n.operand2,n)))}function o(n,t,i){n.term&&(n.term=i.walk(n.term,n))}function s(n,t,i){i.options.reverseSiblings||(n.target=i.walk(n.target,n)),n.arguments&&i.options.goNextSibling&&(n.arguments=i.walk(n.arguments,n)),i.options.reverseSiblings&&i.options.goNextSibling&&(n.target=i.walk(n.target,n))}function h(n,t,i){n.operand1&&(n.operand1=i.walk(n.operand1,n)),n.operand2&&i.options.goNextSibling&&(n.operand2=i.walk(n.operand2,n)),n.operand3&&i.options.goNextSibling&&(n.operand3=i.walk(n.operand3,n))}function c(n,t,i){n.name&&(n.name=i.walk(n.name,n)),n.arguments&&n.arguments.members.length>0&&i.options.goNextSibling&&(n.arguments=i.walk(n.arguments,n)),n.returnTypeAnnotation&&i.options.goNextSibling&&(n.returnTypeAnnotation=i.walk(n.returnTypeAnnotation,n)),n.bod&&n.bod.members.length>0&&i.options.goNextSibling&&(n.bod=i.walk(n.bod,n))}function l(n,t,i){n.id&&(n.id=i.walk(n.id,n)),n.init&&(n.init=i.walk(n.init,n)),n.typeExpr&&i.options.goNextSibling&&(n.typeExpr=i.walk(n.typeExpr,n))}function a(n,t,i){n.returnExpression&&(n.returnExpression=i.walk(n.returnExpression,n))}function v(n,t,i){n.init&&(n.init=i.walk(n.init,n)),n.cond&&i.options.goNextSibling&&(n.cond=i.walk(n.cond,n)),n.incr&&i.options.goNextSibling&&(n.incr=i.walk(n.incr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function y(n,t,i){n.lval=i.walk(n.lval,n),i.options.goNextSibling&&(n.obj=i.walk(n.obj,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function p(n,t,i){n.cond=i.walk(n.cond,n),n.thenBod&&i.options.goNextSibling&&(n.thenBod=i.walk(n.thenBod,n)),n.elseBod&&i.options.goNextSibling&&(n.elseBod=i.walk(n.elseBod,n))}function w(n,t,i){n.cond=i.walk(n.cond,n),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function b(n,t,i){n.cond=i.walk(n.cond,n),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function k(n,t,i){n.statements&&(n.statements=i.walk(n.statements,n))}function d(n,t,i){n.expr&&(n.expr=i.walk(n.expr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function g(n,t,i){n.val&&(n.val=i.walk(n.val,n)),n.caseList&&i.options.goNextSibling&&(n.caseList=i.walk(n.caseList,n))}function nt(n,t,i){n.body&&(n.body=i.walk(n.body,n))}function tt(n,t,i){n.tryNode&&(n.tryNode=i.walk(n.tryNode,n)),n.catchNode&&i.options.goNextSibling&&(n.catchNode=i.walk(n.catchNode,n))}function it(n,t,i){n.tryNode&&(n.tryNode=i.walk(n.tryNode,n)),n.finallyNode&&i.options.goNextSibling&&(n.finallyNode=i.walk(n.finallyNode,n))}function rt(n,t,i){n.body&&(n.body=i.walk(n.body,n))}function ut(n,t,i){n.param&&(n.param=i.walk(n.param,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function t(n,t,i){n.name=i.walk(n.name,n),i.options.goNextSibling&&n.members&&(n.members=i.walk(n.members,n))}function i(n,i,r){t(n,i,r)}function ft(n,t,r){i(n,t,r),r.options.goNextSibling&&n.extendsList&&(n.extendsList=r.walk(n.extendsList,n)),r.options.goNextSibling&&n.implementsList&&(n.implementsList=r.walk(n.implementsList,n))}function et(n,t,i){n.bod&&(n.bod=i.walk(n.bod,n))}function ot(n,t,r){i(n,t,r),r.options.goNextSibling&&n.extendsList&&(n.extendsList=r.walk(n.extendsList,n)),r.options.goNextSibling&&n.implementsList&&(n.implementsList=r.walk(n.implementsList,n))}function st(n,i,r){t(n,i,r)}function ht(n,t,i){n.id&&(n.id=i.walk(n.id,n)),n.alias&&(n.alias=i.walk(n.alias,n))}function ct(n,t,i){n.expr&&(n.expr=i.walk(n.expr,n)),n.body&&i.options.goNextSibling&&(n.body=i.walk(n.body,n))}function lt(){}function at(n,t,i){n.labels=i.walk(n.labels,n),i.options.goNextSibling&&(n.stmt=i.walk(n.stmt,n))}n.walkNone=r,n.walkListChildren=u,n.walkUnaryExpressionChildren=f,n.walkBinaryExpressionChildren=e,n.walkTypeReferenceChildren=o,n.walkCallExpressionChildren=s,n.walkTrinaryExpressionChildren=h,n.walkFuncDeclChildren=c,n.walkBoundDeclChildren=l,n.walkReturnStatementChildren=a,n.walkForStatementChildren=v,n.walkForInStatementChildren=y,n.walkIfStatementChildren=p,n.walkWhileStatementChildren=w,n.walkDoWhileStatementChildren=b,n.walkBlockChildren=k,n.walkCaseStatementChildren=d,n.walkSwitchStatementChildren=g,n.walkTryChildren=nt,n.walkTryCatchChildren=tt,n.walkTryFinallyChildren=it,n.walkFinallyChildren=rt,n.walkCatchChildren=ut,n.walkRecordChildren=t,n.walkNamedTypeChildren=i,n.walkClassDeclChildren=ft,n.walkScriptChildren=et,n.walkTypeDeclChildren=ot,n.walkModuleDeclChildren=st,n.walkImportDeclChildren=ht,n.walkWithStatementChildren=ct,n.walkLabelChildren=lt,n.walkLabeledStatementChildren=at}(t||(t={}))}(TypeScript||(TypeScript={})),function(n){(function(t){function r(t,r){var f=function(n){return u.options.goChildren=i(!0,n,r),n},e=function(n){return i(!1,n,r),n},u=n.getAstWalkerFactory().getWalker(f,e);u.walk(t,null)}function i(t,i,r){var f=i.nodeType,u=n.NodeType._map[f]+"Callback";return r[u]?r[u](t,i):r.DefaultCallback?r.DefaultCallback(t,i):!0}t.walk=r})(n.AstWalkerWithDetailCallback||(n.AstWalkerWithDetailCallback={}));var t=n.AstWalkerWithDetailCallback}(TypeScript||(TypeScript={})),function(n){function t(n){return n===null||n.length===0?null:n[n.length-1]}function f(n,t){return n>=t?n:t}function o(n,t){return n<=t?n:t}function e(n){return n===null?!1:n.minChar===-1||n.limChar===-1?!1:!0}function s(t,r,f){typeof f=="undefined"&&(f=i.Default);var s=function(n){var t,u,i;if(n&&n.length>0)for(t=0;t<n.length;t++)u=n[t].minChar,i=n[t].limChar,n[t].isBlockComment||i++,r>=u&&r<i&&o.path.push(n[t])},h=function(u,h,c){var l;if(e(u)){var y=n.hasFlag(f,i.EdgeInclusive)||u.nodeType===n.NodeType.Name||r===t.limChar,a=u.minChar,v=u.limChar+(y?1:0);r>=a&&r<v&&(l=o.path.ast(),(l==null||u.minChar>=l.minChar&&u.limChar<=l.limChar)&&o.path.push(u)),r<v&&s(u.preComments),r>=a&&s(u.postComments),n.hasFlag(f,i.DontPruneSearchBasedOnPosition)||(c.options.goChildren=a<=r&&r<=v)}return u},o=new u;return n.getAstWalkerFactory().walk(t,h,null,null,o),o.path}function h(t,i){var r=0,u=function(t,u,e){return n.isValidAstNode(t)&&(t.minChar<=i&&(r=f(r,t.minChar)),(t.minChar>i||t.limChar<r)&&(e.options.goChildren=!1)),t};return n.getAstWalkerFactory().walk(t,u),r}function c(t,i){var u=function(n,t,r){var u=r.state;return u.push(n),i(u,r),n},f=function(n,t,i){var r=i.state;return r.pop(),n},e=new r;n.getAstWalkerFactory().walk(t,u,f,null,e)}var r,u,i;n.lastOf=t,n.max=f,n.min=o,r=function(){function i(){this.asts=[],this.top=-1}return i.reverseIndexOf=function(n,t){return n===null||n.length<=t?null:n[n.length-t-1]},i.prototype.clone=function(){var n=new i;return n.asts=this.asts.map(function(n){return n}),n.top=this.top,n},i.prototype.pop=function(){var n=this.ast();for(this.up();this.asts.length>this.count();)this.asts.pop();return n},i.prototype.push=function(n){while(this.asts.length>this.count())this.asts.pop();this.top=this.asts.length,this.asts.push(n)},i.prototype.up=function(){if(this.top<=-1)throw new Error("Invalid call to 'up'");this.top--},i.prototype.down=function(){if(this.top==this.ast.length-1)throw new Error("Invalid call to 'down'");this.top++},i.prototype.nodeType=function(){return this.ast()==null?n.NodeType.None:this.ast().nodeType},i.prototype.ast=function(){return i.reverseIndexOf(this.asts,this.asts.length-(this.top+1))},i.prototype.parent=function(){return i.reverseIndexOf(this.asts,this.asts.length-this.top)},i.prototype.count=function(){return this.top+1},i.prototype.get=function(n){return this.asts[n]},i.prototype.isNameOfClass=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.ClassDeclaration&&this.parent().name===this.ast()},i.prototype.isNameOfInterface=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.InterfaceDeclaration&&this.parent().name===this.ast()},i.prototype.isNameOfArgument=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.ArgDecl&&this.parent().id===this.ast()},i.prototype.isNameOfVariable=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.VarDecl&&this.parent().id===this.ast()},i.prototype.isNameOfModule=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.ModuleDeclaration&&this.parent().name===this.ast()},i.prototype.isNameOfFunction=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===n.NodeType.Name&&this.parent().nodeType===n.NodeType.FuncDecl&&this.parent().name===this.ast()},i.prototype.isChildOfScript=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.Script},i.prototype.isChildOfModule=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.ModuleDeclaration},i.prototype.isChildOfClass=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.ClassDeclaration},i.prototype.isArgumentOfClassConstructor=function(){var i=t(this.asts);return this.count()>=5&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-3].nodeType===n.NodeType.List&&this.asts[this.top-4].nodeType===n.NodeType.ClassDeclaration&&this.asts[this.top-2].isConstructor&&this.asts[this.top-2].arguments===this.asts[this.top-1]&&this.asts[this.top-4].constructorDecl===this.asts[this.top-2]},i.prototype.isChildOfInterface=function(){var i=t(this.asts);return this.count()>=3&&this.asts[this.top]===i&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.InterfaceDeclaration},i.prototype.isTopLevelImplicitModule=function(){return this.count()>=1&&this.asts[this.top].nodeType===n.NodeType.ModuleDeclaration&&n.hasFlag(this.asts[this.top].modFlags,n.ModuleFlags.IsWholeFile)},i.prototype.isBodyOfTopLevelImplicitModule=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.ModuleDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]&&n.hasFlag(this.asts[this.top-1].modFlags,n.ModuleFlags.IsWholeFile)},i.prototype.isBodyOfScript=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Script&&this.asts[this.top-1].bod==this.asts[this.top-0]},i.prototype.isBodyOfSwitch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Switch&&this.asts[this.top-1].caseList==this.asts[this.top-0]},i.prototype.isBodyOfModule=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ModuleDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfClass=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ClassDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfFunction=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-1].bod==this.asts[this.top-0]},i.prototype.isBodyOfInterface=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.InterfaceDeclaration&&this.asts[this.top-1].members==this.asts[this.top-0]},i.prototype.isBodyOfBlock=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Block&&this.asts[this.top-1].statements==this.asts[this.top-0]},i.prototype.isBodyOfFor=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.For&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfCase=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Case&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfTry=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Try&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfCatch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Catch&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfDoWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.DoWhile&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.While&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfForIn=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ForIn&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfWith=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.With&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isBodyOfFinally=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Finally&&this.asts[this.top-1].body==this.asts[this.top-0]},i.prototype.isCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.Switch&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]},i.prototype.isDefaultCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.Switch&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]&&this.asts[this.top-2].defaultCase==this.asts[this.top-0]},i.prototype.isListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},i.prototype.isBodyOfObjectLit=function(){return this.isListOfObjectLit()},i.prototype.isEmptyListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]&&this.asts[this.top-0].members.length==0},i.prototype.isMemberOfObjectLit=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-0].nodeType===n.NodeType.Member&&this.asts[this.top-2].operand==this.asts[this.top-1]},i.prototype.isNameOfMemberOfObjectLit=function(){return this.count()>=4&&this.asts[this.top-3].nodeType===n.NodeType.ObjectLit&&this.asts[this.top-2].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-0].nodeType===n.NodeType.Name&&this.asts[this.top-3].operand==this.asts[this.top-2]},i.prototype.isListOfArrayLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.ArrayLit&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},i.prototype.isTargetOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-1].operand1===this.asts[this.top-0]},i.prototype.isMemberOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.Member&&this.asts[this.top-1].operand2===this.asts[this.top-0]},i.prototype.isItemOfList=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.List},i.prototype.isThenOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.If&&this.asts[this.top-1].thenBod==this.asts[this.top-0]},i.prototype.isElseOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===n.NodeType.If&&this.asts[this.top-1].elseBod==this.asts[this.top-0]},i.prototype.isBodyOfDefaultCase=function(){return this.isBodyOfCase()},i.prototype.isSingleStatementList=function(){return this.count()>=1&&this.asts[this.top].nodeType===n.NodeType.List&&this.asts[this.top].members.length===1},i.prototype.isArgumentListOfFunction=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-1].arguments===this.asts[this.top-0]},i.prototype.isArgumentOfFunction=function(){return this.count()>=3&&this.asts[this.top-1].nodeType===n.NodeType.List&&this.asts[this.top-2].nodeType===n.NodeType.FuncDecl&&this.asts[this.top-2].arguments===this.asts[this.top-1]},i.prototype.isArgumentListOfCall=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.Call&&this.asts[this.top-1].arguments===this.asts[this.top-0]},i.prototype.isArgumentListOfNew=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===n.NodeType.List&&this.asts[this.top-1].nodeType===n.NodeType.New&&this.asts[this.top-1].arguments===this.asts[this.top-0]},i.prototype.isSynthesizedBlock=function(){return this.count()>=1&&this.asts[this.top-0].nodeType===n.NodeType.Block&&this.asts[this.top-0].isStatementBlock===!1},i}(),n.AstPath=r,n.isValidAstNode=e,u=function(){function t(){this.path=new n.AstPath}return t}(),n.AstPathContext=u,function(n){n._map=[],n.Default=0,n.EdgeInclusive=1,n.DontPruneSearchBasedOnPosition=2}(n.GetAstPathOptions||(n.GetAstPathOptions={})),i=n.GetAstPathOptions,n.getAstPathToPosition=s,n.getTokenizationOffset=h,n.walkAST=c}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.logger=n}return t.prototype.logScript=function(t){var i=this;this.logLinemap(t.locationInfo.lineMap);var r=[],u=function(n){r.push(n);var f=(r.length-1)*2;return i.logComments(t,n.preComments,f),i.logNode(t,n,f),i.logComments(t,n.postComments,f),n},f=function(n){return r.pop(),n};n.getAstWalkerFactory().walk(t,u,f)},t.prototype.logNode=function(n,t,i){var r=this.addPadding("",i,"| ",!0);r=r.concat("+ "+t.treeViewLabel()),r=this.addPadding(r,70," ",!1),r=r+this.addLineColumn(n,t.minChar),r=this.addPadding(r,80," ",!1),r=r+"=> ",r=r+this.addLineColumn(n,t.limChar),r=this.addPadding(r,102," ",!1),r=r.concat("["+this.addPadding(t.minChar.toString(),1," ",!0)+", "+this.addPadding(t.limChar.toString(),1," ",!0)+"]"),r=this.addPadding(r,115," ",!1),r=r.concat("sym="+t.sym),r=this.addPadding(r,135," ",!1),r=r.concat("type="+(t.type===null?"null":t.type.getTypeName())),this.logger.log(r)},t.prototype.logComments=function(n,t,i){if(t!=null)for(var r=0;r<t.length;r++)this.logNode(n,t[r],i)},t.prototype.logLinemap=function(n){for(var i="[",t=0;t<n.length;t++)t>0&&(i+=","),i+=n[t];i+="]",this.logger.log("linemap: "+i)},t.prototype.addPadding=function(n,t,i,r){for(var u=r?"":n,f=n.length;f<t;f++)u=u+i;return u=u+(r?n:"")},t.prototype.addLineColumn=function(t,i){var r={line:-1,col:-1};return n.getSourceLineColFromMap(r,i,t.locationInfo.lineMap),r.col!==-1&&r.col++,"("+r.line+", "+r.col+")"},t}();n.AstLogger=t}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.checker=n}return t.prototype.resolveBaseTypeLinks=function(n,t){var r=null,i,u;if(n)for(r=[],i=0,u=n.length;i<u;i++)r[i]=this.checker.resolveBaseTypeLink(n[i],t);return r},t.prototype.resolveBases=function(n,t){var f,e,r;t.extendsList=this.resolveBaseTypeLinks(t.extendsTypeLinks,n);for(var i=0,u=t.extendsList.length,o=t.isClassInstance();i<u;i++)f=t.extendsList[i].isClassInstance(),t.extendsList[i]!=this.checker.anyType&&(r=t.extendsTypeLinks[i].ast,o?f||this.checker.errorReporter.simpleError(r,"A class may only extend other classes, "+t.extendsList[i].symbol.fullName()+" is not a class."):f&&this.checker.errorReporter.simpleError(r,"An interface may only extend other interfaces, "+t.extendsList[i].symbol.fullName()+" is a class."));if(t.implementsList=this.resolveBaseTypeLinks(t.implementsTypeLinks,n),t.implementsList)for(i=0,u=t.implementsList.length;i<u;i++)e=t.implementsList[i],r=t.implementsTypeLinks[i].ast,e.isClassInstance()&&o&&this.checker.errorReporter.simpleError(r,"A class may only implement an interface; "+e.symbol.fullName()+" is a class.")},t.prototype.resolveSignatureGroup=function(n,t,i){for(var h=!n.hasImplementation,r,e,o,u,f=0,s=n.signatures.length;f<s;f++){for(r=n.signatures[f],i?r.returnType.type=i:this.checker.resolveTypeLink(t,r.returnType,h),e=r.parameters.length,o=0;o<e;o++)this.bindSymbol(t,r.parameters[o]);r.hasVariableArgList&&(u=r.parameters[e-1],u.argsOffset=e-1,u.getType().isArray()||(this.checker.errorReporter.simpleErrorFromSym(u,"... parameter must have array type"),u.parameter.typeLink.type=this.checker.makeArrayType(u.parameter.typeLink.type)))}},t.prototype.bindType=function(t,i,r){if(r&&this.bindType(t,r,null),i.hasMembers()){var s=i.members,f=i.ambientMembers,e=i.getAllEnclosedTypes(),o=i.getAllAmbientEnclosedTypes(),h=new n.SymbolTableScope(s,f,e,o,i.symbol),u=new n.SymbolAggregateScope(i.symbol),c=this.checker.currentModDecl,l=this.checker.inBind;u.addParentScope(h),u.addParentScope(t),i.isModuleType()&&(this.checker.currentModDecl=i.symbol.declAST,this.checker.inBind=!0),s&&this.bind(u,i.members.allMembers),e&&this.bind(u,e.allMembers),f&&this.bind(u,f.allMembers),o&&this.bind(u,o.allMembers),this.checker.currentModDecl=c,this.checker.inBind=l}i.extendsTypeLinks&&this.resolveBases(t,i),i.construct&&this.resolveSignatureGroup(i.construct,t,r),i.call&&this.resolveSignatureGroup(i.call,t,null),i.index&&this.resolveSignatureGroup(i.index,t,null),i.elementType&&this.bindType(t,i.elementType,null)},t.prototype.bindSymbol=function(t,i){var e,r,o,f,u;if(!i.bound){e=this.checker.locationInfo,this.checker.units&&i.unitIndex>=0&&i.unitIndex<this.checker.units.length&&(this.checker.locationInfo=this.checker.units[i.unitIndex]);switch(i.kind()){case n.SymbolKind.Type:if(i.flags&n.SymbolFlags.Bound)break;if(r=i,r.flags|=n.SymbolFlags.Bound,r.aliasLink&&!r.type&&r.aliasLink.alias.nodeType==n.NodeType.Name&&(o=r.aliasLink.alias.text,f=this.checker.findSymbolForDynamicModule(o,this.checker.locationInfo.filename,function(n){return t.find(n,!1,!0)}),f&&(r.type=f.getType())),r.type&&r.type!=this.checker.gloModType&&(this.bindType(t,r.type,r.instanceType),r.type.isModuleType()))for(u=0;u<r.expansions.length;u++)this.bindType(t,r.expansions[u],r.instanceType);break;case n.SymbolKind.Field:this.checker.resolveTypeLink(t,i.field.typeLink,!1);break;case n.SymbolKind.Parameter:this.checker.resolveTypeLink(t,i.parameter.typeLink,!0)}this.checker.locationInfo=e}i.bound=!0},t.prototype.bind=function(n,t){t.map(function(t,i,r){r.bindSymbol(n,i)},this)},t}();n.Binder=t}(TypeScript||(TypeScript={})),function(n){var t=function(){function n(){}return n.encodedValues="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n.encode=function(t){if(t<64)return n.encodedValues.charAt(t);throw TypeError(t+": not a 64 based value");},n.decodeChar=function(t){if(t.length===1)return n.encodedValues.indexOf(t);throw TypeError('"'+t+'" must have length 1');},n}(),i=function(){function n(){}return n.encode=function(n){var i,r;n=n<0?(-n<<1)+1:n<<1,i="";do r=n&31,n=n>>5,n>0&&(r=r|32),i=i+t.encode(r);while(n>0);return i},n.decode=function(n){for(var r=0,f=!1,e=0,u,i=0;i<n.length;i++)if(u=t.decodeChar(n[i]),i===0?((u&1)==1&&(f=!0),r=u>>1&15):r=r|(u&31)<<e,e+=i==0?4:5,(u&32)!=32)return{value:f?-r:r,rest:n.substr(i+1)};throw new Error('Base64 value "'+n+'" finished with a continuation bit');},n}();n.Base64VLQFormat=i}(TypeScript||(TypeScript={})),JSON2={},function(){"use strict";function i(n){return n<10?"0"+n:n}function o(n){return e.lastIndex=0,e.test(n)?'"'+n.replace(e,function(n){var t=c[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function u(i,f){var s,l=null,h,a,v=n,c,e=f[i];e&&typeof e=="object"&&typeof e.toJSON=="function"&&(e=e.toJSON(i)),typeof t=="function"&&(e=t.call(f,i,e));switch(typeof e){case"string":return o(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(n+=r,c=[],Object.prototype.toString.apply(e,[])==="[object Array]"){for(a=e.length,s=0;s<a;s+=1)c[s]=u(s,e)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));else for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&(h=u(l,e),h&&c.push(o(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}var s,h;typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},s=String.prototype,h=Number.prototype,h.JSON=s.JSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,r,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON2.stringify!="function"&&(JSON2.stringify=function(i,f,e){var o;if(n="",r="",typeof e=="number")for(o=0;o<e;o+=1)r+=" ";else typeof e=="string"&&(r=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return u("",{"":i})}),typeof JSON2.parse!="function"&&(JSON2.parse=function(n,t){function r(n,i){var f=null,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),f.lastIndex=0,f.test(n)&&(n=n.replace(f,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}(),function(n){var t=function(){function n(){}return n}(),i,r;n.SourceMapPosition=t,i=function(){function n(){this.start=new t,this.end=new t,this.nameIndex=-1,this.childMappings=[]}return n}(),n.SourceMapping=i,r=function(){function t(t,i,r,u,f){this.jsFile=r,this.sourceMapOut=u,this.errorReporter=f,this.sourceMappings=[],this.currentMappings=[],this.names=[],this.currentNameIndex=[],this.currentMappings.push(this.sourceMappings),i=n.switchToForwardSlashes(i),this.jsFileName=n.getPrettyName(i,!1,!0);var e=i.lastIndexOf(this.jsFileName),o=i.substring(0,e);this.tsFileName=n.getRelativePathToFixedPath(o,t)}return t.MapFileExtension=".map",t.EmitSourceMapping=function(i){var u=i[0],o,v,y,p;u.jsFile.WriteLine("//@ sourceMappingURL="+u.jsFileName+t.MapFileExtension);var w=u.sourceMapOut,r="",s=[],h=0,c=0,b=0,k=0,d=0,g=0,l=[],f=0,a=!1,e=null;for(o=0;o<i.length;o++)u=i[o],v=s.length,s.push(u.tsFileName),u.names.length>0&&l.push.apply(l,u.names),y=function(t,i){if(e==null||e.emittedColumn!=t.emittedColumn||e.emittedLine!=t.emittedLine){if(c!==t.emittedLine){while(c<t.emittedLine)h=0,r=r+";",c++;a=!1}else a&&(r=r+",");r=r+n.Base64VLQFormat.encode(t.emittedColumn-h),h=t.emittedColumn,r=r+n.Base64VLQFormat.encode(v-d),d=v,r=r+n.Base64VLQFormat.encode(t.sourceLine-1-k),k=t.sourceLine-1,r=r+n.Base64VLQFormat.encode(t.sourceColumn-b),b=t.sourceColumn,i>=0&&(r=r+n.Base64VLQFormat.encode(f+i-g),g=f+i),a=!0,e=t}},p=function(n){for(var t,i=0;i<n.length;i++)t=n[i],y(t.start,t.nameIndex),p(t.childMappings),y(t.end,t.nameIndex)},p(u.sourceMappings,-1),f=f+u.names.length;r!=""&&w.Write(JSON2.stringify({version:3,file:u.jsFileName,sources:s,names:l,mappings:r}));try{w.Close()}catch(nt){u.errorReporter.emitterError(null,nt.message)}},t}(),n.SourceMapper=r}(TypeScript||(TypeScript={})),function(n){var t,i,u,r,f;(function(n){n._map=[],n._map[0]="Prog",n.Prog=0,n._map[1]="Module",n.Module=1,n._map[2]="DynamicModule",n.DynamicModule=2,n._map[3]="Class",n.Class=3,n._map[4]="Constructor",n.Constructor=4,n._map[5]="Function",n.Function=5,n._map[6]="Args",n.Args=6,n._map[7]="Interface",n.Interface=7})(n.EmitContainer||(n.EmitContainer={})),t=n.EmitContainer,i=function(){function n(){this.column=0,this.line=0,this.pretty=!1,this.inObjectLiteral=!1,this.container=t.Prog}return n}(),n.EmitState=i,u=function(){function n(n){this.ioHost=null,this.outputMany=!0,this.commonDirectoryPath="",this.minWhitespace=n.minWhitespace,this.propagateConstants=n.propagateConstants,this.emitComments=n.emitComments,this.outputOption=n.outputOption}return n.prototype.mapOutputFileName=function(n,t){if(this.outputMany){var i=n;return this.outputOption!=""&&(i=n.replace(this.commonDirectoryPath,""),i=this.outputOption+i),t(i,!1)}return t(this.outputOption,!0)},n}(),n.EmitOptions=u,r=function(){function n(){this.indentAmt=0}return n.indentStep=4,n.indentStepString="    ",n.indentStrings=[],n.prototype.increaseIndent=function(){this.indentAmt+=n.indentStep},n.prototype.decreaseIndent=function(){this.indentAmt-=n.indentStep},n.prototype.getIndent=function(){var t=n.indentStrings[this.indentAmt],i;if(t===undefined){for(t="",i=0;i<this.indentAmt;i=i+n.indentStep)t+=n.indentStepString;n.indentStrings[this.indentAmt]=t}return t},n}(),n.Indenter=r,f=function(){function u(n,t,u,f,e){this.checker=n,this.emittingFileName=t,this.outfile=u,this.emitOptions=f,this.errorReporter=e,this.prologueEmitted=!1,this.thisClassNode=null,this.thisFnc=null,this.moduleDeclList=[],this.moduleName="",this.emitState=new i,this.indenter=new r,this.ambientModule=!1,this.modAliasId=null,this.firstModAlias=null,this.allSourceMappers=[],this.sourceMapper=null,this.captureThisStmtString="var _this = this;",this.varListCountStack=[0]}return u.prototype.setSourceMappings=function(n){this.allSourceMappers.push(n),this.sourceMapper=n},u.prototype.writeToOutput=function(n){this.outfile.Write(n),this.emitState.column+=n.length},u.prototype.writeToOutputTrimmable=function(n){this.emitOptions.minWhitespace&&(n=n.replace(/[\s]*/g,"")),this.writeToOutput(n)},u.prototype.writeLineToOutput=function(t){if(this.emitOptions.minWhitespace){this.writeToOutput(t);var i=t.charCodeAt(t.length-1);i==n.LexCodeSpace||i==n.LexCodeSMC||i==n.LexCodeLBR||this.writeToOutput(" ")}else this.outfile.WriteLine(t),this.emitState.column=0,this.emitState.line++},u.prototype.writeCaptureThisStatement=function(n){this.emitIndent(),this.recordSourceMappingStart(n),this.writeToOutput(this.captureThisStmtString),this.recordSourceMappingEnd(n),this.writeLineToOutput("")},u.prototype.setInVarBlock=function(n){this.varListCountStack[this.varListCountStack.length-1]=n},u.prototype.setInObjectLiteral=function(n){var t=this.emitState.inObjectLiteral;return this.emitState.inObjectLiteral=n,t},u.prototype.setContainer=function(n){var t=this.emitState.container;return this.emitState.container=n,t},u.prototype.getIndentString=function(){return this.emitOptions.minWhitespace?"":this.indenter.getIndent()},u.prototype.emitIndent=function(){this.writeToOutput(this.getIndentString())},u.prototype.emitCommentInPlace=function(n){var t,i,r;if(this.recordSourceMappingStart(n),t=n.getText(),i=!1,n.isBlockComment){if(this.emitState.column==0&&this.emitIndent(),this.writeToOutput(t[0]),t.length>1||n.endsLine){for(this.writeLineToOutput(""),r=1;r<t.length;r++)this.emitIndent(),this.writeLineToOutput(t[r]);i=!0}}else this.emitState.column==0&&this.emitIndent(),this.writeLineToOutput(t[0]),i=!0;i?this.emitIndent():this.writeToOutput(" "),this.recordSourceMappingEnd(n)},u.prototype.emitParensAndCommentsInPlace=function(n,t){var i=t?n.preComments:n.postComments,r;if(n.isParenthesized&&!t&&this.writeToOutput(")"),this.emitOptions.emitComments&&i&&i.length!=0)for(r=0;r<i.length;r++)this.emitCommentInPlace(i[r]);n.isParenthesized&&t&&this.writeToOutput("(")},u.prototype.emitObjectLiteral=function(t){this.writeLineToOutput("{"),this.indenter.increaseIndent();var i=this.setInObjectLiteral(!0);this.emitJavascriptList(t,",",n.TokenID.Comma,!0,!1,!1),this.setInObjectLiteral(i),this.indenter.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")},u.prototype.emitArrayLiteral=function(t){this.writeToOutput("["),t&&(this.writeLineToOutput(""),this.indenter.increaseIndent(),this.emitJavascriptList(t,", ",n.TokenID.Comma,!0,!1,!1),this.indenter.decreaseIndent(),this.emitIndent()),this.writeToOutput("]")},u.prototype.emitNew=function(t,i){if(this.writeToOutput("new "),t.nodeType==n.NodeType.TypeRef){var r=t;r.arrayCount?this.writeToOutput("Array()"):(this.emitJavascript(r.term,n.TokenID.Tilde,!1),this.writeToOutput("()"))}else this.emitJavascript(t,n.TokenID.Tilde,!1),this.recordSourceMappingStart(i),this.writeToOutput("("),this.emitJavascriptList(i,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput(")"),this.recordSourceMappingEnd(i)},u.prototype.tryEmitConstant=function(t){var i,r,f,u;return this.emitOptions.propagateConstants?(i=t.operand2,i&&i.sym&&i.sym.isVariable()&&n.hasFlag(i.sym.flags,n.SymbolFlags.Constant)&&i.sym.declAST&&(r=i.sym.declAST,r.init&&r.init.nodeType==n.NodeType.NumberLit))?(f=r.init,this.writeToOutput(f.value.toString()),u=" /* ",u+=i.actualText,u+=" */ ",this.writeToOutput(u),!0):!1:!1},u.prototype.emitCall=function(i,r,u){if(!this.emitSuperCall(i))if(n.hasFlag(i.flags,n.ASTFlags.ClassBaseConstructorCall)){this.indenter.decreaseIndent(),this.indenter.decreaseIndent();var f=new n.ASTList;f.members[0]=i,this.emitConstructorCalls(f,this.thisClassNode),this.indenter.increaseIndent(),this.indenter.increaseIndent()}else r.nodeType!=n.NodeType.FuncDecl||r.isParenthesized||this.writeToOutput("("),i.target.nodeType==n.NodeType.Super&&this.emitState.container==t.Constructor?this.writeToOutput("_super.call"):this.emitJavascript(r,n.TokenID.OpenParen,!1),r.nodeType!=n.NodeType.FuncDecl||r.isParenthesized||this.writeToOutput(")"),this.recordSourceMappingStart(u),this.writeToOutput("("),i.target.nodeType==n.NodeType.Super&&this.emitState.container==t.Constructor&&(this.writeToOutput("this"),u&&u.members.length&&this.writeToOutput(", ")),this.emitJavascriptList(u,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput(")"),this.recordSourceMappingEnd(u)},u.prototype.emitConstructorCalls=function(t,i){var o,f,r,u,s,e;if(t!=null){for(o=t.members.length,this.recordSourceMappingStart(i),f=0;f<o;f++)r=t.members[f],u=null,u=r.nodeType==n.NodeType.Call?r.target.type.symbol:r.type.symbol,s=u.name,u.declModule!=i.type.symbol.declModule&&(s=u.fullName()),r.nodeType==n.NodeType.Call?(this.emitIndent(),this.writeToOutput("_super.call(this"),e=r.arguments,e&&e.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(e,", ",n.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")")):r.type&&r.type.isClassInstance()&&(this.emitIndent(),this.writeToOutput(i.name.actualText+"._super.constructor"),this.writeToOutput(".call(this)"));this.recordSourceMappingEnd(i)}},u.prototype.emitInnerFunction=function(i,r,u,f,e,o){var g=i.isConstructor&&n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod),nt=g&&n.hasFlag(this.thisClassNode.type.instanceType.typeFlags,n.TypeFlags.HasBaseType)&&!n.hasFlag(this.thisClassNode.type.instanceType.typeFlags,n.TypeFlags.HasBaseTypeOfObject),y=nt&&n.hasFlag(this.thisClassNode.varFlags,n.VarFlags.ClassSuperMustBeFirstCallInConstructor),b=n.hasFlag(i.fncFlags,n.FncFlags.IsFunctionExpression)&&!i.isParenthesized&&!i.isAccessor()&&(n.hasFlag(i.flags,n.ASTFlags.ExplicitSemicolon)||n.hasFlag(i.flags,n.ASTFlags.AutomaticSemicolon)),p,k,a,s,c,d,h,v;this.emitParensAndCommentsInPlace(i,!0),b&&this.writeToOutput("("),this.recordSourceMappingStart(i),i.isAccessor()&&i.accessorSymbol.isObjectLitField||this.writeToOutput("function "),r&&(p=i.getNameText(),p&&!i.isAccessor()&&(i.name&&this.recordSourceMappingStart(i.name),this.writeToOutput(p),i.name&&this.recordSourceMappingEnd(i.name))),this.writeToOutput("(");var l=0,h=0,s,w=[];if(i.arguments){for(k=this.setContainer(t.Args),l=i.arguments.members.length,a=l,i.variableArgList&&a--,h=0;h<a;h++)s=i.arguments.members[h],s.init&&w.push(s),this.emitJavascript(s,n.TokenID.OpenParen,!1),h<a-1&&this.writeToOutput(", ");this.setContainer(k)}for(this.writeLineToOutput(") {"),i.isConstructor?this.recordSourceMappingNameStart("constructor"):i.isGetAccessor()?this.recordSourceMappingNameStart("get_"+i.getNameText()):i.isSetAccessor()?this.recordSourceMappingNameStart("set_"+i.getNameText()):this.recordSourceMappingNameStart(i.getNameText()),this.indenter.increaseIndent(),h=0;h<w.length;h++)s=w[h],this.emitIndent(),this.recordSourceMappingStart(s),this.writeToOutput("if (typeof "+s.id.actualText+' === "undefined") { '),this.recordSourceMappingStart(s.id),this.writeToOutput(s.id.actualText),this.recordSourceMappingEnd(s.id),this.writeToOutput(" = "),this.emitJavascript(s.init,n.TokenID.OpenParen,!1),this.writeLineToOutput("; }"),this.recordSourceMappingEnd(s);if(i.isConstructor&&i.classDecl.varFlags&n.VarFlags.MustCaptureThis&&this.writeCaptureThisStatement(i),i.isConstructor&&!y){if(i.arguments)for(l=i.arguments.members.length,h=0;h<l;h++)s=i.arguments.members[h],(s.varFlags&n.VarFlags.Property)!=n.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(s),this.recordSourceMappingStart(s.id),this.writeToOutput("this."+s.id.actualText),this.recordSourceMappingEnd(s.id),this.writeToOutput(" = "),this.recordSourceMappingStart(s.id),this.writeToOutput(s.id.actualText),this.recordSourceMappingEnd(s.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(s));n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod)||this.emitConstructorCalls(f,o)}if(e&&this.writeCaptureThisStatement(i),i.variableArgList&&(l=i.arguments.members.length,c=i.arguments.members[l-1],this.emitIndent(),this.recordSourceMappingStart(c),this.writeToOutput("var "),this.recordSourceMappingStart(c.id),this.writeToOutput(c.id.actualText),this.recordSourceMappingEnd(c.id),this.writeLineToOutput(" = [];"),this.recordSourceMappingEnd(c),this.emitIndent(),this.writeToOutput("for ("),this.recordSourceMappingStart(c),this.writeToOutput("var _i = 0;"),this.recordSourceMappingEnd(c),this.writeToOutput(" "),this.recordSourceMappingStart(c),this.writeToOutput("_i < (arguments.length - "+(l-1)+")"),this.recordSourceMappingEnd(c),this.writeToOutput("; "),this.recordSourceMappingStart(c),this.writeToOutput("_i++"),this.recordSourceMappingEnd(c),this.writeLineToOutput(") {"),this.indenter.increaseIndent(),this.emitIndent(),this.recordSourceMappingStart(c),this.writeToOutput(c.id.actualText+"[_i] = arguments[_i + "+(l-1)+"];"),this.recordSourceMappingEnd(c),this.writeLineToOutput(""),this.indenter.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")),i.isConstructor&&n.hasFlag(i.fncFlags,n.FncFlags.ClassMethod)&&!y)for(d=this.thisClassNode.members.members.length,h=0;h<d;h++)this.thisClassNode.members.members[h].nodeType==n.NodeType.VarDecl&&(v=this.thisClassNode.members.members[h],!n.hasFlag(v.varFlags,n.VarFlags.Static)&&v.init&&(this.emitIndent(),this.emitJavascriptVarDecl(v,n.TokenID.Tilde),this.writeLineToOutput("")));this.emitBareJavascriptStatements(i.bod,y),this.indenter.decreaseIndent(),this.emitIndent(),this.recordSourceMappingStart(i.endingToken),this.writeToOutput("}"),this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.recordSourceMappingEnd(i),b&&this.writeToOutput(")"),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1),!u&&!n.hasFlag(i.fncFlags,n.FncFlags.IsFunctionExpression)&&(n.hasFlag(i.fncFlags,n.FncFlags.Definition)||i.isConstructor)?this.writeLineToOutput(""):n.hasFlag(i.fncFlags,n.FncFlags.IsFunctionExpression)&&(n.hasFlag(i.flags,n.ASTFlags.ExplicitSemicolon)||n.hasFlag(i.flags,n.ASTFlags.AutomaticSemicolon))&&this.writeLineToOutput(";")},u.prototype.emitJavascriptModule=function(i){var f=i.name.actualText,u,p,h,g,nt,r,v,b,k;if(n.isTSFile(f)?i.name.setText(f.substring(0,f.length-3)):n.isSTRFile(f)&&i.name.setText(f.substring(0,f.length-4)),!n.hasFlag(i.modFlags,n.ModuleFlags.Ambient)){var a=n.hasFlag(i.modFlags,n.ModuleFlags.IsDynamic),d=this.outfile,tt=this.emittingFileName,it=this.allSourceMappers,y=this.sourceMapper,rt=this.emitState.column,ut=this.emitState.line,e=this.setContainer(t.Module),o=this.moduleName,s=n.hasFlag(i.modFlags,n.ModuleFlags.Exported);if(this.moduleDeclList[this.moduleDeclList.length]=i,u=n.hasFlag(i.modFlags,n.ModuleFlags.IsWholeFile),this.moduleName=i.name.actualText,a){if(p=n.stripQuotes(i.name.actualText),h=n.trimModName(p)+".js",h=this.emitOptions.mapOutputFileName(h,n.TypeScriptCompiler.mapToJSFileName),this.emitOptions.ioHost&&(n.switchToForwardSlashes(h)!=n.switchToForwardSlashes(this.emittingFileName)?(this.emittingFileName=h,g=i.containsUnicodeChar||this.emitOptions.emitComments&&i.containsUnicodeCharInComment,this.outfile=this.createFile(this.emittingFileName,g),y!=null&&(this.allSourceMappers=[],nt=this.createFile(this.emittingFileName+n.SourceMapper.MapFileExtension,!1),this.setSourceMappings(new n.SourceMapper(p,this.emittingFileName,this.outfile,nt,this.errorReporter)),this.emitState.column=0,this.emitState.line=0)):n.CompilerDiagnostics.assert(this.emitOptions.outputMany,"Cannot have dynamic modules compiling into single file")),this.setContainer(t.DynamicModule),this.recordSourceMappingStart(i),n.moduleGenTarget==n.ModuleGenTarget.Asynchronous){var c='["require", "exports"',w="require, exports",l=null;for(r=0;r<i.mod.importedModules.length;r++)l=i.mod.importedModules[r],l.id.sym&&!l.id.sym.onlyReferencedAsTypeRef&&(r<=i.mod.importedModules.length-1&&(c+=", ",w+=", "),w+="__"+l.id.actualText+"__",c+=l.firstAliasedModToString());for(r=0;r<i.amdDependencies.length;r++)c+=', "'+i.amdDependencies[r]+'"';c+="]",this.writeLineToOutput("define("+c+", function("+w+") {")}}else s||(this.recordSourceMappingStart(i),this.writeToOutput("var "),this.recordSourceMappingStart(i.name),this.writeToOutput(this.moduleName),this.recordSourceMappingEnd(i.name),this.writeLineToOutput(";"),this.recordSourceMappingEnd(i),this.emitIndent()),this.writeToOutput("("),this.recordSourceMappingStart(i),this.writeToOutput("function ("),this.recordSourceMappingStart(i.name),this.writeToOutput(this.moduleName),this.recordSourceMappingEnd(i.name),this.writeLineToOutput(") {");u||this.recordSourceMappingNameStart(this.moduleName),a&&n.moduleGenTarget!=n.ModuleGenTarget.Asynchronous||this.indenter.increaseIndent(),i.modFlags&n.ModuleFlags.MustCaptureThis&&this.writeCaptureThisStatement(i),this.emitJavascriptList(i.members,null,n.TokenID.Semicolon,!0,!1,!1),a&&n.moduleGenTarget!=n.ModuleGenTarget.Asynchronous||this.indenter.decreaseIndent(),this.emitIndent(),a?(n.moduleGenTarget==n.ModuleGenTarget.Asynchronous&&this.writeLineToOutput("})"),u||this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i),this.outfile!=d&&(this.Close(),y!=null&&(this.allSourceMappers=it,this.sourceMapper=y,this.emitState.column=rt,this.emitState.line=ut),this.outfile=d,this.emittingFileName=tt)):(v=null,i.type&&i.type.symbol.container&&i.type.symbol.container.declAST&&(v=i.type.symbol.container.declAST),b=v&&n.hasFlag(v.modFlags,n.ModuleFlags.IsDynamic),this.recordSourceMappingStart(i.endingToken),e==t.Prog&&s?(this.writeToOutput("}"),u||this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.writeLineToOutput(")(this."+this.moduleName+" || (this."+this.moduleName+" = {}));")):s||e==t.Prog?(k=o!=""?(b?"exports":o)+".":o,this.writeToOutput("}"),u||this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.writeLineToOutput(")("+k+this.moduleName+" || ("+k+this.moduleName+" = {}));")):s||e==t.Prog?(this.writeToOutput("}"),u||this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.writeLineToOutput(")();")):(this.writeToOutput("}"),u||this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.writeLineToOutput(")("+this.moduleName+" || ("+this.moduleName+" = {}));")),this.recordSourceMappingEnd(i),e!=t.Prog&&s&&(this.emitIndent(),this.recordSourceMappingStart(i),b?this.writeLineToOutput("var "+this.moduleName+" = exports."+this.moduleName+";"):this.writeLineToOutput("var "+this.moduleName+" = "+o+"."+this.moduleName+";"),this.recordSourceMappingEnd(i))),this.setContainer(e),this.moduleName=o,this.moduleDeclList.length--}},u.prototype.emitIndex=function(t,i){var r=this.setInObjectLiteral(!1);this.emitJavascript(t,n.TokenID.Tilde,!1),this.writeToOutput("["),this.emitJavascriptList(i,", ",n.TokenID.Comma,!1,!1,!1),this.writeToOutput("]"),this.setInObjectLiteral(r)},u.prototype.emitStringLiteral=function(n){this.writeToOutput(n)},u.prototype.emitJavascriptFunction=function(i){var f,s,h,c;if(!n.hasFlag(i.fncFlags,n.FncFlags.Signature)&&!i.isOverload){s=this.thisFnc,this.thisFnc=i,f=i.isConstructor?this.setContainer(t.Constructor):this.setContainer(t.Function);var e=null,o=!1,r=i.getNameText();(this.emitState.inObjectLiteral||!i.isAccessor())&&(f!=t.Constructor||(i.fncFlags&n.FncFlags.Method)==n.FncFlags.None)&&(h=this.setInObjectLiteral(!1),this.thisClassNode&&(e=this.thisClassNode.extendsList),o=u.shouldCaptureThis(i),this.recordSourceMappingStart(i),n.hasFlag(i.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)&&i.type.symbol.container==this.checker.gloMod&&!i.isConstructor?(this.writeToOutput("this."+r+" = "),this.emitInnerFunction(i,!1,!1,e,o,this.thisClassNode)):this.emitInnerFunction(i,i.name&&!i.name.isMissing(),!1,e,o,this.thisClassNode),this.setInObjectLiteral(h)),this.setContainer(f),this.thisFnc=s,n.hasFlag(i.fncFlags,n.FncFlags.Definition)&&(n.hasFlag(i.fncFlags,n.FncFlags.Static)?this.thisClassNode&&(i.isAccessor()?this.emitPropertyAccessor(i,this.thisClassNode.name.actualText,!1):(this.emitIndent(),this.recordSourceMappingStart(i),this.writeLineToOutput(this.thisClassNode.name.actualText+"."+r+" = "+r+";"),this.recordSourceMappingEnd(i))):(this.emitState.container==t.Module||this.emitState.container==t.DynamicModule)&&n.hasFlag(i.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)&&(this.emitIndent(),c=this.emitState.container==t.Module?this.moduleName:"exports",this.recordSourceMappingStart(i),this.writeLineToOutput(c+"."+r+" = "+r+";"),this.recordSourceMappingEnd(i)))}},u.prototype.emitAmbientVarDecl=function(t){t.init&&(this.emitParensAndCommentsInPlace(t,!0),this.recordSourceMappingStart(t),this.recordSourceMappingStart(t.id),this.writeToOutput(t.id.actualText),this.recordSourceMappingEnd(t.id),this.writeToOutput(" = "),this.emitJavascript(t.init,n.TokenID.Comma,!1),this.recordSourceMappingEnd(t),this.writeToOutput(";"),this.emitParensAndCommentsInPlace(t,!1))},u.prototype.varListCount=function(){return this.varListCountStack[this.varListCountStack.length-1]},u.prototype.emitVarDeclVar=function(){return this.varListCount()>=0&&(this.writeToOutput("var "),this.setInVarBlock(-this.varListCount())),!0},u.prototype.onEmitVar=function(){this.varListCount()>0?this.setInVarBlock(this.varListCount()-1):this.varListCount()<0&&this.setInVarBlock(this.varListCount()+1)},u.prototype.emitJavascriptVarDecl=function(i,r){var u,e,f;(i.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient?(this.emitAmbientVarDecl(i),this.onEmitVar()):(u=i.sym,e=i.init!=null,this.emitParensAndCommentsInPlace(i,!0),this.recordSourceMappingStart(i),u&&u.isMember()&&u.container&&u.container.kind()==n.SymbolKind.Type?(f=u.container.type,f.isClass()&&!n.hasFlag(u.flags,n.SymbolFlags.ModuleMember)?this.emitState.container!=t.Args&&(n.hasFlag(u.flags,n.SymbolFlags.Static)?this.writeToOutput(u.container.name+"."):this.writeToOutput("this.")):f.hasImplementation()?n.hasFlag(u.flags,n.SymbolFlags.Exported)||u.container!=this.checker.gloMod&&n.hasFlag(u.flags,n.SymbolFlags.Property)?n.hasFlag(i.varFlags,n.VarFlags.LocalStatic)?this.writeToOutput("."):this.emitState.container==t.DynamicModule?this.writeToOutput("exports."):this.writeToOutput(this.moduleName+"."):this.emitVarDeclVar():r!=n.TokenID.OpenParen&&(n.hasFlag(u.flags,n.SymbolFlags.Exported)&&u.container==this.checker.gloMod?this.writeToOutput("this."):this.emitVarDeclVar())):r!=n.TokenID.OpenParen&&this.emitVarDeclVar(),this.recordSourceMappingStart(i.id),this.writeToOutput(i.id.actualText),this.recordSourceMappingEnd(i.id),e&&(this.writeToOutputTrimmable(" = "),this.varListCountStack.push(0),this.emitJavascript(i.init,n.TokenID.Comma,!1),this.varListCountStack.pop()),this.onEmitVar(),r!=n.TokenID.OpenParen&&(this.varListCount()<0?this.writeToOutput(", "):r!=n.TokenID.For&&this.writeToOutputTrimmable(";")),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1))},u.prototype.declEnclosed=function(n){if(n==null)return!0;for(var t=0,i=this.moduleDeclList.length;t<i;t++)if(this.moduleDeclList[t]==n)return!0;return!1},u.prototype.emitJavascriptName=function(i,r){var u=i.sym,s,h,c,e,f,o;this.emitParensAndCommentsInPlace(i,!0),this.recordSourceMappingStart(i),i.isMissing()||(r&&this.emitState.container!=t.Args&&u&&(u.container&&u.container.name!=n.globalId?n.hasFlag(u.flags,n.SymbolFlags.Static)&&n.hasFlag(u.flags,n.SymbolFlags.Property)?u.declModule&&n.hasFlag(u.declModule.modFlags,n.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(u.container.name+"."):u.kind()==n.SymbolKind.Field?(s=u,n.hasFlag(s.flags,n.SymbolFlags.ModuleMember)?u.container!=this.checker.gloMod&&(n.hasFlag(u.flags,n.SymbolFlags.Property)||n.hasFlag(u.flags,n.SymbolFlags.Exported))&&(n.hasFlag(u.declModule.modFlags,n.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(u.container.name+".")):u.isInstanceProperty()&&(this.emitThis(),this.writeToOutput("."))):u.kind()==n.SymbolKind.Type&&(u.isInstanceProperty()?(h=u,c=h.type,c.call&&!n.hasFlag(u.flags,n.SymbolFlags.ModuleMember)&&(this.emitThis(),this.writeToOutput("."))):u.unitIndex==this.checker.locationInfo.unitIndex&&this.declEnclosed(u.declModule)||this.writeToOutput(u.container.name+".")):u.container!=this.checker.gloMod||!n.hasFlag(u.flags,n.SymbolFlags.Exported)||n.hasFlag(u.flags,n.SymbolFlags.Ambient)||(u.isType()||u.isMember())&&u.declModule&&n.hasFlag(u.declModule.modFlags,n.ModuleFlags.Ambient)||this.emitState.container!=t.Prog||u.declAST.nodeType==n.NodeType.FuncDecl||this.writeToOutput("this.")),u&&u.declAST&&u.declAST.nodeType==n.NodeType.ModuleDeclaration&&n.hasFlag(u.declAST.modFlags,n.ModuleFlags.IsDynamic)?(e=u.declAST,n.moduleGenTarget==n.ModuleGenTarget.Asynchronous?this.writeLineToOutput("__"+this.modAliasId+"__;"):(f=i.actualText,o=e.mod.symbol.declAST&&n.hasFlag(e.mod.symbol.declAST.modFlags,n.ModuleFlags.Ambient),f=o?f:this.firstModAlias?this.firstModAlias:n.quoteBaseName(f),f=o?f:n.isRelative(n.stripQuotes(f))?f:n.quoteStr("./"+n.stripQuotes(f)),this.writeToOutput("require("+f+")"))):this.writeToOutput(i.actualText)),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1)},u.prototype.emitJavascriptStatements=function(t,i){var u,r;t?t.nodeType!=n.NodeType.Block?(u=t&&(t.nodeType!=n.NodeType.List||t.members.length>0),(i||u)&&(r=t.nodeType==n.NodeType.Block||t.nodeType==n.NodeType.List&&t.members.length==1&&t.members[0].nodeType==n.NodeType.Block,this.recordSourceMappingStart(t),r||(this.writeLineToOutput(" {"),this.indenter.increaseIndent()),this.emitJavascriptList(t,null,n.TokenID.Semicolon,!0,!1,!1),r||(this.writeLineToOutput(""),this.indenter.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")),this.recordSourceMappingEnd(t))):this.emitJavascript(t,n.TokenID.Semicolon,!0):i&&this.writeToOutput("{ }")},u.prototype.emitBareJavascriptStatements=function(t,i){if(typeof i=="undefined"&&(i=!1),t.nodeType!=n.NodeType.Block)if(t.nodeType==n.NodeType.List){var r=t;r.members.length==2&&r.members[0].nodeType==n.NodeType.Block&&r.members[1].nodeType==n.NodeType.EndCode?(this.emitJavascript(r.members[0],n.TokenID.Semicolon,!0),this.writeLineToOutput("")):this.emitJavascriptList(t,null,n.TokenID.Semicolon,!0,!1,i)}else this.emitJavascript(t,n.TokenID.Semicolon,!0);else this.emitJavascript(t,n.TokenID.Semicolon,!0)},u.prototype.recordSourceMappingNameStart=function(n){if(this.sourceMapper){var t=n;n?this.sourceMapper.currentNameIndex.length>0&&(t=this.sourceMapper.names[this.sourceMapper.currentNameIndex.length-1]+"."+n):t="",this.sourceMapper.names.push(t),this.sourceMapper.currentNameIndex.push(this.sourceMapper.names.length-1)}},u.prototype.recordSourceMappingNameEnd=function(){this.sourceMapper&&this.sourceMapper.currentNameIndex.pop()},u.prototype.recordSourceMappingStart=function(t){var r,i,u;this.sourceMapper&&n.isValidAstNode(t)&&(r={line:-1,col:-1},i=new n.SourceMapping,i.start.emittedColumn=this.emitState.column,i.start.emittedLine=this.emitState.line,n.getSourceLineColFromMap(r,t.minChar,this.checker.locationInfo.lineMap),i.start.sourceColumn=r.col,i.start.sourceLine=r.line,n.getSourceLineColFromMap(r,t.limChar,this.checker.locationInfo.lineMap),i.end.sourceColumn=r.col,i.end.sourceLine=r.line,this.sourceMapper.currentNameIndex.length>0&&(i.nameIndex=this.sourceMapper.currentNameIndex[this.sourceMapper.currentNameIndex.length-1]),u=this.sourceMapper.currentMappings[this.sourceMapper.currentMappings.length-1],u.push(i),this.sourceMapper.currentMappings.push(i.childMappings))},u.prototype.recordSourceMappingEnd=function(t){if(this.sourceMapper&&n.isValidAstNode(t)){this.sourceMapper.currentMappings.pop();var i=this.sourceMapper.currentMappings[this.sourceMapper.currentMappings.length-1],r=i[i.length-1];r.end.emittedColumn=this.emitState.column,r.end.emittedLine=this.emitState.line}},u.prototype.Close=function(){this.sourceMapper!=null&&n.SourceMapper.EmitSourceMapping(this.allSourceMappers);try{this.outfile.Close()}catch(t){this.errorReporter.emitterError(null,t.message)}},u.prototype.emitJavascriptList=function(t,i,r,u,f,e,o,s){var a,b,l,v,d,p,c,g,y,w,h,k;if(typeof e=="undefined"&&(e=!1),typeof o=="undefined"&&(o=!1),t!=null)if(t.nodeType!=n.NodeType.List)this.emitPrologue(o),this.emitJavascript(t,r,u);else{if(a=t,a.members.length==0)return;for(this.emitParensAndCommentsInPlace(t,!0),b=a.members.length,l=0;l<b;l++){if(o&&(l!=1&&n.hasFlag(a.flags,n.ASTFlags.StrictMode)||(this.emitPrologue(s),o=!1)),l==1&&e){if(v=this.thisClassNode.constructorDecl,v&&v.arguments)for(d=v.arguments.members.length,p=0;p<d;p++)c=v.arguments.members[p],(c.varFlags&n.VarFlags.Property)!=n.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(c),this.recordSourceMappingStart(c.id),this.writeToOutput("this."+c.id.actualText),this.recordSourceMappingEnd(c.id),this.writeToOutput(" = "),this.recordSourceMappingStart(c.id),this.writeToOutput(c.id.actualText),this.recordSourceMappingEnd(c.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(c));for(g=this.thisClassNode.members.members.length,y=0;y<g;y++)this.thisClassNode.members.members[y].nodeType==n.NodeType.VarDecl&&(w=this.thisClassNode.members.members[y],!n.hasFlag(w.varFlags,n.VarFlags.Static)&&w.init&&(this.emitIndent(),this.emitJavascriptVarDecl(w,n.TokenID.Tilde),this.writeLineToOutput("")))}(h=a.members[l],k=h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.Static)||h.nodeType==n.NodeType.VarDecl&&n.hasFlag(h.varFlags,n.VarFlags.Static),f?k:!k)&&(this.emitJavascript(h,r,u),i&&l<b-1?u?this.writeLineToOutput(i):this.writeToOutput(i):u&&h.nodeType!=n.NodeType.ModuleDeclaration&&h.nodeType!=n.NodeType.InterfaceDeclaration&&!(h.nodeType==n.NodeType.VarDecl&&(h.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient&&h.init==null)&&this.varListCount()>=0&&(h.nodeType!=n.NodeType.Block||h.isStatementBlock)&&h.nodeType!=n.NodeType.EndCode&&h.nodeType!=n.NodeType.FuncDecl&&this.writeLineToOutput(""))}this.emitParensAndCommentsInPlace(t,!1)}},u.prototype.emitJavascript=function(i,r,u){i!=null&&(u&&this.indenter.indentAmt>0&&i.nodeType!=n.NodeType.List&&i.nodeType!=n.NodeType.Block&&i.nodeType!=n.NodeType.InterfaceDeclaration&&!(i.nodeType==n.NodeType.VarDecl&&(i.varFlags&n.VarFlags.Ambient)==n.VarFlags.Ambient&&i.init==null)&&this.varListCount()>=0&&i.nodeType!=n.NodeType.EndCode&&(i.nodeType!=n.NodeType.FuncDecl||this.emitState.container!=t.Constructor)&&this.emitIndent(),i.emit(this,r,u),r==n.TokenID.Semicolon&&i.nodeType<n.NodeType.GeneralNode&&this.writeToOutput(";"))},u.prototype.emitPropertyAccessor=function(n,t,i){var r,f,e;n.accessorSymbol.hasBeenEmitted||(r=n.accessorSymbol,this.emitIndent(),this.recordSourceMappingStart(n),this.writeLineToOutput("Object.defineProperty("+t+(i?'.prototype, "':', "')+n.name.actualText+'", {'),this.indenter.increaseIndent(),r.getter&&(f=r.getter.declAST,this.emitIndent(),this.recordSourceMappingStart(f),this.writeToOutput("get: "),this.emitInnerFunction(f,!1,i,null,u.shouldCaptureThis(f),null),this.writeLineToOutput(",")),r.setter&&(e=r.setter.declAST,this.emitIndent(),this.recordSourceMappingStart(e),this.writeToOutput("set: "),this.emitInnerFunction(e,!1,i,null,u.shouldCaptureThis(e),null),this.writeLineToOutput(",")),this.emitIndent(),this.writeLineToOutput("enumerable: true,"),this.emitIndent(),this.writeLineToOutput("configurable: true"),this.indenter.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("});"),this.recordSourceMappingEnd(n),r.hasBeenEmitted=!0)},u.prototype.emitPrototypeMember=function(t,i){var f,r;t.nodeType==n.NodeType.FuncDecl?(f=t,f.isAccessor()?this.emitPropertyAccessor(f,i,!0):(this.emitIndent(),this.recordSourceMappingStart(f),this.writeToOutput(i+".prototype."+f.getNameText()+" = "),this.emitInnerFunction(f,!1,!0,null,u.shouldCaptureThis(f),null),this.writeLineToOutput(";"))):t.nodeType==n.NodeType.VarDecl&&(r=t,r.init&&(this.emitIndent(),this.recordSourceMappingStart(r),this.recordSourceMappingStart(r.id),this.writeToOutput(i+".prototype."+r.id.actualText),this.recordSourceMappingEnd(r.id),this.writeToOutput(" = "),this.emitJavascript(r.init,n.TokenID.Equals,!1),this.recordSourceMappingEnd(r),this.writeLineToOutput(";")))},u.prototype.emitAddBaseMethods=function(t,i,r){var u,e,f,o;if(i.members&&(u=i.symbol,e=u.name,u.declModule!=r.type.symbol.declModule&&(e=u.fullName()),i.members.allMembers.map(function(i,r){var f=r;f.kind()==n.SymbolKind.Type&&f.type.call&&(this.recordSourceMappingStart(f.declAST),this.writeLineToOutput(t+".prototype."+f.name+" = "+e+".prototype."+f.name+";"),this.recordSourceMappingEnd(f.declAST))},null)),i.extendsList)for(f=0,o=i.extendsList.length;f<o;f++)this.emitAddBaseMethods(t,i.extendsList[f],r)},u.prototype.emitJavascriptClass=function(i){var p,e,s,b,a,v,o,k,y,h,r,f,d;if(!n.hasFlag(i.varFlags,n.VarFlags.Ambient)){p=this.thisClassNode,o=0,this.thisClassNode=i,e=i.name.actualText,this.emitParensAndCommentsInPlace(i,!0),s=this.setContainer(t.Class),this.recordSourceMappingStart(i),n.hasFlag(i.varFlags,n.VarFlags.Exported)&&i.type.symbol.container==this.checker.gloMod?this.writeToOutput("this."+e):this.writeToOutput("var "+e);var c=i.extendsList&&i.extendsList.members.length,l=null,w=null;if(c?this.writeLineToOutput(" = (function (_super) {"):this.writeLineToOutput(" = (function () {"),this.recordSourceMappingNameStart(e),this.indenter.increaseIndent(),c&&(l=i.extendsList.members[0],w=l.nodeType==n.NodeType.Call?l.target:l,this.emitIndent(),this.writeLineToOutput("__extends("+e+", _super);")),this.emitIndent(),b=i.constructorDecl,b)this.emitJavascript(i.constructorDecl,n.TokenID.OpenParen,!1);else{for(a=0,this.recordSourceMappingStart(i),this.indenter.increaseIndent(),this.writeToOutput("function "+i.name.actualText+"() {"),this.recordSourceMappingNameStart("constructor"),c&&(this.writeLineToOutput(""),this.emitIndent(),this.writeLineToOutput("_super.apply(this, arguments);"),a++),i.varFlags&n.VarFlags.MustCaptureThis&&this.writeCaptureThisStatement(i),v=this.thisClassNode.members.members,o=0;o<v.length;o++)v[o].nodeType==n.NodeType.VarDecl&&(f=v[o],!n.hasFlag(f.varFlags,n.VarFlags.Static)&&f.init&&(this.writeLineToOutput(""),this.emitIndent(),this.emitJavascriptVarDecl(f,n.TokenID.Tilde),a++));a?(this.writeLineToOutput(""),this.indenter.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")):(this.writeLineToOutput(" }"),this.indenter.decreaseIndent()),this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i)}for(k=i.members.members.length,y=0;y<k;y++)if(h=i.members.members[y],h.nodeType==n.NodeType.FuncDecl)r=h,n.hasFlag(r.fncFlags,n.FncFlags.Method)&&!r.isSignature()&&(n.hasFlag(r.fncFlags,n.FncFlags.Static)?r.isAccessor()?this.emitPropertyAccessor(r,this.thisClassNode.name.actualText,!1):(this.emitIndent(),this.recordSourceMappingStart(r),this.writeToOutput(i.name.actualText+"."+r.name.actualText+" = "),this.emitInnerFunction(r,r.name&&!r.name.isMissing(),!0,null,u.shouldCaptureThis(r),null),this.writeLineToOutput(";")):this.emitPrototypeMember(r,e));else if(h.nodeType==n.NodeType.VarDecl)f=h,n.hasFlag(f.varFlags,n.VarFlags.Static)&&f.init&&(this.emitIndent(),this.recordSourceMappingStart(f),this.writeToOutput(i.name.actualText+"."+f.id.actualText+" = "),this.emitJavascript(f.init,n.TokenID.Equals,!1),this.writeLineToOutput(";"),this.recordSourceMappingEnd(f));else throw Error("We want to catch this");this.emitIndent(),this.recordSourceMappingStart(i.endingToken),this.writeLineToOutput("return "+e+";"),this.recordSourceMappingEnd(i.endingToken),this.indenter.decreaseIndent(),this.emitIndent(),this.recordSourceMappingStart(i.endingToken),this.writeToOutput("}"),this.recordSourceMappingNameEnd(),this.recordSourceMappingEnd(i.endingToken),this.recordSourceMappingStart(i),this.writeToOutput(")("),c&&this.emitJavascript(w,n.TokenID.Tilde,!1),this.writeToOutput(");"),this.recordSourceMappingEnd(i),(s==t.Module||s==t.DynamicModule)&&n.hasFlag(i.varFlags,n.VarFlags.Exported)&&(this.writeLineToOutput(""),this.emitIndent(),d=s==t.Module?this.moduleName:"exports",this.recordSourceMappingStart(i),this.writeToOutput(d+"."+e+" = "+e+";"),this.recordSourceMappingEnd(i)),this.emitIndent(),this.recordSourceMappingEnd(i),this.emitParensAndCommentsInPlace(i,!1),this.setContainer(s),this.thisClassNode=p}},u.prototype.emitPrologue=function(n){this.prologueEmitted||(n&&(this.prologueEmitted=!0,this.writeLineToOutput("var __extends = this.__extends || function (d, b) {"),this.writeLineToOutput("    function __() { this.constructor = d; }"),this.writeLineToOutput("    __.prototype = b.prototype;"),this.writeLineToOutput("    d.prototype = new __();"),this.writeLineToOutput("};")),this.checker.mustCaptureGlobalThis&&(this.prologueEmitted=!0,this.writeLineToOutput(this.captureThisStmtString)))},u.prototype.emitSuperReference=function(){this.writeToOutput("_super.prototype")},u.prototype.emitSuperCall=function(t){if(t.target.nodeType==n.NodeType.Dot){var i=t.target;if(i.operand1.nodeType==n.NodeType.Super)return this.emitJavascript(i,n.TokenID.OpenParen,!1),this.writeToOutput(".call("),this.emitThis(),t.arguments&&t.arguments.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(t.arguments,", ",n.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")"),!0}return!1},u.prototype.emitThis=function(){!this.thisFnc||this.thisFnc.isMethod()||this.thisFnc.isConstructor?this.writeToOutput("this"):this.writeToOutput("_this")},u.shouldCaptureThis=function(n){return n.hasSelfReference()||n.hasSuperReferenceInFatArrowFunction()},u.prototype.createFile=function(n,t){try{return this.emitOptions.ioHost.createFile(n,t)}catch(i){this.errorReporter.emitterError(null,i.message)}},u}(),n.Emitter=f}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(n){this.outfile=n,this.parser=null,this.checker=null,this.lineCol={line:0,col:0},this.emitAsComments=!0,this.hasErrors=!1,this.pushToErrorSink=!1,this.errorSink=[]}return t.prototype.getCapturedErrors=function(){return this.errorSink},t.prototype.freeCapturedErrors=function(){this.errorSink=[]},t.prototype.captureError=function(n){this.errorSink[this.errorSink.length]=n},t.prototype.setErrOut=function(n){this.outfile=n,this.emitAsComments=!1},t.prototype.emitPrefix=function(){this.emitAsComments&&this.outfile.Write("// "),this.outfile.Write(this.checker.locationInfo.filename+"("+this.lineCol.line+","+this.lineCol.col+"): ")},t.prototype.writePrefix=function(n){n?this.setError(n):(this.lineCol.line=0,this.lineCol.col=0),this.emitPrefix()},t.prototype.writePrefixFromSym=function(t){t&&this.checker.locationInfo.lineMap?n.getSourceLineColFromMap(this.lineCol,t.location,this.checker.locationInfo.lineMap):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},t.prototype.setError=function(t){t&&(t.flags|=n.ASTFlags.Error,this.checker.locationInfo.lineMap&&n.getSourceLineColFromMap(this.lineCol,t.minChar,this.checker.locationInfo.lineMap))},t.prototype.reportError=function(n,t){if(this.pushToErrorSink){this.captureError(t);return}if(this.hasErrors=!0,n&&this.parser.errorRecovery&&this.parser.errorCallback){var i=n.limChar-n.minChar;this.parser.errorCallback(n.minChar,i,t,this.checker.locationInfo.unitIndex)}else this.writePrefix(n),this.outfile.WriteLine(t)},t.prototype.reportErrorFromSym=function(n,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=!0,this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(n.location,n.length,t,this.checker.locationInfo.unitIndex):(this.writePrefixFromSym(n),this.outfile.WriteLine(t))},t.prototype.emitterError=function(n,t){this.reportError(n,t);throw Error("EmitError");},t.prototype.duplicateIdentifier=function(n,t){this.reportError(n,"Duplicate identifier '"+t+"'")},t.prototype.showRef=function(n,t,i){var r={line:-1,col:-1};this.parser.getSourceLineCol(r,i.location),this.reportError(n,"symbol "+t+" defined at ("+r.line+","+r.col+")")},t.prototype.unresolvedSymbol=function(n,t){this.reportError(n,"The name '"+t+"' does not exist in the current scope")},t.prototype.symbolDoesNotReferToAValue=function(n,t){this.reportError(n,"The name '"+t+"' does not refer to a value")},t.prototype.styleError=function(n,t){var i=this.pushToErrorSink;this.pushToErrorSink=!1,this.reportError(n,"STYLE: "+t),this.pushToErrorSink=i},t.prototype.simpleError=function(n,t){this.reportError(n,t)},t.prototype.simpleErrorFromSym=function(n,t){this.reportErrorFromSym(n,t)},t.prototype.invalidSuperReference=function(n){this.simpleError(n,"Keyword 'super' can only be used inside a class instance method")},t.prototype.valueCannotBeModified=function(n){this.simpleError(n,"The left-hand side of an assignment expression must be a variable, property or indexer")},t.prototype.invalidCall=function(t,i,r){var u=t.target.type,f=u.getScopedTypeName(r),e;u.construct&&i==n.NodeType.Call?this.reportError(t,"Value of type '"+f+"' is not callable.  Did you mean to include 'new'?"):(e=i==n.NodeType.Call?"callable":"newable",this.reportError(t,"Value of type '"+f+"' is not "+e))},t.prototype.indexLHS=function(n,t){var i=n.operand1.type.getScopedTypeName(t),r=n.operand2.type.getScopedTypeName(t);this.simpleError(n,"Value of type '"+i+"' is not indexable by type '"+r+"'")},t.prototype.incompatibleTypes=function(n,t,i,r,u,f){t||(t=this.checker.anyType),i||(i=this.checker.anyType);var e=f?f.message:"";r?this.reportError(n,"Operator '"+r+"' cannot be applied to types '"+t.getScopedTypeName(u)+"' and '"+i.getScopedTypeName(u)+"'"+(e?": "+e:"")):this.reportError(n,"Cannot convert '"+t.getScopedTypeName(u)+"' to '"+i.getScopedTypeName(u)+"'"+(e?": "+e:""))},t.prototype.expectedClassOrInterface=function(n){this.simpleError(n,"Expected var, class, interface, or module")},t.prototype.unaryOperatorTypeError=function(n,t,i){this.reportError(n,"Operator '"+t+"' cannot be applied to type '"+i.getTypeName()+"'")},t}();n.ErrorReporter=t}(TypeScript||(TypeScript={})),function(n){function f(t,i,r,f,e,o){var h=r.getText(f,e),s,c,l;return t.log("Quick parse range ("+f+","+e+'): "'+n.stringToLiteral(h,100)+'"'),s=new u,s.setErrorRecovery(null),s.errorCallback=o,c=new n.ClassDeclaration(null,null,null,null),s.currentClassDecl=c,l=s.quickParse(new n.StringSourceText(h),"",0)}var t,i,r,u;(function(n){n._map=[],n.NoTypes=0,n.ArraySuffix=1,n.Primitive=2,n.Named=4,n.AllSimpleTypes=n.Primitive|n.Named,n.AllTypes=n.Primitive|n.Named|n.ArraySuffix})(n.TypeContext||(n.TypeContext={})),t=n.TypeContext,function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="StartScript",n.StartScript=1,n._map[2]="StartStatementList",n.StartStatementList=2,n._map[3]="StartStatement",n.StartStatement=3,n._map[4]="StartFncDecl",n.StartFncDecl=4,n._map[5]="FncDeclName",n.FncDeclName=5,n._map[6]="FncDeclArgs",n.FncDeclArgs=6,n._map[7]="FncDeclReturnType",n.FncDeclReturnType=7,n._map[8]="ForInit",n.ForInit=8,n._map[9]="ForInitAfterVar",n.ForInitAfterVar=9,n._map[10]="ForCondStart",n.ForCondStart=10,n._map[11]="EndStmtList",n.EndStmtList=11,n._map[12]="EndScript",n.EndScript=12}(n.ParseState||(n.ParseState={})),i=n.ParseState,r=function(){function n(n,t){this.Script=n,this.endLexState=t}return n}(),n.QuickParseResult=r,u=function(){function u(){this.varLists=[],this.scopeLists=[],this.staticsLists=[],this.scanner=new n.Scanner,this.currentToken=null,this.needTerminator=!1,this.inFunction=!1,this.inInterfaceDecl=!1,this.currentClassDecl=null,this.inFncDecl=!1,this.anonId=new n.Identifier("_anonymous"),this.style_requireSemi=!1,this.style_funcInLoop=!0,this.incremental=!1,this.errorRecovery=!1,this.outfile=undefined,this.errorCallback=null,this.state=i.StartStatementList,this.ambientModule=!1,this.ambientClass=!1,this.topLevel=!0,this.allowImportDeclaration=!0,this.currentUnitIndex=-1,this.prevIDTok=null,this.statementInfoStack=[],this.hasTopLevelImportOrExport=!1,this.strictMode=!1,this.nestingLevel=0,this.prevExpr=null,this.currentClassDefinition=null,this.parsingClassConstructorDefinition=!1,this.parsingDeclareFile=!1,this.amdDependencies=[],this.inferPropertiesFromThisAssignment=!1,this.requiresExtendsBlock=!1,this.fname=""}return u.prototype.resetStmtStack=function(){this.statementInfoStack=[]},u.prototype.inLoop=function(){for(var n=this.statementInfoStack.length-1;n>=0;n--)if(this.statementInfoStack[n].stmt.isLoop())return!0;return!1},u.prototype.pushStmt=function(n,t){var i={stmt:n,labels:t};this.statementInfoStack.push(i)},u.prototype.popStmt=function(){return this.statementInfoStack.pop()},u.prototype.resolveJumpTarget=function(t){for(var o=n.AST.getResolvedIdentifierName(t.target),s=this.statementInfoStack.length,i,u,f,e,r=s-1;r>=0;r--)if(i=this.statementInfoStack[r],t.target){if(i.labels&&i.labels.members.length>0)for(u=0,f=i.labels.members.length;u<f;u++)if(e=i.labels.members[u],e.id.text==o){t.setResolvedTarget(this,i.stmt);return}}else{if(i.stmt.isLoop()){t.setResolvedTarget(this,i.stmt);return}if(i.stmt.nodeType==n.NodeType.Switch&&t.nodeType==n.NodeType.Break){t.setResolvedTarget(this,i.stmt);return}}t.target?this.reportParseError("could not find enclosing statement with label "+t.target):t.nodeType==n.NodeType.Break?this.reportParseError("break statement requires enclosing loop or switch"):this.reportParseError("continue statement requires enclosing loop")},u.prototype.setErrorRecovery=function(n){this.outfile=n,this.errorRecovery=!0},u.prototype.getSourceLineCol=function(t,i){n.getSourceLineColFromMap(t,i,this.scanner.lineMap)},u.prototype.createRef=function(t,i,r){var u=new n.Identifier(t,i);return u.minChar=r,u},u.prototype.reportParseStyleError=function(n){this.reportParseError("STYLE: "+n)},u.prototype.reportParseError=function(n,t,i){var u,r;if(typeof t=="undefined"&&(t=this.scanner.startPos),typeof i=="undefined"&&(i=this.scanner.pos),u=Math.max(1,i-t),this.errorCallback)this.errorCallback(t,u,n,this.currentUnitIndex);else if(this.errorRecovery)r={line:-1,col:-1},this.getSourceLineCol(r,t),this.outfile&&this.outfile.WriteLine("// "+this.fname+" ("+r.line+","+r.col+"): "+n);else throw new SyntaxError(this.fname+" ("+this.scanner.line+","+this.scanner.col+"): "+n);},u.prototype.checkNextToken=function(n,t,i){typeof i=="undefined"&&(i=null),this.currentToken=this.scanner.scan(),this.checkCurrentToken(n,t,i)},u.prototype.skip=function(t){var r,i,u;for(t|=n.ErrorRecoverySet.EOF,r=n.ErrorRecoverySet.None,i=n.lookupToken(this.currentToken.tokenId),i!=undefined&&(r=i.ers),u=0;(r&t)==n.ErrorRecoverySet.None||this.currentToken.tokenId==n.TokenID.CloseBrace&&u>0;)this.currentToken.tokenId==n.TokenID.OpenBrace?u++:this.currentToken.tokenId==n.TokenID.CloseBrace&&u--,this.currentToken=this.scanner.scan(),r=n.ErrorRecoverySet.None,i=n.lookupToken(this.currentToken.tokenId),i!=undefined&&(r=i.ers)},u.prototype.checkCurrentToken=function(t,i,r){typeof r=="undefined"&&(r=null),this.currentToken.tokenId!=t?(r=r==null?"Expected '"+n.tokenTable[t].text+"'":r,this.reportParseError(r),this.errorRecovery&&this.skip(i)):this.currentToken=this.scanner.scan()},u.prototype.pushDeclLists=function(){this.staticsLists.push(new n.ASTList),this.varLists.push(new n.ASTList),this.scopeLists.push(new n.ASTList)},u.prototype.popDeclLists=function(){this.staticsLists.pop(),this.varLists.pop(),this.scopeLists.pop()},u.prototype.topVarList=function(){return this.varLists[this.varLists.length-1]},u.prototype.topScopeList=function(){return this.scopeLists[this.scopeLists.length-1]},u.prototype.topStaticsList=function(){return this.staticsLists[this.staticsLists.length-1]},u.prototype.parseComment=function(t){var i,r,u;return t?(i=new n.Comment(t.value,t.isBlock,t.endsLine),i.minChar=t.startPos,i.limChar=t.startPos+t.value.length,r={line:-1,col:-1},this.getSourceLineCol(r,i.minChar),i.minLine=r.line,this.getSourceLineCol(r,i.limChar),i.limLine=r.line,!t.isBlock&&t.value.length>3&&t.value.substring(0,3)=="///"&&(u=n.getAdditionalDependencyPath(t.value),u&&this.amdDependencies.push(u),n.getImplicitImport(t.value)&&(this.hasTopLevelImportOrExport=!0)),i):null},u.prototype.parseCommentsInner=function(n){var i,t;if(n){for(i=[],t=0;t<n.length;t++)i.push(this.parseComment(n[t]));return i}return null},u.prototype.parseComments=function(){var n=this.scanner.getComments();return this.parseCommentsInner(n)},u.prototype.parseCommentsForLine=function(n){var t=this.scanner.getCommentsForLine(n);return this.parseCommentsInner(t)},u.prototype.combineComments=function(n,t){return n==null?t:t==null?n:n.concat(t)},u.prototype.parseEnumDecl=function(i){var k=this.scanner.leftCurlyCount,d=this.scanner.rightCurlyCount,f=null,y,s,h,c,b,u,a,l;for(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)?(f=n.Identifier.fromToken(this.currentToken),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,this.currentToken=this.scanner.scan()):(this.reportParseError("Enum declaration requires identifier"),this.errorRecovery&&(f=new n.MissingIdentifier,f.minChar=this.scanner.startPos,f.limChar=this.scanner.startPos,f.flags|=n.ASTFlags.Error)),y=this.scanner.startPos,this.checkCurrentToken(n.TokenID.OpenBrace,i|n.ErrorRecoverySet.ID),this.pushDeclLists(),s=new n.ASTList,s.minChar=y,h=new n.VarDecl(new n.Identifier("_map"),0),h.varFlags|=n.VarFlags.Exported,h.varFlags|=n.VarFlags.Private,h.varFlags|=n.VarFlags.Property|n.VarFlags.Public,h.init=new n.UnaryExpression(n.NodeType.ArrayLit,null),s.append(h),c=null;;){var g=this.scanner.startPos,v,o=null,e=null,p=null,w=null;if(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToIDName(this.currentToken))o=n.Identifier.fromToken(this.currentToken),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos;else if(this.currentToken.tokenId==n.TokenID.CloseBrace)break;else this.reportParseError("Expected identifer of enum member"),this.errorRecovery&&(o=new n.MissingIdentifier,o.minChar=this.scanner.startPos,o.limChar=this.scanner.startPos,o.flags|=n.ASTFlags.Error);if(v=this.scanner.pos,p=this.parseComments(),this.currentToken=this.scanner.scan(),w=this.parseComments(),this.currentToken.tokenId==n.TokenID.Equals?(this.currentToken=this.scanner.scan(),e=this.parseExpr(i,n.OperatorPrecedence.Comma,!0,t.NoTypes),c=e,v=e.limChar):(c==null?(e=new n.NumberLiteral(0),c=e):(e=new n.NumberLiteral(c.value+1),c=e),b=new n.BinaryExpression(n.NodeType.Asg,new n.BinaryExpression(n.NodeType.Index,new n.Identifier("_map"),e),new n.StringLiteral('"'+o.actualText+'"')),s.append(b)),u=new n.VarDecl(o,this.nestingLevel),u.minChar=g,u.limChar=v,u.init=e,u.typeExpr=new n.TypeReference(this.createRef(f.actualText,f.hasEscapeSequence,-1),0),u.varFlags|=n.VarFlags.Readonly|n.VarFlags.Property,e.nodeType==n.NodeType.NumberLit&&(u.varFlags|=n.VarFlags.Constant),u.preComments=p,s.append(u),u.postComments=w,u.varFlags|=n.VarFlags.Exported,this.currentToken.tokenId!=n.TokenID.Comma||(this.currentToken=this.scanner.scan(),u.postComments=this.combineComments(u.postComments,this.parseCommentsForLine(this.scanner.prevLine)),this.currentToken.tokenId!=n.TokenID.Identifier&&!n.convertTokToIDName(this.currentToken)))break}return a=new n.ASTSpan,a.minChar=this.scanner.startPos,a.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseBrace,i),s.limChar=this.scanner.lastTokenLimChar(),l=new n.ModuleDeclaration(f,s,this.topVarList(),this.topScopeList(),a),l.modFlags|=n.ModuleFlags.IsEnum,this.popDeclLists(),l.leftCurlyCount=this.scanner.leftCurlyCount-k,l.rightCurlyCount=this.scanner.rightCurlyCount-d,l},u.prototype.parseDottedName=function(t){if(this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)){var i=n.Identifier.fromToken(this.currentToken);i.preComments=this.parseComments(),t[t.length]=i,i.minChar=this.scanner.startPos,i.limChar=this.scanner.pos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Dot&&this.parseDottedName(t)}else this.reportParseError("need identifier after '.'")},u.prototype.isValidImportPath=function(t){return(t=n.stripQuotes(t),!t||t.indexOf(":")!=-1||t.indexOf("\\")!=-1||t.charAt(0)=="/")?!1:!0},u.prototype.parseImportDeclaration=function(i){var f=null,u=null,e=null,c=this.scanner.startPos,h=!1,s,o,l;return this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)?f=n.Identifier.fromToken(this.currentToken):(this.reportParseError("Expected identifer after 'import'"),f=new n.MissingIdentifier),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,this.currentToken=this.scanner.scan(),this.checkCurrentToken(n.TokenID.Equals,i|n.ErrorRecoverySet.ID),s=this.parseComments(),this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)?this.currentToken.tokenId==n.TokenID.Module?(o=this.scanner.pos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.OpenParen&&(this.currentToken=this.scanner.scan(),(this.currentToken.tokenId==n.TokenID.StringLiteral||this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(this.currentToken.tokenId==n.TokenID.StringLiteral?(this.topLevel?this.hasTopLevelImportOrExport=!0:this.allowImportDeclaration||this.reportParseError("Import declaration of external module is permitted only in global or top level dynamic modules"),l=this.currentToken.getText(),u=n.Identifier.fromToken(this.currentToken),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,this.isValidImportPath(u.text)||this.reportParseError("Invalid import path"),h=!0,this.currentToken=this.scanner.scan(),u.preComments=s):(u=this.parseExpr(i|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Assignment,!0,t.NoTypes),u.preComments=s)),o=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,i|n.ErrorRecoverySet.ID),u&&(u.postComments=this.parseComments()))):(u=this.parseExpr(i|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Assignment,!0,t.NoTypes),o=this.scanner.pos):(this.reportParseError("Expected module name"),u=new n.MissingIdentifier,u.minChar=this.scanner.startPos,this.currentToken.tokenId==n.TokenID.Semicolon?u.limChar=this.scanner.startPos:(u.limChar=this.scanner.pos,this.currentToken=this.scanner.scan()),u.flags|=n.ASTFlags.Error,o=u.limChar),e=new n.ImportDeclaration(f,u),e.isDynamicImport=h,e.minChar=c,e.limChar=o,e},u.prototype.parseModuleDecl=function(t,i,r){var g=this.scanner.leftCurlyCount,nt=this.scanner.rightCurlyCount,a=this.ambientModule,v=this.topLevel,f,s,l,y,tt,h,k,c,p,e,o,w;if(this.topLevel=!1,(this.parsingDeclareFile||a||n.hasFlag(i,n.Modifiers.Ambient))&&(this.ambientModule=!0),this.currentToken=this.scanner.scan(),f=null,s=null,this.pushDeclLists(),l=this.scanner.startPos,y=!1,this.currentToken.tokenId==n.TokenID.Identifier||this.currentToken.tokenId==n.TokenID.StringLiteral||!n.isPrimitiveTypeToken(this.currentToken)&&n.convertTokToID(this.currentToken,this.strictMode)?(tt=this.currentToken.getText(),this.currentToken.tokenId==n.TokenID.StringLiteral&&(y=!0,this.ambientModule||this.reportParseError("Only ambient dynamic modules may have string literal names"),v||this.reportParseError("Dynamic modules may not be nested within other modules")),f=n.Identifier.fromToken(this.currentToken),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,this.currentToken=this.scanner.scan()):this.currentToken.tokenId==n.TokenID.OpenBrace&&(this.reportParseError("Module name missing"),f=new n.Identifier(""),f.minChar=l,f.limChar=l),this.currentToken.tokenId==n.TokenID.Dot&&(s=[],this.parseDottedName(s)),f==null&&(f=new n.MissingIdentifier),h=new n.ASTList,k=this.scanner.startPos,this.checkCurrentToken(n.TokenID.OpenBrace,t|n.ErrorRecoverySet.ID),this.allowImportDeclaration=v&&y?!0:!1,this.parseStatementList(t|n.ErrorRecoverySet.RCurly,h,!0,!0,n.AllowedElements.Global,i),h.minChar=k,h.limChar=this.scanner.pos,c=new n.ASTSpan,c.minChar=this.scanner.startPos,c.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseBrace,t),p=this.scanner.lastTokenLimChar(),this.allowImportDeclaration=v,s&&s.length>0){var d=s.length,b=s[d-1],u=new n.ModuleDeclaration(b,h,this.topVarList(),this.topScopeList(),c);for(u.preComments=r,(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(u.modFlags|=n.ModuleFlags.Ambient),u.modFlags|=n.ModuleFlags.Exported,u.minChar=l,u.limChar=p,this.popDeclLists(),w=d-2;w>=0;w--)o=new n.ASTList,o.append(u),b=s[w],u=new n.ModuleDeclaration(b,o,new n.ASTList,new n.ASTList,c),o.minChar=u.minChar=l,o.limChar=u.limChar=p,(this.parsingDeclareFile||n.hasFlag(i,n.Modifiers.Ambient))&&(u.modFlags|=n.ModuleFlags.Ambient),u.modFlags|=n.ModuleFlags.Exported;o=new n.ASTList,o.append(u),o.minChar=l,o.limChar=p,e=new n.ModuleDeclaration(f,o,new n.ASTList,new n.ASTList,c)}else e=new n.ModuleDeclaration(f,h,this.topVarList(),this.topScopeList(),c),e.preComments=r,this.popDeclLists();return(this.parsingDeclareFile||a||n.hasFlag(i,n.Modifiers.Ambient))&&(e.modFlags|=n.ModuleFlags.Ambient),(a||n.hasFlag(i,n.Modifiers.Exported))&&(e.modFlags|=n.ModuleFlags.Exported),y&&(e.modFlags|=n.ModuleFlags.IsDynamic),this.ambientModule=a,this.topLevel=v,e.leftCurlyCount=this.scanner.leftCurlyCount-g,e.rightCurlyCount=this.scanner.rightCurlyCount-nt,e.limChar=h.limChar,e},u.prototype.parseTypeReferenceTail=function(t,i,r){var u=new n.TypeReference(r,0);for(u.minChar=i;this.currentToken.tokenId==n.TokenID.OpenBracket;)this.currentToken=this.scanner.scan(),u.arrayCount++,this.checkCurrentToken(n.TokenID.CloseBracket,t|n.ErrorRecoverySet.LBrack);return u.limChar=this.scanner.lastTokenLimChar(),u},u.prototype.parseNamedType=function(t,i,r,u){var h,f,s,e,o;return this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Dot?(h=this.scanner.pos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.Identifier&&(this.errorRecovery&&this.scanner.lastTokenHadNewline()||!n.convertTokToID(this.currentToken,this.strictMode))?(this.reportParseError("need identifier after '.'"),this.errorRecovery?(r.flags|=n.ASTFlags.DotLHS,r.limChar=this.scanner.lastTokenLimChar(),r):(e=new n.MissingIdentifier,e.minChar=this.scanner.pos,e.limChar=this.scanner.pos,o=new n.BinaryExpression(n.NodeType.Dot,r,e),o.flags|=n.ASTFlags.Error,o.minChar=r.minChar,o.limChar=e.limChar,this.parseNamedType(t,i,o,u))):(f=n.Identifier.fromToken(this.currentToken),f.minChar=this.scanner.startPos,f.limChar=this.scanner.pos,s=new n.BinaryExpression(n.NodeType.Dot,r,f),s.minChar=r.minChar,s.limChar=f.limChar,this.parseNamedType(t,i,s,u))):u?this.parseTypeReferenceTail(t,i,r):r},u.prototype.parseTypeReference=function(t,i){var u=this.scanner.startPos,h=!1,c,e,o,s,l,a,r,f;switch(this.currentToken.tokenId){case n.TokenID.Void:i||this.reportParseError("void not a valid type in this context");case n.TokenID.Any:case n.TokenID.Number:case n.TokenID.Bool:case n.TokenID.String:return c=n.tokenTable[this.currentToken.tokenId].text,e=new n.Identifier(c),e.minChar=u,e.limChar=this.scanner.pos,this.currentToken=this.scanner.scan(),this.parseTypeReferenceTail(t,u,e);case n.TokenID.Identifier:return o=this.createRef(this.currentToken.getText(),this.currentToken.hasEscapeSequence,u),o.limChar=this.scanner.pos,this.parseNamedType(t,u,o,!0);case n.TokenID.OpenBrace:return this.parseObjectType(u,t);case n.TokenID.New:this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.OpenParen?this.reportParseError("Expected '('"):h=!0;case n.TokenID.OpenParen:return s=new n.ASTList,l=this.parseFormalParameterList(t|n.ErrorRecoverySet.RParen,s,!1,!0,!1,!1,!1,!1,null,!0),this.checkCurrentToken(n.TokenID.EqualsGreaterThan,t),a=this.parseTypeReference(t,!0),r=new n.FuncDecl(null,null,!1,s,null,null,null,n.NodeType.FuncDecl),r.returnTypeAnnotation=a,r.variableArgList=l,r.fncFlags|=n.FncFlags.Signature,h&&(r.fncFlags|=n.FncFlags.ConstructMember,r.hint="_construct",r.classDecl=null),r.minChar=u,this.parseTypeReferenceTail(t,u,r);default:return this.reportParseError("Expected type name"),f=new n.TypeReference(null,0),f.flags|=n.ASTFlags.Error,f.minChar=this.scanner.pos,f.limChar=this.scanner.pos,f}},u.prototype.parseObjectType=function(t,i){var r,f,u;return this.currentToken=this.scanner.scan(),r=new n.ASTList,r.minChar=t,f=this.inInterfaceDecl,this.inInterfaceDecl=!0,this.parseTypeMemberList(i|n.ErrorRecoverySet.RCurly,r),this.inInterfaceDecl=f,this.checkCurrentToken(n.TokenID.CloseBrace,i),u=new n.InterfaceDeclaration(this.anonId,r,null,null),u.minChar=t,u.limChar=r.limChar,this.parseTypeReferenceTail(i,t,u)},u.prototype.parseFunctionBlock=function(t,r,u,f,e){var s,o;this.state=i.StartStatementList,this.checkCurrentToken(n.TokenID.OpenBrace,t|n.ErrorRecoverySet.StmtStart),s=this.inFunction,this.inFunction=!0,this.parseStatementList(t|n.ErrorRecoverySet.RCurly|n.ErrorRecoverySet.StmtStart,f,!0,!1,r,u),f.minChar=e,f.limChar=this.scanner.pos,this.inFunction=s,o=new n.EndCode,o.minChar=f.limChar,o.limChar=o.minChar,f.append(o)},u.prototype.parseFunctionStatements=function(i,r,u,f,e,o,s,h,c){var d,v,w,y,l,g,nt;this.pushDeclLists(),d=this.statementInfoStack,this.resetStmtStack();var a=null,p=!1,b=!1,k;return h?(k=this.scanner.pos,this.currentToken.tokenId===n.TokenID.OpenBrace?(this.reportParseError("Function declarations are not permitted within interfaces, ambient modules or classes"),a=new n.ASTList,v=this.scanner.startPos,this.parseFunctionBlock(i,o,c,a,v),this.checkCurrentToken(n.TokenID.CloseBrace,i),this.currentToken.tokenId===n.TokenID.Semicolon&&(this.currentToken=this.scanner.scan())):this.checkCurrentToken(n.TokenID.Semicolon,i,"Expected ';'")):(a=new n.ASTList,v=this.scanner.startPos,this.currentToken.tokenId==n.TokenID.EqualsGreaterThan&&(f&&this.reportParseError("'=>' may not be used for class methods"),p=!0,this.currentToken=this.scanner.scan()),p&&this.currentToken.tokenId!=n.TokenID.OpenBrace?(w=this.parseExpr(i|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.Assignment,!0,t.NoTypes),y=new n.ReturnStatement,y.returnExpression=w,y.minChar=w.minChar,y.limChar=w.limChar,a.minChar=v,a.append(y)):(b=p,this.parseFunctionBlock(i,o,c,a,v)),k=this.scanner.pos),l=new n.FuncDecl(r,a,u,e,this.topVarList(),this.topScopeList(),this.topStaticsList(),n.NodeType.FuncDecl),this.popDeclLists(),g=this.topScopeList(),g.append(l),nt=!1,h||(!p||b?(l.endingToken=new n.ASTSpan,l.endingToken.minChar=this.scanner.startPos,l.endingToken.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseBrace,i),b&&(l.fncFlags|=n.FncFlags.IsFatArrowFunction)):(l.fncFlags|=n.FncFlags.IsFatArrowFunction,l.endingToken=new n.ASTSpan,l.endingToken.minChar=a.members[0].minChar,l.endingToken.limChar=a.members[0].limChar)),l.minChar=s,l.limChar=k,h||(l.fncFlags|=n.FncFlags.Definition),this.statementInfoStack=d,l},u.prototype.transformAnonymousArgsIntoFormals=function(t,i){var e=this,f=function(i){if(i.nodeType==n.NodeType.Comma)return e.transformAnonymousArgsIntoFormals(t,i);if(i.nodeType==n.NodeType.Name||i.nodeType==n.NodeType.Asg){var u=i.nodeType==n.NodeType.Asg?i.operand1:i,r=new n.ArgDecl(u);return r.preComments=u.preComments,r.postComments=u.postComments,r.minChar=i.minChar,r.limChar=i.limChar,n.hasFlag(u.flags,n.ASTFlags.PossibleOptionalParameter)&&(r.isOptional=!0),i.nodeType==n.NodeType.Asg&&(r.init=i.operand2),t.append(r),r.isOptional||r.init}return e.reportParseError("Invalid lambda argument"),!1},r,u;if(i)return i.nodeType==n.NodeType.Comma?(r=i,r.operand1.isParenthesized&&this.reportParseError("Invalid lambda argument",r.operand1.minChar,r.operand1.limChar),r.operand2.isParenthesized&&this.reportParseError("Invalid lambda argument",r.operand2.minChar,r.operand2.limChar),u=f(r.operand1),u=f(r.operand2)||u):f(i)},u.prototype.parseFormalParameterList=function(i,r,u,f,e,o,s,h,c,l){var p,k,a;r.minChar=this.scanner.startPos,e?this.currentToken=this.scanner.scan():h||this.checkCurrentToken(n.TokenID.OpenParen,i|n.ErrorRecoverySet.RParen);var v=!1,d=!0,w=!1,y=!1;for(h&&c&&c.nodeType!=n.NodeType.EmptyExpr&&(w=this.transformAnonymousArgsIntoFormals(r,c),y=!0);;){var g=!1,b=n.VarFlags.None,nt=this.scanner.startPos;if(this.inferPropertiesFromThisAssignment&&this.currentToken.tokenId==n.TokenID.This&&(u||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.currentToken=this.scanner.scan(),b|=n.VarFlags.Public|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)),this.currentToken.tokenId==n.TokenID.Public?(b|=n.VarFlags.Public|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)):this.currentToken.tokenId==n.TokenID.Private?(b|=n.VarFlags.Private|n.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)):this.currentToken.tokenId==n.TokenID.Static&&u&&(this.reportParseError("Static properties can not be declared as parameter properties"),this.currentToken=this.scanner.scan()),b!=n.VarFlags.None?(u||this.reportParseError("only constructor parameters can be properties"),this.currentToken=this.scanner.scan(),n.isModifier(this.currentToken)&&(this.reportParseError("Multiple modifiers may not be applied to parameters"),this.currentToken=this.scanner.scan()),this.inferPropertiesFromThisAssignment&&this.currentToken.tokenId==n.TokenID.This&&(u||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.currentToken=this.scanner.scan(),this.currentToken=this.scanner.scan())):this.currentToken.tokenId==n.TokenID.DotDotDot&&(v=!0,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Identifier&&!n.convertTokToID(this.currentToken,this.strictMode)||(this.reportParseError("'...' parameters require both a parameter name and an array type annotation to be specified"),v=!1)),p=null,(!y&&this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(p=n.Identifier.fromToken(this.currentToken),p.minChar=this.scanner.startPos,p.limChar=this.scanner.pos),(y||p)&&(g=!0,k=null,a=null,y&&r.members.length?(a=r.members[r.members.length-1],a.isOptional&&(w=!0)):(a=new n.ArgDecl(p),o&&this.reportParseError("Property getters may not take any arguments"),s&&!d&&this.reportParseError("Property setters may only take one argument"),a.minChar=nt,a.preComments=this.parseComments(),this.currentToken=this.scanner.scan()),this.currentToken.tokenId==n.TokenID.Question&&(a.isOptional=!0,w=!0,this.currentToken=this.scanner.scan()),this.currentToken.tokenId==n.TokenID.Colon&&(this.currentToken=this.scanner.scan(),k=this.parseTypeReference(i,!1)),this.currentToken.tokenId==n.TokenID.Equals&&(f&&this.reportParseError("Arguments in signatures may not have default values"),w=!0,this.currentToken=this.scanner.scan(),a.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,!1,t.NoTypes)),!w||a.isOptionalArg()||v||this.reportParseError("Optional parameters may only be followed by other optional parameters"),v&&a.isOptionalArg()&&this.reportParseError("Varargs may not be optional or have default parameters"),v&&!k&&this.reportParseError("'...' parameters require both a parameter name and an array type annotation to be specified"),a.postComments=this.parseComments(),a.typeExpr=k,a.limChar=this.scanner.lastTokenLimChar(),a.varFlags|=b,y?y=!1:r.append(a)),d=!1,this.currentToken.tokenId==n.TokenID.Comma){if(g&&!v){this.currentToken=this.scanner.scan();continue}else if(this.reportParseError("Unexpected ',' in argument list"),this.errorRecovery){this.currentToken=this.scanner.scan();continue}}else break}return e?this.checkCurrentToken(n.TokenID.CloseBracket,i|n.ErrorRecoverySet.LCurly|n.ErrorRecoverySet.SColon):l&&this.checkCurrentToken(n.TokenID.CloseParen,i|n.ErrorRecoverySet.LCurly|n.ErrorRecoverySet.SColon),r.limChar=this.scanner.lastTokenLimChar(),v},u.prototype.parseFncDecl=function(t,r,u,f,e,o,s,h,c,l,a){var tt=this.scanner.leftCurlyCount,it=this.scanner.rightCurlyCount,rt=this.parsingClassConstructorDefinition,w,nt,v;this.parsingClassConstructorDefinition=!1;var y=null,ut=this.scanner.startPos,ft=this.scanner.pos,b=this.nestingLevel,et=this.parseComments(),k=!!l;if(this.nestingLevel=0,!this.style_funcInLoop&&this.inLoop()&&this.reportParseStyleError("function declaration in loop"),f||s||o||l)e&&(y=e);else if(this.currentToken=this.scanner.scan(),this.state=i.StartFncDecl,this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))y=n.Identifier.fromToken(this.currentToken),y.minChar=this.scanner.startPos,y.limChar=this.scanner.pos,this.currentToken=this.scanner.scan();else if(r)return this.reportParseError("Function declaration must include identifier"),this.nestingLevel=b,new n.IncompleteAST(ut,this.scanner.pos);this.state=i.FncDeclName;var p=new n.ASTList,d=!1,g=!1,ot=n.hasFlag(c,n.Modifiers.Getter),st=n.hasFlag(c,n.Modifiers.Setter);return(this.currentToken.tokenId==n.TokenID.OpenParen||o&&this.currentToken.tokenId==n.TokenID.OpenBracket||l&&(l.preProcessedLambdaArgs||this.currentToken.tokenId==n.TokenID.DotDotDot))&&(d=this.parseFormalParameterList(t,p,!1,u,o,ot,st,k,l?l.preProcessedLambdaArgs:null,a)),this.state=i.FncDeclArgs,w=null,this.currentToken.tokenId==n.TokenID.Colon&&(this.currentToken=this.scanner.scan(),n.hasFlag(c,n.Modifiers.Setter)&&this.reportParseError("Property setters may not declare a return type"),w=this.parseTypeReference(t,!0)),o&&p.members.length==0&&this.reportParseError("Index signatures require a parameter type to be specified"),this.state=i.FncDeclReturnType,k&&this.currentToken.tokenId!=n.TokenID.EqualsGreaterThan&&this.reportParseError("Expected '=>'"),!r||this.parsingDeclareFile||h||f&&(this.ambientModule||this.ambientClass||this.inInterfaceDecl)||this.currentToken.tokenId!=n.TokenID.Semicolon||(g=!0,r=!1,u=!0),nt=this.inFncDecl,this.inFncDecl=!0,v=this.parseFunctionStatements(t|n.ErrorRecoverySet.RCurly,y,!1,f,p,n.AllowedElements.None,ft,u,n.Modifiers.None),this.inFncDecl=nt,v.variableArgList=d,v.isOverload=g,u||(v.fncFlags|=n.FncFlags.Definition),s&&(v.fncFlags|=n.FncFlags.Static),u&&(v.fncFlags|=n.FncFlags.Signature),o&&(v.fncFlags|=n.FncFlags.IndexerMember),v.returnTypeAnnotation=w,f&&(v.fncFlags|=n.FncFlags.Method,v.fncFlags|=n.FncFlags.ClassPropertyMethodExported),v.leftCurlyCount=this.scanner.leftCurlyCount-tt,v.rightCurlyCount=this.scanner.rightCurlyCount-it,this.nestingLevel=b,this.parsingClassConstructorDefinition=rt,v.preComments=et,v},u.prototype.convertToTypeReference=function(t){var i,r,u;switch(t.nodeType){case n.NodeType.TypeRef:return t;case n.NodeType.Name:return i=new n.TypeReference(t,0),i.minChar=t.minChar,i.limChar=t.limChar,i;case n.NodeType.Index:return r=t,i=this.convertToTypeReference(r.operand1),i?(i.arrayCount++,i.minChar=r.minChar,i.limChar=r.limChar,i):u=new n.AST(n.NodeType.Error)}return null},u.prototype.parseArgList=function(i){var r=new n.ASTList,u;if(r.minChar=this.scanner.startPos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId!==n.TokenID.CloseParen)for(;;){if(r.members.length>65535){this.reportParseError("max number of args exceeded");break}if(u=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,!0,t.NoTypes),r.append(u),this.currentToken.tokenId!=n.TokenID.Comma)break;this.currentToken=this.scanner.scan()}return r.limChar=this.scanner.pos,r},u.prototype.parseBaseList=function(t,i,r,u){for(var o=!0,e=t,f,s;;){if(o&&(this.currentToken.tokenId===n.TokenID.Implements?e=i:this.currentToken.tokenId!=n.TokenID.Extends||this.requiresExtendsBlock||(this.requiresExtendsBlock=u),this.currentToken=this.scanner.scan(),o=!1),f=null,this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)?(s=this.scanner.startPos,f=n.Identifier.fromToken(this.currentToken),f.minChar=s,f.limChar=this.scanner.pos,f=this.parseNamedType(r|n.ErrorRecoverySet.LCurly,s,f,!1)):(this.reportParseError("Expected base name"),this.errorRecovery&&(f=new n.MissingIdentifier,f.minChar=this.scanner.pos,f.limChar=this.scanner.pos,f.flags|=n.ASTFlags.Error)),this.currentToken.tokenId==n.TokenID.OpenParen?u?this.reportParseError("Base classes may only be initialized via a 'super' call within the constructor body"):this.reportParseError("Interfaces may not be extended with a call expression"):e.append(f),u&&e==t&&t.members.length>1&&this.reportParseError("A class may only extend one other class"),this.currentToken.tokenId==n.TokenID.Comma){this.currentToken=this.scanner.scan();continue}else if(this.currentToken.tokenId==n.TokenID.Extends||this.currentToken.tokenId==n.TokenID.Implements){this.currentToken.tokenId!=n.TokenID.Extends||this.requiresExtendsBlock||(this.requiresExtendsBlock=u),e=t,o=!0;continue}break}},u.prototype.parseClassDecl=function(t,i,r){var c=this.scanner.leftCurlyCount,l=this.scanner.rightCurlyCount,s,h,u,f;(r&n.Modifiers.Readonly)!=n.Modifiers.None&&this.reportParseError("const modifier is implicit for class"),(this.parsingDeclareFile||this.ambientModule)&&(r|=n.Modifiers.Ambient,r|=n.Modifiers.Exported),s=this.parsingDeclareFile||(r&n.Modifiers.Ambient)!=n.Modifiers.None,h=this.ambientClass,this.ambientClass=s,this.currentToken=this.scanner.scan(),u=null,this.currentToken.tokenId==n.TokenID.Identifier||!n.isPrimitiveTypeToken(this.currentToken)&&n.convertTokToID(this.currentToken,this.strictMode)?(u=n.Identifier.fromToken(this.currentToken),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,this.currentToken=this.scanner.scan()):(this.reportParseError("class missing name"),this.errorRecovery&&(u=new n.MissingIdentifier,u.minChar=this.scanner.pos,u.limChar=this.scanner.pos,u.flags|=n.ASTFlags.Error));var e=null,o=null,a=!1;return(this.currentToken.tokenId==n.TokenID.Extends||this.currentToken.tokenId==n.TokenID.Implements)&&(e=new n.ASTList,o=new n.ASTList,this.parseBaseList(e,o,t,!0)),f=new n.ClassDeclaration(u,new n.ASTList,e,o),this.currentClassDefinition=f,this.parseClassElements(f,t,r),(this.ambientModule||this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Exported))&&(f.varFlags|=n.VarFlags.Exported),(this.ambientModule||n.hasFlag(r,n.Modifiers.Ambient))&&(f.varFlags|=n.VarFlags.Ambient),f.varFlags|=n.VarFlags.Class,this.ambientClass=h,f.leftCurlyCount=this.scanner.leftCurlyCount-c,f.rightCurlyCount=this.scanner.rightCurlyCount-l,f},u.prototype.parseClassElements=function(t,i,r){var u=r,s=!1,y=this.scanner.startPos,h,f,e,l,v,c,o,a;for(this.checkCurrentToken(n.TokenID.OpenBrace,i),this.nestingLevel++,h=this.scanner.startPos,f=!1;!(this.currentToken.tokenId==n.TokenID.CloseBrace||this.currentToken.tokenId==n.TokenID.EndOfFile);)e=!0,l=n.Modifiers.Public|n.Modifiers.Private,this.currentToken.tokenId==n.TokenID.Get?(u&n.Modifiers.Getter&&this.reportParseError("Duplicate 'get' declaration in class body"),u&n.Modifiers.Setter&&this.reportParseError("Getter already marked as a setter"),u|=n.Modifiers.Getter):this.currentToken.tokenId==n.TokenID.Set?(u&n.Modifiers.Setter&&this.reportParseError("Duplicate 'set' declaration in class body"),u&n.Modifiers.Getter&&this.reportParseError("Setter already marked as a getter"),u|=n.Modifiers.Setter):this.currentToken.tokenId==n.TokenID.Private?(u&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Private):this.currentToken.tokenId==n.TokenID.Public?(u&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Public):this.currentToken.tokenId==n.TokenID.Static?(u&n.Modifiers.Static&&this.reportParseError("Multiple modifiers may not be applied to class members"),u|=n.Modifiers.Static):this.currentToken.tokenId==n.TokenID.Constructor?(u!=r&&this.reportParseError("Constructors may not have modifiers"),this.parseClassConstructorDeclaration(h,i,u),e=!1,s=!0):f||this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToIDName(this.currentToken)?(v=f?u&n.Modifiers.Getter?"get":"set":this.currentToken.getText(),c=f?new n.Identifier(v):n.Identifier.fromToken(this.currentToken),c.minChar=this.scanner.startPos,c.limChar=this.scanner.pos,f?(u=u^(u&n.Modifiers.Getter?n.Modifiers.Getter:n.Modifiers.Setter),f=!1):this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.OpenParen?(this.parseClassMemberFunctionDeclaration(c,h,i,u),e=!1):((u&n.Modifiers.Getter||u&n.Modifiers.Setter)&&this.reportParseError("Property accessors must be functions"),o=this.parseClassMemberVariableDeclaration(c,h,!1,i,u),o.init&&o.init.nodeType==n.NodeType.FuncDecl?this.currentToken.tokenId==n.TokenID.CloseBrace&&(e=!1):o.init&&o.init.nodeType==n.NodeType.ObjectLit&&this.currentToken.tokenId!=n.TokenID.Semicolon?(e=!1,o.init.flags|=n.ASTFlags.AutomaticSemicolon):this.currentToken.tokenId!=n.TokenID.Semicolon&&(this.reportParseError("Expected ';'"),e=!1)),s=!0):this.currentToken.tokenId==n.TokenID.Super?this.reportParseError("Base class initializers must be the first statement in a class definition"):!f&&(u&n.Modifiers.Getter||u&n.Modifiers.Setter)&&(this.currentToken.tokenId==n.TokenID.OpenParen||this.currentToken.tokenId==n.TokenID.Equals||this.currentToken.tokenId==n.TokenID.Colon||this.currentToken.tokenId==n.TokenID.Semicolon)?(f=!0,e=!1):this.currentToken.tokenId!=n.TokenID.Semicolon&&(this.reportParseError("Unexpected '"+this.currentToken.getText()+"' in class definition"),s=!0),e&&(this.currentToken=this.scanner.scan()),s&&(u=r,h=this.scanner.startPos,s=!1);a=this.scanner.pos,this.currentToken.tokenId==n.TokenID.CloseBrace&&(t.endingToken=new n.ASTSpan,t.endingToken.minChar=this.scanner.startPos,t.endingToken.limChar=this.scanner.pos,this.currentClassDefinition.members.members.length||(this.currentClassDefinition.preComments=this.parseComments()),this.currentToken=this.scanner.scan()),this.nestingLevel--,this.currentClassDefinition.members.minChar=y,this.currentClassDefinition.members.limChar=a,this.currentClassDefinition.limChar=a,this.currentClassDefinition=null},u.prototype.parseClassConstructorDeclaration=function(t,i,r){var a,o,s,h,u;this.parsingClassConstructorDefinition=!0;var e=this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient),f=new n.ASTList,c=!1,l=this.parseComments();if(this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.OpenParen&&(c=this.parseFormalParameterList(i,f,!0,e,!1,!1,!1,!1,null,!0),f.members.length>0&&(a=f.members[f.members.length-1])),o=e||this.currentToken.tokenId==n.TokenID.Semicolon,o)for(s=0;s<f.members.length;s++)h=f.members[s],n.hasFlag(h.varFlags,n.VarFlags.Property)&&this.reportParseError("Overload or ambient signatures may not specify parameter properties",h.minChar,h.limChar);return o||(this.currentClassDefinition.constructorNestingLevel=this.nestingLevel+1),u=this.parseFunctionStatements(i|n.ErrorRecoverySet.RCurly,this.currentClassDefinition.name,!0,!1,f,n.AllowedElements.Properties,t,o,r),u.preComments=l,o&&!e&&(u.isOverload=!0),u.variableArgList=c,this.currentClassDecl=null,u.returnTypeAnnotation=this.convertToTypeReference(this.currentClassDefinition.name),u.classDecl=this.currentClassDefinition,e&&(u.fncFlags|=n.FncFlags.Ambient),o&&(u.fncFlags|=n.FncFlags.Signature),(this.ambientModule||n.hasFlag(r,n.Modifiers.Exported))&&(u.fncFlags|=n.FncFlags.Exported),this.currentClassDefinition.constructorDecl&&(e||this.currentClassDefinition.constructorDecl.isSignature()||u.isSignature()||this.reportParseError("Duplicate constructor definition")),(e||!u.isSignature())&&(this.currentClassDefinition.constructorDecl=u),u.fncFlags|=n.FncFlags.ClassMethod,this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=u,this.parsingClassConstructorDefinition=!1,u},u.prototype.parseClassMemberVariableDeclaration=function(i,r,u,f,e){var o=new n.VarDecl(i,this.nestingLevel),h,s;if(o.minChar=r,h=!1,o.preComments=this.parseComments(),this.currentToken.tokenId==n.TokenID.Colon&&(this.currentToken=this.scanner.scan(),o.typeExpr=this.parseTypeReference(f|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1),o.typeExpr&&o.typeExpr.nodeType==n.NodeType.TypeRef&&(s=o.typeExpr,s.term&&s.term.nodeType==n.NodeType.FuncDecl&&(s.term.preComments=o.preComments))),this.currentToken.tokenId==n.TokenID.Equals){if((this.parsingDeclareFile||n.hasFlag(e,n.Modifiers.Ambient))&&(this.reportParseError("context does not permit variable initializer"),this.errorRecovery))return this.skip(f),o.flags|=n.ASTFlags.Error,o.limChar=this.scanner.lastTokenLimChar(),o;this.currentToken=this.scanner.scan(),o.init=this.parseExpr(n.ErrorRecoverySet.Comma|f,n.OperatorPrecedence.Comma,!0,t.NoTypes),o.limChar=o.init.limChar,e&n.Modifiers.Static||(this.currentClassDefinition.varFlags|=n.VarFlags.ClassSuperMustBeFirstCallInConstructor)}else o.limChar=this.scanner.pos;return e&n.Modifiers.Static&&(o.varFlags|=n.VarFlags.Static,h=!0),o.varFlags|=(e&n.Modifiers.Private)!=n.Modifiers.None?n.VarFlags.Private:n.VarFlags.Public,o.varFlags|=n.VarFlags.Property,u&&(o.varFlags|=n.VarFlags.ClassConstructorProperty),u||h||(o.varFlags|=n.VarFlags.ClassBodyProperty),this.currentClassDefinition.knownMemberNames[i.actualText]=!0,u||(this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=o),o.postComments=this.parseComments(),o},u.prototype.parseClassMemberFunctionDeclaration=function(t,i,r,u){var c=this.prevIDTok!=null,o=n.hasFlag(u,n.Modifiers.Getter)||n.hasFlag(u,n.Modifiers.Setter),s=n.hasFlag(u,n.Modifiers.Static),h=this.ambientModule||n.hasFlag(u,n.Modifiers.Ambient),e,f;return(r|=n.ErrorRecoverySet.RParen,o&&u&n.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient classes"),e=this.parseFncDecl(r,!0,h,!0,t,!1,s,h,u,null,!0),e.nodeType==n.NodeType.Error)?e:(f=e,f.minChar=i,f.bod!==null&&(f.limChar=f.bod.limChar),f.fncFlags|=u&n.Modifiers.Private?n.FncFlags.Private:n.FncFlags.Public,s&&(f.fncFlags|=n.FncFlags.Static),o&&(n.hasFlag(u,n.Modifiers.Getter)?(f.fncFlags|=n.FncFlags.GetAccessor,f.hint="get"+f.name.actualText):(f.fncFlags|=n.FncFlags.SetAccessor,f.hint="set"+f.name.actualText),f.fncFlags|=n.FncFlags.IsFunctionExpression,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater",f.minChar,f.limChar)),f.fncFlags|=n.FncFlags.ClassMethod,this.currentClassDefinition.knownMemberNames[t.actualText]=!0,this.currentClassDefinition.members.members[this.currentClassDefinition.members.members.length]=f,f)},u.prototype.parseTypeMember=function(t){var r=this.scanner.startPos,i=this.parsePropertyDeclaration(t,n.Modifiers.Public,!0,!1);return i&&(i.minChar=r,i.nodeType==n.NodeType.VarDecl&&this.checkCurrentToken(n.TokenID.Semicolon,t)),i},u.prototype.parseTypeMemberList=function(t,i){for(t|=n.ErrorRecoverySet.TypeScriptS;;){switch(this.currentToken.tokenId){case n.TokenID.CloseBrace:case n.TokenID.EndOfFile:i.limChar=this.scanner.pos;return}var r=this.parseTypeMember(t);r&&i.append(r)}},u.prototype.parseInterfaceDecl=function(t,i){var c=this.scanner.leftCurlyCount,l=this.scanner.rightCurlyCount,a,r,f,o,s,e,h,u;return this.currentToken=this.scanner.scan(),a=this.scanner.pos,r=null,this.currentToken.tokenId==n.TokenID.Identifier||!n.isPrimitiveTypeToken(this.currentToken)&&n.convertTokToID(this.currentToken,this.strictMode)?(r=n.Identifier.fromToken(this.currentToken),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos,this.currentToken=this.scanner.scan()):(this.reportParseError("interface missing name"),this.errorRecovery&&(r=new n.MissingIdentifier,r.minChar=this.scanner.pos,r.limChar=this.scanner.pos,r.flags|=n.ASTFlags.Error)),f=null,o=null,(this.currentToken.tokenId===n.TokenID.Extends||this.currentToken.tokenId===n.TokenID.Implements)&&(this.currentToken.tokenId===n.TokenID.Implements&&this.reportParseError("Expected 'extends'"),f=new n.ASTList,o=new n.ASTList,f.minChar=this.scanner.startPos,this.parseBaseList(f,o,t,!1)),s=this.scanner.startPos,this.checkCurrentToken(n.TokenID.OpenBrace,t|n.ErrorRecoverySet.TypeScriptS),e=new n.ASTList,e.minChar=s,h=this.inInterfaceDecl,this.inInterfaceDecl=!0,this.parseTypeMemberList(t|n.ErrorRecoverySet.RCurly,e),this.inInterfaceDecl=h,this.checkCurrentToken(n.TokenID.CloseBrace,t),u=new n.InterfaceDeclaration(r,e,f,null),n.hasFlag(i,n.Modifiers.Private)&&(u.varFlags|=n.VarFlags.Private),n.hasFlag(i,n.Modifiers.Public)&&(u.varFlags|=n.VarFlags.Public),(this.parsingDeclareFile||this.ambientModule||n.hasFlag(i,n.Modifiers.Exported))&&(u.varFlags|=n.VarFlags.Exported),u.limChar=e.limChar,u.leftCurlyCount=this.scanner.leftCurlyCount-c,u.rightCurlyCount=this.scanner.rightCurlyCount-l,u},u.prototype.makeVarDecl=function(t,i){var r=new n.VarDecl(t,i),u=this.topVarList();return u&&u.append(r),r},u.prototype.parsePropertyDeclaration=function(i,r,u,f){var s=null,y=this.scanner.startPos,c=y,p=!1,l=!1,w=this.prevIDTok!=null,k=n.hasFlag(r,n.Modifiers.Getter)||n.hasFlag(r,n.Modifiers.Setter),d,g,h,b,a,e,v,o;if((this.parsingDeclareFile||this.ambientModule||n.hasFlag(r,n.Modifiers.Ambient))&&(u=!0),this.currentToken.tokenId!=n.TokenID.OpenParen||w){if(this.currentToken.tokenId==n.TokenID.New)u&&(this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.OpenParen&&(p=!0)),p||(u||(this.currentToken=this.scanner.scan()),s=new n.Identifier("new"),s.minChar=this.scanner.pos-3,s.limChar=this.scanner.pos,c=this.scanner.pos);else if(this.currentToken.tokenId==n.TokenID.OpenBracket&&u)l=!0,s=new n.Identifier("__item");else if(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToIDName(this.currentToken)||w)w?(s=n.Identifier.fromToken(this.prevIDTok),s.minChar=this.scanner.lastTokenLimChar()-3,s.limChar=this.scanner.lastTokenLimChar(),c=s.limChar,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),this.currentToken.getText()==s.actualText&&this.currentToken!=this.prevIDTok&&(this.currentToken=this.scanner.scan()),this.prevIDTok=null):(s=n.Identifier.fromToken(this.currentToken),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,c=this.scanner.pos,this.currentToken=this.scanner.scan());else if(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery)return d=this.scanner.startPos,g=this.scanner.pos,this.skip(i&~n.ErrorRecoverySet.Comma),this.scanner.pos==g&&(this.currentToken=this.scanner.scan()),h=new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),h.flags|=n.ASTFlags.Error,h.minChar=d,h.limChar=this.scanner.lastTokenLimChar(),h}else u||f||(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery&&(this.skip(i),s=new n.MissingIdentifier));if(this.currentToken.tokenId==n.TokenID.Question&&(this.inInterfaceDecl&&s?s.flags|=n.ASTFlags.OptionalName:this.reportParseError("Optional properties may only be declared on interface or object types"),this.currentToken=this.scanner.scan()),this.currentToken.tokenId==n.TokenID.OpenParen||l&&this.currentToken.tokenId==n.TokenID.OpenBracket)return(b=i|n.ErrorRecoverySet.RParen,l&&(b=i|n.ErrorRecoverySet.RBrack),a=this.parseFncDecl(b,!0,u,!this.inFncDecl,s,l,f,this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient),r,null,!0),a.nodeType==n.NodeType.Error)?a:(o=a,o.name&&(o.name.minChar=y,o.name.limChar=c),(r&n.Modifiers.Public)!=n.Modifiers.None&&(o.fncFlags|=n.FncFlags.Public),(r&n.Modifiers.Private)!=n.Modifiers.None&&(o.fncFlags|=n.FncFlags.Private),f&&(o.fncFlags|=n.FncFlags.Static),(this.parsingDeclareFile||n.hasFlag(r,n.Modifiers.Ambient))&&(o.fncFlags|=n.FncFlags.Ambient),k&&(n.hasFlag(r,n.Modifiers.Getter)?(o.fncFlags|=n.FncFlags.GetAccessor,o.hint="get"+o.name.actualText):(o.fncFlags|=n.FncFlags.SetAccessor,o.hint="set"+o.name.actualText),o.fncFlags|=n.FncFlags.IsFunctionExpression,r&n.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient types")),s==null&&(p?(o.fncFlags|=n.FncFlags.ConstructMember,o.hint="_construct",o.classDecl=this.currentClassDecl):(o.hint="_call",o.fncFlags|=n.FncFlags.CallMember)),o);if(e=new n.VarDecl(s,this.nestingLevel),e.preComments=this.parseComments(),e.minChar=y,this.currentToken.tokenId==n.TokenID.Colon&&(this.currentToken=this.scanner.scan(),e.typeExpr=this.parseTypeReference(i|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1),e.typeExpr&&e.typeExpr.nodeType==n.NodeType.TypeRef&&(v=e.typeExpr,v.term&&v.term.nodeType==n.NodeType.FuncDecl&&(v.term.preComments=e.preComments))),this.currentToken.tokenId==n.TokenID.Equals){if(u&&(this.reportParseError("context does not permit variable initializer"),this.errorRecovery))return this.skip(i),e.flags|=n.ASTFlags.Error,e.limChar=this.scanner.lastTokenLimChar(),e;this.currentToken=this.scanner.scan(),e.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,!0,t.NoTypes),e.limChar=e.init.limChar,e.init.nodeType==n.NodeType.FuncDecl?(o=e.init,o.hint=e.id.text,o.boundToProperty=e):k&&this.reportParseError("Accessors may only be functions")}else e.limChar=this.scanner.pos;return(r&n.Modifiers.Readonly)!=n.Modifiers.None&&(e.varFlags|=n.VarFlags.Readonly),f&&(e.varFlags|=n.VarFlags.Static),(r&n.Modifiers.Public)!=n.Modifiers.None&&(e.varFlags|=n.VarFlags.Public),(r&n.Modifiers.Private)!=n.Modifiers.None&&(e.varFlags|=n.VarFlags.Private),e.varFlags|=n.VarFlags.Property,e},u.prototype.parseVariableDeclaration=function(i,r,u,f){var y=n.hasFlag(r,n.Modifiers.Readonly),s=this.scanner.startPos,e=null,o=null,c=!1,l,h,a,v;for(this.currentToken=this.scanner.scan(),l=this.parseComments();;){if(this.currentToken.tokenId!=n.TokenID.Identifier&&!n.convertTokToID(this.currentToken,this.strictMode)&&(this.reportParseError("Expected identifier in variable declaration"),this.errorRecovery))return e=new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),e.minChar=s,this.skip(i),e.flags|=n.ASTFlags.Error,e.limChar=this.scanner.lastTokenLimChar(),e;if(h=n.Identifier.fromToken(this.currentToken),this.strictMode&&h.text=="eval"&&this.reportParseError("'eval' may not name a variable in strict mode"),e=this.makeVarDecl(h,this.nestingLevel),e.id.minChar=this.scanner.startPos,e.id.limChar=this.scanner.pos,e.preComments=l,f&&(e.varFlags|=n.VarFlags.Static),n.hasFlag(r,n.Modifiers.Readonly)&&(e.varFlags|=n.VarFlags.Readonly),(this.parsingDeclareFile||this.ambientModule||n.hasFlag(r,n.Modifiers.Ambient))&&(e.varFlags|=n.VarFlags.Ambient),(this.parsingDeclareFile||this.ambientModule||n.hasFlag(r,n.Modifiers.Exported))&&(e.varFlags|=n.VarFlags.Exported),e.minChar=s,o&&o.append(e),this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Colon&&(this.currentToken=this.scanner.scan(),a=this.inFncDecl,this.inFncDecl=!1,e.typeExpr=this.parseTypeReference(i|n.ErrorRecoverySet.Asg|n.ErrorRecoverySet.Comma,!1),this.inFncDecl=a),this.currentToken.tokenId==n.TokenID.Equals?(n.hasFlag(e.varFlags,n.VarFlags.Ambient)&&this.reportParseError("Ambient variable can not have an initializer"),this.currentToken=this.scanner.scan(),e.init=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,u,t.NoTypes),e.limChar=e.init.limChar,e.init.nodeType==n.NodeType.FuncDecl&&(v=e.init,v.hint=e.id.actualText)):(y&&this.reportParseError("const declaration requires initializer"),e.limChar=this.scanner.pos),e.postComments=this.parseCommentsForLine(this.scanner.line),this.currentToken.tokenId!=n.TokenID.Comma)return o?(o.limChar=e.limChar,o):e;c||(o=new n.ASTList,o.minChar=e.minChar,o.append(e),c=!0),this.currentToken=this.scanner.scan(),s=this.scanner.startPos}},u.prototype.parseMemberList=function(i){var e=new n.ASTList,l,b,a,f;if(this.currentToken.tokenId==n.TokenID.CloseBrace)return e;for(var u=null,r=null,o=null,s=null,v=this.scanner.startPos,h=!1,c=!1,y=null,p=0,w=0;;){if(l=!1,this.currentToken.tokenId==n.TokenID.Get||this.currentToken.tokenId==n.TokenID.Set?(h=this.currentToken.tokenId==n.TokenID.Set,y=this.currentToken,p=this.scanner.startPos,w=this.scanner.pos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToIDName(this.currentToken)?(u=h?"set":"get",u=u+this.currentToken.getText(),r=n.Identifier.fromToken(this.currentToken),r.minChar=this.scanner.startPos,l=!0,n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")):this.currentToken.tokenId!=n.TokenID.Colon?this.reportParseError("Expected identifier, string or number as accessor name"):(c=!0,r=n.Identifier.fromToken(y),r.minChar=p,r.limChar=w)):this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToIDName(this.currentToken)?(u=this.currentToken.getText(),r=n.Identifier.fromToken(this.currentToken),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):this.currentToken.tokenId==n.TokenID.StringLiteral?(u=this.currentToken.getText(),r=new n.StringLiteral(u),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):this.currentToken.tokenId==n.TokenID.NumberLiteral?(b=this.currentToken,u=b.value.toString(),r=new n.StringLiteral(u),r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos):(this.reportParseError("Expected identifier, string or number as member name"),this.errorRecovery&&(r=new n.MissingIdentifier,r.minChar=this.scanner.startPos,r.flags|=n.ASTFlags.Error,this.skip(i|n.ErrorRecoverySet.Comma),r.limChar=this.scanner.lastTokenLimChar())),c?c=!1:this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Question&&(r.flags|=n.ASTFlags.OptionalName,this.currentToken=this.scanner.scan()),l)a=new n.ASTList,this.parseFormalParameterList(i|n.ErrorRecoverySet.RParen,a,!1,!0,!1,!h,h,!1,null,!0),f=this.parseFunctionStatements(i|n.ErrorRecoverySet.RCurly,r,!1,!0,a,n.AllowedElements.None,this.scanner.startPos,!1,n.Modifiers.None),h&&f.returnTypeAnnotation&&this.reportParseError("Property setters may not declare a return type"),f.fncFlags|=h?n.FncFlags.SetAccessor:n.FncFlags.GetAccessor,f.fncFlags|=n.FncFlags.IsFunctionExpression,f.hint=u,o=f,s=new n.BinaryExpression(n.NodeType.Member,r,o),s.minChar=r.minChar,o.nodeType==n.NodeType.FuncDecl&&(f=o,f.hint=u);else if(this.currentToken.tokenId==n.TokenID.Colon)this.currentToken=this.scanner.scan(),o=this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,!0,t.NoTypes),o.nodeType==n.NodeType.TypeRef&&this.reportParseError("Expected 'new' on array declaration in member definition"),s=new n.BinaryExpression(n.NodeType.Member,r,o),s.minChar=r.minChar,o.nodeType==n.NodeType.FuncDecl&&(f=o,f.hint=u);else if(this.reportParseError("Expected ':' in member definition"),this.errorRecovery)return this.skip(i),e.flags|=n.ASTFlags.Error,e.minChar=v,e.limChar=this.scanner.lastTokenLimChar(),e;if(u=null,e.append(s),s.limChar=this.scanner.lastTokenLimChar(),this.currentToken.tokenId!=n.TokenID.Comma)break;else this.currentToken=this.scanner.scan();if(this.currentToken.tokenId==n.TokenID.CloseBrace)break}return s&&(e.limChar=s.limChar),e.minChar=v,e},u.prototype.parseArrayList=function(i){var r=null,u;if(this.currentToken.tokenId==n.TokenID.CloseBracket)return r;for(r=new n.ASTList,r.minChar=this.scanner.startPos;;){if(u=this.currentToken.tokenId==n.TokenID.Comma||this.currentToken.tokenId==n.TokenID.CloseBracket?new n.AST(n.NodeType.EmptyExpr):this.parseExpr(n.ErrorRecoverySet.Comma|i,n.OperatorPrecedence.Comma,!0,t.NoTypes),r.append(u),this.currentToken.tokenId!=n.TokenID.Comma)break;this.currentToken=this.scanner.scan()}return r.limChar=this.scanner.lastTokenLimChar(),r},u.prototype.parseArrayLiteral=function(t){var i=null;return i=new n.UnaryExpression(n.NodeType.ArrayLit,this.parseArrayList(t))},u.prototype.parseTerm=function(i,r,u,f){var e=null,l=!1,g=!1,o=this.scanner.startPos,s=this.scanner.pos,c=!1,w=!1,k,a,nt,v,y,d,tt,b,it,p,h,rt;switch(this.currentToken.tokenId){case n.TokenID.Number:case n.TokenID.Bool:case n.TokenID.Any:case n.TokenID.String:k=new n.Identifier(n.tokenTable[this.currentToken.tokenId].text),n.hasFlag(u,t.Primitive)?(e=new n.TypeReference(k,0),l=!0):(e=k,l=!0),e.minChar=o,this.currentToken=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.This:e=new n.AST(n.NodeType.This),e.minChar=o,this.currentToken=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.Super:e=new n.AST(n.NodeType.Super),e.minChar=o,this.currentToken=this.scanner.scan(),s=this.scanner.lastTokenLimChar();break;case n.TokenID.True:e=new n.AST(n.NodeType.True),this.currentToken=this.scanner.scan(),e.minChar=o;break;case n.TokenID.False:e=new n.AST(n.NodeType.False),this.currentToken=this.scanner.scan(),e.minChar=o;break;case n.TokenID.Null:e=new n.AST(n.NodeType.Null),this.currentToken=this.scanner.scan(),e.minChar=o;break;case n.TokenID.New:o=this.scanner.pos,this.currentToken=this.scanner.scan(),a=this.parseTerm(i,!1,t.AllSimpleTypes,f),a.nodeType==n.NodeType.Error||a.nodeType==n.NodeType.Index&&a.operand1.nodeType==n.NodeType.TypeRef?this.reportParseError("Cannot invoke 'new' on this expression"):(e=new n.CallExpression(n.NodeType.New,a,null),e.minChar=o,s=this.scanner.lastTokenLimChar(),g=!0);break;case n.TokenID.Function:o=this.scanner.pos,e=this.parseFncDecl(i,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,null,!0),e.fncFlags|=n.FncFlags.IsFunctionExpression,e.minChar=o,s=this.scanner.lastTokenLimChar(),e.limChar=s}if(e==null&&(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(nt=this.currentToken.getText(),e=this.createRef(nt,this.currentToken.hasEscapeSequence,o),l=!0,e.minChar=o,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Question&&(e.flags|=n.ASTFlags.PossibleOptionalParameter),s=this.scanner.lastTokenLimChar()),f&&this.checkCurrentToken(n.TokenID.GreaterThan,i),e==null)switch(this.currentToken.tokenId){case n.TokenID.OpenParen:if(o=this.scanner.pos,v=this.scanner.previousToken().tokenId,this.currentToken=this.scanner.scan(),y=v==n.TokenID.OpenParen||v==n.TokenID.Comma||v==n.TokenID.EqualsEquals||v==n.TokenID.Colon,y&&this.currentToken.tokenId==n.TokenID.CloseParen?(c=!0,w=!1,this.currentToken=this.scanner.scan()):y&&this.currentToken.tokenId==n.TokenID.DotDotDot?(c=!0,w=!0):(e=this.parseExpr(i|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes,y),s=this.scanner.lastTokenLimChar(),c=y&&(e.nodeType==n.NodeType.Name||e.nodeType==n.NodeType.Comma)&&(this.currentToken.tokenId==n.TokenID.Colon||this.currentToken.tokenId==n.TokenID.Question),w=!0),e&&!c){if(n.hasFlag(e.flags,n.ASTFlags.SkipNextRParen)){e.flags=e.flags&~n.ASTFlags.SkipNextRParen;break}this.checkCurrentToken(n.TokenID.CloseParen,i),e.isParenthesized=!0}break;case n.TokenID.NumberLiteral:d=this.currentToken,this.currentToken=this.scanner.scan(),e=new n.NumberLiteral(d.value,d.hasEmptyFraction),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.StringLiteral:e=new n.StringLiteral(this.currentToken.getText()),this.currentToken=this.scanner.scan(),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.RegularExpressionLiteral:tt=this.currentToken,e=new n.RegexLiteral(tt.regex),this.currentToken=this.scanner.scan(),e.minChar=o,s=this.scanner.lastTokenLimChar();break;case n.TokenID.OpenBracket:o=this.scanner.startPos,this.currentToken=this.scanner.scan(),e=this.parseArrayLiteral(n.ErrorRecoverySet.RBrack|i),e.minChar=o,s=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseBracket,i);break;case n.TokenID.OpenBrace:o=this.scanner.startPos,this.currentToken=this.scanner.scan(),b=this.parseMemberList(n.ErrorRecoverySet.RCurly|i),this.checkCurrentToken(n.TokenID.CloseBrace,i),e=new n.UnaryExpression(n.NodeType.ObjectLit,b),e.minChar=o,s=this.scanner.lastTokenLimChar(),b.minChar=o,b.limChar=s;break;case n.TokenID.LessThan:o=this.scanner.startPos,this.currentToken=this.scanner.scan(),it=this.parseTypeReference(n.ErrorRecoverySet.BinOp,!1),this.checkCurrentToken(n.TokenID.GreaterThan,i),e=new n.UnaryExpression(n.NodeType.TypeAssertion,this.parseExpr(i,n.OperatorPrecedence.Unary,!1,t.NoTypes)),e.castTerm=it;break;default:this.prevExpr&&n.hasFlag(this.prevExpr.flags,n.ASTFlags.PossibleOptionalParameter)?(c=!0,e=this.prevExpr):(this.reportParseError("Check format of expression term"),this.errorRecovery&&(p=new n.MissingIdentifier,p.minChar=o,p.flags|=n.ASTFlags.Error,this.skip(i|n.ErrorRecoverySet.Postfix),this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode)?(p.setText(this.currentToken.getText(),this.currentToken.hasEscapeSequence),this.currentToken=this.scanner.scan(),s=this.scanner.lastTokenLimChar()):s=this.scanner.lastTokenLimChar(),e=p))}return c&&(this.currentToken.tokenId==n.TokenID.Colon||this.currentToken.tokenId==n.TokenID.Comma||this.currentToken.tokenId==n.TokenID.CloseParen||this.currentToken.tokenId==n.TokenID.DotDotDot?(e=this.parseLambdaExpr(i,e,!0,w),e.minChar=o,s=this.scanner.lastTokenLimChar(),e.limChar=s):e&&(e.isParenthesized=!0)),l&&u!=t.NoTypes&&(u|=t.ArraySuffix),h=this.parsePostfixOperators(i,e,r,g,u,o,s),h?(l&&h.nodeType==n.NodeType.Index&&(rt=h,rt.operand2==null&&(h=this.convertToTypeReference(h))),h.minChar=o,h.limChar=n.max(h.limChar,this.scanner.lastTokenLimChar()),h):new n.AST(n.NodeType.Error)},u.prototype.parseLambdaExpr=function(t,i,r,u){var f=this.parseFncDecl(t,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,{preProcessedLambdaArgs:i},u);return f.fncFlags|=n.FncFlags.IsFunctionExpression,f.fncFlags|=n.FncFlags.IsFatArrowFunction,r||(f.flags|=n.ASTFlags.SkipNextRParen),f.limChar=this.scanner.lastTokenLimChar(),f},u.prototype.parseExpr=function(i,r,u,f,e){var h,v,p,l,b,k,nt,d,tt,it,ft,a,rt;typeof e=="undefined"&&(e=!1);var o=null,s=n.lookupToken(this.currentToken.tokenId),c=!0,y=null,g=this.scanner.startPos,ut=this.parseComments(),w=!1;if(s!=undefined&&s.unopNodeType!=n.NodeType.None)c=!1,this.currentToken=this.scanner.scan(),h=this.parseExpr(n.ErrorRecoverySet.BinOp|i,s.unopPrecedence,u,t.NoTypes),s.unopNodeType==n.NodeType.Pos&&h.nodeType==n.NodeType.NumberLit?o=h:s.unopNodeType==n.NodeType.Neg&&h.nodeType==n.NodeType.NumberLit?(v=h,v.value=-v.value,v.value==0&&(v.isNegativeZero=!0),o=h):(o=new n.UnaryExpression(s.unopNodeType,h),o.limChar=h.limChar),o.minChar=g;else{if(o=this.parseTerm(n.ErrorRecoverySet.BinOp|n.ErrorRecoverySet.AddOp|i,!0,f,!1),o.nodeType==n.NodeType.Name)p=o,y=p.actualText;else if(o.nodeType==n.NodeType.Dot&&(b=!1,this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId==n.TokenID.Colon||this.currentToken.tokenId==n.TokenID.Equals)&&this.parsingClassConstructorDefinition&&this.nestingLevel==this.currentClassDefinition.constructorNestingLevel&&o.operand1.nodeType==n.NodeType.This&&o.operand2.nodeType==n.NodeType.Name&&(k=o.operand2,this.currentClassDefinition.knownMemberNames[k.actualText]||(o=this.parseClassMemberVariableDeclaration(k,o.minChar,!0,i,n.Modifiers.Public),b=!0)),!b)){for(l=o;l.nodeType==n.NodeType.Dot;)nt=l,l=nt.operand2;l.nodeType==n.NodeType.Name&&(p=l,y=p.actualText)}this.scanner.lastTokenHadNewline()||this.currentToken.tokenId!=n.TokenID.PlusPlus&&this.currentToken.tokenId!=n.TokenID.MinusMinus||(c=!1,d=o,o=new n.UnaryExpression(this.currentToken.tokenId==n.TokenID.PlusPlus?n.NodeType.IncPost:n.NodeType.DecPost,d),o.limChar=this.scanner.pos,o.minChar=d.minChar,this.currentToken=this.scanner.scan())}for(;;){if(s=n.lookupToken(this.currentToken.tokenId),s==undefined||s.binopNodeType==n.NodeType.None)break;if(!u&&s.binopNodeType==n.NodeType.In)break;if(s.binopPrecedence==n.OperatorPrecedence.Assignment){if(s.binopPrecedence<r)break;c||this.reportParseError("illegal assignment")}else if(s.binopPrecedence<=r)break;if(e&&this.currentToken.tokenId==n.TokenID.Comma&&this.scanner.getLookAheadToken().tokenId==n.TokenID.DotDotDot){w=!0,c=!1,o=this.parseLambdaExpr(i,o,!1,!0);break}this.currentToken=this.scanner.scan(),c=!1,s.binopNodeType==n.NodeType.ConditionalExpression?e&&(this.currentToken.tokenId==n.TokenID.Equals||this.currentToken.tokenId==n.TokenID.Colon||this.currentToken.tokenId==n.TokenID.CloseParen||this.currentToken.tokenId==n.TokenID.Comma)?(w=!0,c=!0):(this.prevExpr=o,tt=this.parseExpr(i|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.Assignment,u,t.NoTypes),this.prevExpr=null,this.checkCurrentToken(n.TokenID.Colon,i|n.ErrorRecoverySet.ExprStart),it=this.parseExpr(i|n.ErrorRecoverySet.BinOp,n.OperatorPrecedence.Assignment,u,t.NoTypes),o=new n.ConditionalExpression(o,tt,it)):(ft=t.NoTypes,a=new n.BinaryExpression(s.binopNodeType,o,this.parseExpr(i|n.ErrorRecoverySet.BinOp,s.binopPrecedence,u,t.NoTypes,e)),a.operand2.nodeType==n.NodeType.FuncDecl&&(rt=a.operand2,rt.hint=y),a.minChar=o.minChar,a.limChar=this.scanner.lastTokenLimChar(),y=null,o=a)}return c&&(o.flags|=n.ASTFlags.Writeable),w||(o.minChar=g,o.limChar=n.max(o.limChar,this.scanner.lastTokenLimChar()),o.preComments=ut,o.postComments=this.parseCommentsForLine(this.scanner.line)),o},u.prototype.parsePostfixOperators=function(i,r,u,f,e,o,s){var v=0,c,l,h,a;for(r||(r=new n.AST(n.NodeType.EmptyExpr),r.isParenthesized=!0),r.minChar=o,r.limChar=s;;)switch(this.currentToken.tokenId){case n.TokenID.OpenParen:if(f)c=r,c.arguments=this.parseArgList(i),f=!1;else{if(!u)return r;r=new n.CallExpression(n.NodeType.Call,r,this.parseArgList(i)),r.minChar=o}r.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,i);break;case n.TokenID.OpenBracket:if(this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.CloseBracket&&n.hasFlag(e,t.ArraySuffix)){this.currentToken=this.scanner.scan(),r.nodeType==n.NodeType.TypeRef?(l=r,l.arrayCount++):r=new n.BinaryExpression(n.NodeType.Index,r,null),r.limChar=this.scanner.pos;break}r=new n.BinaryExpression(n.NodeType.Index,r,this.parseExpr(i|n.ErrorRecoverySet.RBrack,n.OperatorPrecedence.None,!0,t.NoTypes)),r.minChar=o,r.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseBracket,i);break;case n.TokenID.Dot:if(h=null,a=this.scanner.pos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.Identifier&&(this.errorRecovery&&this.scanner.lastTokenHadNewline()||!n.convertTokToIDName(this.currentToken))){if(this.reportParseError("Expected identifier following dot"),this.errorRecovery)return this.skip(i),r.flags|=n.ASTFlags.Error|n.ASTFlags.DotLHS,r;h=new n.MissingIdentifier}else r.flags|=n.ASTFlags.DotLHS,h=this.createRef(this.currentToken.getText(),this.currentToken.hasEscapeSequence,this.scanner.startPos),h.limChar=this.scanner.pos,this.currentToken=this.scanner.scan();r=new n.BinaryExpression(n.NodeType.Dot,r,h),r.minChar=o,r.limChar=this.scanner.lastTokenLimChar();break;case n.TokenID.EqualsGreaterThan:r=this.parseFncDecl(i,!1,!1,!1,null,!1,!1,!1,n.Modifiers.None,{preProcessedLambdaArgs:r},!1),r.fncFlags|=n.FncFlags.IsFunctionExpression,r.minChar=o,r.limChar=this.scanner.lastTokenLimChar();break;default:return r}},u.prototype.parseTry=function(t,i,r){var f=this.scanner.startPos,e=this.parseComments(),u;return(this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.OpenBrace&&(this.reportParseError("Expected '{'"),this.errorRecovery))?(u=t,u.minChar=f,u.limChar=this.scanner.lastTokenLimChar(),u.flags|=n.ASTFlags.Error,u):(t.body=this.parseStatement(i,n.AllowedElements.None,r),t.minChar=f,t.limChar=t.body.limChar,t.preComments=e,t.postComments=this.parseComments(),t)},u.prototype.parseCatch=function(t,i){var e=this.scanner.startPos,h=this.parseComments(),u,o,r,s,f;return(this.currentToken=this.scanner.scan(),this.checkCurrentToken(n.TokenID.OpenParen,t|n.ErrorRecoverySet.ExprStart),(this.currentToken.tokenId!=n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(this.reportParseError("Expected identifier in catch header"),this.errorRecovery))?(this.skip(t),r=new n.Catch(new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),new n.Statement(n.NodeType.Empty)),r.statement.minChar=e,r.statement.limChar=this.scanner.pos,r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos,r.flags|=n.ASTFlags.Error,r):(u=new n.VarDecl(n.Identifier.fromToken(this.currentToken),this.nestingLevel),u.id.minChar=this.scanner.startPos,u.id.limChar=this.scanner.pos,u.minChar=u.id.minChar,u.limChar=u.id.limChar,this.currentToken=this.scanner.scan(),o=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,t|n.ErrorRecoverySet.StmtStart),this.currentToken.tokenId!=n.TokenID.OpenBrace&&(this.reportParseError("Expected '{' to start catch body"),this.errorRecovery))?(this.skip(t),r=new n.Catch(new n.VarDecl(new n.MissingIdentifier,this.nestingLevel),new n.Statement(n.NodeType.Empty)),r.statement.minChar=e,r.statement.limChar=o,r.minChar=this.scanner.startPos,r.limChar=this.scanner.pos,r.flags|=n.ASTFlags.Error,r):(s=this.parseStatement(t,n.AllowedElements.None,i),f=new n.Catch(u,s),f.statement.minChar=e,f.statement.limChar=o,f.minChar=e,f.limChar=s.limChar,f.preComments=h,f.postComments=this.parseComments(),f)},u.prototype.parseFinally=function(t,i){var e=this.scanner.startPos,o=this.parseComments(),u,f,r;return(this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.OpenBrace&&(this.reportParseError("Expected '{' to start body of finally statement"),this.errorRecovery))?(this.skip(t),u=new n.Finally(new n.Statement(n.NodeType.Empty)),u.flags|=n.ASTFlags.Error,u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,u):(f=this.parseStatement(t,n.AllowedElements.None,i),r=new n.Finally(f),r.minChar=e,r.limChar=r.body.limChar,r.preComments=o,r.postComments=this.parseComments(),r)},u.prototype.parseTryCatchFinally=function(t,i,r){var u=new n.Try(null),c=this.scanner.startPos,f,e,s,o,h;return this.pushStmt(u,r),this.parseTry(u,t|n.ErrorRecoverySet.Catch,i),this.popStmt(),f=null,e=null,this.currentToken.tokenId==n.TokenID.Catch&&(s=this.parseCatch(t|n.ErrorRecoverySet.Catch,i),f=new n.TryCatch(u,s),f.minChar=u.minChar,f.limChar=s.limChar),this.currentToken.tokenId!=n.TokenID.Finally?f==null?(this.reportParseError("try with neither catch nor finally"),this.errorRecovery)?(o=new n.TryFinally(u,new n.Finally(new n.AST(n.NodeType.Empty))),o.flags|=n.ASTFlags.Error,o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,o):new n.TryFinally(u,new n.Finally(new n.AST(n.NodeType.Empty))):f:(f&&(u=f),h=this.parseFinally(t,i),e=new n.TryFinally(u,h),e.minChar=c,e.limChar=h.limChar,e)},u.prototype.parseStatement=function(r,u,f){function rt(){return n.hasFlag(o,n.Modifiers.Ambient)||n.hasFlag(f,n.Modifiers.Ambient)}function l(){n.hasFlag(o,n.Modifiers.Exported)&&this.reportError("Statement may not be exported")}var e=null,a=null,pt=null,c,o=n.Modifiers.None,s=this.scanner.startPos,ct=!1,v=!1,h=null,ft=this.parseComments(),g,et,ht,nt,p,lt,it,y,at,k,vt,tt,b,w,d,ot,ut,st,yt;for(this.state=i.StartStatement;;){switch(this.currentToken.tokenId){case n.TokenID.EndOfFile:e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.pos;break;case n.TokenID.Function:this.parsingDeclareFile||rt()||this.ambientModule?(this.currentToken=this.scanner.scan(),h=this.parsePropertyDeclaration(r|n.ErrorRecoverySet.SColon,o,!0,!1),h.nodeType==n.NodeType.VarDecl?this.reportParseError("function keyword can only introduce function declaration"):h.nodeType==n.NodeType.FuncDecl&&(h.fncFlags,n.FncFlags.IsFatArrowFunction)&&(v=!0),e=h,(this.parsingDeclareFile||this.ambientModule&&e.nodeType==n.NodeType.FuncDecl)&&(e.fncFlags|=n.FncFlags.Exported)):(e=this.parseFncDecl(r,!0,!1,!1,null,!1,!1,rt(),o,null,!0),n.hasFlag(e.fncFlags,n.FncFlags.IsFatArrowFunction)&&(v=!0),this.ambientModule&&this.reportParseError("function declaration not permitted within ambient module"),n.hasFlag(o,n.Modifiers.Exported)&&(e.fncFlags|=n.FncFlags.Exported));break;case n.TokenID.Module:(u&n.AllowedElements.ModuleDeclarations)==n.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(e=this.parseModuleDecl(r,o,ft),ft=null);break;case n.TokenID.Import:(u&n.AllowedElements.ModuleDeclarations)==n.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(n.hasFlag(o,n.Modifiers.Exported)&&this.reportParseError("export keyword not permitted on import declaration"),e=this.parseImportDeclaration(r,o),v=!0);break;case n.TokenID.Export:(u&n.AllowedElements.ModuleDeclarations)==n.AllowedElements.None&&(this.reportParseError("'export' statements are only allowed at the global and module levels"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()),this.topLevel&&(this.hasTopLevelImportOrExport=!0),o|=n.Modifiers.Exported,this.currentToken=this.scanner.scan();break;case n.TokenID.Private:o|=n.Modifiers.Private,this.currentToken=this.scanner.scan(),this.parsingClassConstructorDefinition?(this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),s=this.scanner.pos,this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId!=n.TokenID.This||(this.currentToken=this.scanner.scan()).tokenId!=n.TokenID.Dot)?(this.reportParseError("Expected 'this.' for property declaration"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(this.currentToken=this.scanner.scan(),g=n.Identifier.fromToken(this.currentToken),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.currentToken=this.scanner.scan(),e=this.parseClassMemberVariableDeclaration(g,s,this.parsingClassConstructorDefinition,r,o))):this.currentToken.tokenId!=n.TokenID.Interface&&(this.currentToken.tokenId==n.TokenID.Get?(this.prevIDTok=this.currentToken,this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.currentToken.tokenId==n.TokenID.Set&&(this.prevIDTok=this.currentToken,this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Setter,this.prevIDTok=null)),h=this.parsePropertyDeclaration(r|n.ErrorRecoverySet.SColon,o,rt(),!1),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(v=!0),e=h);break;case n.TokenID.Public:this.parsingClassConstructorDefinition?(this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),this.currentToken=this.scanner.scan(),s=this.scanner.pos,o|=n.Modifiers.Public,this.inferPropertiesFromThisAssignment&&(this.currentToken.tokenId!=n.TokenID.This||(this.currentToken=this.scanner.scan()).tokenId!=n.TokenID.Dot)?(this.reportParseError("Expected 'this.' for property declaration"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(this.currentToken=this.scanner.scan(),g=n.Identifier.fromToken(this.currentToken),g.minChar=this.scanner.startPos,g.limChar=this.scanner.pos,this.currentToken=this.scanner.scan(),e=this.parseClassMemberVariableDeclaration(g,s,this.parsingClassConstructorDefinition,r,o))):(u&n.AllowedElements.Properties)==n.AllowedElements.None?(this.reportParseError("'property' statements are only allowed within classes"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):(o|=n.Modifiers.Public,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Get?(this.prevIDTok=this.currentToken,this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.currentToken.tokenId==n.TokenID.Set&&(this.prevIDTok=this.currentToken,this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Setter,this.prevIDTok=null)),h=this.parsePropertyDeclaration(r|n.ErrorRecoverySet.SColon,o,rt(),!1),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(v=!0),e=h);break;case n.TokenID.Declare:u&n.AllowedElements.AmbientDeclarations||this.reportParseError("Ambient declarations are only allowed at the top-level or module scopes"),!this.parsingDeclareFile&&n.hasFlag(f,n.Modifiers.Ambient)&&this.reportParseError("Duplicate ambient declaration in this context. (Is the enclosing module or class already ambient?)"),o|=n.Modifiers.Ambient,this.currentToken=this.scanner.scan();break;case n.TokenID.Class:(u&n.AllowedElements.ClassDeclarations)==n.AllowedElements.None?(this.reportParseError("class not allowed in this context"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseClassDecl(r,s,o);break;case n.TokenID.Interface:(u&n.AllowedElements.InterfaceDeclarations)==n.AllowedElements.None?(this.reportParseError("interface not allowed in this context"),this.currentToken=this.scanner.scan(),e=new n.AST(n.NodeType.Error),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar()):e=this.parseInterfaceDecl(r,o);break;case n.TokenID.Var:et=this.parseVariableDeclaration(r|n.ErrorRecoverySet.StmtStart,o,!0,!1),e=et.nodeType==n.NodeType.VarDecl?et:new n.Block(et,!1),v=!0;break;case n.TokenID.Static:this.currentClassDecl==null&&this.reportParseError("Statics may only be class members"),l(),o|=n.Modifiers.Public,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Get?(this.prevIDTok=this.currentToken,this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Getter,this.prevIDTok=null)):this.currentToken.tokenId==n.TokenID.Set&&(this.currentToken=this.scanner.scan(),n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),(this.currentToken.tokenId==n.TokenID.Identifier||n.convertTokToID(this.currentToken,this.strictMode))&&(o|=n.Modifiers.Setter)),rt()&&(o|=n.Modifiers.Ambient),h=this.parsePropertyDeclaration(r|n.ErrorRecoverySet.SColon,o,this.parsingDeclareFile||(o&n.Modifiers.Ambient)!=n.Modifiers.None,!0),ht=this.topStaticsList(),ht&&h.nodeType==n.NodeType.VarDecl&&ht.append(h),(h.nodeType==n.NodeType.VarDecl||h.nodeType==n.NodeType.FuncDecl&&n.hasFlag(h.fncFlags,n.FncFlags.IsFatArrowFunction))&&(v=!0),e=h;break;case n.TokenID.For:l(),o!=n.Modifiers.None&&this.reportParseError("syntax error: for statement does not take modifiers"),s=this.scanner.startPos,this.checkNextToken(n.TokenID.OpenParen,r|n.ErrorRecoverySet.ExprStart|n.ErrorRecoverySet.Var),this.state=i.ForInit,ct=!0;switch(this.currentToken.tokenId){case n.TokenID.Var:c=this.parseVariableDeclaration(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.In,n.Modifiers.None,!1,!1);break;case n.TokenID.Semicolon:c=null,this.state=i.ForCondStart;break;default:c=this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.In,n.OperatorPrecedence.None,!1,t.NoTypes)}this.state=i.ForInitAfterVar,this.currentToken.tokenId==n.TokenID.In?c!=null&&ct?(this.currentToken=this.scanner.scan(),nt=new n.ForInStatement(c,this.parseExpr(n.ErrorRecoverySet.RParen|r,n.OperatorPrecedence.Comma,!1,t.NoTypes)),nt.limChar=this.scanner.pos,nt.statement.minChar=s,nt.statement.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,n.ErrorRecoverySet.StmtStart|r),this.pushStmt(nt,a),nt.body=this.parseStatement(r,u,f),this.popStmt(),nt.minChar=s,e=nt):(this.reportParseError("malformed for statement"),this.errorRecovery&&(this.skip(r|n.ErrorRecoverySet.StmtStart),e=new n.AST(n.NodeType.Empty),e.flags|=n.ASTFlags.Error)):(p=new n.ForStatement(c),p.minChar=s,this.checkCurrentToken(n.TokenID.Semicolon,r),this.currentToken.tokenId==n.TokenID.Semicolon?p.cond=null:(p.cond=this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes),this.currentToken.tokenId!=n.TokenID.Semicolon&&(this.skip(r|n.ErrorRecoverySet.StmtStart),e=p,e.flags|=n.ASTFlags.Error)),this.currentToken=this.scanner.scan(),p.incr=this.currentToken.tokenId==n.TokenID.CloseParen?null:this.parseExpr(r|n.ErrorRecoverySet.SColon|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes),this.checkCurrentToken(n.TokenID.CloseParen,r|n.ErrorRecoverySet.LCurly),this.pushStmt(p,a),p.body=this.parseStatement(r,u,f),this.popStmt(),p.limChar=p.body.limChar,e=p);break;case n.TokenID.With:n.codeGenTarget<n.CodeGenTarget.ES5&&this.reportParseError("'with' statements are only available in ES5 codegen mode or better"),this.strictMode&&this.reportParseError("'with' statements are not available in strict mode"),l(),o!=n.Modifiers.None&&this.reportParseError("'with' statement does not take modifiers"),s=this.scanner.startPos,this.checkNextToken(n.TokenID.OpenParen,r|n.ErrorRecoverySet.ExprStart|n.ErrorRecoverySet.Var),lt=this.parseExpr(r|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.None,!0,t.NoTypes),this.checkCurrentToken(n.TokenID.CloseParen,r|n.ErrorRecoverySet.LCurly),it=new n.WithStatement(lt),it.body=this.parseStatement(r,u,f),it.minChar=s,it.limChar=it.body.limChar,e=it;break;case n.TokenID.Switch:for(l(),o!=n.Modifiers.None&&this.reportParseError("'switch' statement does not take modifiers"),this.checkNextToken(n.TokenID.OpenParen,r|n.ErrorRecoverySet.ExprStart),y=new n.SwitchStatement(this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes)),y.statement.minChar=s,y.statement.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,r|n.ErrorRecoverySet.LCurly),at=this.scanner.startPos,this.checkCurrentToken(n.TokenID.OpenBrace,r|n.ErrorRecoverySet.SCase),y.defaultCase=null,y.caseList=new n.ASTList,k=null,this.pushStmt(y,a);;)if(this.currentToken.tokenId==n.TokenID.Case||this.currentToken.tokenId==n.TokenID.Default)vt=this.currentToken.tokenId==n.TokenID.Default,k=new n.CaseStatement,k.minChar=this.scanner.startPos,this.currentToken=this.scanner.scan(),vt?y.defaultCase=k:k.expr=this.parseExpr(r|n.ErrorRecoverySet.Colon,n.OperatorPrecedence.None,!0,t.NoTypes),this.checkCurrentToken(n.TokenID.Colon,r|n.ErrorRecoverySet.StmtStart),k.body=new n.ASTList,this.parseStatementList(r|n.ErrorRecoverySet.RCurly,k.body,!1,!0,u,o),k.limChar=k.body.limChar,y.caseList.append(k);else break;y.caseList.minChar=at,y.caseList.limChar=this.scanner.pos,y.limChar=y.caseList.limChar,this.checkCurrentToken(n.TokenID.CloseBrace,r),this.popStmt(),e=y;break;case n.TokenID.While:l(),o!=n.Modifiers.None&&this.reportParseError("'while' statement does not take modifiers"),s=this.scanner.startPos,this.checkNextToken(n.TokenID.OpenParen,n.ErrorRecoverySet.ExprStart|r),tt=new n.WhileStatement(this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes)),tt.minChar=s,this.checkCurrentToken(n.TokenID.CloseParen,r|n.ErrorRecoverySet.StmtStart),this.pushStmt(tt,a),tt.body=this.parseStatement(r,u,f),tt.limChar=tt.body.limChar,this.popStmt(),e=tt;break;case n.TokenID.Do:l(),o!=n.Modifiers.None&&this.reportParseError("'do' statement does not take modifiers"),s=this.scanner.startPos,this.currentToken=this.scanner.scan(),b=new n.DoWhileStatement,b.minChar=s,this.pushStmt(b,a),b.body=this.parseStatement(r|n.ErrorRecoverySet.While,u,f),this.popStmt(),b.whileAST=new n.Identifier("while"),b.whileAST.minChar=this.scanner.startPos,this.checkCurrentToken(n.TokenID.While,r|n.ErrorRecoverySet.LParen),b.whileAST.limChar=b.whileAST.minChar+5,this.checkCurrentToken(n.TokenID.OpenParen,r|n.ErrorRecoverySet.ExprStart),b.cond=this.parseExpr(r|n.ErrorRecoverySet.RParen,n.OperatorPrecedence.None,!0,t.NoTypes),b.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,r),e=b,this.currentToken.tokenId==n.TokenID.Semicolon&&(this.currentToken=this.scanner.scan());break;case n.TokenID.If:l(),o!=n.Modifiers.None&&this.reportParseError("if statement does not take modifiers"),s=this.scanner.startPos,this.checkNextToken(n.TokenID.OpenParen,r|n.ErrorRecoverySet.ExprStart),w=new n.IfStatement(this.parseExpr(r|n.ErrorRecoverySet.LParen,n.OperatorPrecedence.None,!0,t.NoTypes)),w.minChar=s,w.statement.minChar=s,w.statement.limChar=this.scanner.pos,this.checkCurrentToken(n.TokenID.CloseParen,r|n.ErrorRecoverySet.StmtStart),this.pushStmt(w,a),w.thenBod=this.parseStatement(n.ErrorRecoverySet.Else|r,u,f),w.limChar=w.thenBod.limChar,this.currentToken.tokenId==n.TokenID.Else&&(this.currentToken=this.scanner.scan(),w.elseBod=this.parseStatement(r,u,f),w.limChar=w.elseBod.limChar),this.popStmt(),e=w;break;case n.TokenID.Try:l(),o!=n.Modifiers.None&&this.reportParseError("try statement does not take modifiers"),s=this.scanner.startPos,e=this.parseTryCatchFinally(r,f,a);break;case n.TokenID.OpenBrace:l(),o!=n.Modifiers.None&&this.reportParseError("block does not take modifiers"),s=this.scanner.startPos,this.currentToken=this.scanner.scan(),d=new n.Block(new n.ASTList,!0),this.pushStmt(d,a),this.parseStatementList(r|n.ErrorRecoverySet.RCurly,d.statements,!1,!1,n.AllowedElements.None,o),this.popStmt(),d.statements.minChar=s,d.statements.limChar=this.scanner.pos,d.minChar=d.statements.minChar,d.limChar=d.statements.limChar,this.checkCurrentToken(n.TokenID.CloseBrace,r),e=d;break;case n.TokenID.Semicolon:l(),o!=n.Modifiers.None&&this.reportParseError("modifier can not appear here"),e=new n.AST(n.NodeType.Empty),this.currentToken=this.scanner.scan();break;case n.TokenID.Break:case n.TokenID.Continue:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before jump statement"),ot=new n.Jump(this.currentToken.tokenId==n.TokenID.Break?n.NodeType.Break:n.NodeType.Continue),this.currentToken=this.scanner.scan(),this.currentToken.tokenId!=n.TokenID.Identifier||this.scanner.lastTokenHadNewline()||(ot.target=this.currentToken.getText(),this.currentToken=this.scanner.scan()),this.resolveJumpTarget(ot),e=ot,v=!0;break;case n.TokenID.Return:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before return statement"),this.inFunction||this.reportParseError("return statement outside of function body"),s=this.scanner.startPos,this.currentToken=this.scanner.scan(),ut=new n.ReturnStatement,ut.minChar=s,this.currentToken.tokenId==n.TokenID.Semicolon||this.currentToken.tokenId==n.TokenID.CloseBrace||this.scanner.lastTokenHadNewline()||(ut.returnExpression=this.parseExpr(r|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.None,!0,t.NoTypes)),v=!0,ut.limChar=this.scanner.lastTokenLimChar(),e=ut;break;case n.TokenID.Throw:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before a throw statement"),s=this.scanner.startPos,this.currentToken=this.scanner.scan(),this.currentToken.tokenId==n.TokenID.Semicolon||this.currentToken.tokenId==n.TokenID.CloseBrace||this.scanner.lastTokenHadNewline()?(this.reportParseError("throw with no target"),c=null):c=this.parseExpr(r|n.ErrorRecoverySet.SColon,n.OperatorPrecedence.None,!0,t.NoTypes),e=new n.UnaryExpression(n.NodeType.Throw,c),e.limChar=this.scanner.lastTokenLimChar(),v=!0;break;case n.TokenID.Enum:this.currentToken=this.scanner.scan(),e=this.parseEnumDecl(r,o),e.minChar=s,e.limChar=this.scanner.lastTokenLimChar(),(this.parsingDeclareFile||this.ambientModule||n.hasFlag(o,n.Modifiers.Ambient))&&(e.modFlags|=n.ModuleFlags.Ambient),(this.parsingDeclareFile||this.ambientModule||n.hasFlag(o,n.Modifiers.Exported))&&(e.modFlags|=n.ModuleFlags.Exported);break;case n.TokenID.Debugger:l(),o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before debugger statement"),s=this.scanner.startPos,this.currentToken=this.scanner.scan(),st=new n.DebuggerStatement,st.minChar=s,v=!0,st.limChar=this.scanner.lastTokenLimChar(),e=st;break;default:o!=n.Modifiers.None&&this.reportParseError("modifiers can not appear before an expression statement or label"),s=this.scanner.startPos,yt=this.scanner.pos,c=this.parseExpr(n.ErrorRecoverySet.Colon|n.ErrorRecoverySet.StmtStart|r,n.OperatorPrecedence.None,!0,t.NoTypes),this.scanner.pos==yt?(this.currentToken=this.scanner.scan(),e=c):this.currentToken.tokenId==n.TokenID.Colon&&!this.scanner.lastTokenHadNewline()&&c&&c.nodeType==n.NodeType.Name?(a==null&&(a=new n.ASTList),a.append(new n.Label(c)),this.currentToken=this.scanner.scan()):(e=c,v=!0)}if(e)break}if(v)switch(this.currentToken.tokenId){case n.TokenID.Semicolon:this.currentToken=this.scanner.scan(),e.flags|=n.ASTFlags.ExplicitSemicolon;break;case n.TokenID.EndOfFile:e.limChar=this.scanner.pos;case n.TokenID.CloseBrace:e.flags|=n.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon");break;default:this.scanner.lastTokenHadNewline()?(e.flags|=n.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon")):this.reportParseError("Expected ';'")}return a&&(e=new n.LabeledStatement(a,e)),e.minChar=s,e.limChar=n.max(e.limChar,this.scanner.lastTokenLimChar()),ft&&(e.preComments=ft),this.ambientModule&&!this.okAmbientModuleMember(e)&&this.reportParseError("statement not permitted within ambient module"),e.flags|=n.ASTFlags.IsStatement,e},u.prototype.okAmbientModuleMember=function(t){var i=t.nodeType;return i==n.NodeType.ClassDeclaration||i==n.NodeType.ImportDeclaration||i==n.NodeType.InterfaceDeclaration||i==n.NodeType.ModuleDeclaration||i==n.NodeType.Empty||i==n.NodeType.VarDecl||i==n.NodeType.Block&&!t.isStatementBlock||i==n.NodeType.FuncDecl&&t.isMethod()},u.prototype.parseStatementList=function(t,r,u,f,e,o){var h=u,l,s,a;r.minChar=this.scanner.startPos;var c=this.scanner.pos,v=(e&n.AllowedElements.ModuleDeclarations)==n.AllowedElements.None,y=(e&n.AllowedElements.ClassDeclarations)==n.AllowedElements.None;for(t|=n.ErrorRecoverySet.TypeScriptS|n.ErrorRecoverySet.RCurly,this.state=i.StartStatementList,l=this.strictMode,this.nestingLevel++;;){if(this.currentToken.tokenId==n.TokenID.CloseBrace||f&&(this.currentToken.tokenId==n.TokenID.Case||this.currentToken.tokenId==n.TokenID.Default)||v&&this.currentToken.tokenId==n.TokenID.Export||y&&this.currentToken.tokenId==n.TokenID.Class||this.currentToken.tokenId==n.TokenID.EndOfFile){this.state=i.EndStmtList,r.limChar=c,r.members.length==0?r.preComments=this.parseComments():r.postComments=this.parseComments(),this.strictMode=l,this.nestingLevel--;return}s=this.parseStatement(t&~(n.ErrorRecoverySet.Else|n.ErrorRecoverySet.RParen|n.ErrorRecoverySet.Catch|n.ErrorRecoverySet.Colon),e,o),s&&(s.postComments=this.combineComments(s.postComments,this.parseCommentsForLine(this.scanner.prevLine)),r.append(s),c=s.limChar,h&&(s.nodeType==n.NodeType.QString?(a=s,a.text=='"use strict"'?(r.flags|=n.ASTFlags.StrictMode,this.strictMode=!0):h=!1):h=!1))}},u.prototype.quickParse=function(t,i,u){var e=n.moduleGenTarget,f;try{return n.moduleGenTarget=n.ModuleGenTarget.Local,f=this.parse(t,i,u,n.AllowedElements.QuickParse),new r(f,this.scanner.lexState)}finally{n.moduleGenTarget=e}},u.prototype.parse=function(t,r,u,f){var l,s,a,e,c,v,o;typeof f=="undefined"&&(f=n.AllowedElements.Global),l=this,this.ambientModule=!1,this.topLevel=!0,this.hasTopLevelImportOrExport=!1,this.requiresExtendsBlock=!1,this.fname=r,this.currentUnitIndex=u,this.amdDependencies=[],this.scanner.resetComments(),this.scanner.setErrorHandler(function(n){return l.reportParseError(n)}),this.scanner.setSourceText(t,n.LexMode.File);var y=this.scanner.leftCurlyCount,p=this.scanner.rightCurlyCount,h=this.scanner.pos;for(this.currentToken=this.scanner.scan(),this.pushDeclLists(),s=new n.ASTList,s.minChar=h,this.state=i.StartScript,this.parsingDeclareFile=n.isDSTRFile(r)||n.isDTSFile(r);;){if(this.parseStatementList(n.ErrorRecoverySet.EOF|n.ErrorRecoverySet.Func,s,!0,!1,f,n.Modifiers.None),this.currentToken.tokenId===n.TokenID.EndOfFile)break;a=n.tokenTable[this.currentToken.tokenId],this.reportParseError("Unexpected statement block terminator '"+a.text+"'"),this.currentToken=this.scanner.scan()}return this.state=i.EndScript,s.limChar=this.scanner.pos,e=null,n.moduleGenTarget!=n.ModuleGenTarget.Local&&this.hasTopLevelImportOrExport&&(c=n.switchToForwardSlashes(r),v=new n.Identifier(c),e=new n.ModuleDeclaration(v,s,this.topVarList(),this.topScopeList(),null),e.modFlags|=n.ModuleFlags.IsDynamic,e.modFlags|=n.ModuleFlags.IsWholeFile,e.modFlags|=n.ModuleFlags.Exported,this.parsingDeclareFile&&(e.modFlags|=n.ModuleFlags.Ambient),e.minChar=h,e.limChar=this.scanner.pos,e.prettyName=n.getPrettyName(c),e.containsUnicodeChar=this.scanner.seenUnicodeChar,e.containsUnicodeCharInComment=this.scanner.seenUnicodeCharInComment,e.amdDependencies=this.amdDependencies,s=new n.ASTList,s.minChar=e.minChar,s.limChar=e.limChar,s.append(e)),o=new n.Script(this.topVarList(),this.topScopeList()),o.bod=s,this.popDeclLists(),o.minChar=h,o.limChar=this.scanner.pos,o.locationInfo=new n.LocationInfo(r,this.scanner.lineMap,u),o.leftCurlyCount=this.scanner.leftCurlyCount-y,o.rightCurlyCount=this.scanner.rightCurlyCount-p,o.isDeclareFile=this.parsingDeclareFile,o.topLevelMod=e,o.containsUnicodeChar=this.scanner.seenUnicodeChar,o.containsUnicodeCharInComment=this.scanner.seenUnicodeCharInComment,o.requiresExtendsBlock=this.requiresExtendsBlock,o},u}(),n.Parser=u,n.quickParse=f}(TypeScript||(TypeScript={})),function(n){function i(n,t,i){var r=i.state;return n.print(r),r.increaseIndent(),n}function r(n,t,i){var r=i.state;return r.decreaseIndent(),n}var t=function(){function t(n,t){this.outfile=n,this.parser=t,this.builder="",this.indent1="  ",this.indentStrings=[],this.indentAmt=0}return t.prototype.increaseIndent=function(){this.indentAmt++},t.prototype.decreaseIndent=function(){this.indentAmt--},t.prototype.startLine=function(){var t,i;if(this.builder.length>0&&n.CompilerDiagnostics.Alert(this.builder),t=this.indentStrings[this.indentAmt],t===undefined){for(t="",i=0;i<this.indentAmt;i++)t+=this.indent1;this.indentStrings[this.indentAmt]=t}this.builder+=t},t.prototype.write=function(n){this.builder+=n},t.prototype.writeLine=function(n){this.builder+=n,this.outfile.WriteLine(this.builder),this.builder=""},t}();n.PrintContext=t,n.prePrintAST=i,n.postPrintAST=r}(TypeScript||(TypeScript={})),function(n){function e(n,t){for(var r=0,u=t.length,i;r+1<u;){if(i=r+(u-r)/2,i-=i%2,t[i]<=n&&n<=t[i+1])return!0;n<t[i]?u=i:r=i+2}return!1}function c(t){return n.codeGenTarget==n.CodeGenTarget.ES3?e(t,tt):e(t,rt)}function s(t){return n.codeGenTarget==n.CodeGenTarget.ES3?e(t,nt):e(t,it)}function y(){var r,t;n.initializeStaticTokens(),i[n.LexCodeLPR]=n.staticTokens[n.TokenID.OpenParen],i[n.LexCodeRPR]=n.staticTokens[n.TokenID.CloseParen],i[n.LexCodeCMA]=n.staticTokens[n.TokenID.Comma],i[n.LexCodeSMC]=n.staticTokens[n.TokenID.Semicolon],i[n.LexCodeLBR]=n.staticTokens[n.TokenID.OpenBracket],i[n.LexCodeRBR]=n.staticTokens[n.TokenID.CloseBracket],i[n.LexCodeTIL]=n.staticTokens[n.TokenID.Tilde],i[n.LexCodeQUE]=n.staticTokens[n.TokenID.Question],i[n.LexCodeLC]=n.staticTokens[n.TokenID.OpenBrace],i[n.LexCodeRC]=n.staticTokens[n.TokenID.CloseBrace],i[n.LexCodeCOL]=n.staticTokens[n.TokenID.Colon],n.LexKeywordTable=new n.StringHashTable;for(r in n.TokenID._map)r<=n.TokenID.LimKeyword&&n.LexKeywordTable.add(n.TokenID._map[r].toLowerCase(),r);for(t=0;t<n.LexCodeASCIIChars;t++)f[t]=p(t)?!0:!1}function ut(t,i){return t==n.LexCodeLBR||t==n.LexCodeLC||t==n.LexCodeLPR?i+1:t==n.LexCodeRBR||t==n.LexCodeRC||t==n.LexCodeRPR?i-1:i}function p(t){return t>=97&&t<=122||t>=65&&t<=90||t==n.LexCodeDollar||t==n.LexCodeUnderscore}function o(n){return n>=48&&n<=57}function ft(n){return f[n]||o(n)}function et(t){return t==n.LexCodeRBR?n.LexCodeLBR:t==n.LexCodeRC?n.LexCodeLC:t==n.LexCodeRPR?n.LexCodeLPR:0}function st(n){return d(n,!0,!1)}function ht(n,t){return d(n,!1,t)}function d(t,i,r){var u,f;if(t.tokenId<=n.TokenID.LimKeyword)if(u=n.lookupToken(t.tokenId),u!=undefined){if(f=n.Reservation.Javascript|n.Reservation.JavascriptFuture,r&&(f|=n.Reservation.JavascriptFutureStrict),i||!n.hasFlag(u.reservation,f))return!0}else return!1;else return!1}function v(n,t){var i,u,r;if(t===-1)return 0;for(i=0,u=n.length-1;i<u;)r=i+u>>1,t<n[r]?u=r-1:i=t<n[r+1]?u=r:r+1;return i}function g(n,t,i){var r=v(i,t);r>0&&(n.line=r,n.col=t-i[r])}function ct(n,t){var i={line:-1,col:-1};return g(i,t,n.locationInfo.lineMap),i.col>=0&&i.col++,i}function lt(n,t,i){return n.locationInfo.lineMap[t]+(i-1)}function at(t){switch(t.tokenId){case n.TokenID.Any:case n.TokenID.Bool:case n.TokenID.Number:case n.TokenID.String:return!0}return!1}function vt(t){switch(t.tokenId){case n.TokenID.Public:case n.TokenID.Private:case n.TokenID.Static:return!0}return!1}var t,r,u,ot,l,h,a,w,b,k;n.LexEOF=-1,n.LexCodeNWL=10,n.LexCodeRET=13,n.LexCodeLS=8232,n.LexCodePS=8233,n.LexCodeTAB=9,n.LexCodeVTAB=11,n.LexCode_e="e".charCodeAt(0),n.LexCode_E="E".charCodeAt(0),n.LexCode_x="x".charCodeAt(0),n.LexCode_X="X".charCodeAt(0),n.LexCode_a="a".charCodeAt(0),n.LexCode_A="A".charCodeAt(0),n.LexCode_f="f".charCodeAt(0),n.LexCode_F="F".charCodeAt(0),n.LexCode_g="g".charCodeAt(0),n.LexCode_m="m".charCodeAt(0),n.LexCode_i="i".charCodeAt(0),n.LexCode_u="u".charCodeAt(0),n.LexCode_0="0".charCodeAt(0),n.LexCode_9="9".charCodeAt(0),n.LexCode_8="8".charCodeAt(0),n.LexCode_7="7".charCodeAt(0),n.LexCodeBSL="\\".charCodeAt(0),n.LexCodeSHP="#".charCodeAt(0),n.LexCodeBNG="!".charCodeAt(0),n.LexCodeQUO='"'.charCodeAt(0),n.LexCodeAPO="'".charCodeAt(0),n.LexCodePCT="%".charCodeAt(0),n.LexCodeAMP="&".charCodeAt(0),n.LexCodeLPR="(".charCodeAt(0),n.LexCodeRPR=")".charCodeAt(0),n.LexCodePLS="+".charCodeAt(0),n.LexCodeMIN="-".charCodeAt(0),n.LexCodeMUL="*".charCodeAt(0),n.LexCodeSLH="/".charCodeAt(0),n.LexCodeXOR="^".charCodeAt(0),n.LexCodeCMA=",".charCodeAt(0),n.LexCodeDOT=".".charCodeAt(0),n.LexCodeLT="<".charCodeAt(0),n.LexCodeEQ="=".charCodeAt(0),n.LexCodeGT=">".charCodeAt(0),n.LexCodeQUE="?".charCodeAt(0),n.LexCodeLBR="[".charCodeAt(0),n.LexCodeRBR="]".charCodeAt(0),n.LexCodeUSC="_".charCodeAt(0),n.LexCodeLC="{".charCodeAt(0),n.LexCodeRC="}".charCodeAt(0),n.LexCodeBAR="|".charCodeAt(0),n.LexCodeTIL="~".charCodeAt(0),n.LexCodeCOL=":".charCodeAt(0),n.LexCodeSMC=";".charCodeAt(0),n.LexCodeUnderscore="_".charCodeAt(0),n.LexCodeDollar="$".charCodeAt(0),n.LexCodeSpace=32,n.LexCodeAtSign="@".charCodeAt(0),n.LexCodeASCIIChars=128,n.LexKeywordTable=undefined;var i=new Array(n.LexCodeASCIIChars),f=new Array(n.LexCodeASCIIChars),nt=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,13312,19893,19893,19968,19968,40869,40869,40960,42124,44032,44032,55203,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],tt=[768,846,864,866,1155,1158,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1611,1621,1632,1641,1648,1648,1750,1756,1759,1764,1767,1768,1770,1773,1776,1785,1809,1809,1840,1866,1958,1968,2305,2307,2364,2364,2366,2381,2385,2388,2402,2403,2406,2415,2433,2435,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2530,2531,2534,2543,2562,2562,2620,2620,2622,2626,2631,2632,2635,2637,2662,2673,2689,2691,2748,2748,2750,2757,2759,2761,2763,2765,2790,2799,2817,2819,2876,2876,2878,2883,2887,2888,2891,2893,2902,2903,2918,2927,2946,2947,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3134,3140,3142,3144,3146,3149,3157,3158,3174,3183,3202,3203,3262,3268,3270,3272,3274,3277,3285,3286,3302,3311,3330,3331,3390,3395,3398,3400,3402,3405,3415,3415,3430,3439,3458,3459,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3633,3633,3636,3642,3655,3662,3664,3673,3761,3761,3764,3769,3771,3772,3784,3789,3792,3801,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3903,3953,3972,3974,3975,3984,3991,3993,4028,4038,4038,4140,4146,4150,4153,4160,4169,4182,4185,4969,4977,6068,6099,6112,6121,6160,6169,6313,6313,8255,8256,8400,8412,8417,8417,12330,12335,12441,12442,12539,12539,64286,64286,65056,65059,65075,65076,65101,65103,65296,65305,65343,65343,65381,65381],it=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,13312,19893,19893,19968,19968,40908,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,44032,55203,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],rt=[768,879,1155,1159,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1552,1562,1611,1641,1648,1648,1750,1756,1759,1764,1767,1768,1770,1773,1776,1785,1809,1809,1840,1866,1958,1968,1984,1993,2027,2035,2070,2073,2075,2083,2085,2087,2089,2093,2137,2139,2276,2302,2304,2307,2362,2364,2366,2383,2385,2391,2402,2403,2406,2415,2433,2435,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2530,2531,2534,2543,2561,2563,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2662,2673,2677,2677,2689,2691,2748,2748,2750,2757,2759,2761,2763,2765,2786,2787,2790,2799,2817,2819,2876,2876,2878,2884,2887,2888,2891,2893,2902,2903,2914,2915,2918,2927,2946,2946,3006,3010,3014,3016,3018,3021,3031,3031,3046,3055,3073,3075,3134,3140,3142,3144,3146,3149,3157,3158,3170,3171,3174,3183,3202,3203,3260,3260,3262,3268,3270,3272,3274,3277,3285,3286,3298,3299,3302,3311,3330,3331,3390,3396,3398,3400,3402,3405,3415,3415,3426,3427,3430,3439,3458,3459,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3633,3633,3636,3642,3655,3662,3664,3673,3761,3761,3764,3769,3771,3772,3784,3789,3792,3801,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3903,3953,3972,3974,3975,3981,3991,3993,4028,4038,4038,4139,4158,4160,4169,4182,4185,4190,4192,4194,4196,4199,4205,4209,4212,4226,4237,4239,4253,4957,4959,5906,5908,5938,5940,5970,5971,6002,6003,6068,6099,6109,6109,6112,6121,6155,6157,6160,6169,6313,6313,6432,6443,6448,6459,6470,6479,6576,6592,6600,6601,6608,6617,6679,6683,6741,6750,6752,6780,6783,6793,6800,6809,6912,6916,6964,6980,6992,7001,7019,7027,7040,7042,7073,7085,7088,7097,7142,7155,7204,7223,7232,7241,7248,7257,7376,7378,7380,7400,7405,7405,7410,7412,7616,7654,7676,7679,8204,8205,8255,8256,8276,8276,8400,8412,8417,8417,8421,8432,11503,11505,11647,11647,11744,11775,12330,12335,12441,12442,42528,42537,42607,42607,42612,42621,42655,42655,42736,42737,43010,43010,43014,43014,43019,43019,43043,43047,43136,43137,43188,43204,43216,43225,43232,43249,43264,43273,43302,43309,43335,43347,43392,43395,43443,43456,43472,43481,43561,43574,43587,43587,43596,43597,43600,43609,43643,43643,43696,43696,43698,43700,43703,43704,43710,43711,43713,43713,43755,43759,43765,43766,44003,44010,44012,44013,44016,44025,64286,64286,65024,65039,65056,65062,65075,65076,65101,65103,65296,65305,65343,65343];n.LexLookUpUnicodeMap=e,n.LexIsUnicodeDigit=c,n.LexIsUnicodeIdStart=s,n.LexInitialize=y,n.LexAdjustIndent=ut,n.LexIsIdentifierStartChar=p,n.LexIsDigit=o,n.LexIsIdentifierChar=ft,n.LexMatchingOpen=et,function(n){n._map=[],n._map[0]="Start",n.Start=0,n._map[1]="InFraction",n.InFraction=1,n._map[2]="InEmptyFraction",n.InEmptyFraction=2,n._map[3]="InExponent",n.InExponent=3}(n.NumberScanState||(n.NumberScanState={})),t=n.NumberScanState,function(n){n._map=[],n._map[0]="Start",n.Start=0,n._map[1]="InMultilineComment",n.InMultilineComment=1,n._map[2]="InMultilineSingleQuoteString",n.InMultilineSingleQuoteString=2,n._map[3]="InMultilineDoubleQuoteString",n.InMultilineDoubleQuoteString=3}(n.LexState||(n.LexState={})),r=n.LexState,function(n){n._map=[],n._map[0]="Line",n.Line=0,n._map[1]="File",n.File=1}(n.LexMode||(n.LexMode={})),u=n.LexMode,function(n){n._map=[],n._map[0]="Line",n.Line=0,n._map[1]="Block",n.Block=1}(n.CommentStyle||(n.CommentStyle={})),ot=n.CommentStyle,l=function(){function n(n){this.text=n}return n.prototype.getText=function(n,t){return this.text.substring(n,t)},n.prototype.getLength=function(){return this.text.length},n}(),n.StringSourceText=l,h=function(){function n(n,t,i){this.segmentStart=n,this.segmentEnd=t,this.segment=i}return n.prototype.charCodeAt=function(n){return this.segment.charCodeAt(n-this.segmentStart)},n.prototype.substring=function(n,t){return this.segment.substring(n-this.segmentStart,t-this.segmentStart)},n}(),n.SourceTextSegment=h,a=function(){function n(n,t){this.seg1=n,this.seg2=t}return n.prototype.charCodeAt=function(n){return this.seg1.segmentStart<=n&&n<this.seg1.segmentEnd?this.seg1.segment.charCodeAt(n-this.seg1.segmentStart):this.seg2.segment.charCodeAt(n-this.seg2.segmentStart)},n.prototype.substring=function(n,t){return this.seg1.segmentStart<=n&&t<=this.seg1.segmentEnd?this.seg1.segment.substring(n-this.seg1.segmentStart,t-this.seg1.segmentStart):this.seg2.segment.substring(n-this.seg2.segmentStart)+this.seg1.segment.substring(0,t-this.seg1.segmentStart)},n}(),n.AggerateSourceTextSegment=a,w=function(){function t(n){this.sourceText=n,this.agg=new a(t.emptySegment,t.emptySegment),this.len=this.sourceText.getLength()}return t.emptySegment=new h(0,0,""),t.prototype.max=function(n,t){return n>=t?n:t},t.prototype.min=function(n,t){return n<=t?n:t},t.prototype.fetchSegment=function(t,i){var e,o;if(this.agg.seg1.segmentStart<=t&&i<=this.agg.seg1.segmentEnd)return this.agg.seg1;if(this.agg.seg2.segmentStart<=t&&i<=this.agg.seg1.segmentEnd)return this.agg;var f=this.agg.seg1,u=f.segmentEnd,r=n.max(u+512,i);return r=n.min(r,this.len),e=this.sourceText.getText(u,r),o=new h(u,r,e),this.agg.seg2=f,this.agg.seg1=o,this.agg},t.prototype.charCodeAt=function(n){return this.fetchSegment(n,n+1).charCodeAt(n)},t.prototype.substring=function(n,t){return this.fetchSegment(n,t).substring(n,t)},t}(),n.ScannerTextStream=w,b=function(){function t(){this.prevToken=null,this.curSavedToken=null,this.prevSavedToken=null,this.prevToken=null,this.currentToken=0,this.tokens=[],this.seenUnicodeChar=!1,this.seenUnicodeCharInComment=!1,this.prevLine=1,this.line=1,this.col=0,this.lexState=r.Start,this.commentStack=[],this.lineMap=[]}return t.prototype.previousToken=function(){return this.prevToken},t.prototype.close=function(){this.currentToken=0},t.prototype.addToken=function(t,i){this.tokens[this.currentToken++]=new n.SavedToken(t,i.startPos,i.pos)},t.prototype.scan=function(){if(this.startLine=this.line,this.startPos=this.col,this.currentTokenIndex==this.currentTokens.length)if(this.line<this.lineMap.length)this.line++,this.col=0,this.currentTokenIndex=0,this.currentTokens=this.tokensByLine[this.line];else return n.staticTokens[n.TokenID.EndOfFile];if(this.currentTokenIndex<this.currentTokens.length){this.prevToken=this.curSavedToken.tok,this.prevSavedToken=this.curSavedToken,this.curSavedToken=this.currentTokens[this.currentTokenIndex++];var t=this.curSavedToken.tok;return this.pos=this.curSavedToken.limChar,this.col+=this.curSavedToken.limChar-this.curSavedToken.minChar,this.startPos=this.curSavedToken.minChar,this.prevLine=this.line,t}return n.staticTokens[n.TokenID.EndOfFile]},t.prototype.syncToTok=function(n){var t,i;for(this.line=v(this.lineMap,n),this.currentTokenIndex=0,t=n-this.lineMap[this.line];this.lexStateByLine[this.line]==r.InMultilineComment&&this.line>0;)this.line--,t=0;for(i=this.lineMap.length-1,this.currentTokens=this.tokensByLine[this.line];this.currentTokens.length==0&&this.line<i;)this.line++,this.currentTokens=this.tokensByLine[this.line],t=0;if(this.line<=i){while(this.currentTokenIndex<this.currentTokens.length&&t>this.currentTokens[this.currentTokenIndex].limChar)this.currentTokenIndex++;if(this.currentTokenIndex<this.currentTokens.length)return this.col=this.currentTokens[this.currentTokenIndex].minChar,this.col+this.lineMap[this.line]}return-1},t.prototype.lastTokenLimChar=function(){return this.prevSavedToken!==null?this.prevSavedToken.limChar:0},t.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},t.prototype.pushComment=function(n){this.commentStack.push(n)},t.prototype.getComments=function(){var n=this.commentStack;return this.commentStack=[],n},t.prototype.getCommentsForLine=function(n){for(var t=null;this.commentStack.length>0&&this.commentStack[0].line==n;)t=t==null?[this.commentStack.shift()]:t.concat([this.commentStack.shift()]);return t},t.prototype.resetComments=function(){this.commentStack=[]},t.prototype.setSourceText=function(){},t.prototype.setErrorHandler=function(){},t.prototype.getLookAheadToken=function(){throw new Error("Invalid operation.");},t}(),n.SavedTokens=b,k=function(){function e(){this.prevLine=1,this.line=1,this.col=0,this.pos=0,this.startPos=0,this.len=0,this.lineMap=[],this.ch=n.LexEOF,this.lexState=r.Start,this.mode=u.File,this.scanComments=!0,this.interveningWhitespace=!1,this.interveningWhitespacePos=0,this.leftCurlyCount=0,this.rightCurlyCount=0,this.commentStack=[],this.saveScan=null,this.seenUnicodeChar=!1,this.seenUnicodeCharInComment=!1,this.prevTok=n.staticTokens[n.TokenID.EndOfFile],this.startCol=this.col,this.startLine=this.line,this.lineMap[1]=0,n.LexKeywordTable||y()}return e.prototype.previousToken=function(){return this.prevTok},e.prototype.setSourceText=function(n,t){this.mode=t,this.scanComments=this.mode===u.Line,this.pos=0,this.interveningWhitespacePos=0,this.startPos=0,this.line=1,this.col=0,this.startCol=this.col,this.startLine=this.line,this.len=0,this.src=n.getText(0,n.getLength()),this.len=this.src.length,this.lineMap=[],this.lineMap[1]=0,this.commentStack=[],this.leftCurlyCount=0,this.rightCurlyCount=0,this.seenUnicodeChar=!1,this.seenUnicodeCharInComment=!1},e.prototype.setErrorHandler=function(n){this.reportError=n},e.prototype.setSaveScan=function(n){this.saveScan=n},e.prototype.setText=function(n,t){this.setSourceText(new l(n),t)},e.prototype.setScanComments=function(n){this.scanComments=n},e.prototype.getLexState=function(){return this.lexState},e.prototype.tokenStart=function(){this.startPos=this.pos,this.startLine=this.line,this.startCol=this.col,this.interveningWhitespace=!1},e.prototype.peekChar=function(){return this.pos<this.len?this.src.charCodeAt(this.pos):n.LexEOF},e.prototype.peekCharAt=function(t){return t<this.len?this.src.charCodeAt(t):n.LexEOF},e.prototype.IsHexDigit=function(t){return t>=n.LexCode_0&&t<=n.LexCode_9||t>=n.LexCode_A&&t<=n.LexCode_F||t>=n.LexCode_a&&t<=n.LexCode_f},e.prototype.IsOctalDigit=function(t){return t>=n.LexCode_0&&t<=n.LexCode_7||t>=n.LexCode_a&&t<=n.LexCode_f},e.prototype.scanHexDigits=function(){for(var t=!1;;)if(this.IsHexDigit(this.ch))this.nextChar(),t=!0;else return t?new n.NumberLiteralToken(parseInt(this.src.substring(this.startPos,this.pos))):null},e.prototype.scanOctalDigits=function(){for(var t=!1;;)if(this.IsOctalDigit(this.ch))this.nextChar(),t=!0;else return t?new n.NumberLiteralToken(parseInt(this.src.substring(this.startPos,this.pos))):null},e.prototype.scanDecimalNumber=function(i){for(var r=!1,u=this.pos,f=this.col;;)if(o(this.ch))r=!0,this.ch!=n.LexCode_0&&i==t.InEmptyFraction&&(i=t.InFraction),this.nextChar();else if(this.ch==n.LexCodeDOT)if(i==t.Start)this.nextChar(),i=t.InEmptyFraction;else return r?new n.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),i==t.InEmptyFraction):(this.pos=u,this.col=f,null);else if(this.ch==n.LexCode_e||this.ch==n.LexCode_E)if(i==t.Start)if(r)r=!1,this.nextChar(),i=t.InExponent;else return this.pos=u,this.col=f,null;else if(i==t.InFraction||i==t.InEmptyFraction)this.nextChar(),i=t.InExponent,r=!1;else return r?new n.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null);else if(this.ch==n.LexCodePLS||this.ch==n.LexCodeMIN)if(i==t.InExponent){if(r)return this.pos=u,this.col=f,null;this.nextChar()}else return i==t.InEmptyFraction||i==t.InFraction?new n.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),i==t.InEmptyFraction):r?new n.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=u,this.col=f,null);else return r?new n.NumberLiteralToken(parseFloat(this.src.substring(this.startPos,this.pos)),i==t.InEmptyFraction):(this.pos=u,this.col=f,null)},e.prototype.scanNumber=function(){if(this.peekChar()==n.LexCode_0)switch(this.peekCharAt(this.pos+1)){case n.LexCode_x:case n.LexCode_X:return this.advanceChar(2),this.scanHexDigits();case n.LexCode_8:case n.LexCode_9:case n.LexCodeDOT:return this.scanDecimalNumber(t.Start);default:return this.scanOctalDigits()}else return this.scanDecimalNumber(t.Start)},e.prototype.scanFraction=function(){return this.scanDecimalNumber(t.InFraction)},e.prototype.newLine=function(){this.col=0,this.mode==u.File&&(this.line++,this.lineMap[this.line]=this.pos+1)},e.prototype.finishMultilineComment=function(){var t;for(this.lexState=r.InMultilineComment;this.pos<this.len;){if(this.ch==n.LexCodeMUL){if(t=this.peekCharAt(this.pos+1),t==n.LexCodeSLH)return this.advanceChar(2),this.mode==u.File&&this.tokenStart(),this.lexState=r.Start,!0}else if(this.ch==n.LexCodeNWL){if(this.newLine(),this.mode==u.Line)return this.nextChar(),!1}else this.ch>=n.LexCodeASCIIChars&&(this.seenUnicodeCharInComment=!0);this.nextChar()}return!1},e.prototype.pushComment=function(n){this.commentStack.push(n)},e.prototype.getComments=function(){var n=this.commentStack;return this.commentStack=[],n},e.prototype.getCommentsForLine=function(n){for(var t=null;this.commentStack.length>0&&this.commentStack[0].line==n;)t=t==null?[this.commentStack.shift()]:t.concat([this.commentStack.shift()]);return t},e.prototype.resetComments=function(){this.commentStack=[]},e.prototype.endsLine=function(t){return t==n.LexCodeNWL||t==n.LexCodeRET||t==n.LexCodeLS||t==n.LexCodePS},e.prototype.finishSinglelineComment=function(){while(this.pos<this.len){if(this.endsLine(this.ch))break;this.ch>=n.LexCodeASCIIChars&&(this.seenUnicodeCharInComment=!0),this.nextChar()}this.mode==u.File&&this.tokenStart()},e.prototype.tokenText=function(){return this.src.substring(this.startPos,this.pos)},e.prototype.findClosingSLH=function(){for(var t=this.pos,i=this.src.charCodeAt(t),u=0,r=!1;!this.endsLine(i)&&t<this.len;){if(i==n.LexCodeSLH&&!r)return t;u=i,t++,r=r?!1:u==n.LexCodeBSL,i=this.src.charCodeAt(t)}return-1},e.prototype.speculateRegex=function(){var o,r,u,t;if(n.noRegexTable[this.prevTok.tokenId]!=undefined)return null;var f=this.pos,e=this.col,i=this.findClosingSLH();if(i>0){for(o=this.src.substring(f,i),r="",this.pos=i+1,this.ch=this.peekChar(),u=this.pos;this.ch==n.LexCode_i||this.ch==n.LexCode_g||this.ch==n.LexCode_m;)this.nextChar();if(this.pos-u>3)return null;r=this.src.substring(u,this.pos),t=undefined;try{t=new RegExp(o,r)}catch(s){}if(t)return this.col=e+(this.pos-this.startPos),new n.RegularExpressionLiteralToken(t)}return this.pos=f,this.col=e,null},e.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},e.prototype.lastTokenLimChar=function(){return this.interveningWhitespace?this.interveningWhitespacePos:this.startPos},e.prototype.advanceChar=function(n){this.pos+=n,this.col+=n,this.ch=this.peekChar()},e.prototype.nextChar=function(){this.pos++,this.col++,this.ch=this.peekChar()},e.prototype.getLookAheadToken=function(){var n=this.prevLine,t=this.line,i=this.col,r=this.pos,u=this.startPos,f=this.startCol,e=this.startLine,o=this.ch,s=this.prevTok,h=this.lexState,c=this.interveningWhitespace,l=this.interveningWhitespacePos,a=this.leftCurlyCount,v=this.rightCurlyCount,y=this.seenUnicodeChar,p=this.seenUnicodeCharInComment,w=this.commentStack.length,b=this.scan();return this.prevLine=n,this.line=t,this.col=i,this.pos=r,this.startPos=u,this.startCol=f,this.startLine=e,this.ch=o,this.prevTok=s,this.lexState=h,this.interveningWhitespace=c,this.interveningWhitespacePos=l,this.leftCurlyCount=a,this.rightCurlyCount=v,this.seenUnicodeChar=y,this.seenUnicodeCharInComment=p,this.commentStack.length=w,b},e.prototype.scanInLine=function(){var i,u,t;return this.lexState==r.InMultilineComment&&this.scanComments?(this.ch=this.peekChar(),i=this.line,this.finishMultilineComment(),this.startPos<this.pos?(u=this.src.substring(this.startPos,this.pos),this.tokenStart(),new n.CommentToken(n.TokenID.Comment,u,!0,this.startPos,i,!0)):n.staticTokens[n.TokenID.EndOfFile]):this.lexState==r.InMultilineSingleQuoteString&&this.pos<this.len?(this.ch=n.LexCodeAPO,this.lexState=r.Start,this.scanStringConstant()):this.lexState==r.InMultilineDoubleQuoteString&&this.pos<this.len?(this.ch=n.LexCodeQUO,this.lexState=r.Start,this.scanStringConstant()):(this.prevLine=this.line,t=this.innerScan(),t.tokenId!=n.TokenID.Whitespace&&(this.prevTok=t),t)},e.prototype.scan=function(){return this.prevLine=this.line,this.prevTok=this.innerScan(),this.saveScan&&this.saveScan.addToken(this.prevTok,this),this.prevTok},e.prototype.isValidUnicodeIdentifierChar=function(){var n=s(this.ch)||c(this.ch);return this.seenUnicodeChar=this.seenUnicodeChar||n,n},e.prototype.scanStringConstant=function(){var i=this.ch,f,t;this.nextChar();n:for(;;){switch(this.ch){case n.LexEOF:this.reportScannerError("Unterminated string constant");break n;case n.LexCodeLS:case n.LexCodePS:this.seenUnicodeChar=!0;case n.LexCodeRET:case n.LexCodeNWL:this.reportScannerError("Unterminated string constant");break n;case n.LexCodeAPO:case n.LexCodeQUO:if(this.ch==i){this.nextChar();break n}break;case n.LexCodeBSL:this.nextChar();switch(this.ch){case n.LexCodeAPO:case n.LexCodeQUO:case n.LexCodeBSL:this.nextChar();continue n;case n.LexCodeLS:case n.LexCodePS:this.seenUnicodeChar=!0;case n.LexCodeRET:case n.LexCodeNWL:if(this.ch==n.LexCodeRET&&this.peekCharAt(this.pos+1)==n.LexCodeNWL&&this.nextChar(),this.nextChar(),this.newLine(),this.mode==u.Line){this.lexState=i==n.LexCodeAPO?r.InMultilineSingleQuoteString:r.InMultilineDoubleQuoteString;break n}break;case n.LexCode_x:case n.LexCode_u:for(f=this.ch==n.LexCode_x?2:4,this.nextChar(),t=0;t<f;t++)if(this.IsHexDigit(this.ch))this.nextChar();else{this.reportScannerError("Invalid Unicode escape sequence");break}continue n}}this.ch>=n.LexCodeASCIIChars&&(this.seenUnicodeChar=!0),this.nextChar()}return new n.StringLiteralToken(this.src.substring(this.startPos,this.pos))},e.prototype.scanIdentifier=function(){for(var i=!1,r=this.ch==n.LexCodeBSL,l=!1,u,t,h,e;;){while(f[this.ch]||o(this.ch)||this.ch>=n.LexCodeASCIIChars&&this.isValidUnicodeIdentifierChar())this.nextChar();if(this.ch==n.LexCodeBSL){if(this.nextChar(),this.ch==n.LexCode_u){for(this.nextChar(),u=0;u<4;u++)if(this.IsHexDigit(this.ch))this.nextChar();else return this.reportScannerError("Invalid Unicode escape sequence"),n.staticTokens[n.TokenID.Error];if(t=parseInt(this.src.substring(this.pos-4,this.pos),16),!f[t]&&(r||!o(t))&&(!(t>=n.LexCodeASCIIChars)||!s(t)&&(r||!c(t))))return this.reportScannerError("Invalid identifier character"),n.staticTokens[n.TokenID.Error];i=!0,r=!1;continue}return this.reportScannerError("Invalid Unicode escape sequence"),n.staticTokens[n.TokenID.Error]}break}return e=this.src.substring(this.startPos,this.pos),i||(h=n.LexKeywordTable.lookup(e))==null?new n.IdentifierToken(e,i):n.staticTokens[h]},e.prototype.innerScan=function(){var r,a,c,e,t,o,l,h,v;this.tokenStart(),this.ch=this.peekChar();n:while(this.pos<this.len){if(f[this.ch]||this.ch==n.LexCodeBSL||this.ch>=n.LexCodeASCIIChars&&s(this.ch))return this.scanIdentifier();if(this.ch==n.LexCodeSpace){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);do this.nextChar();while(this.ch==n.LexCodeSpace);if(this.mode==u.Line)return a=this.src.substring(this.startPos,this.pos),new n.WhitespaceToken(n.TokenID.Whitespace,a);this.tokenStart(),this.interveningWhitespace=!0}else if(this.ch==n.LexCodeSLH)if(this.nextChar(),this.ch==n.LexCodeSLH){if(this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1),t=this.pos-1,o=this.line,this.finishSinglelineComment(),c=this.src.substring(t,this.pos),e=new n.CommentToken(n.TokenID.Comment,c,!1,t,o,!1),this.scanComments)return this.startPos=t,e;this.pushComment(e),this.interveningWhitespace=!0}else if(this.ch==n.LexCodeMUL){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1),t=this.pos-1,o=this.line,this.nextChar(),this.finishMultilineComment();var c=this.src.substring(t,this.pos),y=this.endsLine(this.peekChar()),e=new n.CommentToken(n.TokenID.Comment,c,!0,t,o,y);if(this.scanComments)return this.startPos=t,e;this.pushComment(e),this.interveningWhitespace=!0}else return l=this.speculateRegex(),l?l:this.peekCharAt(this.pos)==n.LexCodeEQ?(this.nextChar(),n.staticTokens[n.TokenID.SlashEquals]):n.staticTokens[n.TokenID.Slash];else{if(this.ch==n.LexCodeSMC)return this.nextChar(),n.staticTokens[n.TokenID.Semicolon];if(this.ch==n.LexCodeAPO||this.ch==n.LexCodeQUO)return this.scanStringConstant();if(i[this.ch])return h=i[this.ch],h.tokenId==n.TokenID.OpenBrace?this.leftCurlyCount++:h.tokenId==n.TokenID.CloseBrace&&this.rightCurlyCount++,this.nextChar(),h;if(this.ch>=n.LexCode_0&&this.ch<=n.LexCode_9)return r=this.scanNumber(),r?r:(this.nextChar(),n.staticTokens[n.TokenID.Error]);switch(this.ch){case n.LexCodeTAB:case n.LexCodeVTAB:if(this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.mode==u.Line){do this.nextChar();while(this.ch==n.LexCodeSpace||this.ch==9);return v=this.src.substring(this.startPos,this.pos),new n.WhitespaceToken(n.TokenID.Whitespace,v)}this.interveningWhitespace=!0;case 255:case 254:case 239:case 187:case 191:case n.LexCodeLS:case n.LexCodePS:case n.LexCodeNWL:case n.LexCodeRET:if(this.ch==n.LexCodeNWL&&(this.newLine(),this.mode==u.Line))return n.staticTokens[n.TokenID.EndOfFile];this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.nextChar(),this.tokenStart(),this.interveningWhitespace=!0;break;case n.LexCodeDOT:return this.peekCharAt(this.pos+1)==n.LexCodeDOT?this.peekCharAt(this.pos+2)==n.LexCodeDOT?(this.advanceChar(3),n.staticTokens[n.TokenID.DotDotDot]):(this.nextChar(),n.staticTokens[n.TokenID.Dot]):(this.nextChar(),r=this.scanFraction(),r?r:n.staticTokens[n.TokenID.Dot]);case n.LexCodeEQ:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.EqualsEqualsEquals]):(this.advanceChar(2),n.staticTokens[n.TokenID.EqualsEquals]):this.peekCharAt(this.pos+1)==n.LexCodeGT?(this.advanceChar(2),n.staticTokens[n.TokenID.EqualsGreaterThan]):(this.nextChar(),n.staticTokens[n.TokenID.Equals]);case n.LexCodeBNG:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.ExclamationEqualsEquals]):(this.advanceChar(2),n.staticTokens[n.TokenID.ExclamationEquals]):(this.nextChar(),n.staticTokens[n.TokenID.Exclamation]);case n.LexCodePLS:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.PlusEquals]):this.peekCharAt(this.pos+1)==n.LexCodePLS?(this.advanceChar(2),n.staticTokens[n.TokenID.PlusPlus]):(this.nextChar(),n.staticTokens[n.TokenID.Plus]);case n.LexCodeMIN:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.MinusEquals]):this.peekCharAt(this.pos+1)==n.LexCodeMIN?(this.advanceChar(2),n.staticTokens[n.TokenID.MinusMinus]):(this.nextChar(),n.staticTokens[n.TokenID.Minus]);case n.LexCodeMUL:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AsteriskEquals]):(this.nextChar(),n.staticTokens[n.TokenID.Asterisk]);case n.LexCodePCT:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.PercentEquals]):(this.nextChar(),n.staticTokens[n.TokenID.Percent]);case n.LexCodeLT:return this.peekCharAt(this.pos+1)==n.LexCodeLT?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.LessThanLessThanEquals]):(this.advanceChar(2),n.staticTokens[n.TokenID.LessThanLessThan]):this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.LessThanEquals]):(this.nextChar(),n.staticTokens[n.TokenID.LessThan]);case n.LexCodeGT:return this.peekCharAt(this.pos+1)==n.LexCodeGT?this.peekCharAt(this.pos+2)==n.LexCodeEQ?(this.advanceChar(3),n.staticTokens[n.TokenID.GreaterThanGreaterThanEquals]):this.peekCharAt(this.pos+2)==n.LexCodeGT?this.peekCharAt(this.pos+3)==n.LexCodeEQ?(this.advanceChar(4),n.staticTokens[n.TokenID.GreaterThanGreaterThanGreaterThanEquals]):(this.advanceChar(3),n.staticTokens[n.TokenID.GreaterThanGreaterThanGreaterThan]):(this.advanceChar(2),n.staticTokens[n.TokenID.GreaterThanGreaterThan]):this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.GreaterThanEquals]):(this.nextChar(),n.staticTokens[n.TokenID.GreaterThan]);case n.LexCodeXOR:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.CaretEquals]):(this.nextChar(),n.staticTokens[n.TokenID.Caret]);case n.LexCodeBAR:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.BarEquals]):this.peekCharAt(this.pos+1)==n.LexCodeBAR?(this.advanceChar(2),n.staticTokens[n.TokenID.BarBar]):(this.nextChar(),n.staticTokens[n.TokenID.Bar]);case n.LexCodeAMP:return this.peekCharAt(this.pos+1)==n.LexCodeEQ?(this.advanceChar(2),n.staticTokens[n.TokenID.AmpersandEquals]):this.peekCharAt(this.pos+1)==n.LexCodeAMP?(this.advanceChar(2),n.staticTokens[n.TokenID.AmpersandAmpersand]):(this.nextChar(),n.staticTokens[n.TokenID.And]);default:this.reportScannerError("Invalid character"),this.nextChar();continue n}}}return n.staticTokens[n.TokenID.EndOfFile]},e.prototype.reportScannerError=function(n){this.reportError&&this.reportError(n)},e}(),n.Scanner=k,n.convertTokToIDName=st,n.convertTokToID=ht,n.getLineNumberFromPosition=v,n.getSourceLineColFromMap=g,n.getLineColumnFromPosition=ct,n.getPositionFromLineColumn=lt,n.isPrimitiveTypeToken=at,n.isModifier=vt}(TypeScript||(TypeScript={})),function(n){function t(t,i,r,u,f){var e=new n.ScopeChain(null,i.scopeChain,t);e.thisType=r,e.classType=u,e.fnc=f,i.scopeChain=e}function i(n){n.scopeChain=n.scopeChain.previous}function u(n,t){return n!=null&&n.isInstanceProperty()?n:t}function f(n){return n.isInstanceProperty()}function e(i,r){var f=i,o=null,e=null,u;(f.name&&f.mod&&(f.name.sym=f.mod.symbol),u=f.mod,u)&&(o=new n.SymbolTableScope(u.members,u.ambientMembers,u.enclosedTypes,u.ambientEnclosedTypes,u.symbol),u.memberScope=o,r.modDeclChain.push(f),r.typeFlow.checker.currentModDecl=f,e=new n.SymbolAggregateScope(u.symbol),e.addParentScope(o),e.addParentScope(r.scopeChain.scope),t(e,r,null,null,null),u.containedScope=e,u.symbol&&r.typeFlow.addLocalsFromScope(u.containedScope,u.symbol,f.vars,u.members.privateMembers,!0))}function o(i,r){var s=i,o=null,f=null,u,h,e;s.name&&s.type&&(s.name.sym=s.type.symbol),u=i.type,u?(h=u.symbol,o=r.typeFlow.checker.scopeOf(u),f=new n.SymbolAggregateScope(u.symbol),f.addParentScope(o),f.addParentScope(r.scopeChain.scope),u.containedScope=f,u.memberScope=o,e=u.instanceType,o=r.typeFlow.checker.scopeOf(e),e.memberScope=o,f=new n.SymbolAggregateScope(e.symbol),f.addParentScope(r.scopeChain.scope),t(f,r,e,u,null),e.containedScope=f):i.type=r.typeFlow.anyType}function s(i,r){var e=i,o=null,u=null,f;e.name&&e.type&&(e.name.sym=e.type.symbol),f=i.type,o=r.typeFlow.checker.scopeOf(f),f.memberScope=o,u=new n.SymbolAggregateScope(f.symbol),u.addParentScope(o),u.addParentScope(r.scopeChain.scope),t(u,r,null,null,null),f.containedScope=u}function h(i,r){var f=i,u=f.type,o=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),s=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u=new n.Type,h=new n.WithSymbol(f.minChar,r.typeFlow.checker.locationInfo.unitIndex,u),e;u.members=o,u.ambientMembers=s,u.symbol=h,u.setHasImplementation(),f.type=u,e=new n.SymbolScopeBuilder(u.members,u.ambientMembers,null,null,r.scopeChain.scope,u.symbol),t(e,r,null,null,null),u.containedScope=e}function c(i,r){var u=i,e=null,d=null,c,o,b,a,v,f,nt,k,tt,it;u.type&&(d=i.type.symbol);var s=n.hasFlag(u.fncFlags,n.FncFlags.Static),rt=s&&r.scopeChain.fnc!=null,h=rt?r.scopeChain.fnc.type.memberScope:r.scopeChain.scope;if(r.scopeChain.thisType&&(!u.isConstructor||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod))?(c=r.scopeChain.thisType,h=c.typeFlags&n.TypeFlags.IsClass||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod)?r.scopeChain.previous.scope.container&&r.scopeChain.previous.scope.container.declAST&&r.scopeChain.previous.scope.container.declAST.nodeType==n.NodeType.FuncDecl&&r.scopeChain.previous.scope.container.declAST.isConstructor?c.constructorScope:s&&r.scopeChain.classType?r.scopeChain.classType.containedScope:c.containedScope:!u.isMethod()||s?c.constructorScope:c.containedScope,e=c.symbol):u.isConstructor&&r.scopeChain.thisType&&(e=r.scopeChain.thisType.symbol),u.type==null||n.hasFlag(u.type.symbol.flags,n.SymbolFlags.TypeSetDuringScopeAssignment)){r.scopeChain.fnc&&r.scopeChain.fnc.type&&(e=r.scopeChain.fnc.type.symbol);var l=null,y=r.scopeChain.fnc,p=u.name?u.name.actualText:null,f=null;s?(y.type.members==null&&e.getType().memberScope&&(y.type.members=e.type.memberScope.valueMembers),l=r.scopeChain.fnc.type.memberScope,y.innerStaticFuncs[y.innerStaticFuncs.length]=u):l=r.scopeChain.scope,p&&p!="__missing"&&!u.isAccessor()&&(f=s?l.findLocal(p,!1,!1):l.findLocal(p,!1,!1)),r.typeFlow.checker.createFunctionSignature(u,e,l,f,f==null),(!u.accessorSymbol&&u.fncFlags&n.FncFlags.ClassMethod&&e&&(!f||f.declAST.nodeType!=n.NodeType.FuncDecl)&&u.isAccessor()||f&&f.isAccessor())&&(u.accessorSymbol=r.typeFlow.checker.createAccessorSymbol(u,f,e.getType(),u.isMethod()&&s,!0,l,e)),u.type.symbol.flags|=n.SymbolFlags.TypeSetDuringScopeAssignment}if(u.name&&u.type&&(u.name.sym=u.type.symbol),u.scopeType=u.type,!u.isOverload){var w=new n.StringHashTable,ut=new n.ScopedMembers(new n.DualStringHashTable(w,new n.StringHashTable)),ft=new n.StringHashTable,et=new n.ScopedMembers(new n.DualStringHashTable(ft,new n.StringHashTable)),g=new n.StringHashTable,ot=new n.ScopedMembers(new n.DualStringHashTable(g,new n.StringHashTable)),st=new n.StringHashTable,ht=new n.ScopedMembers(new n.DualStringHashTable(st,new n.StringHashTable));if(u.unitIndex=r.typeFlow.checker.locationInfo.unitIndex,o=new n.SymbolScopeBuilder(ut,et,null,null,h,d),b=new n.SymbolScopeBuilder(ot,ht,null,null,h,null),u.isConstructor&&r.scopeChain.thisType&&(r.scopeChain.thisType.constructorScope=o),u.symbols=w,!u.isSpecialFn()){if(a=u.type,v=u.signature,u.isConstructor||(a.containedScope=o,o.container=a.symbol,a.memberScope=b,b.container=a.symbol),u.enclosingFnc=r.scopeChain.fnc,a.enclosingType=s?r.scopeChain.classType:r.scopeChain.thisType,f=i.type.symbol,(u.fncFlags&n.FncFlags.Signature)==n.FncFlags.None&&u.vars&&(r.typeFlow.addLocalsFromScope(o,f,u.vars,w,!1),r.typeFlow.addLocalsFromScope(b,f,u.statics,g,!1)),v.parameters)for(nt=v.parameters.length,k=0;k<nt;k++)tt=v.parameters[k],r.typeFlow.checker.resolveTypeLink(o,tt.parameter.typeLink,!0);r.typeFlow.checker.resolveTypeLink(o,v.returnType,u.isSignature())}(!u.isConstructor||n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod))&&(it=u.isConstructor&&n.hasFlag(u.fncFlags,n.FncFlags.ClassMethod)?r.scopeChain.thisType:null,t(o,r,it,null,u)),u.name&&n.hasFlag(u.fncFlags,n.FncFlags.IsFunctionExpression)&&u.name.sym&&w.add(u.name.actualText,u.name.sym)}}function l(i,r){var f=i,e,u;f.param&&(e=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),u=new n.SymbolScopeBuilder(e,null,null,null,r.scopeChain.scope,r.scopeChain.scope.container),f.containedScope=u,t(u,r,r.scopeChain.thisType,r.scopeChain.classType,r.scopeChain.fnc))}function v(t,i,r){var u=r.state,f=!0,a;return t&&(t.nodeType==n.NodeType.List?(a=t,a.enclosingScope=u.scopeChain.scope):t.nodeType==n.NodeType.ModuleDeclaration?e(t,u):t.nodeType==n.NodeType.ClassDeclaration?o(t,u):t.nodeType==n.NodeType.InterfaceDeclaration?s(t,u):t.nodeType==n.NodeType.With?h(t,u):t.nodeType==n.NodeType.FuncDecl?c(t,u):t.nodeType==n.NodeType.Catch?l(t,u):t.nodeType==n.NodeType.TypeRef&&(f=!1)),r.options.goChildren=f,t}function y(t,r,u){var f=u.state,o=!0,h,e,s;return t&&(t.nodeType==n.NodeType.ModuleDeclaration?(h=t,i(f),f.modDeclChain.pop(),f.modDeclChain.length>=1&&(f.typeFlow.checker.currentModDecl=f.modDeclChain[f.modDeclChain.length-1])):t.nodeType==n.NodeType.ClassDeclaration?i(f):t.nodeType==n.NodeType.InterfaceDeclaration?i(f):t.nodeType==n.NodeType.With?i(f):t.nodeType==n.NodeType.FuncDecl?(e=t,e.isConstructor&&!n.hasFlag(e.fncFlags,n.FncFlags.ClassMethod)||e.isOverload||i(f)):t.nodeType==n.NodeType.Catch?(s=t,s.param&&i(f)):o=!1),u.options.goChildren=o,t}var a=function(){function n(n,t,i){this.scopeChain=n,this.typeFlow=t,this.modDeclChain=i}return n}(),r;n.AssignScopeContext=a,n.pushAssignScope=t,n.popAssignScope=i,n.instanceCompare=u,n.instanceFilterStop=f,r=function(){function n(n,t){this.select=n,this.stop=t,this.result=null}return n.prototype.reset=function(){this.result=null},n.prototype.update=function(n){return this.result=this.select(this.result,n),this.result?this.stop(this.result):!1},n}(),n.ScopeSearchFilter=r,n.instanceFilter=new r(u,f),n.preAssignModuleScopes=e,n.preAssignClassScopes=o,n.preAssignInterfaceScopes=s,n.preAssignWithScopes=h,n.preAssignFuncDeclScopes=c,n.preAssignCatchScopes=l,n.preAssignScopes=v,n.postAssignScopes=y}(TypeScript||(TypeScript={})),function(n){function f(t,i,r){var u=r.state;return n.hasFlag(t.flags,u.matchFlag)&&(u.pos<0||u.pos==t.limChar)&&(u.ast=t,t.type==null&&u.pos>=0&&u.flow.inScopeTypeCheck(t,u.scope),u.type=t.type,u.options.stopWalk()),t}function e(t,i,r,u,f,e,o,s,h){var l=new n.SymbolScopeBuilder(i,r,u,f,null,t),c=new n.ScopeChain(t,e.scopeChain,l);c.thisType=o,c.classType=s,c.moduleDecl=h,e.scopeChain=c}function o(n){n.scopeChain=n.scopeChain.previous}function r(t,i,r){var u=r.state,h=t.minChar,s=t.limChar,o,e,f;if(t.nodeType==n.NodeType.Script&&u.pos>s&&(s=u.pos),h<=u.pos&&s>=u.pos){switch(t.nodeType){case n.NodeType.Script:o=t,u.scopeGetter=function(){return o.bod===null?null:o.bod.enclosingScope},u.scopeStartAST=o;break;case n.NodeType.ClassDeclaration:u.scopeGetter=function(){return t.type===null||t.type.instanceType.containedScope===null?null:t.type.instanceType.containedScope},u.scopeStartAST=t,u.enclosingClassDecl=t;break;case n.NodeType.ObjectLit:e=t,e.targetType&&(u.scopeGetter=function(){return e.targetType.containedScope},u.objectLiteralScopeGetter=function(){return e.targetType.memberScope},u.enclosingObjectLit=e);break;case n.NodeType.ModuleDeclaration:u.deepestModuleDecl=t,u.scopeGetter=function(){return t.type===null?null:t.type.containedScope},u.scopeStartAST=t;break;case n.NodeType.InterfaceDeclaration:u.scopeGetter=function(){return t.type===null?null:t.type.containedScope},u.scopeStartAST=t;break;case n.NodeType.FuncDecl:f=t,u.skipNextFuncDeclForClass?u.skipNextFuncDeclForClass=!1:(u.scopeGetter=function(){return f.isConstructor&&n.hasFlag(f.fncFlags,n.FncFlags.ClassMethod)&&t.type&&t.type.enclosingType?t.type.enclosingType.constructorScope:f.scopeType?f.scopeType.containedScope:f.type?f.type.containedScope:null},u.scopeStartAST=t)}r.options.goChildren=!0}else r.options.goChildren=!1;return t}function s(i,u,f,e,o){var s=new t(i,u,f,e,o);return(n.getAstWalkerFactory().walk(u,r,null,null,s),s.scopeStartAST===null)?null:s}var u=function(){function n(n,t){this.scopeChain=n,this.checker=t,this.script=null}return n}(),i,t;n.TypeCollectionContext=u,i=function(){function t(t,i,r){this.flow=t,this.pos=i,this.matchFlag=r,this.type=null,this.ast=null,this.options=new n.AstWalkOptions}return t}(),n.MemberScopeContext=i,t=function(){function t(n,t,i,r,u){this.logger=n,this.script=t,this.text=i,this.pos=r,this.isMemberCompletion=u,this.scopeGetter=null,this.objectLiteralScopeGetter=null,this.scopeStartAST=null,this.skipNextFuncDeclForClass=!1,this.deepestModuleDecl=null,this.enclosingClassDecl=null,this.enclosingObjectLit=null,this.publicsOnly=!0,this.useFullAst=!1}return t.prototype.getScope=function(){return this.scopeGetter()},t.prototype.getObjectLiteralScope=function(){return this.objectLiteralScopeGetter()},t.prototype.getScopeAST=function(){return this.scopeStartAST},t.prototype.getScopePosition=function(){return this.scopeStartAST.minChar},t.prototype.getScriptFragmentStartAST=function(){return this.scopeStartAST},t.prototype.getScriptFragmentPosition=function(){return this.getScriptFragmentStartAST().minChar},t.prototype.getScriptFragment=function(){if(this.scriptFragment==null){var t=this.getScriptFragmentStartAST(),i=t.minChar,r=this.isMemberCompletion?this.pos:this.pos+1;this.scriptFragment=n.quickParse(this.logger,t,this.text,i,r,null).Script}return this.scriptFragment},t}(),n.EnclosingScopeContext=t,n.preFindMemberScope=f,n.pushTypeCollectionScope=e,n.popTypeCollectionScope=o,n.preFindEnclosingScope=r,n.findEnclosingScopeAt=s}(TypeScript||(TypeScript={})),function(n){var i=function(){function t(){this.hasVariableArgList=!1,this.parameters=null,this.declAST=null,this.typeCheckStatus=n.TypeCheckStatus.NotStarted,this.nonOptionalParameterCount=0}return t.prototype.specializeType=function(i,r,u){var f=new t,o,l,c;if(this.hasVariableArgList&&(f.hasVariableArgList=!0),f.returnType=new n.TypeLink,f.returnType.type=this.returnType.type?this.returnType.type.specializeType(i,r,u,!1):u.anyType,this.parameters)for(f.parameters=[],o=0,l=this.parameters.length;o<l;o++){var h=this.parameters[o],e=new n.ValueLocation,s=new n.ParameterSymbol(h.name,h.location,u.locationInfo.unitIndex,e);s.declAST=this.declAST,e.symbol=s,e.typeLink=new n.TypeLink,f.parameters[o]=s,c=h.getType(),c?(e.typeLink.type=c.specializeType(i,r,u,!1),s.declAST.type=e.typeLink.type):e.typeLink.type=u.anyType}return f.nonOptionalParameterCount=this.nonOptionalParameterCount,f.declAST=this.declAST,f},t.prototype.toString=function(){return this.toStringHelper(!1,!1,null)},t.prototype.toStringHelper=function(n,t,i){return this.toStringHelperEx(n,t,i).toString()},t.prototype.toStringHelperEx=function(t,i,r,u){var f,o,s,e;for(typeof u=="undefined"&&(u=""),f=new n.MemberNameArray,f.prefix=i?u+"[":u+"(",o=this.parameters.length,s=this.hasVariableArgList?o-1:o,e=0;e<s;e++)f.add(n.MemberName.create(this.parameters[e].name+(this.parameters[e].isOptional()?"?":"")+": ")),f.add(this.parameters[e].getType().getScopedTypeNameEx(r)),e<o-1&&f.add(n.MemberName.create(", "));return this.hasVariableArgList&&(f.add(n.MemberName.create("..."+this.parameters[e].name+": ")),f.add(this.parameters[e].getType().getScopedTypeNameEx(r))),t?i?f.add(n.MemberName.create("] => ")):f.add(n.MemberName.create(") => ")):i?f.add(n.MemberName.create("]: ")):f.add(n.MemberName.create("): ")),this.returnType.type?f.add(this.returnType.type.getScopedTypeNameEx(r)):f.add(n.MemberName.create("any")),f},t}(),t;n.Signature=i,t=function(){function t(){this.signatures=[],this.hasImplementation=!0,this.definitionSignature=null,this.hasBeenTypechecked=!1,this.flags=n.SignatureFlags.None}return t.prototype.addSignature=function(t){this.signatures==null&&(this.signatures=[]),this.signatures[this.signatures.length]=t,!t.declAST||t.declAST.isOverload||t.declAST.isSignature()||n.hasFlag(t.declAST.fncFlags,n.FncFlags.Ambient)||!n.hasFlag(t.declAST.fncFlags,n.FncFlags.Definition)||(this.definitionSignature=t)},t.prototype.toString=function(){return this.signatures.toString()},t.prototype.toStrings=function(t,i,r){var f=[],e=this.signatures.length,u;for(e>1&&(i=!1),u=0;u<e;u++)e>1&&this.signatures[u]==this.definitionSignature||(this.flags&n.SignatureFlags.IsIndexer?f.push(this.signatures[u].toStringHelperEx(i,!0,r)):f.push(this.signatures[u].toStringHelperEx(i,!1,r,t)));return f},t.prototype.specializeType=function(n,i,r){var f=new t,u,e;if(this.signatures)for(u=0,e=this.signatures.length;u<e;u++)f.addSignature(this.signatures[u].specializeType(n,i,r));return f},t.prototype.verifySignatures=function(t){var u=0,i,r;if(this.signatures&&(u=this.signatures.length)>0)for(i=0;i<u;i++){for(r=i+1;r<u;r++)this.signatures[i].declAST&&this.signatures[r].declAST&&!n.hasFlag(this.signatures[i].declAST.fncFlags,n.FncFlags.Definition)&&!n.hasFlag(this.signatures[r].declAST.fncFlags,n.FncFlags.Definition)&&t.signaturesAreIdentical(this.signatures[i],this.signatures[r])&&t.errorReporter.simpleError(this.signatures[i].declAST,this.signatures[i].declAST&&this.signatures[i].declAST.name?"Signature for '"+this.signatures[i].declAST.name.actualText+"' is duplicated":"Signature is duplicated");this.definitionSignature&&(t.signatureIsAssignableToTarget(this.definitionSignature,this.signatures[i])||t.errorReporter.simpleError(this.signatures[i].declAST,"Overload signature is not compatible with function definition"))}},t.prototype.typeCheck=function(t,i,r){var f,u;if(!this.hasBeenTypechecked&&(this.hasBeenTypechecked=!0,f=0,this.signatures&&(f=this.signatures.length)>0)){for(u=0;u<f;u++)r||this.definitionSignature||!this.signatures[u].declAST||!this.signatures[u].declAST.isOverload||n.hasFlag(this.signatures[u].declAST.fncFlags,n.FncFlags.Ambient)||t.errorReporter.simpleError(this.signatures[u].declAST,"Overload declaration lacks definition"),this.signatures[u].declAST&&this.signatures[u].declAST.isConstructor&&this.signatures[u].declAST.classDecl&&this.signatures[u].declAST.classDecl.type.symbol.typeCheckStatus==n.TypeCheckStatus.NotStarted&&t.typeFlow.typeCheck(this.signatures[u].declAST.classDecl),t.typeFlow.typeCheck(this.signatures[u].declAST);this.verifySignatures(t)}},t}(),n.SignatureGroup=t}(TypeScript||(TypeScript={})),function(n){function o(t,i){return t.declAST&&i&&i.declAST&&t.declAST.nodeType==n.NodeType.FuncDecl?t.declAST.minChar<=i.declAST.minChar&&t.declAST.limChar>=i.declAST.limChar:!1}function i(n,t){while(n.container){if(n==t||o(n.container,t))return!0;n=n.container}return!1}var u,f,r,t,e,s,h,c,l;(function(n){n._map=[],n._map[0]="NotStarted",n.NotStarted=0,n._map[1]="Started",n.Started=1,n._map[2]="Finished",n.Finished=2})(n.TypeCheckStatus||(n.TypeCheckStatus={})),u=n.TypeCheckStatus,n.aLexicallyEnclosesB=o,n.aEnclosesB=i,f=function(){function t(t,i,r,u){this.name=t,this.location=i,this.length=r,this.unitIndex=u,this.bound=!1,this.flags=n.SymbolFlags.None,this.isObjectLitField=!1,this.declAST=null,this.declModule=null,this.passSymbolCreated=n.CompilerDiagnostics.analysisPass}return t.prototype.instanceScope=function(){return null},t.prototype.isVariable=function(){return!1},t.prototype.isMember=function(){return!1},t.prototype.isInferenceSymbol=function(){return!1},t.prototype.isWith=function(){return!1},t.prototype.writeable=function(){return!1},t.prototype.isType=function(){return!1},t.prototype.getType=function(){return null},t.prototype.isAccessor=function(){return!1},t.prototype.isInstanceProperty=function(){return n.hasFlag(this.flags,n.SymbolFlags.Property)&&!n.hasFlag(this.flags,n.SymbolFlags.ModuleMember)},t.prototype.getTypeName=function(n){return this.getTypeNameEx(n).toString()},t.prototype.getTypeNameEx=function(){return n.MemberName.create(this.toString())},t.prototype.getOptionalNameString=function(){return n.hasFlag(this.flags,n.SymbolFlags.Optional)?"?":""},t.prototype.pathToRoot=function(){for(var i=[],t=this;t&&t.name!=n.globalId;)i[i.length]=t,t=t.container;return i},t.prototype.findCommonAncestorPath=function(n){var t,u,i,r,e,o,f,s,h;if(this.container==null)return[];for(t=this.container.pathToRoot(),u=n?n.pathToRoot():[],i=-1,r=0,e=t.length;r<e;r++){for(o=t[r],f=0,s=u.length;f<s;f++)if(h=u[f],o==h){i=r;break}if(i>=0)break}return i>=0?t.slice(0,i):t},t.prototype.getPrettyName=function(){return this.name},t.prototype.scopeRelativeName=function(n){var i,r,t,u,f;if(n==null)return this.getPrettyName(null)+this.getOptionalNameString();for(i=this.findCommonAncestorPath(n.container),r="",t=0,u=i.length;t<u;t++)f=i[t].getPrettyName(t==u-1?n.container:i[t+1]),r=f+"."+r;return r+=this.getPrettyName(u==0?n.container:i[0])+this.getOptionalNameString()},t.prototype.fullName=function(){for(var i=this.name,t=this.container;t&&t.name!=n.globalId;)i=t.name+"."+i,t=t.container;return i},t.prototype.isExternallyVisible=function(t){return this==t.gloMod?!0:n.hasFlag(this.flags,n.SymbolFlags.Private)?!1:n.hasFlag(this.flags,n.SymbolFlags.Exported)?this.container.isExternallyVisible(t):this.container==t.gloMod},t.prototype.visible=function(t,r){if(r==null||this.container==r.gloMod)return!0;if(n.hasFlag(this.flags,n.SymbolFlags.ModuleMember))return n.hasFlag(this.flags,n.SymbolFlags.Exported)?n.hasFlag(this.flags,n.SymbolFlags.Private)?i(this,t.container):!0:r&&r.currentModDecl==this.declModule||r.currentModDecl&&r.currentModDecl.mod&&r.currentModDecl.mod.symbol&&this.declModule&&this.declModule.mod&&this.declModule.mod.symbol&&i(r.currentModDecl.mod.symbol,this.declModule.mod.symbol);var u=this.declAST&&this.declAST.nodeType==n.NodeType.FuncDecl,f=u&&this.declAST.isMethod(),e=u&&n.hasFlag(this.declAST.fncFlags,n.FncFlags.Static),o=f&&n.hasFlag(this.declAST.fncFlags,n.FncFlags.Private),s=this.isType()&&this.aliasLink;return this.isMember()||f||e||s?n.hasFlag(this.flags,n.SymbolFlags.Private)||o?t.container==null&&this.container!=t.container?!1:this.container==null?!0:i(t.container,this.container):!0:this.container?i(this,t.container):!0},t.prototype.addRef=function(n){this.refs||(this.refs=[]),this.refs[this.refs.length]=n},t.prototype.toString=function(){return this.name?this.name:"_anonymous"},t.prototype.print=function(n){n.Write(this.toString())},t.prototype.specializeType=function(){throw new Error("please implement in derived class");},t.prototype.setType=function(){throw new Error("please implement in derived class");},t.prototype.kind=function(){throw new Error("please implement in derived class");},t.prototype.getInterfaceDeclFromSymbol=function(t){if(this.declAST!=null){if(this.declAST.nodeType==n.NodeType.InterfaceDeclaration)return this.declAST;if(this.container!=null&&this.container!=t.gloMod&&this.container.declAST.nodeType==n.NodeType.InterfaceDeclaration)return this.container.declAST}return null},t.prototype.getVarDeclFromSymbol=function(){return this.declAST!=null&&this.declAST.nodeType==n.NodeType.VarDecl?this.declAST:null},t.prototype.getDocComments=function(){return this.declAST!=null?this.declAST.getDocComments():[]},t.prototype.isStatic=function(){return n.hasFlag(this.flags,n.SymbolFlags.Static)},t}(),n.Symbol=f,r=function(){function n(){}return n}(),n.ValueLocation=r,t=function(t){function i(n,i,r,f){t.call(this,n,i,r,f),this.typeCheckStatus=u.NotStarted}return __extends(i,t),i.prototype.isInferenceSymbol=function(){return!0},i.prototype.transferVarFlags=function(t){n.hasFlag(t,n.VarFlags.Ambient)&&(this.flags|=n.SymbolFlags.Ambient),n.hasFlag(t,n.VarFlags.Constant)&&(this.flags|=n.SymbolFlags.Constant),n.hasFlag(t,n.VarFlags.Static)&&(this.flags|=n.SymbolFlags.Static),n.hasFlag(t,n.VarFlags.Property)&&(this.flags|=n.SymbolFlags.Property),n.hasFlag(t,n.VarFlags.Private)&&(this.flags|=n.SymbolFlags.Private),n.hasFlag(t,n.VarFlags.Public)&&(this.flags|=n.SymbolFlags.Public),n.hasFlag(t,n.VarFlags.Readonly)&&(this.flags|=n.SymbolFlags.Readonly),n.hasFlag(t,n.VarFlags.Exported)&&(this.flags|=n.SymbolFlags.Exported)},i}(f),n.InferenceSymbol=t,e=function(t){function i(i,r,u,f,e){t.call(this,i,r,u,f),this.type=e,this.expansions=[],this.expansionsDeclAST=[],this.isDynamic=!1,this.isMethod=!1,this.aliasLink=null,this.onlyReferencedAsTypeRef=n.optimizeModuleCodeGen,this.prettyName=this.name}return __extends(i,t),i.prototype.addLocation=function(n){this.additionalLocations==null&&(this.additionalLocations=[]),this.additionalLocations[this.additionalLocations.length]=n},i.prototype.kind=function(){return n.SymbolKind.Type},i.prototype.isType=function(){return!0},i.prototype.getType=function(){return this.type},i.prototype.getTypeNameEx=function(n){return this.type.getMemberTypeNameEx(this.name?this.name+this.getOptionalNameString():"",!1,!1,n)},i.prototype.instanceScope=function(){return this.type.typeFlags&n.TypeFlags.IsClass||!this.type.isClass()?this.type.containedScope:this.type.instanceType.constructorScope},i.prototype.toString=function(){var n=this.type.getTypeName();return this.name&&(n=this.name+":"+n),n},i.prototype.isClass=function(){return this.instanceType!=null},i.prototype.isFunction=function(){return this.declAST!=null&&this.declAST.nodeType==n.NodeType.FuncDecl},i.prototype.specializeType=function(n,t,r){var u,f;return this.type==n?t.symbol:(u=this.type.specializeType(n,t,r,!1),u!=this.type?f=new i(this.name,-1,0,-1,u):this)},i.prototype.getPrettyName=function(t){if(!!t&&n.isQuoted(this.prettyName)&&this.type.isModuleType()){var r=t.pathToRoot(),i=this.getPrettyNameOfDynamicModule(r);if(i!=null)return i.name}return this.prettyName},i.prototype.getPrettyNameOfDynamicModule=function(n){var t=n.length,i=null,r;return n.length>0&&n[t-1].getType().isModuleType()&&n[t-1].isDynamic&&(t>1&&n[t-2].getType().isModuleType()&&n[t-2].isDynamic&&(r=n[t-2].getType(),i=r.findDynamicModuleName(this.type)),i==null&&(r=n[t-1].getType(),i=r.findDynamicModuleName(this.type))),i},i.prototype.getDocComments=function(){var n=[],t;for(this.declAST!=null&&(n=n.concat(this.declAST.getDocComments())),t=0;t<this.expansionsDeclAST.length;t++)n=n.concat(this.expansionsDeclAST[t].getDocComments());return n},i}(t),n.TypeSymbol=e,s=function(n){function t(t,i,r){n.call(this,"with",t,4,i,r)}return __extends(t,n),t.prototype.isWith=function(){return!0},t}(e),n.WithSymbol=s,h=function(t){function i(n,i,r,u,f){t.call(this,n,i,n.length,r),this.canWrite=u,this.field=f,this.getter=null,this.setter=null,this.hasBeenEmitted=!1,this.name=n,this.location=i}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Field},i.prototype.writeable=function(){return this.isAccessor()?this.setter!=null:this.canWrite},i.prototype.getType=function(){return this.field.typeLink.type},i.prototype.getTypeNameEx=function(t){return n.MemberName.create(this.field.typeLink.type.getScopedTypeNameEx(t),this.name+this.getOptionalNameString()+": ","")},i.prototype.isMember=function(){return!0},i.prototype.setType=function(n){this.field.typeLink.type=n},i.prototype.isAccessor=function(){return this.getter!=null||this.setter!=null},i.prototype.isVariable=function(){return!0},i.prototype.toString=function(){return this.getTypeNameEx(null).toString()},i.prototype.specializeType=function(t,f,e){var h=this.field.typeLink.type.specializeType(t,f,e,!1),s,o;return h!=this.field.typeLink.type?(s=new r,o=new i(this.name,0,e.locationInfo.unitIndex,this.canWrite,s),o.flags=this.flags,s.symbol=o,s.typeLink=new n.TypeLink,o.setType(h),o.typeCheckStatus=u.Finished,o):this},i.prototype.getDocComments=function(){if(this.getter!=null||this.setter!=null){var n=[];return this.getter!=null&&(n=n.concat(this.getter.getDocComments())),this.setter!=null&&(n=n.concat(this.setter.getDocComments())),n}return this.declAST!=null?this.declAST.getDocComments():[]},i}(t),n.FieldSymbol=h,c=function(t){function i(n,i,r,u){t.call(this,n,i,n.length,r),this.parameter=u,this.paramDocComment=null,this.funcDecl=null,this.argsOffset=-1,this.name=n,this.location=i}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Parameter},i.prototype.writeable=function(){return!0},i.prototype.getType=function(){return this.parameter.typeLink.type},i.prototype.setType=function(n){this.parameter.typeLink.type=n},i.prototype.isVariable=function(){return!0},i.prototype.isOptional=function(){return this.parameter&&this.parameter.symbol&&this.parameter.symbol.declAST?this.parameter.symbol.declAST.isOptional:!1},i.prototype.getTypeNameEx=function(t){return n.MemberName.create(this.getType().getScopedTypeNameEx(t),this.name+(this.isOptional()?"?":"")+": ","")},i.prototype.toString=function(){return this.getTypeNameEx(null).toString()},i.prototype.specializeType=function(n,t,u){var o=this.parameter.typeLink.type.specializeType(n,t,u,!1),e,f;return this.parameter.typeLink.type!=o?(e=new r,f=new i(this.name,0,u.locationInfo.unitIndex,e),e.symbol=f,f.setType(o),f):this},i.prototype.getParameterDocComments=function(){var t,u,i,r;return this.paramDocComment||(t=[],this.funcDecl&&(u=this.funcDecl.getDocComments(),i=n.Comment.getParameterDocCommentText(this.name,u),i!=""&&t.push(i)),r=n.Comment.getDocCommentText(this.getDocComments()),r!=""&&t.push(r),this.paramDocComment=t.join("\n")),this.paramDocComment},i}(t),n.ParameterSymbol=c,l=function(t){function i(n,i,r,u){t.call(this,n,i,n.length,r),this.variable=u}return __extends(i,t),i.prototype.kind=function(){return n.SymbolKind.Variable},i.prototype.writeable=function(){return!0},i.prototype.getType=function(){return this.variable.typeLink.type},i.prototype.getTypeNameEx=function(t){return n.MemberName.create(this.getType().getScopedTypeNameEx(t),this.name+": ","")},i.prototype.setType=function(n){this.variable.typeLink.type=n},i.prototype.isVariable=function(){return!0},i}(t),n.VariableSymbol=l}(TypeScript||(TypeScript={})),function(n){var s=function(){function n(n){this.dualMembers=n,this.allMembers=this.dualMembers,this.publicMembers=this.dualMembers.primaryTable,this.privateMembers=this.dualMembers.secondaryTable}return n.prototype.addPublicMember=function(n,t){return this.dualMembers.primaryTable.add(n,t)},n.prototype.addPrivateMember=function(n,t){return this.dualMembers.secondaryTable.add(n,t)},n}(),i,t,u,f,r,e,o;n.ScopedMembers=s,function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="Type",n.Type=1,n._map[2]="Field",n.Field=2,n._map[3]="Parameter",n.Parameter=3,n._map[4]="Variable",n.Variable=4}(n.SymbolKind||(n.SymbolKind={})),i=n.SymbolKind,t=function(){function n(n){this.container=n}return n.prototype.printLabel=function(){return"base"},n.prototype.getAllSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.getAllTypeSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.getAllValueSymbolNames=function(){return["please","implement","in","derived","classes"]},n.prototype.search=function(){return null},n.prototype.findLocal=function(){return null},n.prototype.find=function(){return null},n.prototype.findImplementation=function(){return null},n.prototype.findAmbient=function(){return null},n.prototype.print=function(n){this.container?n.WriteLine(this.printLabel()+" scope with container: "+this.container.name+"..."):n.WriteLine(this.printLabel()+" scope...")},n.prototype.enter=function(){throw new Error("please implement in derived class");},n.prototype.getTable=function(){throw new Error("please implement in derived class");},n}(),n.SymbolScope=t,u=function(t){function i(n){t.call(this,n),this.valueCache=null,this.valueImplCache=null,this.valueAmbientCache=null,this.typeCache=null,this.typeImplCache=null,this.typeAmbientCache=null,this.parents=null,this.container=n}return __extends(i,t),i.prototype.printLabel=function(){return"agg"},i.prototype.search=function(n,t,i,r){var u,f;if(this.parents)for(u=0;u<this.parents.length;u++)if(f=this.parents[u].search(n,t,i,r),f&&n.update(f))return f;return n.result},i.prototype.getAllSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.getAllTypeSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllTypeSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.getAllValueSymbolNames=function(n){var i=[],t,r;if(this.parents)for(t=0;t<this.parents.length;t++)r=this.parents[t].getAllValueSymbolNames(n),r&&(i=i.concat(r));return i},i.prototype.print=function(n){if(t.prototype.print.call(this,n),this.parents)for(var i=0;i<this.parents.length;i++)this.parents[i].print(n)},i.prototype.findImplementation=function(t,i,r){var u=null,e=0,f=this.valueImplCache;if(r&&(f=this.typeImplCache),f&&(u=f.lookup(t))!=null&&(i?!(n.hasFlag(u.flags,n.SymbolFlags.Private)||u.declAST&&u.declAST.nodeType==n.NodeType.FuncDecl&&n.hasFlag(u.declAST.fncFlags,n.FncFlags.Private)):!0))return u;if(this.parents)for(e=0;e<this.parents.length;e++)if(u=this.parents[e].findImplementation(t,i,r),u)break;return f&&(r?(this.typeImplCache=new n.StringHashTable,f=this.typeImplCache):(this.valueImplCache=new n.StringHashTable,f=this.valueImplCache)),f.add(t,u),u},i.prototype.find=function(t,i,r){var u=null,e=0,f=this.valueCache;if(r&&(f=this.typeCache),f&&(u=f.lookup(t))!=null&&(i?!(n.hasFlag(u.flags,n.SymbolFlags.Private)||u.declAST&&u.declAST.nodeType==n.NodeType.FuncDecl&&n.hasFlag(u.declAST.fncFlags,n.FncFlags.Private)):!0))return u;if(this.parents)for(e=0;e<this.parents.length;e++)if(u=this.parents[e].find(t,i,r),u)break;return f==null&&(r?(this.typeCache=new n.StringHashTable,f=this.typeCache):(this.valueCache=new n.StringHashTable,f=this.valueCache)),f.add(t,u),u},i.prototype.findAmbient=function(t,i,r){var f=null,e=0,u=this.valueAmbientCache;if(r&&(u=this.typeAmbientCache),u&&(f=u.lookup(t))!=null)return f;if(this.parents)for(e=0;e<this.parents.length;e++)if(f=this.parents[e].findAmbient(t,i,r),f)break;return u==null&&(r?(this.typeAmbientCache=new n.StringHashTable,u=this.typeAmbientCache):(this.valueAmbientCache=new n.StringHashTable,u=this.valueAmbientCache)),u.add(t,f),f},i.prototype.addParentScope=function(n){this.parents==null&&(this.parents=[]),this.parents[this.parents.length]=n},i}(t),n.SymbolAggregateScope=u,f=function(n){function t(t,i,r,u,f){n.call(this,f),this.valueMembers=t,this.ambientValueMembers=i,this.enclosedTypes=r,this.ambientEnclosedTypes=u,this.container=f}return __extends(t,n),t.prototype.printLabel=function(){return"table"},t.prototype.getAllSymbolNames=function(n){var t=this.getAllTypeSymbolNames(n);return t.concat(this.getAllValueSymbolNames(n))},t.prototype.getAllTypeSymbolNames=function(){var t=[];return this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys())),t},t.prototype.getAllValueSymbolNames=function(){var t=[];return this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys())),t},t.prototype.search=function(n,t,i,r){var u=this.find(t,i,r);return n.update(u),n.result},t.prototype.find=function(n,t,i){var u=null,f=null,r;return(i?(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers):(u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers),f&&(r=f.lookup(n),r))?r:u&&(r=u.lookup(n),r)?r:null},t.prototype.findAmbient=function(n,t,i){var r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers,u;return(i&&(r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),r&&(u=r.lookup(n),u))?u:null},t.prototype.print=function(t){n.prototype.print.call(this,t),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(n){t.WriteLine("  "+n)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(n){t.WriteLine("  "+n)},null)},t.prototype.findImplementation=function(n,t,r){var u=this.find(n,t,r),f,e;return u&&(u.kind()==i.Type?(f=u,f.type.hasImplementation()||(u=null)):u.container&&u.container.kind()==i.Type&&(e=u.container,e.type.hasImplementation()||(u=null))),u},t.prototype.getTable=function(){return this.valueMembers.publicMembers},t}(t),n.SymbolTableScope=f,r=function(t){function i(n,i,r,u,f,e){t.call(this,e),this.valueMembers=n,this.ambientValueMembers=i,this.enclosedTypes=r,this.ambientEnclosedTypes=u,this.parent=f,this.container=e}return __extends(i,t),i.prototype.printLabel=function(){return"builder"},i.prototype.getAllSymbolNames=function(n){var t=this.getAllTypeSymbolNames(n);return t.concat(this.getAllValueSymbolNames(n))},i.prototype.getAllTypeSymbolNames=function(n){var t=[],i;return this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys())),!n&&this.parent&&(i=this.parent.getAllTypeSymbolNames(n),i&&(t=t.concat(i))),t},i.prototype.getAllValueSymbolNames=function(n){var t=[],i;return this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys())),!n&&this.parent&&(i=this.parent.getAllValueSymbolNames(n),i&&(t=t.concat(i))),t},i.prototype.search=function(n,t,i,r){var u=null,f=this.valueMembers==null?null:i?this.valueMembers.publicMembers:this.valueMembers.allMembers,e=this.ambientValueMembers==null?null:i?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(r&&(f=this.enclosedTypes==null?null:i?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,e=this.ambientEnclosedTypes==null?null:i?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),e&&(u=e.lookup(t))!=null&&n.update(u))?u:f&&(u=f.lookup(t))!=null&&n.update(u)?u:this.parent&&(u=this.parent.search(n,t,i,r),u&&n.update(u))?u:n.result},i.prototype.print=function(n){t.prototype.print.call(this,n),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(t,i){var u=i;n.WriteLine("  "+t)},null),this.parent&&this.parent.print(n)},i.prototype.find=function(n,t,i){var r=null,u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),f&&(r=f.lookup(n))!=null)?r:u&&(r=u.lookup(n))!=null?r:this.parent?this.parent.find(n,t,i):null},i.prototype.findAmbient=function(n,t,i){var u=null,r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),r&&(u=r.lookup(n))!=null)?u:this.parent?this.parent.findAmbient(n,t,i):null},i.prototype.findLocal=function(n,t,i){var r=null,u=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,f=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return(i&&(u=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,f=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),u&&(r=u.lookup(n))!=null&&r)?r:f&&(r=f.lookup(n))!=null&&r?r:null},i.prototype.enter=function(t,i,r,u,f,e,o){var s=null;s=o?e?this.ambientEnclosedTypes==null?null:f?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.privateMembers:this.ambientValueMembers==null?null:f?this.ambientValueMembers.publicMembers:this.ambientValueMembers.privateMembers:e?this.enclosedTypes==null?null:f?this.enclosedTypes.publicMembers:this.enclosedTypes.privateMembers:this.valueMembers==null?null:f?this.valueMembers.publicMembers:this.valueMembers.privateMembers,s?s.add(r.name,r)||u.duplicateIdentifier(i,r.name):n.CompilerDiagnostics.Alert("YYYYY"),r.container=t},i.prototype.getTable=function(){return this.valueMembers.allMembers},i}(t),n.SymbolScopeBuilder=r,e=function(n){function t(t,i,r){n.call(this,i),this.scope=t,this.filter=r}return __extends(t,n),t.prototype.print=function(n){this.scope.print(n)},t.prototype.find=function(n,t,i){return this.filter.reset(),this.scope.search(this.filter,n,t,i)},t.prototype.findLocal=function(n,t,i){return this.scope.findLocal(n,t,i)},t}(t),n.FilteredSymbolScope=e,o=function(n){function t(t,i,r,u){n.call(this,t,null,null,null,i,r),this.filter=u}return __extends(t,n),t.prototype.findLocal=function(t,i,r){var u=n.prototype.findLocal.call(this,t,i,r);return u&&!this.filter(u)?null:u},t.prototype.search=function(){throw new Error("please implement");},t.prototype.find=function(t,i,r){var u=n.prototype.findLocal.call(this,t,i,r);return u&&!this.filter(u)?null:n.prototype.find.call(this,t,i,r)},t}(r),n.FilteredSymbolScopeBuilder=o}(TypeScript||(TypeScript={})),function(n){function u(t,i,r,u,f,e,s,h){t!==undefined&&(n.tokenTable[t]=new o(t,i,r,u,f,e,s,h),u!=n.NodeType.None&&(n.nodeTypeTable[u]=s,n.nodeTypeToTokTable[u]=t),e!=n.NodeType.None&&(n.nodeTypeTable[e]=s))}function s(t){return n.tokenTable[t]}function w(){for(var t=0;t<=i.LimFixed;t++)n.staticTokens[t]=new e(t)}var i,t,r,o,f,h,e,c,l,a,v,y,p;(function(n){n._map=[],n._map[0]="Any",n.Any=0,n._map[1]="Bool",n.Bool=1,n._map[2]="Break",n.Break=2,n._map[3]="Case",n.Case=3,n._map[4]="Catch",n.Catch=4,n._map[5]="Class",n.Class=5,n._map[6]="Const",n.Const=6,n._map[7]="Continue",n.Continue=7,n._map[8]="Debugger",n.Debugger=8,n._map[9]="Default",n.Default=9,n._map[10]="Delete",n.Delete=10,n._map[11]="Do",n.Do=11,n._map[12]="Else",n.Else=12,n._map[13]="Enum",n.Enum=13,n._map[14]="Export",n.Export=14,n._map[15]="Extends",n.Extends=15,n._map[16]="Declare",n.Declare=16,n._map[17]="False",n.False=17,n._map[18]="Finally",n.Finally=18,n._map[19]="For",n.For=19,n._map[20]="Function",n.Function=20,n._map[21]="Constructor",n.Constructor=21,n._map[22]="Get",n.Get=22,n._map[23]="If",n.If=23,n._map[24]="Implements",n.Implements=24,n._map[25]="Import",n.Import=25,n._map[26]="In",n.In=26,n._map[27]="InstanceOf",n.InstanceOf=27,n._map[28]="Interface",n.Interface=28,n._map[29]="Let",n.Let=29,n._map[30]="Module",n.Module=30,n._map[31]="New",n.New=31,n._map[32]="Number",n.Number=32,n._map[33]="Null",n.Null=33,n._map[34]="Package",n.Package=34,n._map[35]="Private",n.Private=35,n._map[36]="Protected",n.Protected=36,n._map[37]="Public",n.Public=37,n._map[38]="Return",n.Return=38,n._map[39]="Set",n.Set=39,n._map[40]="Static",n.Static=40,n._map[41]="String",n.String=41,n._map[42]="Super",n.Super=42,n._map[43]="Switch",n.Switch=43,n._map[44]="This",n.This=44,n._map[45]="Throw",n.Throw=45,n._map[46]="True",n.True=46,n._map[47]="Try",n.Try=47,n._map[48]="TypeOf",n.TypeOf=48,n._map[49]="Var",n.Var=49,n._map[50]="Void",n.Void=50,n._map[51]="With",n.With=51,n._map[52]="While",n.While=52,n._map[53]="Yield",n.Yield=53,n._map[54]="Semicolon",n.Semicolon=54,n._map[55]="OpenParen",n.OpenParen=55,n._map[56]="CloseParen",n.CloseParen=56,n._map[57]="OpenBracket",n.OpenBracket=57,n._map[58]="CloseBracket",n.CloseBracket=58,n._map[59]="OpenBrace",n.OpenBrace=59,n._map[60]="CloseBrace",n.CloseBrace=60,n._map[61]="Comma",n.Comma=61,n._map[62]="Equals",n.Equals=62,n._map[63]="PlusEquals",n.PlusEquals=63,n._map[64]="MinusEquals",n.MinusEquals=64,n._map[65]="AsteriskEquals",n.AsteriskEquals=65,n._map[66]="SlashEquals",n.SlashEquals=66,n._map[67]="PercentEquals",n.PercentEquals=67,n._map[68]="AmpersandEquals",n.AmpersandEquals=68,n._map[69]="CaretEquals",n.CaretEquals=69,n._map[70]="BarEquals",n.BarEquals=70,n._map[71]="LessThanLessThanEquals",n.LessThanLessThanEquals=71,n._map[72]="GreaterThanGreaterThanEquals",n.GreaterThanGreaterThanEquals=72,n._map[73]="GreaterThanGreaterThanGreaterThanEquals",n.GreaterThanGreaterThanGreaterThanEquals=73,n._map[74]="Question",n.Question=74,n._map[75]="Colon",n.Colon=75,n._map[76]="BarBar",n.BarBar=76,n._map[77]="AmpersandAmpersand",n.AmpersandAmpersand=77,n._map[78]="Bar",n.Bar=78,n._map[79]="Caret",n.Caret=79,n._map[80]="And",n.And=80,n._map[81]="EqualsEquals",n.EqualsEquals=81,n._map[82]="ExclamationEquals",n.ExclamationEquals=82,n._map[83]="EqualsEqualsEquals",n.EqualsEqualsEquals=83,n._map[84]="ExclamationEqualsEquals",n.ExclamationEqualsEquals=84,n._map[85]="LessThan",n.LessThan=85,n._map[86]="LessThanEquals",n.LessThanEquals=86,n._map[87]="GreaterThan",n.GreaterThan=87,n._map[88]="GreaterThanEquals",n.GreaterThanEquals=88,n._map[89]="LessThanLessThan",n.LessThanLessThan=89,n._map[90]="GreaterThanGreaterThan",n.GreaterThanGreaterThan=90,n._map[91]="GreaterThanGreaterThanGreaterThan",n.GreaterThanGreaterThanGreaterThan=91,n._map[92]="Plus",n.Plus=92,n._map[93]="Minus",n.Minus=93,n._map[94]="Asterisk",n.Asterisk=94,n._map[95]="Slash",n.Slash=95,n._map[96]="Percent",n.Percent=96,n._map[97]="Tilde",n.Tilde=97,n._map[98]="Exclamation",n.Exclamation=98,n._map[99]="PlusPlus",n.PlusPlus=99,n._map[100]="MinusMinus",n.MinusMinus=100,n._map[101]="Dot",n.Dot=101,n._map[102]="DotDotDot",n.DotDotDot=102,n._map[103]="Error",n.Error=103,n._map[104]="EndOfFile",n.EndOfFile=104,n._map[105]="EqualsGreaterThan",n.EqualsGreaterThan=105,n._map[106]="Identifier",n.Identifier=106,n._map[107]="StringLiteral",n.StringLiteral=107,n._map[108]="RegularExpressionLiteral",n.RegularExpressionLiteral=108,n._map[109]="NumberLiteral",n.NumberLiteral=109,n._map[110]="Whitespace",n.Whitespace=110,n._map[111]="Comment",n.Comment=111,n._map[112]="Lim",n.Lim=112,n.LimFixed=n.EqualsGreaterThan,n.LimKeyword=n.Yield})(n.TokenID||(n.TokenID={})),i=n.TokenID,n.tokenTable=[],n.nodeTypeTable=[],n.nodeTypeToTokTable=[],n.noRegexTable=[],n.noRegexTable[i.Identifier]=!0,n.noRegexTable[i.StringLiteral]=!0,n.noRegexTable[i.NumberLiteral]=!0,n.noRegexTable[i.RegularExpressionLiteral]=!0,n.noRegexTable[i.This]=!0,n.noRegexTable[i.PlusPlus]=!0,n.noRegexTable[i.MinusMinus]=!0,n.noRegexTable[i.CloseParen]=!0,n.noRegexTable[i.CloseBracket]=!0,n.noRegexTable[i.CloseBrace]=!0,n.noRegexTable[i.True]=!0,n.noRegexTable[i.False]=!0,function(n){n._map=[],n._map[0]="None",n.None=0,n._map[1]="Comma",n.Comma=1,n._map[2]="Assignment",n.Assignment=2,n._map[3]="Conditional",n.Conditional=3,n._map[4]="LogicalOr",n.LogicalOr=4,n._map[5]="LogicalAnd",n.LogicalAnd=5,n._map[6]="BitwiseOr",n.BitwiseOr=6,n._map[7]="BitwiseExclusiveOr",n.BitwiseExclusiveOr=7,n._map[8]="BitwiseAnd",n.BitwiseAnd=8,n._map[9]="Equality",n.Equality=9,n._map[10]="Relational",n.Relational=10,n._map[11]="Shift",n.Shift=11,n._map[12]="Additive",n.Additive=12,n._map[13]="Multiplicative",n.Multiplicative=13,n._map[14]="Unary",n.Unary=14,n._map[15]="Lim",n.Lim=15}(n.OperatorPrecedence||(n.OperatorPrecedence={})),t=n.OperatorPrecedence,function(n){n._map=[],n.None=0,n.Javascript=1,n.JavascriptFuture=2,n.TypeScript=4,n.JavascriptFutureStrict=8,n.TypeScriptAndJS=n.Javascript|n.TypeScript,n.TypeScriptAndJSFuture=n.JavascriptFuture|n.TypeScript,n.TypeScriptAndJSFutureStrict=n.JavascriptFutureStrict|n.TypeScript}(n.Reservation||(n.Reservation={})),r=n.Reservation,o=function(){function n(n,t,i,r,u,f,e,o){this.tokenId=n,this.reservation=t,this.binopPrecedence=i,this.binopNodeType=r,this.unopPrecedence=u,this.unopNodeType=f,this.text=e,this.ers=o}return n}(),n.TokenInfo=o,u(i.Any,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"any",n.ErrorRecoverySet.PrimType),u(i.Bool,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"bool",n.ErrorRecoverySet.PrimType),u(i.Break,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"break",n.ErrorRecoverySet.Stmt),u(i.Case,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"case",n.ErrorRecoverySet.SCase),u(i.Catch,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"catch",n.ErrorRecoverySet.Catch),u(i.Class,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"class",n.ErrorRecoverySet.TypeScriptS),u(i.Const,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"const",n.ErrorRecoverySet.Var),u(i.Continue,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"continue",n.ErrorRecoverySet.Stmt),u(i.Debugger,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.Debugger,"debugger",n.ErrorRecoverySet.Stmt),u(i.Default,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"default",n.ErrorRecoverySet.SCase),u(i.Delete,r.TypeScriptAndJS,t.None,n.NodeType.None,t.Unary,n.NodeType.Delete,"delete",n.ErrorRecoverySet.Prefix),u(i.Do,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"do",n.ErrorRecoverySet.Stmt),u(i.Else,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"else",n.ErrorRecoverySet.Else),u(i.Enum,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"enum",n.ErrorRecoverySet.TypeScriptS),u(i.Export,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"export",n.ErrorRecoverySet.TypeScriptS),u(i.Extends,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"extends",n.ErrorRecoverySet.None),u(i.Declare,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"declare",n.ErrorRecoverySet.Stmt),u(i.False,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"false",n.ErrorRecoverySet.RLit),u(i.Finally,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"finally",n.ErrorRecoverySet.Catch),u(i.For,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"for",n.ErrorRecoverySet.Stmt),u(i.Function,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"function",n.ErrorRecoverySet.Func),u(i.Constructor,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"constructor",n.ErrorRecoverySet.Func),u(i.Get,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"get",n.ErrorRecoverySet.Func),u(i.Set,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"set",n.ErrorRecoverySet.Func),u(i.If,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"if",n.ErrorRecoverySet.Stmt),u(i.Implements,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"implements",n.ErrorRecoverySet.None),u(i.Import,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"import",n.ErrorRecoverySet.TypeScriptS),u(i.In,r.TypeScriptAndJS,t.Relational,n.NodeType.In,t.None,n.NodeType.None,"in",n.ErrorRecoverySet.None),u(i.InstanceOf,r.TypeScriptAndJS,t.Relational,n.NodeType.InstOf,t.None,n.NodeType.None,"instanceof",n.ErrorRecoverySet.BinOp),u(i.Interface,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"interface",n.ErrorRecoverySet.TypeScriptS),u(i.Let,r.JavascriptFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"let",n.ErrorRecoverySet.None),u(i.Module,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"module",n.ErrorRecoverySet.TypeScriptS),u(i.New,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"new",n.ErrorRecoverySet.PreOp),u(i.Number,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"number",n.ErrorRecoverySet.PrimType),u(i.Null,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"null",n.ErrorRecoverySet.RLit),u(i.Package,r.JavascriptFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"package",n.ErrorRecoverySet.None),u(i.Private,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"private",n.ErrorRecoverySet.TypeScriptS),u(i.Protected,r.JavascriptFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"protected",n.ErrorRecoverySet.None),u(i.Public,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"public",n.ErrorRecoverySet.TypeScriptS),u(i.Return,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"return",n.ErrorRecoverySet.Stmt),u(i.Static,r.TypeScriptAndJSFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"static",n.ErrorRecoverySet.None),u(i.String,r.TypeScript,t.None,n.NodeType.None,t.None,n.NodeType.None,"string",n.ErrorRecoverySet.PrimType),u(i.Super,r.TypeScriptAndJSFuture,t.None,n.NodeType.None,t.None,n.NodeType.None,"super",n.ErrorRecoverySet.RLit),u(i.Switch,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"switch",n.ErrorRecoverySet.Stmt),u(i.This,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"this",n.ErrorRecoverySet.RLit),u(i.Throw,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"throw",n.ErrorRecoverySet.Stmt),u(i.True,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"true",n.ErrorRecoverySet.RLit),u(i.Try,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"try",n.ErrorRecoverySet.Stmt),u(i.TypeOf,r.TypeScriptAndJS,t.None,n.NodeType.None,t.Unary,n.NodeType.Typeof,"typeof",n.ErrorRecoverySet.Prefix),u(i.Var,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"var",n.ErrorRecoverySet.Var),u(i.Void,r.TypeScriptAndJS,t.None,n.NodeType.None,t.Unary,n.NodeType.Void,"void",n.ErrorRecoverySet.Prefix),u(i.With,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.With,"with",n.ErrorRecoverySet.Stmt),u(i.While,r.TypeScriptAndJS,t.None,n.NodeType.None,t.None,n.NodeType.None,"while",n.ErrorRecoverySet.While),u(i.Yield,r.JavascriptFutureStrict,t.None,n.NodeType.None,t.None,n.NodeType.None,"yield",n.ErrorRecoverySet.None),u(i.Identifier,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"identifier",n.ErrorRecoverySet.ID),u(i.NumberLiteral,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"numberLiteral",n.ErrorRecoverySet.Literal),u(i.RegularExpressionLiteral,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"regex",n.ErrorRecoverySet.RegExp),u(i.StringLiteral,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"qstring",n.ErrorRecoverySet.Literal),u(i.Semicolon,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,";",n.ErrorRecoverySet.SColon),u(i.CloseParen,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,")",n.ErrorRecoverySet.RParen),u(i.CloseBracket,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"]",n.ErrorRecoverySet.RBrack),u(i.OpenBrace,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"{",n.ErrorRecoverySet.LCurly),u(i.CloseBrace,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"}",n.ErrorRecoverySet.RCurly),u(i.DotDotDot,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"...",n.ErrorRecoverySet.None),u(i.Comma,r.None,t.Comma,n.NodeType.Comma,t.None,n.NodeType.None,",",n.ErrorRecoverySet.Comma),u(i.Equals,r.None,t.Assignment,n.NodeType.Asg,t.None,n.NodeType.None,"=",n.ErrorRecoverySet.Asg),u(i.PlusEquals,r.None,t.Assignment,n.NodeType.AsgAdd,t.None,n.NodeType.None,"+=",n.ErrorRecoverySet.BinOp),u(i.MinusEquals,r.None,t.Assignment,n.NodeType.AsgSub,t.None,n.NodeType.None,"-=",n.ErrorRecoverySet.BinOp),u(i.AsteriskEquals,r.None,t.Assignment,n.NodeType.AsgMul,t.None,n.NodeType.None,"*=",n.ErrorRecoverySet.BinOp),u(i.SlashEquals,r.None,t.Assignment,n.NodeType.AsgDiv,t.None,n.NodeType.None,"/=",n.ErrorRecoverySet.BinOp),u(i.PercentEquals,r.None,t.Assignment,n.NodeType.AsgMod,t.None,n.NodeType.None,"%=",n.ErrorRecoverySet.BinOp),u(i.AmpersandEquals,r.None,t.Assignment,n.NodeType.AsgAnd,t.None,n.NodeType.None,"&=",n.ErrorRecoverySet.BinOp),u(i.CaretEquals,r.None,t.Assignment,n.NodeType.AsgXor,t.None,n.NodeType.None,"^=",n.ErrorRecoverySet.BinOp),u(i.BarEquals,r.None,t.Assignment,n.NodeType.AsgOr,t.None,n.NodeType.None,"|=",n.ErrorRecoverySet.BinOp),u(i.LessThanLessThanEquals,r.None,t.Assignment,n.NodeType.AsgLsh,t.None,n.NodeType.None,"<<=",n.ErrorRecoverySet.BinOp),u(i.GreaterThanGreaterThanEquals,r.None,t.Assignment,n.NodeType.AsgRsh,t.None,n.NodeType.None,">>=",n.ErrorRecoverySet.BinOp),u(i.GreaterThanGreaterThanGreaterThanEquals,r.None,t.Assignment,n.NodeType.AsgRs2,t.None,n.NodeType.None,">>>=",n.ErrorRecoverySet.BinOp),u(i.Question,r.None,t.Conditional,n.NodeType.ConditionalExpression,t.None,n.NodeType.None,"?",n.ErrorRecoverySet.BinOp),u(i.Colon,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,":",n.ErrorRecoverySet.Colon),u(i.BarBar,r.None,t.LogicalOr,n.NodeType.LogOr,t.None,n.NodeType.None,"||",n.ErrorRecoverySet.BinOp),u(i.AmpersandAmpersand,r.None,t.LogicalAnd,n.NodeType.LogAnd,t.None,n.NodeType.None,"&&",n.ErrorRecoverySet.BinOp),u(i.Bar,r.None,t.BitwiseOr,n.NodeType.Or,t.None,n.NodeType.None,"|",n.ErrorRecoverySet.BinOp),u(i.Caret,r.None,t.BitwiseExclusiveOr,n.NodeType.Xor,t.None,n.NodeType.None,"^",n.ErrorRecoverySet.BinOp),u(i.And,r.None,t.BitwiseAnd,n.NodeType.And,t.None,n.NodeType.None,"&",n.ErrorRecoverySet.BinOp),u(i.EqualsEquals,r.None,t.Equality,n.NodeType.Eq,t.None,n.NodeType.None,"==",n.ErrorRecoverySet.BinOp),u(i.ExclamationEquals,r.None,t.Equality,n.NodeType.Ne,t.None,n.NodeType.None,"!=",n.ErrorRecoverySet.BinOp),u(i.EqualsEqualsEquals,r.None,t.Equality,n.NodeType.Eqv,t.None,n.NodeType.None,"===",n.ErrorRecoverySet.BinOp),u(i.ExclamationEqualsEquals,r.None,t.Equality,n.NodeType.NEqv,t.None,n.NodeType.None,"!==",n.ErrorRecoverySet.BinOp),u(i.LessThan,r.None,t.Relational,n.NodeType.Lt,t.None,n.NodeType.None,"<",n.ErrorRecoverySet.BinOp),u(i.LessThanEquals,r.None,t.Relational,n.NodeType.Le,t.None,n.NodeType.None,"<=",n.ErrorRecoverySet.BinOp),u(i.GreaterThan,r.None,t.Relational,n.NodeType.Gt,t.None,n.NodeType.None,">",n.ErrorRecoverySet.BinOp),u(i.GreaterThanEquals,r.None,t.Relational,n.NodeType.Ge,t.None,n.NodeType.None,">=",n.ErrorRecoverySet.BinOp),u(i.LessThanLessThan,r.None,t.Shift,n.NodeType.Lsh,t.None,n.NodeType.None,"<<",n.ErrorRecoverySet.BinOp),u(i.GreaterThanGreaterThan,r.None,t.Shift,n.NodeType.Rsh,t.None,n.NodeType.None,">>",n.ErrorRecoverySet.BinOp),u(i.GreaterThanGreaterThanGreaterThan,r.None,t.Shift,n.NodeType.Rs2,t.None,n.NodeType.None,">>>",n.ErrorRecoverySet.BinOp),u(i.Plus,r.None,t.Additive,n.NodeType.Add,t.Unary,n.NodeType.Pos,"+",n.ErrorRecoverySet.AddOp),u(i.Minus,r.None,t.Additive,n.NodeType.Sub,t.Unary,n.NodeType.Neg,"-",n.ErrorRecoverySet.AddOp),u(i.Asterisk,r.None,t.Multiplicative,n.NodeType.Mul,t.None,n.NodeType.None,"*",n.ErrorRecoverySet.BinOp),u(i.Slash,r.None,t.Multiplicative,n.NodeType.Div,t.None,n.NodeType.None,"/",n.ErrorRecoverySet.BinOp),u(i.Percent,r.None,t.Multiplicative,n.NodeType.Mod,t.None,n.NodeType.None,"%",n.ErrorRecoverySet.BinOp),u(i.Tilde,r.None,t.None,n.NodeType.None,t.Unary,n.NodeType.Not,"~",n.ErrorRecoverySet.PreOp),u(i.Exclamation,r.None,t.None,n.NodeType.None,t.Unary,n.NodeType.LogNot,"!",n.ErrorRecoverySet.PreOp),u(i.PlusPlus,r.None,t.None,n.NodeType.None,t.Unary,n.NodeType.IncPre,"++",n.ErrorRecoverySet.PreOp),u(i.MinusMinus,r.None,t.None,n.NodeType.None,t.Unary,n.NodeType.DecPre,"--",n.ErrorRecoverySet.PreOp),u(i.OpenParen,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"(",n.ErrorRecoverySet.LParen),u(i.OpenBracket,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"[",n.ErrorRecoverySet.LBrack),u(i.Dot,r.None,t.Unary,n.NodeType.None,t.None,n.NodeType.None,".",n.ErrorRecoverySet.Dot),u(i.EndOfFile,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"<EOF>",n.ErrorRecoverySet.EOF),u(i.EqualsGreaterThan,r.None,t.None,n.NodeType.None,t.None,n.NodeType.None,"=>",n.ErrorRecoverySet.None),n.lookupToken=s,function(n){n._map=[],n._map[0]="Punctuation",n.Punctuation=0,n._map[1]="Keyword",n.Keyword=1,n._map[2]="Operator",n.Operator=2,n._map[3]="Comment",n.Comment=3,n._map[4]="Whitespace",n.Whitespace=4,n._map[5]="Identifier",n.Identifier=5,n._map[6]="NumberLiteral",n.NumberLiteral=6,n._map[7]="StringLiteral",n.StringLiteral=7,n._map[8]="RegExpLiteral",n.RegExpLiteral=8}(n.TokenClass||(n.TokenClass={})),f=n.TokenClass,h=function(){function n(n,t,i){this.tok=n,this.minChar=t,this.limChar=i}return n}(),n.SavedToken=h,e=function(){function t(n){this.tokenId=n}return t.prototype.toString=function(){return"token: "+this.tokenId+" "+this.getText()+" ("+i._map[this.tokenId]+")"},t.prototype.print=function(n,t){t.WriteLine(this.toString()+",on line"+n)},t.prototype.getText=function(){return n.tokenTable[this.tokenId].text},t.prototype.classification=function(){if(this.tokenId<=i.LimKeyword)return f.Keyword;var t=s(this.tokenId);return t!=undefined&&(t.unopNodeType!=n.NodeType.None||t.binopNodeType!=n.NodeType.None)?f.Operator:f.Punctuation},t}(),n.Token=e,c=function(n){function t(t,r){n.call(this,i.NumberLiteral),this.value=t,this.hasEmptyFraction=r}return __extends(t,n),t.prototype.getText=function(){return this.hasEmptyFraction?this.value.toString()+".0":this.value.toString()},t.prototype.classification=function(){return f.NumberLiteral},t}(e),n.NumberLiteralToken=c,l=function(n){function t(t){n.call(this,i.StringLiteral),this.value=t}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.StringLiteral},t}(e),n.StringLiteralToken=l,a=function(n){function t(t,r){n.call(this,i.Identifier),this.value=t,this.hasEscapeSequence=r}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.Identifier},t}(e),n.IdentifierToken=a,v=function(n){function t(t,i){n.call(this,t),this.value=i}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.Whitespace},t}(e),n.WhitespaceToken=v,y=function(n){function t(t,i,r,u,f,e){n.call(this,t),this.value=i,this.isBlock=r,this.startPos=u,this.line=f,this.endsLine=e}return __extends(t,n),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return f.Comment},t}(e),n.CommentToken=y,p=function(n){function t(t){n.call(this,i.RegularExpressionLiteral),this.regex=t}return __extends(t,n),t.prototype.getText=function(){return this.regex.toString()},t.prototype.classification=function(){return f.RegExpLiteral},t}(e),n.RegularExpressionLiteralToken=p,n.staticTokens=[],n.initializeStaticTokens=w}(TypeScript||(TypeScript={})),function(n){var u=function(){function n(){this.arrayBase=null}return n.prototype.specialize=function(n,t){return this.arrayBase==null&&(this.arrayBase=n.specializeType(t.wildElm.type,this.arrayType.elementType,t,!0)),this.arrayBase},n}(),f,t,e,i,r,o;n.ArrayCache=u,f=function(){function t(){this.onlyCaptureFirstError=!1,this.flags=n.TypeRelationshipFlags.SuccessfulComparison,this.message=""}return t.prototype.addMessageToFront=function(n){this.onlyCaptureFirstError?this.setMessage(n):this.message=this.message?n+":\n\t"+this.message:n},t.prototype.setMessage=function(n){this.message=n},t}(),n.TypeComparisonInfo=f,function(n){n._map=[],n._map[0]="Resident",n.Resident=0,n._map[1]="Transient",n.Transient=1}(n.TypeCheckCollectionMode||(n.TypeCheckCollectionMode={})),t=n.TypeCheckCollectionMode,e=function(){function i(i){this.errorReporter=i,this.importedGlobalsTable=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.importedGlobalsTypeTable=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.globals=null,this.globalTypes=null,this.ambientGlobals=null,this.ambientGlobalTypes=null,this.residentGlobalValues=new n.StringHashTable,this.residentGlobalTypes=new n.StringHashTable,this.residentGlobalAmbientValues=new n.StringHashTable,this.residentGlobalAmbientTypes=new n.StringHashTable,this.residentTypeCheck=!0,this.mod=null,this.gloMod=null,this.wildElm=null,this.importedGlobals=new n.SymbolScopeBuilder(null,this.importedGlobalsTable,null,this.importedGlobalsTypeTable,null,null),this.dualGlobalValues=new n.DualStringHashTable(this.residentGlobalValues,new n.StringHashTable),this.dualGlobalTypes=new n.DualStringHashTable(this.residentGlobalTypes,new n.StringHashTable),this.dualAmbientGlobalValues=new n.DualStringHashTable(this.residentGlobalAmbientValues,new n.StringHashTable),this.dualAmbientGlobalTypes=new n.DualStringHashTable(this.residentGlobalAmbientTypes,new n.StringHashTable);var r=new n.ScopedMembers(new n.DualStringHashTable(this.dualGlobalValues,new n.StringHashTable)),u=new n.ScopedMembers(new n.DualStringHashTable(this.dualAmbientGlobalValues,new n.StringHashTable)),f=new n.ScopedMembers(new n.DualStringHashTable(this.dualGlobalTypes,new n.StringHashTable)),e=new n.ScopedMembers(new n.DualStringHashTable(this.dualAmbientGlobalTypes,new n.StringHashTable));this.globalScope=new n.SymbolScopeBuilder(r,u,f,e,this.importedGlobals,null),this.voidType=this.enterPrimitive(n.Primitive.Void,"void"),this.booleanType=this.enterPrimitive(n.Primitive.Boolean,"bool"),this.doubleType=this.enterPrimitive(n.Primitive.Double,"number"),this.importedGlobals.ambientEnclosedTypes.addPublicMember("number",this.doubleType.symbol),this.stringType=this.enterPrimitive(n.Primitive.String,"string"),this.anyType=this.enterPrimitive(n.Primitive.Any,"any"),this.nullType=this.enterPrimitive(n.Primitive.Null,"null"),this.undefinedType=this.enterPrimitive(n.Primitive.Undefined,"undefined"),this.setCollectionMode(t.Resident),this.wildElm=new n.TypeSymbol("_element",-1,0,-1,new n.Type),this.importedGlobalsTypeTable.addPublicMember(this.wildElm.name,this.wildElm),this.mod=new n.ModuleType(f,e),this.mod.members=r,this.mod.ambientMembers=u,this.mod.containedScope=this.globalScope,this.gloMod=new n.TypeSymbol(n.globalId,-1,0,-1,this.mod),this.mod.members.addPublicMember(this.gloMod.name,this.gloMod),this.defineGlobalValue("undefined",this.undefinedType)}return i.prototype.enterPrimitive=function(t,i){var r=new n.Type,u;return r.primitiveTypeClass=t,u=new n.TypeSymbol(i,-1,i.length,-1,r),u.typeCheckStatus=n.TypeCheckStatus.Finished,r.symbol=u,this.importedGlobals.enter(null,null,u,this.errorReporter,!0,!0,!0),r},i.prototype.setCollectionMode=function(n){this.residentTypeCheck=this.dualGlobalValues.insertPrimary=this.dualGlobalTypes.insertPrimary=this.dualAmbientGlobalValues.insertPrimary=this.dualAmbientGlobalTypes.insertPrimary=n==t.Resident},i.prototype.refreshPersistentState=function(){this.globals=new n.StringHashTable,this.globalTypes=new n.StringHashTable,this.ambientGlobals=new n.StringHashTable,this.ambientGlobalTypes=new n.StringHashTable,this.globalTypes.add(this.voidType.symbol.name,this.voidType.symbol),this.globalTypes.add(this.booleanType.symbol.name,this.booleanType.symbol),this.globalTypes.add(this.doubleType.symbol.name,this.doubleType.symbol),this.globalTypes.add("number",this.doubleType.symbol),this.globalTypes.add(this.stringType.symbol.name,this.stringType.symbol),this.globalTypes.add(this.anyType.symbol.name,this.anyType.symbol),this.globalTypes.add(this.nullType.symbol.name,this.nullType.symbol),this.globalTypes.add(this.undefinedType.symbol.name,this.undefinedType.symbol),this.dualGlobalValues.secondaryTable=this.globals,this.dualGlobalTypes.secondaryTable=this.globalTypes,this.dualAmbientGlobalValues.secondaryTable=this.ambientGlobals,this.dualAmbientGlobalTypes.secondaryTable=this.ambientGlobalTypes},i.prototype.defineGlobalValue=function(t,i){var u=new n.ValueLocation,r;u.typeLink=new n.TypeLink,r=new n.VariableSymbol(t,0,-1,u),r.setType(i),r.typeCheckStatus=n.TypeCheckStatus.Finished,r.container=this.gloMod,this.importedGlobalsTable.addPublicMember(t,r)},i}(),n.PersistentGlobalTypeState=e,i=function(){function n(n,t,i){this.contextualType=n,this.provisional=t,this.contextID=i,this.targetSig=null,this.targetThis=null,this.targetAccessorType=null}return n}(),n.ContextualTypeContext=i,r=function(){function t(n){this.checker=n,this.contextStack=[],this.hadProvisionalErrors=!1}return t.contextID=n.TypeCheckStatus.Finished+1,t.prototype.pushContextualType=function(n,r){this.contextStack.push(new i(n,r,t.contextID++)),this.checker.errorReporter.pushToErrorSink=r},t.prototype.popContextualType=function(){var n=this.contextStack.pop();return this.checker.errorReporter.pushToErrorSink=this.isProvisional(),this.hadProvisionalErrors=this.hadProvisionalErrors||n.provisional&&this.checker.errorReporter.getCapturedErrors().length,this.checker.errorReporter.freeCapturedErrors(),n},t.prototype.getContextualType=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1]:null},t.prototype.getContextID=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].contextID:n.TypeCheckStatus.Finished},t.prototype.isProvisional=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].provisional:!1},t}(),n.ContextualTypingContextStack=r,o=function(){function t(n){this.persistentState=n,this.errorReporter=null,this.checkControlFlow=!1,this.printControlFlowGraph=!1,this.checkControlFlowUseDef=!1,this.styleSettings=null,this.units=null,this.anon="_anonymous",this.locationInfo=null,this.typeFlow=null,this.currentCompareA=null,this.currentCompareB=null,this.currentModDecl=null,this.inBind=!1,this.inWith=!1,this.errorsOnWith=!0,this.currentContextualTypeContext=null,this.resolvingBases=!1,this.canCallDefinitionSignature=!1,this.assignableCache={},this.subtypeCache={},this.identicalCache={},this.provisionalStartedTypecheckObjects=[],this.mustCaptureGlobalThis=!1,this.voidType=this.persistentState.voidType,this.booleanType=this.persistentState.booleanType,this.numberType=this.persistentState.doubleType,this.stringType=this.persistentState.stringType,this.anyType=this.persistentState.anyType,this.nullType=this.persistentState.nullType,this.undefinedType=this.persistentState.undefinedType,this.globals=this.persistentState.dualGlobalValues,this.globalTypes=this.persistentState.dualGlobalTypes,this.ambientGlobals=this.persistentState.dualAmbientGlobalValues,this.ambientGlobalTypes=this.persistentState.dualAmbientGlobalTypes,this.gloModType=this.persistentState.mod,this.gloMod=this.persistentState.gloMod,this.wildElm=this.persistentState.wildElm,this.globalScope=this.persistentState.globalScope,this.typingContextStack=new r(this)}return t.prototype.setStyleOptions=function(n){this.styleSettings=n},t.prototype.setContextualType=function(n,t){this.typingContextStack.pushContextualType(n,t),this.currentContextualTypeContext=this.typingContextStack.getContextualType()},t.prototype.unsetContextualType=function(){var n=this.typingContextStack.popContextualType();return this.currentContextualTypeContext=this.typingContextStack.getContextualType(),n},t.prototype.hadProvisionalErrors=function(){return this.typingContextStack.hadProvisionalErrors},t.prototype.resetProvisionalErrors=function(){this.typingContextStack.getContextualType()||(this.typingContextStack.hadProvisionalErrors=!1)},t.prototype.typeCheckWithContextualType=function(n,t,i,r){i&&this.setContextualType(n,this.typingContextStack.isProvisional()||t),this.typeFlow.typeCheck(r),i&&this.unsetContextualType()},t.prototype.resetTargetType=function(){this.currentContextualTypeContext=this.typingContextStack.getContextualType()},t.prototype.killCurrentContextualType=function(){this.currentContextualTypeContext=null,this.errorReporter.pushToErrorSink=!1},t.prototype.hasTargetType=function(){return this.currentContextualTypeContext&&this.currentContextualTypeContext.contextualType},t.prototype.getTargetTypeContext=function(){return this.currentContextualTypeContext},t.prototype.inProvisionalTypecheckMode=function(){return this.typingContextStack.isProvisional()},t.prototype.getTypeCheckFinishedStatus=function(){return this.inProvisionalTypecheckMode()?this.typingContextStack.getContextID():n.TypeCheckStatus.Finished},t.prototype.typeStatusIsFinished=function(t){return t==n.TypeCheckStatus.Finished||this.inProvisionalTypecheckMode()&&t==this.typingContextStack.getContextID()},t.prototype.addStartedPTO=function(n){this.inProvisionalTypecheckMode()&&(this.provisionalStartedTypecheckObjects[this.provisionalStartedTypecheckObjects.length]=n)},t.prototype.cleanStartedPTO=function(){for(var t=0;t<this.provisionalStartedTypecheckObjects.length;t++)this.provisionalStartedTypecheckObjects[t].typeCheckStatus>=this.typingContextStack.getContextID()&&(this.provisionalStartedTypecheckObjects[t].typeCheckStatus=n.TypeCheckStatus.NotStarted);this.provisionalStartedTypecheckObjects=[]},t.prototype.collectTypes=function(t){var i,r,u;t.nodeType==n.NodeType.Script&&(i=t,this.locationInfo=i.locationInfo),r=new n.ScopeChain(this.gloMod,null,this.globalScope),u=new n.TypeCollectionContext(r,this),n.getAstWalkerFactory().walk(t,n.preCollectTypes,n.postCollectTypes,null,u)},t.prototype.makeArrayType=function(t){return t.arrayCache==null&&(t.arrayCache=new u,t.arrayCache.arrayType=new n.Type,t.arrayCache.arrayType.elementType=t,t.arrayCache.arrayType.symbol=t.symbol),t.arrayCache.arrayType},t.prototype.getParameterList=function(t,i){var s=t.arguments,h=null,c=null,l=s.members.length,a=0,e=[],f;if(l>0)for(h=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),c=new n.SymbolScopeBuilder(h,null,null,null,null,i),f=0;f<l;f++){var r=s.members[f],o=new n.ValueLocation,u=new n.ParameterSymbol(r.id.text,r.minChar,this.locationInfo.unitIndex,o);u.declAST=r,u.funcDecl=t,r.id.sym=u,r.sym=u,o.symbol=u,o.typeLink=n.getTypeLink(r.typeExpr,this,!1),c.enter(null,r,u,this.errorReporter,!0,!1,!1),e[e.length]=u,r.isOptionalArg()||a++}return{parameters:e,nonOptionalParameterCount:a}},t.prototype.createFunctionSignature=function(t,i,r,u,f){var d=n.hasFlag(t.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported)||i==this.gloMod,v=n.hasFlag(t.fncFlags,n.FncFlags.Static),y=n.hasFlag(t.fncFlags,n.FncFlags.Private),g=n.hasFlag(t.fncFlags,n.FncFlags.Definition),p=n.hasFlag(t.fncFlags,n.FncFlags.Ambient),b=t.isConstructMember()||t.isConstructor,nt=i==this.gloMod,h=new n.Signature,tt=t.fncFlags&n.FncFlags.IsFunctionExpression,w,l,e,o,s,a;t.returnTypeAnnotation||g?h.returnType=n.getTypeLink(t.returnTypeAnnotation,this,!1):(h.returnType=new n.TypeLink,h.returnType.type=this.anyType),h.hasVariableArgList=t.variableArgList,w=this.getParameterList(t,i),h.parameters=w.parameters,h.nonOptionalParameterCount=w.nonOptionalParameterCount,t.signature=h,h.declAST=t,l=u&&u.getType()&&!u.isAccessor()&&(t.isSignature()||p==n.hasFlag(u.flags,n.SymbolFlags.Ambient)),l&&y!=n.hasFlag(u.flags,n.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Public/Private visibility of overloads does not agree"),e=l?u.getType():new n.Type,b?(e.construct==null&&(e.construct=new n.SignatureGroup),e.construct.addSignature(h),e.construct.hasImplementation=!t.isSignature(),e.construct.hasImplementation&&e.setHasImplementation()):t.isIndexerMember()?(e.index==null&&(e.index=new n.SignatureGroup,e.index.flags|=n.SignatureFlags.IsIndexer),e.index.addSignature(h),e.index.hasImplementation=!t.isSignature(),e.index.hasImplementation&&e.setHasImplementation()):(e.call==null&&(e.call=new n.SignatureGroup),e.call.addSignature(h),e.call.hasImplementation=!t.isSignature(),e.call.hasImplementation&&e.setHasImplementation());var a=e.instanceType,c=null,k=!1;return t.name&&!t.name.isMissing()?c=t.name.text:t.hint&&(c=t.hint,k=!0),e.symbol==null&&(e.symbol=new n.TypeSymbol(c?c:this.anon,t.minChar,t.limChar-t.minChar,this.locationInfo.unitIndex,e),l||(e.symbol.declAST=t)),v&&(e.symbol.flags|=n.SymbolFlags.Static),p&&(e.symbol.flags|=n.SymbolFlags.Ambient),y&&(e.symbol.flags|=n.SymbolFlags.Private),e.symbol.isMethod=t.isMethod(),e.symbol.isMethod&&(e.symbol.flags|=n.SymbolFlags.Property),t.type=e,b||(!c||tt||t.isAccessor()||k?t.isSpecialFn()||(e.symbol.container=i):f?t.isMethod()&&v?(i.type.members.publicMembers.add(c,e.symbol)||this.errorReporter.duplicateIdentifier(t,c),e.symbol.container=i):(u==null||u.declAST&&!u.declAST.isOverload&&i.isType())&&r.enter(i,t,e.symbol,this.errorReporter,!y&&(d||v||nt),!1,p):t.isSpecialFn()||(e.symbol.container=i)),l&&(o=u?u.getType():null,s=e,s!=o&&(s.construct==null?s.construct=o&&o.construct?o.construct:new n.SignatureGroup:o&&o.construct&&s.construct.signatures.concat(o.construct.signatures),o&&(s.call==null?s.call=o.call:o.call&&s.call.signatures.concat(o.call.signatures),v||(s.instanceType==null&&(s.instanceType=o.instanceType),a=s.instanceType,a&&(a.call==null?a.call=o.call:o.call&&a.call.signatures.concat(o.call.signatures))),s.index==null?s.index=o.index:o.index&&s.index.signatures.concat(o.index.signatures)))),h},t.prototype.createAccessorSymbol=function(t,i,r,u,f,e,o){var s=null,l=t.signature,a=t.name.text,v=n.hasFlag(t.fncFlags,n.FncFlags.Static),c=n.hasFlag(t.fncFlags,n.FncFlags.Private),h;return i==null?(h=new n.ValueLocation,s=new n.FieldSymbol(a,t.minChar,this.locationInfo.unitIndex,!1,h),h.symbol=s,s.declAST=t,n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?(s.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),s.getter=l.declAST.type.symbol):(s.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),s.setter=l.declAST.type.symbol),h.typeLink=n.getTypeLink(null,this,!1),u?r?(r.members.publicMembers.add(a,s)||this.errorReporter.duplicateIdentifier(t,s.name),s.container=r.symbol):this.errorReporter.simpleError(t,"Accessor property may not be added in this context"):e.enter(o,t,s,this.errorReporter,!c||v,!1,!1),f&&(s.flags|=n.SymbolFlags.Property),v&&(s.flags|=n.SymbolFlags.Static),s.flags|=c?n.SymbolFlags.Private:n.SymbolFlags.Public):(s=i,c!=n.hasFlag(s.flags,n.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Getter and setter accessors do not agree in visibility"),n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?(s.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),s.getter=t.type.symbol):(s.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),s.setter=t.type.symbol)),s},t.prototype.addBases=function(t,i,r){var f,u,e;if(t.addParentScope(new n.SymbolTableScope(i.members,i.ambientMembers,i.getAllEnclosedTypes(),i.getAllAmbientEnclosedTypes(),i.symbol)),f=0,i.extendsList)for(e=i.extendsList.length;f<e;f++){if(u=i.extendsList[f],r.baseId==u.typeID){this.errorReporter.reportErrorFromSym(u.symbol,"Type '"+r.base+"' is recursively referenced as a base class of itself"),u.symbol.flags|=n.SymbolFlags.RecursivelyReferenced;break}this.addBases(t,u,r)}},t.prototype.scopeOf=function(t){var i=new n.SymbolAggregateScope(t.symbol),r={base:t.symbol&&t.symbol.name?t.symbol.name:"{}",baseId:t.typeID};return this.addBases(i,t,r),i},t.prototype.lookupMemberTypeSymbol=function(n,t){var i=null,r,u;return n.containedScope?i=n.containedScope.find(t,!1,!0):n.members&&(i=n.members.allMembers.lookup(t),i==null&&n.ambientMembers&&(i=n.ambientMembers.allMembers.lookup(t))),i==null&&(r=n.getAllEnclosedTypes(),u=n.getAllAmbientEnclosedTypes(),r&&(i=r.allMembers.lookup(t),i==null&&u&&(i=u.allMembers.lookup(t)))),i&&i.isType()?i:null},t.prototype.findSymbolForDynamicModule=function(t,i,r){var e=t,u=r(t),o,f;if(u==null&&(u||(t=n.swapQuotes(e),u=r(t)),u||(t=n.stripQuotes(e)+".ts",u=r(t)),u||(t=n.stripQuotes(e)+".str",u=r(t)),u||(t=n.stripQuotes(e)+".d.ts",u=r(t)),u||(t=n.stripQuotes(e)+".d.str",u=r(t)),!u&&!n.isRelative(e)))for(t=e,o=n.stripQuotes(t),f=n.getRootFilePath(n.switchToForwardSlashes(i));u==null&&f!="";)t=n.normalizePath(f+o+".ts"),u=r(t),u==null&&(t=n.changePathToSTR(t),u=r(t)),u==null&&(t=n.changePathToDTS(t),u=r(t)),u==null&&(t=n.changePathToDSTR(t),u=r(t)),u==null&&(f==="/"?f="":(f=n.normalizePath(f+".."),f=f&&f!="/"?f+"/":f));return u},t.prototype.resolveTypeMember=function(t,i){var f=i.operand1,h=i.operand2,e=this.anyType,o=this.anyType,s,r,u,p,l,a,v,y,c;return f&&h&&h.nodeType==n.NodeType.Name&&(f.nodeType==n.NodeType.Dot?o=this.resolveTypeMember(t,f):f.nodeType==n.NodeType.Name&&(s=f,r=t.find(s.text,!1,!0),r==null?this.errorReporter.unresolvedSymbol(s,s.actualText):r.isType()?(u=r,u.aliasLink&&!u.type&&u.aliasLink.alias.nodeType==n.NodeType.Name&&(p=u.aliasLink.alias.text,l=this.findSymbolForDynamicModule(p,this.locationInfo.filename,function(n){return t.find(n,!1,!0)}),l&&(u.type=l.getType())),n.optimizeModuleCodeGen&&r&&(a=r.getType(),a&&u.aliasLink&&u.onlyReferencedAsTypeRef&&(v=a.symbol.declAST,v&&n.hasFlag(v.modFlags,n.ModuleFlags.IsDynamic)&&(u.onlyReferencedAsTypeRef=!this.resolvingBases))),r.visible(t,this)||this.errorReporter.simpleError(f,"The symbol '"+s.actualText+"' is not visible at this point"),o=r.getType(),s.sym=r):this.errorReporter.simpleError(f,"Expected type")),o||(o=this.anyType),o!=this.anyType&&(y=h,c=this.lookupMemberTypeSymbol(o,y.text),c==null?(e=this.anyType,this.errorReporter.simpleError(i,"Expected type")):(e=c.getType(),c.visible(t,this)||this.errorReporter.simpleError(f,"The symbol '"+h.actualText+"' is not visible at this point")),y.sym=e.symbol)),e.isClass()&&(e=e.instanceType),e},t.prototype.resolveFuncDecl=function(n,t,i){var e=this.createFunctionSignature(n,t.container,t,i,!1).declAST.type.symbol,f,r,u,o,s;for(f=n.isConstructMember()?e.type.construct.signatures:n.isIndexerMember()?e.type.getInstanceType().index.signatures:e.type.call.signatures,r=f[f.length-1],u=r.parameters.length,o=0;o<u;o++)s=r.parameters[o],this.resolveTypeLink(t,s.parameter.typeLink,!0);return u&&n.variableArgList&&(r.parameters[u-1].parameter.typeLink.type.elementType||(this.errorReporter.simpleErrorFromSym(r.parameters[u-1].parameter.symbol,"... parameter must have array type"),r.parameters[u-1].parameter.typeLink.type=this.makeArrayType(r.parameters[u-1].parameter.typeLink.type))),this.resolveTypeLink(t,r.returnType,n.isSignature()),e},t.prototype.resolveVarDecl=function(t,i){var r=new n.ValueLocation,u=new n.FieldSymbol(t.id.text,t.minChar,this.locationInfo.unitIndex,(t.varFlags&n.VarFlags.Readonly)==n.VarFlags.None,r);return u.transferVarFlags(t.varFlags),r.symbol=u,u.declAST=t,r.typeLink=n.getTypeLink(t.typeExpr,this,t.init==null),this.resolveTypeLink(i,r.typeLink,!0),t.sym=u,t.type=r.typeLink.type,u},t.prototype.resolveTypeLink=function(t,i,r){var b=0,u,s,h,p,a,o,g,w;if(i.type==null){if(u=i.ast,u)while(i.type==null)switch(u.nodeType){case n.NodeType.Name:s=u,h=t.find(s.text,!1,!0),h==null?(i.type=this.anyType,this.errorReporter.unresolvedSymbol(s,s.actualText)):h.isType()?(h.visible(t,this)||this.errorReporter.simpleError(u,"The symbol '"+s.actualText+"' is not visible at this point"),s.sym=h,i.type=h.getType(),i.type?i.type.isClass()&&(i.type=i.type.instanceType):i.type=this.anyType):(i.type=this.anyType,this.errorReporter.simpleError(u,"Expected type"));break;case n.NodeType.Dot:i.type=this.resolveTypeMember(t,u);break;case n.NodeType.TypeRef:p=u,b=p.arrayCount,u=p.term,u==null&&(i.type=this.anyType);break;case n.NodeType.InterfaceDeclaration:var k=u,f=new n.Type,l=new n.TypeSymbol(k.name.text,u.minChar,u.limChar-u.minChar,this.locationInfo.unitIndex,f);f.symbol=l,f.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.containedScope=new n.SymbolTableScope(f.members,null,null,null,l),f.containedScope.container=l,f.memberScope=f.containedScope;var nt=k.members,d=nt.members,tt=d.length;for(a=0;a<tt;a++){var v=d[a],e=null,y=!0,c=null;v.nodeType==n.NodeType.FuncDecl?(o=v,c=o.name,e=f.members.allMembers.lookup(o.getNameText()),y=e==null,o.isSpecialFn()?(y=!1,e=this.resolveFuncDecl(o,t,l)):e=this.resolveFuncDecl(o,t,e),o.type=e.type):(c=v.id,e=this.resolveVarDecl(v,t),y=!c.isMissing()),y&&(c&&n.hasFlag(c.flags,n.ASTFlags.OptionalName)&&(e.flags|=n.SymbolFlags.Optional),f.members.allMembers.add(e.name,e)||this.errorReporter.duplicateIdentifier(u,e.name))}u.type=f,i.type=f;break;case n.NodeType.FuncDecl:g=this.resolveFuncDecl(u,t,null),i.type=g.type;break;default:i.type=this.anyType,this.errorReporter.simpleError(u,"Expected type")}for(w=b;w>0;w--)i.type=this.makeArrayType(i.type);r&&i.type==null&&(i.type=this.anyType),i.ast&&(i.ast.type=i.type)}},t.prototype.resolveBaseTypeLink=function(n,t){this.resolvingBases=!0,this.resolveTypeLink(t,n,!0),this.resolvingBases=!1;var i=null;return i=n.type.isClass()?n.type.instanceType:n.type},t.prototype.findMostApplicableSignature=function(n,t){var o,u,c,l;if(n.length==1)return{sig:n[0].signature,ambiguous:!1};var i=n[0],r=null,s=null,f=null,e=null,h=!1;for(o=1;o<n.length;o++){for(r=n[o],u=0,u=0;t&&u<t.members.length;u++)if(s=t.members[u].type,f=u<i.signature.parameters.length?i.signature.parameters[u].getType():i.signature.parameters[i.signature.parameters.length-1].getType().elementType,e=u<r.signature.parameters.length?r.signature.parameters[u].getType():r.signature.parameters[r.signature.parameters.length-1].getType().elementType,this.typesAreIdentical(f,e))continue;else if(this.typesAreIdentical(s,f))break;else if(this.typesAreIdentical(s,e)){i=r;break}else if(this.sourceIsSubtypeOfTarget(f,e))break;else if(this.sourceIsSubtypeOfTarget(e,f)){i=r;break}else if(r.hadProvisionalErrors)break;else if(i.hadProvisionalErrors){i=r;break}t&&u!=t.members.length?h=!1:(c={getLength:function(){return 2},setTypeAtIndex:function(){},getTypeAtIndex:function(n){return n?r.signature.returnType.type:i.signature.returnType.type}},l=this.findBestCommonType(i.signature.returnType.type,null,c,!0),h=!l)}return{sig:i.signature,ambiguous:h}},t.prototype.getApplicableSignatures=function(t,i,r){for(var h=[],f=null,o=!1,c=null,s=!1,u,e=0;e<t.length;e++){for(o=!1,u=0;u<i.members.length;u++)if(!(u>=t[e].parameters.length))if(f=t[e].parameters[u].getType(),t[e].declAST.variableArgList&&u>=t[e].nonOptionalParameterCount-1&&f.isArray()&&(f=f.elementType),f==this.anyType)continue;else if(i.members[u].nodeType==n.NodeType.FuncDecl){if(this.typeFlow.functionInterfaceType&&f==this.typeFlow.functionInterfaceType)continue;if(this.canContextuallyTypeFunction(f,i.members[u],!0)){if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),s=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(i.members[u].type,f,r)||(r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'"),o=!0),this.resetProvisionalErrors(),o)break}else if(this.canContextuallyTypeFunction(f,i.members[u],!1)){if(this.typeFlow.typeCheck(i.members[u]),!this.sourceIsAssignableToTarget(i.members[u].type,f,r))break}else break}else if(i.members[u].nodeType==n.NodeType.ObjectLit){if(this.typeFlow.objectInterfaceType&&f==this.typeFlow.objectInterfaceType)continue;if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),s=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(i.members[u].type,f,r)||(r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'"),o=!0),this.resetProvisionalErrors(),o)break}else if(i.members[u].nodeType==n.NodeType.ArrayLit){if(this.typeFlow.arrayInterfaceType&&f==this.typeFlow.arrayInterfaceType)continue;if(this.typeCheckWithContextualType(f,!0,!0,i.members[u]),this.cleanStartedPTO(),s=this.hadProvisionalErrors(),!this.sourceIsAssignableToTarget(i.members[u].type,f,r)){r&&r.setMessage("Could not apply type '"+f.getTypeName()+"' to argument "+(u+1)+", which is of type '"+i.members[u].type.getTypeName()+"'");break}if(this.resetProvisionalErrors(),o)break}u==i.members.length&&(h[h.length]={signature:t[e],hadProvisionalErrors:s}),s=!1}return h},t.prototype.canContextuallyTypeFunction=function(n,t,i){var u,e,r,f;if(t.isParenthesized||t.isMethod()||i&&t.returnTypeAnnotation||t.isInlineCallLiteral)return!1;if(i=i||this.typeFlow.functionInterfaceType==n,!i)return!0;for(t.signature||(this.createFunctionSignature(t,this.typeFlow.scope.container,this.typeFlow.scope,null,null),this.typeFlow.typeCheck(t)),u=t.signature,e=u.parameters.length,r=0;r<e;r++){var o=u.parameters[r],s=o,h=s.declAST;if(i&&h.typeExpr)return!1}return n.construct&&n.call?!1:(f=n.construct?n.construct:n.call,!f||f.signatures.length>1)?!1:!0},t.prototype.canContextuallyTypeObjectLiteral=function(t,i){var f,s,o,r,l,a;if(t==this.typeFlow.objectInterfaceType)return!0;if(f=i.operand,!(f&&t.memberScope))return!1;var u=null,h=null,e="",c={};for(r=0;r<f.members.length;r++){if(u=f.members[r].operand1,u.nodeType==n.NodeType.Name)e=u.text;else if(u.nodeType==n.NodeType.QString)s=u.text,e=s.substring(1,s.length-1);else return!1;if(h=t.memberScope.find(e,!0,!1),!h)return!1;c[e]=!0}for(o=t.memberScope.getAllValueSymbolNames(!0),r=0;r<o.length;r++)if(l=o[r],a=t.memberScope.find(l,!0,!1),!c[o[r]]&&!n.hasFlag(a.flags,n.SymbolFlags.Optional))return!1;return!0},t.prototype.widenType=function(n){return n==this.undefinedType||n==this.nullType?this.anyType:n},t.prototype.isNullOrUndefinedType=function(n){return n==this.undefinedType||n==this.nullType},t.prototype.findBestCommonType=function(n,t,i,r,u){var e=0,h=i.getLength(),s=0,f=n,o;for(t&&(f=f?f.mergeOrdered(t,this,r):t),o=f;s<h;){for(e=0;e<h;e++)if(e!=s)if(o&&(f=o.mergeOrdered(i.getTypeAtIndex(e),this,r,u))&&(o=f),f==this.anyType||f==null)break;else t&&i.setTypeAtIndex(e,t);if(o&&f)break;s++,s<h&&(o=i.getTypeAtIndex(s))}return r?f:f==this.voidType?null:f},t.prototype.typesAreIdentical=function(t,i){var r,h,f,e,u;if(t==i)return!0;if(!t||!i||t.isClass()||t.isClassInstance())return!1;if(r=i.typeID<<16|t.typeID,this.identicalCache[r])return!0;if(t.typeFlags&n.TypeFlags.IsEnum||i.typeFlags&n.TypeFlags.IsEnum)return!1;if(t.isArray()||i.isArray())return t.isArray()&&i.isArray()?(this.identicalCache[r]=!1,h=this.typesAreIdentical(t.elementType,i.elementType),this.subtypeCache[r]=h?!0:undefined,h):!1;if(t.primitiveTypeClass!=i.primitiveTypeClass)return!1;if(this.identicalCache[r]=!1,t.memberScope&&i.memberScope){if(f=t.memberScope.getAllValueSymbolNames(!0).sort(),e=i.memberScope.getAllValueSymbolNames(!0).sort(),f.length!=e.length)return this.identicalCache[r]=undefined,!1;var c=null,l=null,o=null,s=null;for(u=0;u<f.length;u++){if(f[u]!=e[u]||(c=t.memberScope.find(f[u],!1,!1),l=i.memberScope.find(e[u],!1,!1),(c.flags&n.SymbolFlags.Optional)!=(l.flags&n.SymbolFlags.Optional)))return this.identicalCache[r]=undefined,!1;if((o=c.getType(),s=l.getType(),!o||!s||this.identicalCache[s.typeID<<16|o.typeID]==undefined)&&!this.typesAreIdentical(o,s))return this.identicalCache[r]=undefined,!1}}else if(t.memberScope||i.memberScope)return this.identicalCache[r]=undefined,!1;return this.signatureGroupsAreIdentical(t.call,i.call)?this.signatureGroupsAreIdentical(t.construct,i.construct)?this.signatureGroupsAreIdentical(t.index,i.index)?(this.identicalCache[r]=!0,!0):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1)},t.prototype.signatureGroupsAreIdentical=function(n,t){var i,r;if(n==t)return!0;if(!n||!t||n.signatures.length!=t.signatures.length)return!1;var f=null,e=null,u=!1;for(i=0;i<n.signatures.length;i++){for(f=n.signatures[i],r=0;r<t.signatures.length;r++)if(e=t.signatures[r],this.signaturesAreIdentical(f,e)){u=!0;break}if(u){u=!1;continue}return!1}return!0},t.prototype.signaturesAreIdentical=function(n,t){if(n.hasVariableArgList!=t.hasVariableArgList||n.nonOptionalParameterCount!=t.nonOptionalParameterCount||n.parameters.length!=t.parameters.length||!this.typesAreIdentical(n.returnType.type,t.returnType.type))return!1;for(var i=0;i<n.parameters.length;i++)if(!this.typesAreIdentical(n.parameters[i].parameter.typeLink.type,t.parameters[i].parameter.typeLink.type))return!1;return!0},t.prototype.sourceIsSubtypeOfTarget=function(n,t,i){return this.sourceIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.signatureGroupIsSubtypeOfTarget=function(n,t,i){return this.signatureGroupIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.signatureIsSubtypeOfTarget=function(n,t,i){return this.signatureIsRelatableToTarget(n,t,!1,this.subtypeCache,i)},t.prototype.sourceIsAssignableToTarget=function(n,t,i){return this.sourceIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.signatureGroupIsAssignableToTarget=function(n,t,i){return this.signatureGroupIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.signatureIsAssignableToTarget=function(n,t,i){return this.signatureIsRelatableToTarget(n,t,!0,this.assignableCache,i)},t.prototype.sourceIsRelatableToTarget=function(t,i,r,u,f){var e,w,h,y,p,b,k;if(t==i||!(t&&i)||(e=t.typeID<<16|i.typeID,u[e]!=undefined))return!0;if(r){if(t==this.anyType||i==this.anyType)return!0}else if(i==this.anyType)return!0;if(t==this.undefinedType||t==this.nullType&&i!=this.undefinedType&&i!=this.voidType||i==this.numberType&&t.typeFlags&n.TypeFlags.IsEnum||t==this.numberType&&i.typeFlags&n.TypeFlags.IsEnum)return!0;if(t.typeFlags&n.TypeFlags.IsEnum||i.typeFlags&n.TypeFlags.IsEnum)return!1;if(t.isArray()||i.isArray())return t.isArray()&&i.isArray()?(u[e]=!1,w=this.sourceIsRelatableToTarget(t.elementType,i.elementType,r,u,f),u[e]=w?!0:undefined,w):!1;if(t.primitiveTypeClass!=i.primitiveTypeClass)if(i.primitiveTypeClass==n.Primitive.None)if(t==this.numberType&&this.typeFlow.numberInterfaceType)t=this.typeFlow.numberInterfaceType;else if(t==this.stringType&&this.typeFlow.stringInterfaceType)t=this.typeFlow.stringInterfaceType;else if(t==this.booleanType&&this.typeFlow.booleanInterfaceType)t=this.typeFlow.booleanInterfaceType;else return!1;else return!1;if(u[e]=!1,t.hasBase(i))return u[e]=!0,!0;if(this.typeFlow.objectInterfaceType&&i==this.typeFlow.objectInterfaceType||this.typeFlow.functionInterfaceType&&(t.call||t.construct)&&i==this.typeFlow.functionInterfaceType)return!0;if(i.isClass()||i.isClassInstance())return u[e]=undefined,!1;if(i.memberScope&&t.memberScope){var c=i.memberScope.getAllValueSymbolNames(!0),o=null,s=null,l=null,a=null,v=null;for(h=0;h<c.length;h++)if(o=i.memberScope.find(c[h],!1,!1),s=t.memberScope.find(c[h],!1,!1),o.name!="arguments"||!this.typeFlow.iargumentsInterfaceType||!(this.typeFlow.iargumentsInterfaceType.symbol.flags&n.SymbolFlags.CompilerGenerated)||o.kind()!=n.SymbolKind.Variable||o.variable.typeLink.type!=this.typeFlow.iargumentsInterfaceType){if(o.isInferenceSymbol()&&(v=o,v.typeCheckStatus==n.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(o.declAST)),l=o.getType(),!s&&(this.typeFlow.objectInterfaceType&&(s=this.typeFlow.objectInterfaceType.memberScope.find(c[h],!1,!1)),!s&&(this.typeFlow.functionInterfaceType&&(l.call||l.construct)&&(s=this.typeFlow.functionInterfaceType.memberScope.find(c[h],!1,!1)),!s)))if(o.flags&n.SymbolFlags.Optional)continue;else return u[e]=undefined,f&&(f.flags|=n.TypeRelationshipFlags.RequiredPropertyIsMissing,f.addMessageToFront("Type '"+t.getTypeName()+"' is missing property '"+c[h]+"' from type '"+i.getTypeName()+"'")),!1;if((s.isInferenceSymbol()&&(v=s,v.typeCheckStatus==n.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(s.declAST)),a=s.getType(),!l||!a||u[a.typeID<<16|l.typeID]==undefined)&&!this.sourceIsRelatableToTarget(a,l,r,u,f))return u[e]=undefined,f&&(f.flags|=n.TypeRelationshipFlags.IncompatiblePropertyTypes,f.addMessageToFront("Types of property '"+o.name+"' of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible")),!1}}return(t.call||i.call)&&!this.signatureGroupIsRelatableToTarget(t.call,i.call,r,u,f)?(f&&(t.call&&i.call?f.addMessageToFront("Call signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"):(y=i.call?i.getTypeName():t.getTypeName(),p=i.call?t.getTypeName():i.getTypeName(),f.setMessage("Type '"+y+"' requires a call signature, but Type '"+p+"' lacks one")),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):(t.construct||i.construct)&&!this.signatureGroupIsRelatableToTarget(t.construct,i.construct,r,u,f)?(f&&(t.construct&&i.construct?f.addMessageToFront("Construct signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"):(y=i.construct?i.getTypeName():t.getTypeName(),p=i.construct?t.getTypeName():i.getTypeName(),f.setMessage("Type '"+y+"' requires a construct signature, but Type '"+p+"' lacks one")),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):i.index&&(b=!i.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:i.index,k=!t.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:t.index,!this.signatureGroupIsRelatableToTarget(k,b,r,u,f))?(f&&(f.addMessageToFront("Index signatures of types '"+t.getTypeName()+"' and '"+i.getTypeName()+"' are incompatible"),f.flags|=n.TypeRelationshipFlags.IncompatibleSignatures),u[e]=undefined,!1):(u[e]=!0,!0)},t.prototype.signatureGroupIsRelatableToTarget=function(n,t,i,r,u){var f,e;if(n==t)return!0;if(!(n&&t))return!1;var s=null,h=null,o=!1;for(f=0;f<t.signatures.length;f++){for(s=t.signatures[f],e=0;e<n.signatures.length;e++)if(h=n.signatures[e],this.signatureIsRelatableToTarget(h,s,i,r,u)){o=!0;break}if(o){o=!1;continue}return!1}return!0},t.prototype.signatureIsRelatableToTarget=function(t,i,r,u,f){var s,l,v,a,e,o;if(!t.parameters||!i.parameters)return!1;if(s=i.hasVariableArgList?i.nonOptionalParameterCount-1:i.nonOptionalParameterCount,l=t.hasVariableArgList?t.nonOptionalParameterCount-1:t.nonOptionalParameterCount,l>s&&!i.hasVariableArgList)return f&&(f.flags|=n.TypeRelationshipFlags.SourceSignatureHasTooManyParameters,f.addMessageToFront("Call signature expects "+s+" or fewer parameters")),!1;if(v=t.returnType.type,a=i.returnType.type,a!=this.voidType&&!this.sourceIsRelatableToTarget(v,a,r,u,f))return f&&(f.flags|=n.TypeRelationshipFlags.IncompatibleReturnTypes),!1;var w=l<s&&t.hasVariableArgList?s:l,h=null,c=null,y="",p="";for(e=0,o=0;e<w;e++,o++)if(!t.hasVariableArgList||e<l?(h=t.parameters[e].parameter.typeLink.type,y=t.parameters[e].parameter.symbol.name):e==l&&(h=t.parameters[e].parameter.typeLink.type,h.elementType&&(h=h.elementType),y=t.parameters[e].parameter.symbol.name),o<i.parameters.length&&o<s?(c=i.parameters[o].parameter.typeLink.type,p=i.parameters[o].parameter.symbol.name):i.hasVariableArgList&&o==s&&(c=i.parameters[o].parameter.typeLink.type,c.elementType&&(c=c.elementType),p=i.parameters[o].parameter.symbol.name),!(this.sourceIsRelatableToTarget(h,c,r,u,f)||this.sourceIsRelatableToTarget(c,h,r,u,f)))return f&&(f.flags|=n.TypeRelationshipFlags.IncompatibleParameterTypes),!1;return!0},t}(),n.TypeChecker=o}(TypeScript||(TypeScript={})),function(n){function r(t,i){var u,r;if(t)for(u=t.members.length,i==null&&(i=[]),r=0;r<u;r++){var e=t.members[r],o=e,f=new n.TypeLink;f.ast=o,i[i.length]=f}return i}function u(n,t){n.extendsTypeLinks=r(t.extendsList,n.extendsTypeLinks),n.implementsTypeLinks=r(t.implementsList,n.implementsTypeLinks)}function y(t,i,r){var u=new n.ValueLocation,f;u.typeLink=new n.TypeLink,u.typeLink.ast=i,u.typeLink.type=t.instanceType,f=new n.FieldSymbol("prototype",i.minChar,r.checker.locationInfo.unitIndex,!0,u),f.flags|=n.SymbolFlags.Property|n.SymbolFlags.BuiltIn,u.symbol=f,f.declAST=i,t.members.addPublicMember("prototype",f)}function t(t){var i=new n.Signature;i.returnType=new n.TypeLink,i.returnType.type=t.instanceType,i.parameters=[],t.construct=new n.SignatureGroup,t.construct.addSignature(i)}function p(i,r){var u,f;for(i.construct=new n.SignatureGroup,u=null,r.construct||t(r),f=0;f<r.construct.signatures.length;f++)u=new n.Signature,u.parameters=r.construct.signatures[f].parameters,u.nonOptionalParameterCount=r.construct.signatures[f].nonOptionalParameterCount,u.typeCheckStatus=r.construct.signatures[f].typeCheckStatus,u.declAST=r.construct.signatures[f].declAST,u.returnType=new n.TypeLink,u.returnType.type=i.instanceType,i.construct.addSignature(u)}function f(n,t){var i=t.scope.find(n,!1,!0);return i==null&&t.previous&&(i=f(n,t.previous)),i}function i(t,r){var u=null,o,s,h,c;switch(t.nodeType){case n.NodeType.Name:var e=t.text,a=n.isQuoted(e),l=function(){return r.members?r.members.lookup(e):f(e,r.topLevelScope)};u=a?r.tcContext.checker.findSymbolForDynamicModule(e,r.tcContext.script.locationInfo.filename,l):l(e);break;case n.NodeType.Dot:o=t,s=i(o.operand1,r),s&&s.getType()&&(u=i(o.operand2,r))}return u&&(h=u.getType(),h&&(c=h.members,c&&(r.members=c.publicMembers))),u}function e(t,r,u){var o=u.scopeChain,f=null,h=null,e=t,c=i(e.alias,{topLevelScope:o,members:null,tcContext:u}),l=u.scopeChain.container==u.checker.gloMod,s;return c&&(s=c.getType(),s&&(h=s)),f=new n.TypeSymbol(e.id.text,e.id.minChar,e.limChar-e.minChar,u.checker.locationInfo.unitIndex,h),f.aliasLink=e,u.scopeChain.moduleDecl&&(f.flags|=n.SymbolFlags.ModuleMember,f.declModule=u.scopeChain.moduleDecl),f.declAST=e,e.id.sym=f,o.scope.enter(o.container,t,f,u.checker.errorReporter,l,!0,!1),o.scope.enter(o.container,t,f,u.checker.errorReporter,l,!1,!1),!0}function o(t,i,r){var s=r.scopeChain,e=t,v=n.hasFlag(e.modFlags,n.ModuleFlags.Ambient),y=n.hasFlag(e.modFlags,n.ModuleFlags.IsEnum),p=r.scopeChain.container==r.checker.gloMod,c=n.hasFlag(e.modFlags,n.ModuleFlags.Exported),h=e.name.text,ft=n.isQuoted(h),o=s.scope.findLocal(h,!1,!1),u=null,f=null,l,a;if(o==null||o.kind()!=n.SymbolKind.Type)f==null&&(l=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),a=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f=new n.ModuleType(l,a),y&&(f.typeFlags|=n.TypeFlags.IsEnum),f.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.setHasImplementation()),u=new n.TypeSymbol(h,e.name.minChar,h.length,r.checker.locationInfo.unitIndex,f),u.isDynamic=n.isQuoted(e.prettyName),r.scopeChain.moduleDecl&&(u.declModule=r.scopeChain.moduleDecl),u.declAST=e,u.prettyName=e.prettyName,s.scope.enter(s.container,t,u,r.checker.errorReporter,c||p,!0,v),s.scope.enter(s.container,t,u,r.checker.errorReporter,c||p,!1,v),f.symbol=u;else{o&&o.declAST&&o.declAST.nodeType!=n.NodeType.ModuleDeclaration&&r.checker.errorReporter.simpleError(e,"Conflicting symbol name for module '"+h+"'"),u=o;var w=u.type.getAllEnclosedTypes().publicMembers,g=w==null?new n.StringHashTable:w,l=new n.ScopedMembers(new n.DualStringHashTable(g,new n.StringHashTable)),b=u.type.getAllAmbientEnclosedTypes().publicMembers,nt=b==null?new n.StringHashTable:b,a=new n.ScopedMembers(new n.DualStringHashTable(nt,new n.StringHashTable)),k=u.type.members.publicMembers,tt=k==null?new n.StringHashTable:k,it=new n.ScopedMembers(new n.DualStringHashTable(tt,new n.StringHashTable)),d=u.type.ambientMembers.publicMembers,rt=d==null?new n.StringHashTable:d,ut=new n.ScopedMembers(new n.DualStringHashTable(rt,new n.StringHashTable));f=new n.ModuleType(l,a),y&&(f.typeFlags|=n.TypeFlags.IsEnum),f.members=it,f.ambientMembers=ut,f.setHasImplementation(),f.symbol=u,u.addLocation(e.minChar),u.expansions.push(f),u.expansionsDeclAST.push(e)}return r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface(),c&&(u.flags|=n.SymbolFlags.Exported),(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)&&(u.flags|=n.SymbolFlags.ModuleMember),e.mod=f,n.pushTypeCollectionScope(u,f.members,f.ambientMembers,f.enclosedTypes,f.ambientEnclosedTypes,r,null,null,e),!0}function s(i,r,f){var p=f.scopeChain,h=i,o,s,e=null,l=h.name.text,d=!1,a=n.hasFlag(h.varFlags,n.VarFlags.Ambient),v=n.hasFlag(h.varFlags,n.VarFlags.Exported),w=f.scopeChain.container==f.checker.gloMod,g=p.container,b=!1,c,k;return e=p.scope.findLocal(l,!1,!0),e||(c=p.scope.findLocal(l,!1,!1),c&&c.isType()&&c.declAST&&c.declAST.nodeType==n.NodeType.FuncDecl&&c.declAST.isSignature()&&(e=c,b=!0,v&&(e.flags|=n.SymbolFlags.Exported),a&&(e.flags|=n.SymbolFlags.Ambient),f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,v||w,!0,a))),e&&!b&&e.declAST!=h&&(e=null),e==null?(k=p.scope.findLocal(l,!1,!1),o=new n.Type,o.setHasImplementation(),s=new n.Type,s.setHasImplementation(),o.instanceType=s,o.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),y(o,h,f),s.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),s.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),e=new n.TypeSymbol(l,h.name.minChar,l.length,f.checker.locationInfo.unitIndex,o),e.declAST=h,e.instanceType=s,o.symbol=e,s.symbol=e,f.scopeChain.moduleDecl&&(f.scopeChain.moduleDecl.recordNonInterface(),e.declModule=f.scopeChain.moduleDecl,e.flags|=n.SymbolFlags.ModuleMember),v&&(e.flags|=n.SymbolFlags.Exported),a&&(e.flags|=n.SymbolFlags.Ambient),i.type=o,f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,v||w,!0,a),k==null&&f.scopeChain.scope.enter(f.scopeChain.container,i,e,f.checker.errorReporter,v||w,!1,a)):(o=e.type,o.instanceType==null&&(o.instanceType=new n.Type,o.instanceType.setHasImplementation(),o.instanceType.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.instanceType.symbol=o.symbol,o.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),o.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable))),s=o.instanceType,i.type=o),h.constructorDecl||(e&&e.declAST&&e.declAST.type&&e.declAST.type.call&&!e.declAST.isOverload&&f.checker.errorReporter.duplicateIdentifier(e.declAST,e.name),t(h.type)),o.typeFlags|=n.TypeFlags.IsClass,s.typeFlags|=n.TypeFlags.IsClass,u(s,h),n.pushTypeCollectionScope(e,s.members,s.ambientMembers,null,null,f,s,o,null),!0}function h(t,i,r){var l=r.scopeChain,o=t,e=null,f=null,c=n.hasFlag(o.varFlags,n.VarFlags.Exported),a=r.scopeChain.container==r.checker.gloMod,h=!0,s;return h=!1,s=o.name.text,e=l.scope.findLocal(s,!1,!0),e==null?(f=new n.Type,e=new n.TypeSymbol(s,o.name.minChar,s.length,r.checker.locationInfo.unitIndex,f),f.symbol=e,f.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),f.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),e.declAST=o,e.declModule=r.scopeChain.moduleDecl):(h=!0,f=e.type),f||(f=r.checker.anyType),t.type=f,u(f,o),c&&(e.flags|=n.SymbolFlags.Exported),r.scopeChain.moduleDecl&&(e.flags|=n.SymbolFlags.ModuleMember),h||r.scopeChain.scope.enter(r.scopeChain.container,t,e,r.checker.errorReporter,a||c,!0,!1),n.pushTypeCollectionScope(e,f.members,f.ambientMembers,null,null,r,f,null,null),!0}function c(t,i,r){var s=r.scopeChain,u=t;if(n.hasFlag(u.varFlags,n.VarFlags.Public|n.VarFlags.Private)){var e=new n.ValueLocation,o=n.hasFlag(u.varFlags,n.VarFlags.Private),f=new n.FieldSymbol(u.id.text,u.id.minChar,r.checker.locationInfo.unitIndex,!n.hasFlag(u.varFlags,n.VarFlags.Readonly),e);f.transferVarFlags(u.varFlags),e.symbol=f,f.declAST=t,u.parameterPropertySym=f,r.scopeChain.scope.enter(r.scopeChain.container,t,f,r.checker.errorReporter,!o,!1,!1),e.typeLink=n.getTypeLink(u.typeExpr,r.checker,u.init==null),u.sym=f}return!1}function l(t,i,r){var a=r.scopeChain,u=t,s=n.hasFlag(u.varFlags,n.VarFlags.Ambient),h=n.hasFlag(u.varFlags,n.VarFlags.Exported),v=r.scopeChain.container==r.checker.gloMod,c=n.hasFlag(u.varFlags,n.VarFlags.Property),l=n.hasFlag(u.varFlags,n.VarFlags.Static),y=n.hasFlag(u.varFlags,n.VarFlags.Private),p=n.hasFlag(u.id.flags,n.ASTFlags.OptionalName),o,e,f;if(r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface(),c||h||r.scopeChain.container==r.checker.gloMod||r.scopeChain.moduleDecl){if(s&&(o=a.scope.findLocal(u.id.text,!1,!1),o))return u.sym=o,!1;if(u.id==null)return r.checker.errorReporter.simpleError(u,"Expected variable identifier at this location"),!1;e=new n.ValueLocation,f=new n.FieldSymbol(u.id.text,u.id.minChar,r.checker.locationInfo.unitIndex,(u.varFlags&n.VarFlags.Readonly)==n.VarFlags.None,e),f.transferVarFlags(u.varFlags),p&&(f.flags|=n.SymbolFlags.Optional),e.symbol=f,f.declAST=t,(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)&&(f.flags|=n.SymbolFlags.ModuleMember,f.declModule=r.scopeChain.moduleDecl),n.hasFlag(u.varFlags,n.VarFlags.Property)&&l&&r.scopeChain.classType?(r.scopeChain.classType.members.publicMembers.add(u.id.text,f)||r.checker.errorReporter.duplicateIdentifier(t,f.name),f.container=r.scopeChain.classType.symbol):r.scopeChain.scope.enter(r.scopeChain.container,t,f,r.checker.errorReporter,!y&&(c||h||v||l),!1,s),n.hasFlag(u.varFlags,n.VarFlags.Exported)&&(f.flags|=n.SymbolFlags.Exported),e.typeLink=n.getTypeLink(u.typeExpr,r.checker,u.init==null),u.sym=f}return!1}function a(t,i,r){var y=r.scopeChain,a,b;r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface();var f=t,u=null,o=f.getNameText(),p=n.hasFlag(f.fncFlags,n.FncFlags.Exported|n.FncFlags.ClassPropertyMethodExported),h=n.hasFlag(f.fncFlags,n.FncFlags.Static),k=n.hasFlag(f.fncFlags,n.FncFlags.Private),v=f.isConstructMember()||f.isConstructor,e=(f.isMethod()&&h||f.isAccessor())&&r.scopeChain.classType?r.scopeChain.classType.symbol:r.scopeChain.container,s=r.scopeChain.scope,d=e==r.checker.gloMod,w=f.name&&n.hasFlag(f.name.flags,n.ASTFlags.OptionalName),l=!1,c=!1;return(v&&n.hasFlag(f.fncFlags,n.FncFlags.ClassMethod)&&(e=e.container,s=y.previous.scope),f.unitIndex=r.checker.locationInfo.unitIndex,!f.isConstructor&&e&&e.declAST&&e.declAST.nodeType==n.NodeType.FuncDecl&&e.declAST.isConstructor&&!f.isMethod())?l:(n.hasFlag(f.fncFlags,n.FncFlags.Signature)?(a=r.scopeChain.thisType,o&&o!="__missing"&&(h?u=e.type.members.allMembers.lookup(o):(u=s.findLocal(o,!1,!1),u==null&&(u=s.findLocal(o,!1,!0))),u&&(c=!0,f.isSignature()||n.hasFlag(f.fncFlags,n.FncFlags.Ambient)==n.hasFlag(u.flags,n.SymbolFlags.Ambient)||(u=null))),u==null?(u=f.isSpecialFn()?r.checker.createFunctionSignature(f,e,s,e,!1).declAST.type.symbol:r.checker.createFunctionSignature(f,e,s,null,!c).declAST.type.symbol,u.declAST!=null&&f.isSpecialFn()||(u.declAST=t)):u.kind()==n.SymbolKind.Type?u=r.checker.createFunctionSignature(f,e,s,u,!1).declAST.type.symbol:r.checker.errorReporter.simpleError(f,"Function or method '"+f.name.actualText+"' already declared as a property"),f.type=f.isSpecialFn()&&!h?a?a:u.type:u.type):(o&&(h?u=e.type.members.allMembers.lookup(o):(f.isConstructor&&r.scopeChain.previous&&(u=r.scopeChain.previous.scope.findLocal(o,!1,!1)),u==null&&(u=s.findLocal(o,!1,!1))),u&&(c=!0,v||u.declAST.nodeType!=n.NodeType.FuncDecl||u.declAST.isAccessor()||u.declAST.isSignature()||(u=null,c=!1))),u&&!u.isAccessor()&&u.type&&u.type.construct&&u.type.construct.signatures!=[]&&(u.type.construct.signatures[0].declAST==null||!n.hasFlag(u.type.construct.signatures[0].declAST.fncFlags,n.FncFlags.Ambient))&&!f.isConstructor&&r.checker.errorReporter.simpleError(f,"Functions may not have class overloads"),!u||u.kind()==n.SymbolKind.Type||!f.isMethod()||f.isAccessor()||f.isConstructor||(r.checker.errorReporter.simpleError(f,"Function or method '"+f.name.actualText+"' already declared as a property"),u.type=r.checker.anyType),b=r.checker.createFunctionSignature(f,e,s,u,!c),((!u||u.declAST.nodeType!=n.NodeType.FuncDecl)&&f.isAccessor()||u&&u.isAccessor())&&(f.accessorSymbol=r.checker.createAccessorSymbol(f,u,e.type,f.isMethod()&&h,!0,s,e)),f.type.symbol.declAST=t,f.isConstructor&&(l=!0)),p&&(f.type.call&&(f.type.symbol.flags|=n.SymbolFlags.Exported),u&&!u.isAccessor()&&u.kind()==n.SymbolKind.Type&&u.type.call&&(u.flags|=n.SymbolFlags.Exported)),r.scopeChain.moduleDecl&&!f.isSpecialFn()&&(f.type.symbol.flags|=n.SymbolFlags.ModuleMember,f.type.symbol.declModule=r.scopeChain.moduleDecl),u&&w&&(u.flags|=n.SymbolFlags.Optional),l)}function w(t,i,r){var f=r.state,u=!1,y=f.scopeChain,v;return t.nodeType==n.NodeType.Script?(v=t,f.script=v,u=!0):t.nodeType==n.NodeType.List?u=!0:t.nodeType==n.NodeType.ImportDeclaration?u=e(t,i,f):t.nodeType==n.NodeType.With?u=!1:t.nodeType==n.NodeType.ModuleDeclaration?u=o(t,i,f):t.nodeType==n.NodeType.ClassDeclaration?u=s(t,i,f):t.nodeType==n.NodeType.Block?u=!0:t.nodeType==n.NodeType.InterfaceDeclaration?u=h(t,i,f):t.nodeType==n.NodeType.ArgDecl?u=c(t,i,f):t.nodeType==n.NodeType.VarDecl?u=l(t,i,f):t.nodeType==n.NodeType.FuncDecl?u=a(t,i,f):t.isStatementOrExpression()&&f.scopeChain.moduleDecl&&f.scopeChain.moduleDecl.recordNonInterface(),r.options.goChildren=u,t}function b(t,i,r){var u=r.state;return t.nodeType==n.NodeType.ModuleDeclaration?n.popTypeCollectionScope(u):t.nodeType==n.NodeType.ClassDeclaration?n.popTypeCollectionScope(u):t.nodeType==n.NodeType.InterfaceDeclaration&&n.popTypeCollectionScope(u),t}var v=function(){function n(n){this.normalBlock=n,this.exceptionBlock=-1}return n}();n.Continuation=v,n.createNewConstructGroupForType=t,n.cloneParentConstructGroupForChildType=p,n.globalId="__GLO",n.preCollectImportTypes=e,n.preCollectModuleTypes=o,n.preCollectClassTypes=s,n.preCollectInterfaceTypes=h,n.preCollectArgDeclTypes=c,n.preCollectVarDeclTypes=l,n.preCollectFuncDeclTypes=a,n.preCollectTypes=w,n.postCollectTypes=b}(TypeScript||(TypeScript={})),function(n){var f=function(){function n(n,t,i){this.container=n,this.previous=t,this.scope=i}return n}(),i,r,t,e,o,u,s;n.ScopeChain=f,i=function(){function i(n){this.bb=n,this.defsBySymbol=[],this.useIndexBySymbol=[]}return i.prototype.updateTop=function(){for(var n=new t(this.top.bitCount),r,f,i=0,u=this.bb.successors.length;i<u;i++)r=this.bb.successors[i],r.useDef&&n.union(r.useDef.top);return n.difference(this.kill),n.union(this.gen),f=n.notEq(this.top),this.top=n,f},i.prototype.initialize=function(t){function e(t,i,u){var h=u.state,o,c,e,s;if(t==null&&(t=null),t.nodeType==n.NodeType.VarDecl)o=t,(o.init||n.hasFlag(o.varFlags,n.VarFlags.AutoInit))&&r(o.sym,h);else if(t.nodeType==n.NodeType.Name){if(i)if(i.nodeType==n.NodeType.Asg){if(e=i,e.operand1==t)return t}else if(i.nodeType==n.NodeType.VarDecl&&(c=i,c.id==t))return t;s=t,f(s.sym,h,t)}else t.nodeType>=n.NodeType.Asg&&t.nodeType<=n.NodeType.LastAsg?(e=t,e.operand1&&e.operand1.nodeType==n.NodeType.Name&&(s=e.operand1,r(s.sym,h))):t.nodeType==n.NodeType.FuncDecl&&(u.options.goChildren=!1);return t}var i=this,r=function(n,t){if(t.isLocalSym(n)){var r=t.getSymbolIndex(n);i.useIndexBySymbol[r]=[],i.defsBySymbol[r]=!0}},f=function(n,t,r){var u,e,f;t.isLocalSym(n)&&(u=t.getSymbolIndex(n),i.useIndexBySymbol[u]==undefined&&(i.useIndexBySymbol[u]=[]),e=i.useIndexBySymbol[u],f=t.getUseIndex(r),t.addUse(u,f),e.push(f))},u=new n.AstWalkOptions;u.reverseSiblings=!0,n.getAstWalkerFactory().walk(this.bb.content,e,null,u,t)},i.prototype.initializeGen=function(n){var e=this.useIndexBySymbol.length,o=n.uses.length,r,i,u,f;for(this.gen=new t(o),r=0;r<e;r++)if(i=this.useIndexBySymbol[r],i!=undefined&&i.length>0)for(u=0,f=i.length;u<f;u++)this.gen.set(i[u],!0);this.top=this.gen},i.prototype.initializeKill=function(n){var i,f,r,u,e;for(this.kill=new t(this.gen.bitCount),i=0,f=this.defsBySymbol.length;i<f;i++)if(this.defsBySymbol[i]&&(r=n.useIndexBySymbol[i],r))for(u=0,e=r.length;u<e;u++)this.kill.set(r[u],!0)},i}(),n.BBUseDefInfo=i,r=function(){function t(){this.useIndexBySymbol=[],this.uses=[],this.symbols=[],this.symbolMap=new n.StringHashTable,this.symbolCount=0}return t.prototype.getSymbolIndex=function(n){var i=n.name,t=this.symbolMap.lookup(i);return t==null&&(t=this.symbolCount++,this.symbols[t]=n,this.symbolMap.add(i,t)),t},t.prototype.addUse=function(n,t){var i=this.useIndexBySymbol[n];i==undefined&&(i=[],this.useIndexBySymbol[n]=i),i[i.length]=t},t.prototype.getUseIndex=function(n){return this.uses[this.uses.length]=n,this.uses.length-1},t.prototype.isLocalSym=function(t){return t&&t.container==this.func&&t.kind()==n.SymbolKind.Variable},t.prototype.killSymbol=function(n,t){for(var f=this.symbolMap.lookup(n.name),r=this.useIndexBySymbol[f],i=0,u=r.length;i<u;i++)t.set(r[i],!0)},t}(),n.UseDefContext=r,t=function(){function n(t){var r,i;if(this.bitCount=t,this.firstBits=0,this.restOfBits=null,this.bitCount>n.packBits)for(this.restOfBits=[],r=Math.floor(this.bitCount/n.packBits),i=0;i<r;i++)this.restOfBits[i]=0}return n.packBits=30,n.prototype.set=function(t,i){if(t<n.packBits)i?this.firstBits|=1<<t:this.firstBits&=~(1<<t);else{var r=Math.floor(t/n.packBits)-1,u=t%n.packBits;i?this.restOfBits[r]|=1<<u:this.restOfBits[r]&=~(1<<u)}},n.prototype.map=function(t){for(var f,r,e,u,i=0;i<n.packBits;i++){if(i==this.bitCount)return;(1<<i&this.firstBits)!=0&&t(i)}if(this.restOfBits)for(r=n.packBits,i=0,f=this.restOfBits.length;i<f;i++)for(e=this.restOfBits[i],u=0;u<n.packBits;u++)if((1<<u&e)!=0&&t(r),r++,r==this.bitCount)return},n.prototype.union=function(n){var t,i,r,u;if(this.firstBits|=n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)r=this.restOfBits[t],u=n.restOfBits[t],this.restOfBits[t]=r|u},n.prototype.intersection=function(n){var t,i,r,u;if(this.firstBits&=n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)r=this.restOfBits[t],u=n.restOfBits[t],this.restOfBits[t]=r&u},n.prototype.notEq=function(n){var t,i,r,u;if(this.firstBits!=n.firstBits)return!0;if(this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)if(r=this.restOfBits[t],u=n.restOfBits[t],r!=u)return!0;return!1},n.prototype.difference=function(n){var f=this.firstBits,t,i,u,r;if(this.firstBits&=~n.firstBits,this.restOfBits)for(t=0,i=this.restOfBits.length;t<i;t++)u=this.restOfBits[t],r=n.restOfBits[t],this.restOfBits[t]&=~r},n}(),n.BitVector=t,e=function(){function t(){this.predecessors=[],this.index=-1,this.markValue=0,this.successors=[],this.useDef=null,this.content=new n.ASTList}return t.prototype.marked=function(n){return this.markValue>n},t.prototype.mark=function(){this.markValue++},t.prototype.addSuccessor=function(n){this.successors[this.successors.length]=n,n.predecessors[n.predecessors.length]=this},t}(),n.BasicBlock=e,o=function(){function t(n,t){this.current=n,this.exit=t,this.entry=null,this.unreachable=null,this.noContinuation=!1,this.statementStack=[],this.currentSwitch=[],this.markBase=0,this.linearBBs=[],this.entry=this.current}return t.prototype.walk=function(n,t){return this.walker.walk(n,t)},t.prototype.pushSwitch=function(n){this.currentSwitch.push(n)},t.prototype.popSwitch=function(){return this.currentSwitch.pop()},t.prototype.reportUnreachable=function(t){var u,i,r;if(this.unreachable&&this.unreachable.length>0)for(u=this.unreachable.length,i=0;i<u;i++)r=this.unreachable[i],r.nodeType!=n.NodeType.EndCode&&t.simpleError(r,"unreachable code")},t.prototype.printAST=function(t,i){var r=new n.PrintContext(i,null);r.increaseIndent(),n.getAstWalkerFactory().walk(t,n.prePrintAST,n.postPrintAST,null,r),r.decreaseIndent()},t.prototype.printBlockContent=function(n,t){for(var r=n.content,f,i=0,u=r.members.length;i<u;i++)f=r.members[i],this.printAST(f,t)},t.prototype.bfs=function(n,t,i,r){var h=this.markBase++,f=[],u,s,e,o;for(f[f.length]=this.entry;f.length>0;)if(u=f.pop(),!u.marked(h)&&(u.mark(),n&&n(u),s=u.successors.length,s>0)){for(i&&i(),e=s-1;e>=0;e--)o=u.successors[e],o.marked(this.markBase)||(t&&t(u,o),f[f.length]=o);r&&r()}},t.prototype.useDef=function(n,t){var s=this,f=new r,h,u,o,e,c;for(f.func=t,h=function(n){n.useDef=new i(n),n.useDef.initialize(f),s.linearBBs[s.linearBBs.length]=n},this.bfs(h,null,null,null),u=0,o=this.linearBBs.length;u<o;u++)this.linearBBs[u].useDef.initializeGen(f),this.linearBBs[u].useDef.initializeKill(f);for(e=!0;e;)for(e=!1,u=0;u<o;u++)e=this.linearBBs[u].useDef.updateTop()||e;c=this.entry.useDef.top,c.map(function(t){var i=f.uses[t];n.simpleError(i,"use of variable '"+i.actualText+"' that is not definitely assigned")})},t.prototype.print=function(n){function e(){n.Write("  Branches to ")}function o(){n.WriteLine("")}function s(t,i){i.index<0&&(i.index=r++),n.Write(i.index+" ")}var i=this,r=0,f=function(t){t.index<0&&(t.index=r++),t==i.exit?n.WriteLine("Exit block with index "+t.index):(n.WriteLine("Basic block with index "+t.index),i.printBlockContent(t,n))},t,u;if(this.bfs(f,s,e,o),this.unreachable!=null)for(t=0,u=this.unreachable.length;t<u;t++)n.WriteLine("Unreachable basic block ..."),this.printAST(this.unreachable[t],n)},t.prototype.pushStatement=function(n,t,i){this.statementStack.push({stmt:n,continueBB:t,breakBB:i})},t.prototype.popStatement=function(){return this.statementStack.pop()},t.prototype.returnStmt=function(){this.current.addSuccessor(this.exit),this.setUnreachable()},t.prototype.setUnreachable=function(){this.current=null,this.noContinuation=!0},t.prototype.addUnreachable=function(n){this.unreachable===null&&(this.unreachable=[]),this.unreachable[this.unreachable.length]=n},t.prototype.unconditionalBranch=function(n,t){for(var i=null,u,r=0,f=this.statementStack.length;r<f;r++)if(u=this.statementStack[r],u.stmt==n){i=t?u.continueBB:u.breakBB;break}i&&this.current.addSuccessor(i),this.setUnreachable()},t.prototype.addContent=function(n){this.current&&this.current.content.append(n)},t}(),n.ControlFlowContext=o,u=function(){function n(){this.cacheSize=16,this.rdCache=[],this.nextUp=0;for(var n=0;n<this.cacheSize;n++)this.rdCache[n]={actuals:[],exactCandidates:[],conversionCandidates:[],id:n}}return n.prototype.getResolutionData=function(){var n=null;return this.nextUp<this.cacheSize&&(n=this.rdCache[this.nextUp]),n==null&&(this.cacheSize++,n={actuals:[],exactCandidates:[],conversionCandidates:[],id:this.cacheSize},this.rdCache[this.cacheSize]=n),this.nextUp++,n},n.prototype.returnResolutionData=function(n){n.actuals.length=0,n.exactCandidates.length=0,n.conversionCandidates.length=0,this.nextUp=n.id},n}(),n.ResolutionDataCache=u,s=function(){function t(n,t,i,r){this.logger=n,this.initScope=t,this.parser=i,this.checker=r,this.thisFnc=null,this.thisClassNode=null,this.enclosingFncIsMethod=!1,this.arrayInterfaceType=null,this.stringInterfaceType=null,this.objectInterfaceType=null,this.functionInterfaceType=null,this.numberInterfaceType=null,this.booleanInterfaceType=null,this.iargumentsInterfaceType=null,this.currentScript=null,this.inImportTypeCheck=!1,this.inTypeRefTypeCheck=!1,this.inArrayElementTypeCheck=!1,this.resolutionDataCache=new u,this.nestingLevel=0,this.inSuperCall=!1,this.checker.typeFlow=this,this.scope=this.initScope,this.globalScope=this.initScope,this.doubleType=this.checker.numberType,this.booleanType=this.checker.booleanType,this.stringType=this.checker.stringType,this.anyType=this.checker.anyType,this.regexType=this.anyType,this.nullType=this.checker.nullType,this.voidType=this.checker.voidType,this.arrayAnyType=this.checker.makeArrayType(this.anyType)}return t.prototype.initLibs=function(){var o=this.globalScope.find("Array",!1,!0),t,i,r,u,f,e;o&&o.kind()==n.SymbolKind.Type&&(this.arrayInterfaceType=o.type),t=this.globalScope.find("String",!1,!0),t&&t.kind()==n.SymbolKind.Type&&(this.stringInterfaceType=t.type),i=this.globalScope.find("Object",!1,!0),i&&i.kind()==n.SymbolKind.Type&&(this.objectInterfaceType=i.type),r=this.globalScope.find("Function",!1,!0),r&&r.kind()==n.SymbolKind.Type&&(this.functionInterfaceType=r.type),u=this.globalScope.find("Number",!1,!0),u&&u.kind()==n.SymbolKind.Type&&(this.numberInterfaceType=u.type),f=this.globalScope.find("Boolean",!1,!0),f&&f.kind()==n.SymbolKind.Type&&(this.booleanInterfaceType=f.type),e=this.globalScope.find("RegExp",!1,!0),e&&e.kind()==n.SymbolKind.Type&&(this.regexType=e.type)},t.prototype.cast=function(n,t){return this.castWithCoercion(n,t,!0,!1)},t.prototype.castWithCoercion=function(t,i,r,u){var f=new n.TypeComparisonInfo;return this.checker.sourceIsAssignableToTarget(t.type,i,f)||u&&this.checker.sourceIsAssignableToTarget(i,t.type,f)?(r&&(t.type=i==null?this.anyType:i.isClass()?i.instanceType:i),t):(this.checker.errorReporter.incompatibleTypes(t,t.type,i,null,this.scope,f),t)},t.prototype.inScopeTypeCheck=function(t,i){var s=this.scope,r,f,o;this.scope=i;for(var h=this.thisFnc,c=this.thisType,l=this.thisClassNode,a=this.checker.currentModDecl,v=this.enclosingFncIsMethod,u=this.scope.container,e=null;u;){if(u.kind()==n.SymbolKind.Type){if(r=u,f=r.type,f.call&&e==null&&(this.enclosingFncIsMethod=r.isMethod,e=u.declAST),f.isClass()){this.thisType=f.instanceType,r.declAST&&r.declAST.nodeType==n.NodeType.ClassDeclaration&&(this.thisClassNode=r.declAST);break}if(f.isModuleType()){this.checker.currentModDecl=r.declAST;break}}u=u.container}return this.thisFnc=e,o=this.typeCheck(t),this.thisFnc=h,this.thisType=c,this.thisClassNode=l,this.checker.currentModDecl=a,this.enclosingFncIsMethod=v,this.scope=s,o},t.prototype.typeCheck=function(n){return n?n.typeCheck(this):null},t.prototype.inScopeTypeCheckDecl=function(t){if(t.nodeType==n.NodeType.VarDecl||t.nodeType==n.NodeType.ArgDecl)this.inScopeTypeCheckBoundDecl(t);else if(t.nodeType==n.NodeType.FuncDecl){var i=t;i.isAccessor()&&this.typeCheckFunction(i)}},t.prototype.inScopeTypeCheckBoundDecl=function(t){var i=t.sym,s=this.thisFnc,h=this.thisType,c=this.enclosingFncIsMethod,l=this.checker.locationInfo,f,o,r,e,u;if(i&&i.container&&(f=n.hasFlag(t.varFlags,n.VarFlags.ClassConstructorProperty)?i.container.getType().constructorScope:i.container.instanceScope(),n.hasFlag(t.varFlags,n.VarFlags.Property)&&i.container.declAST.nodeType==n.NodeType.FuncDecl&&(this.thisFnc=i.container.declAST),f)){for(o=this.scope,this.scope=f,r=i.container,this.checker.locationInfo=this.checker.units&&i.unitIndex>=0&&i.unitIndex<this.checker.units.length?this.checker.units[i.unitIndex]:n.unknownLocationInfo;r;){if(r.kind()==n.SymbolKind.Type&&(e=r,u=e.type,u.call&&(this.enclosingFncIsMethod=e.isMethod),u.isClass())){this.thisType=u.instanceType;break}r=r.container}this.typeCheckBoundDecl(t),this.scope=o}this.thisFnc=s,this.thisType=h,this.checker.locationInfo=l,this.enclosingFncIsMethod=c},t.prototype.resolveBoundDecl=function(n){if(n.typeExpr)(n.typeExpr.type==null||n.typeExpr.type&&n.typeExpr.type==this.anyType&&this.scope||n.typeExpr.type.symbol==null||!this.checker.typeStatusIsFinished(n.typeExpr.type.symbol.typeCheckStatus))&&this.typeCheck(n.typeExpr),n.type=n.typeExpr.type,n.sym&&n.sym.setType(n.type);else if(n.init==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(n,"type implicitly set to 'any'"),n.type=this.anyType,n.sym)){if(n.sym.isType()){var t=n.sym;if(t.isMethod){this.checker.errorReporter.simpleError(n,"Cannot bind method group to variable.  (Did you mean to use 'declare function' instead of 'declare var'?)");return}this.checker.errorReporter.simpleError(n,"Cannot bind type to variable");return}n.sym.setType(n.type)}},t.prototype.typeCheckBoundDecl=function(t){var o=this,i=t.sym,r,u,f;if(i==null)t.init?(t.init=this.typeCheck(t.init),t.type=this.checker.widenType(t.init.type)):(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType);else if(i.typeCheckStatus==n.TypeCheckStatus.Started)this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType,i.setType(this.anyType);else if(i.typeCheckStatus==n.TypeCheckStatus.NotStarted){if(i.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(i),r=!1,t.type==null&&t.typeExpr&&(this.resolveBoundDecl(t),r=!0,t.type=t.typeExpr.type,i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()),t.init){var s=n.hasFlag(t.varFlags,n.VarFlags.LocalStatic),h=this.scope,e=!t.init.isParenthesized;s&&(this.scope=t.sym.container.getType().memberScope),n.hasFlag(t.varFlags,n.VarFlags.Property)&&this.thisClassNode&&n.getAstWalkerFactory().walk(t.init,function(t,i,r){return t&&t.nodeType==n.NodeType.FuncDecl&&(n.hasFlag(t.fncFlags,n.FncFlags.IsFatArrowFunction)&&(t.fncFlags|=n.FncFlags.IsPropertyBound),r.options.goChildren=!1),t}),this.checker.typeCheckWithContextualType(t.type,this.checker.inProvisionalTypecheckMode(),e,t.init),this.scope=h,t.type?(u=!1,f=null,t.init.type&&(f=t.init.type.containedScope,u=!0,t.init.type==this.voidType&&this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.actualText+"'")),t.init=this.castWithCoercion(t.init,t.type,e&&!this.checker.inProvisionalTypecheckMode(),!1),u&&t.init.type.containedScope==null&&(t.init.type.containedScope=f)):(t.type=this.checker.widenType(t.init.type),t.type==this.voidType&&(this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.actualText+"'"),t.type=this.anyType)),i.setType(t.type)}else r||this.resolveBoundDecl(t);i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.checker.typeStatusIsFinished(i.typeCheckStatus)&&i.declAST!=t&&t.init&&(t.init=this.typeCheck(t.init),t.type=i.getType(),t.init=this.cast(t.init,t.type));return t.id&&t.sym&&(t.id.sym=t.sym),t.sym&&t.sym.container&&this.checkTypePrivacy(t.sym.getType(),t.sym,function(n,i){return o.varPrivacyErrorReporter(t,n,i)}),t},t.prototype.varPrivacyErrorReporter=function(t,i,r){var u="",f;r?(f="",n.isQuoted(i)||(f="'"),u=" is using inaccessible module "+f+i+f):u=" has or is using private type '"+i+"'",n.hasFlag(t.varFlags,n.VarFlags.Public)?t.sym.container.declAST.nodeType==n.NodeType.InterfaceDeclaration?this.checker.errorReporter.simpleError(t,"property '"+t.sym.name+"' of exported interface"+u):this.checker.errorReporter.simpleError(t,"public member '"+t.sym.name+"' of exported class"+u):this.checker.errorReporter.simpleError(t,"exported variable '"+t.sym.name+"'"+u)},t.prototype.typeCheckSuper=function(t){if(this.thisType&&this.enclosingFncIsMethod&&!this.thisFnc.isStatic()&&this.thisType.baseClass())t.type=this.thisType.baseClass();else{if(!this.enclosingFncIsMethod&&this.thisType&&this.thisType.baseClass()&&this.thisFnc&&n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.IsFatArrowFunction)){for(var i=this.thisFnc.enclosingFnc;n.hasFlag(i.fncFlags,n.FncFlags.IsFatArrowFunction);)i=i.enclosingFnc;if(i&&(i.isMethod()||i.isConstructor)&&!i.isStatic())return t.type=this.thisType.baseClass(),i.setHasSuperReferenceInFatArrowFunction(),t}t.type=this.anyType,this.checker.errorReporter.invalidSuperReference(t)}return t},t.prototype.typeCheckThis=function(t){var r,u,i,f;if(t.type=this.anyType,r=!1,this.thisFnc==null?this.thisType?this.thisClassNode&&this.thisClassNode.nodeType==n.NodeType.ClassDeclaration?r=!0:t.type=this.thisType:this.checker.currentModDecl&&this.checker.errorReporter.simpleError(t,"'this' may not be referenced within module bodies"):(this.thisClassNode&&(n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.IsPropertyBound)||this.inSuperCall&&n.hasFlag(this.thisClassNode.varFlags,n.VarFlags.ClassSuperMustBeFirstCallInConstructor))&&(r=!0),(this.thisFnc.isMethod()||this.thisFnc.isConstructor||this.thisFnc.isTargetTypedAsMethod)&&(!this.thisType||this.thisFnc.fncFlags&n.FncFlags.Static||(t.type=this.thisType))),!this.enclosingFncIsMethod&&this.thisFnc&&n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.IsFatArrowFunction))if(this.thisFnc.boundToProperty)u=this.thisFnc.boundToProperty.sym.container,u.declAST.nodeType==n.NodeType.FuncDecl&&u.declAST.setHasSelfReference();else{for(i=this.thisFnc.enclosingFnc,f=i;i;){if(this.thisClassNode&&n.hasFlag(i.fncFlags,n.FncFlags.IsPropertyBound)&&(r=!0),!n.hasFlag(i.fncFlags,n.FncFlags.IsFatArrowFunction)||i.hasSelfReference()){i.setHasSelfReference();break}i=i.enclosingFnc}!i&&f?(i=f,i.setHasSelfReference()):i||(this.thisClassNode?this.thisClassNode.varFlags|=n.VarFlags.MustCaptureThis:this.checker.currentModDecl?this.checker.currentModDecl.modFlags|=n.ModuleFlags.MustCaptureThis:this.checker.mustCaptureGlobalThis=!0),i&&(i.isMethod()||i.isConstructor)&&this.thisType&&!n.hasFlag(i.fncFlags,n.FncFlags.Static)&&(t.type=this.thisType)}return r&&this.checker.errorReporter.simpleError(t,"Keyword 'this' cannot be referenced in initializers in a class body, or in super constructor calls"),t},t.prototype.setTypeFromSymbol=function(t,i){if(i.isVariable()){if(i.isInferenceSymbol()){var r=i;r.declAST&&!this.checker.typeStatusIsFinished(r.typeCheckStatus)&&this.inScopeTypeCheckDecl(r.declAST),this.checker.styleSettings.innerScopeDeclEscape||r.declAST&&r.declAST.nodeType==n.NodeType.VarDecl&&this.nestingLevel<r.declAST.nestingLevel&&this.checker.errorReporter.styleError(t,"Illegal reference to a variable defined in more nested scope")}t.type=i.getType(),i.writeable()||(t.flags=t.flags&~n.ASTFlags.Writeable)}else i.isType()?(t.type=i.getType(),t.flags=t.flags&~n.ASTFlags.Writeable):(t.type=this.anyType,this.checker.errorReporter.symbolDoesNotReferToAValue(t,i.name))},t.prototype.typeCheckName=function(t){var s=this,r=t,f,e;if(this.checker.inWith)r.type=this.anyType;else{var o=this.inTypeRefTypeCheck,u=r.text,c=u,h=n.isQuoted(r.text),i=this.scope.find(u,!1,o);i==null&&h&&(i=this.checker.findSymbolForDynamicModule(u,this.currentScript.locationInfo.filename,function(n){return s.scope.find(n,!1,o)})),i?(n.optimizeModuleCodeGen&&i&&i.isType()&&(f=i.getType(),f&&i.aliasLink&&i.onlyReferencedAsTypeRef&&(e=f.symbol.declAST,e&&n.hasFlag(e.modFlags,n.ModuleFlags.IsDynamic)&&(i.onlyReferencedAsTypeRef=this.inTypeRefTypeCheck))),i.declAST&&i.declAST.nodeType==n.NodeType.FuncDecl&&!i.declAST.returnTypeAnnotation&&i.declAST.signature.typeCheckStatus==n.TypeCheckStatus.Started&&(i.declAST.type.symbol.flags|=n.SymbolFlags.RecursivelyReferenced,i.declAST.signature.returnType.type=this.anyType),this.setTypeFromSymbol(t,i),r.sym=i,this.thisFnc&&this.thisFnc.type&&i.container!=this.thisFnc.type.symbol&&(this.thisFnc.freeVariables[this.thisFnc.freeVariables.length]=i)):(r.isMissing()||this.checker.errorReporter.unresolvedSymbol(r,r.text),r.type=this.anyType)}return t},t.prototype.typeCheckScript=function(n){return this.checker.locationInfo=n.locationInfo,this.scope=this.checker.globalScope,n.topLevelMod||this.addLocalsFromScope(this.scope,this.checker.gloMod,n.vars,this.checker.globals,!0),this.currentScript=n,n.bod=this.typeCheck(n.bod),this.currentScript=null,n},t.prototype.typeCheckBitNot=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,t},t.prototype.typeCheckUnaryNumberOperator=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,n},t.prototype.typeCheckLogNot=function(n){var t=n;return t.operand=this.typeCheck(t.operand),t.type=this.booleanType,t},t.prototype.astIsWriteable=function(t){return n.hasFlag(t.flags,n.ASTFlags.Writeable)},t.prototype.typeCheckIncOrDec=function(t){var i=t,r=i.operand;return this.astIsWriteable(i)?(i=this.typeCheckUnaryNumberOperator(t),i.operand.type==this.checker.numberType||i.operand.type==this.checker.anyType||i.operand.type.typeFlags&n.TypeFlags.IsEnum||this.checker.errorReporter.simpleError(t,"'++' and '--' may only be applied to operands of type 'number' or 'any'")):(this.checker.errorReporter.valueCannotBeModified(i),i.type=this.doubleType),i},t.prototype.typeCheckBitwiseOperator=function(t,i){var r=t,e=null,u,f;return r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2),u=r.operand1.type,f=r.operand2.type,i&&!this.astIsWriteable(r)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&this.checker.errorReporter.styleError(t,"use of "+n.nodeTypeTable[r.nodeType]),this.checker.sourceIsSubtypeOfTarget(u,this.doubleType)&&this.checker.sourceIsSubtypeOfTarget(f,this.doubleType)?e=this.doubleType:u==this.booleanType&&f==this.booleanType?e=this.booleanType:u==this.anyType?(f==this.anyType||f==this.doubleType||f==this.booleanType)&&(e=this.anyType):f==this.anyType&&(u==this.anyType||u==this.doubleType||u==this.booleanType)&&(e=this.anyType),e==null&&(e=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)),r.type=e,r},t.prototype.typeCheckArithmeticOperator=function(t,i){var r=t,u,f,e;return(r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2),u=r.operand1.type,f=r.operand2.type,i&&!this.astIsWriteable(r.operand1)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&(r.nodeType==n.NodeType.And||r.nodeType==n.NodeType.Or||r.nodeType==n.NodeType.AsgAnd||r.nodeType==n.NodeType.AsgOr)&&this.checker.errorReporter.styleError(t,"use of "+n.nodeTypeTable[r.nodeType]),u==null||f==null)?(this.checker.errorReporter.simpleError(r,"Could not typecheck arithmetic operation.  Possible recursive typecheck error?"),r.type=this.anyType,r):(e=r.nodeType,this.checker.isNullOrUndefinedType(u)&&(u=f),this.checker.isNullOrUndefinedType(f)&&(f=u),u=this.checker.widenType(u),f=this.checker.widenType(f),e==n.NodeType.Add||e==n.NodeType.AsgAdd?u==this.checker.stringType||f==this.checker.stringType?r.type=this.checker.stringType:u==this.checker.numberType&&f==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(u,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?r.type=this.checker.numberType:u==this.checker.anyType||f==this.checker.anyType?r.type=this.checker.anyType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)):u==this.checker.numberType&&f==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(u,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(f,this.checker.numberType)?r.type=this.checker.numberType:u==this.checker.anyType||f==this.checker.anyType?r.type=this.checker.numberType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,u,f,r.printLabel(),this.scope)),r)},t.prototype.typeCheckDotOperator=function(n){var t=n,h=!1,i,u,o,e;if(t.operand1=this.typeCheck(t.operand1),i=t.operand1.type,u=null,i){if(i==this.anyType)return t.type=this.anyType,t;if(i==this.stringType)if(this.stringInterfaceType)u=this.stringInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i==this.doubleType)if(this.numberInterfaceType)u=this.numberInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i==this.booleanType)if(this.booleanInterfaceType)u=this.booleanInterfaceType.memberScope;else return t.type=this.anyType,t;else if((i.call||i.construct)&&i.members==null)if(this.functionInterfaceType)u=this.functionInterfaceType.memberScope;else return t.type=this.anyType,t;else if(i.elementType)if(this.arrayInterfaceType)o=i.elementType.getArrayBase(this.arrayInterfaceType,this.checker),u=o.memberScope;else return t.type=this.anyType,t;else u=i.memberScope}if(u==null)this.checker.errorReporter.expectedClassOrInterface(t),t.type=this.anyType;else{var f=t.operand2,s=this.thisClassNode&&t.operand1.type==this.thisClassNode.type.instanceType||this.inTypeRefTypeCheck,r=u.find(f.text,!s,this.inTypeRefTypeCheck);r||this.objectInterfaceType&&i&&(i.isReferenceType()&&(r=this.objectInterfaceType.memberScope.find(f.text,!1,this.inTypeRefTypeCheck)),r||this.functionInterfaceType&&(i.call||i.construct)&&(r=this.functionInterfaceType.memberScope.find(f.text,!1,this.inTypeRefTypeCheck))),r&&r.visible(u,this.checker)?(r.isVariable()&&r.isInferenceSymbol()&&(e=r,e.declAST&&!this.checker.typeStatusIsFinished(e.typeCheckStatus)&&this.inScopeTypeCheckDecl(e.declAST)),f.sym=r,t.type=r.getType()):(t.type=this.anyType,r==null?this.checker.errorReporter.simpleError(f,"The property '"+f.actualText+"' does not exist on value of type '"+i.getScopedTypeName(this.scope)+"'"):this.inTypeRefTypeCheck||this.checker.errorReporter.simpleError(t,"The property '"+f.actualText+" on type '"+i.getScopedTypeName(this.scope)+"' is not visible"))}return t.type==null&&(t.type=this.anyType),t},t.prototype.typeCheckBooleanOperator=function(n){var t=n,i,r;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),i=t.operand1.type,r=t.operand2.type,this.checker.sourceIsAssignableToTarget(i,r)||this.checker.sourceIsAssignableToTarget(r,i)||this.checker.errorReporter.incompatibleTypes(t,i,r,t.printLabel(),this.scope),t.type=this.booleanType,t},t.prototype.typeCheckAsgOperator=function(t){var i=t,f=!i.operand2.isParenthesized,e,o,s,r,u;return i.operand1=this.typeCheck(i.operand1),this.checker.typeCheckWithContextualType(i.operand1.type,this.checker.inProvisionalTypecheckMode(),f,i.operand2),e=i.operand1.type,o=i.operand2.type,this.astIsWriteable(i.operand1)||this.checker.errorReporter.valueCannotBeModified(i),i.operand1.nodeType==n.NodeType.Call&&(s=i.operand1),r=!1,u=null,i.operand2.type&&(u=i.operand2.type.containedScope,r=!0),i.operand2=this.castWithCoercion(i.operand2,e,f&&!this.checker.inProvisionalTypecheckMode(),!1),r&&i.operand2.type.containedScope==null&&(i.operand2.type.containedScope=u),i.type=o,i},t.prototype.typeCheckIndex=function(t){var i=t,r,u,f;return i.operand1=this.typeCheck(i.operand1),i.operand2=this.typeCheck(i.operand2),this.checker.styleSettings.literalSubscript||i.operand2.nodeType==n.NodeType.QString&&this.checker.errorReporter.styleError(t,"use literal subscript ('.') notation instead)"),r=i.operand1.type,u=i.operand2.type,r.elementType?u==this.checker.anyType||u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum)?i.type=r.elementType:u==this.checker.stringType?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType):r.index?u==this.checker.anyType||!(r.index.flags&n.SignatureFlags.IsStringIndexer||r.index.flags&n.SignatureFlags.IsNumberIndexer)||r.index.flags&n.SignatureFlags.IsStringIndexer&&u==this.checker.stringType||r.index.flags&n.SignatureFlags.IsNumberIndexer&&(u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum))?(f=this.resolveOverload(t,r.index),i.type=f?f.returnType.type:this.checker.anyType):u==this.checker.stringType?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType):(r==this.checker.anyType||r==this.checker.stringType||r==this.checker.numberType||r==this.checker.booleanType||r.isReferenceType())&&(u==this.checker.anyType||u==this.checker.stringType||u==this.checker.numberType||n.hasFlag(u.typeFlags,n.TypeFlags.IsEnum))?i.type=this.checker.anyType:(this.checker.errorReporter.simpleError(i,"Illegal property access"),i.type=this.checker.anyType),i},t.prototype.typeCheckInOperator=function(n){return n.operand1=this.cast(this.typeCheck(n.operand1),this.stringType),n.operand2=this.typeCheck(n.operand2),(n.operand1.type==this.checker.anyType||n.operand1.type==this.checker.stringType)&&(n.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(n.operand2.type,this.objectInterfaceType))||this.checker.errorReporter.simpleError(n,"The in operator requires the left operand to be of type Any or the String primitive type, and the right operand to be of type Any or an object type"),n.type=this.booleanType,n},t.prototype.typeCheckShift=function(n,t){return n.operand1=this.cast(this.typeCheck(n.operand1),this.doubleType),n.operand2=this.cast(this.typeCheck(n.operand2),this.doubleType),t&&!this.astIsWriteable(n.operand1)&&this.checker.errorReporter.valueCannotBeModified(n),n.type=this.doubleType,n},t.prototype.typeCheckQMark=function(n){n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2),n.operand3=this.typeCheck(n.operand3);var t=n.operand2.type,i=n.operand3.type;return t==i?n.type=t:this.checker.sourceIsSubtypeOfTarget(t,i)?n.type=i:this.checker.sourceIsSubtypeOfTarget(i,t)?n.type=t:(n.type=this.anyType,this.checker.errorReporter.incompatibleTypes(n,t,i,n.printLabel(),this.scope)),n},t.prototype.addFormals=function(n,t,i){for(var f=t.parameters.length,u,r=0;r<f;r++)u=t.parameters[r],u.container=n,i.add(u.name,u)},t.prototype.addLocalsFromScope=function(t,i,r,u,f){for(var p=r.members.length,v=!1,e,c,o,s,l,y,a,h=0;h<p;h++)e=r.members[h],(e.sym==null||e.sym.kind()!=n.SymbolKind.Field)&&(c=null,(c=u.lookup(e.id.text))==null?(o=new n.ValueLocation,o.typeLink=new n.TypeLink,s=null,n.hasFlag(e.varFlags,n.VarFlags.Static)?(e.varFlags|=n.VarFlags.LocalStatic,s=new n.FieldSymbol(e.id.text,e.minChar,this.checker.locationInfo.unitIndex,!0,o)):s=new n.VariableSymbol(e.id.text,e.minChar,this.checker.locationInfo.unitIndex,o),s.transferVarFlags(e.varFlags),o.symbol=s,s.declAST=e,o.typeLink.ast=e.typeExpr,this.checker.resolveTypeLink(t,o.typeLink,!1),e.type==null&&e.init==null&&(e.type=this.anyType),o.typeLink.type=e.type,o.symbol.container=i,e.sym=o.symbol,u.add(e.id.text,s),e.id.text=="arguments"&&(v=!0)):(e.type=c.getType(),e.sym=c));f||v||(l=new n.ValueLocation,l.typeLink=new n.TypeLink,y=new n.VariableSymbol("arguments",r.minChar,this.checker.locationInfo.unitIndex,l),this.iargumentsInterfaceType||(a=t.find("IArguments",!1,!0),a?(a.flags|=n.SymbolFlags.CompilerGenerated,this.iargumentsInterfaceType=a.getType()):this.iargumentsInterfaceType=this.anyType),l.typeLink.type=this.iargumentsInterfaceType,u.add("arguments",y))},t.prototype.addConstructorLocalArgs=function(t,i,r,u){var c,o,f,s,e,h;if(i)for(c=i.members.length,o=0;o<c;o++)f=i.members[o],(f.sym==null||u||f.sym.kind()!=n.SymbolKind.Field)&&(s=null,(s=r.lookup(f.id.text))==null?(this.resolveBoundDecl(f),e=new n.ValueLocation,e.typeLink=new n.TypeLink,h=new n.ParameterSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,e),h.declAST=f,e.symbol=h,e.typeLink.type=f.type,e.symbol.container=t,f.sym=e.symbol,r.add(f.id.text,h)):(f.type=s.getType(),f.sym=s))},t.prototype.checkInitSelf=function(n){var r,t,f,e,u,o,i,s;if(!n.isMethod())for(r=n.freeVariables,t=0,f=r.length;t<f;t++)if(e=r[t],e.isInstanceProperty())return!0;for(u=n.scopes,o=u.members.length,i=0;i<o;i++)if(s=u.members[i],this.checkInitSelf(s))return!0;return!1},t.prototype.checkPromoteFreeVars=function(t,i){for(var f=t.freeVariables,r,u=0,e=f.length;u<e;u++)r=f[u],r.isInstanceProperty()||r.container!=i||(n.instanceFilter.reset(),this.scope.search(n.instanceFilter,r.name,!1,!1)&&this.checker.errorReporter.simpleError(t,"Constructor-local variable shadows class property '"+r.name+"'. To access the class property, use 'self."+r.name+"'"),this.checker.errorReporter.simpleError(t,"Constructor-local variables may not be accessed from instance method bodies. Consider changing local variable '"+r.name+"' to a class property"))},t.prototype.allReturnsAreVoid=function(t){var i=!0,r;return t.signature.returnType.type==null&&(r=function(t,r,u){var f=!0,e;switch(t.nodeType){case n.NodeType.FuncDecl:f=!1;break;case n.NodeType.Return:e=t,e.returnExpression&&(i=!1,f=!1)}return u.options.goChildren=f,u.options.goNextSibling=f,t},n.getAstWalkerFactory().walk(t.bod,r)),i},t.prototype.classConstructorHasSuperCall=function(t){var i=!1,r=function(t,r,u){var f=!0,e;switch(t.nodeType){case n.NodeType.FuncDecl:f=!1;break;case n.NodeType.Call:if(e=t,e.target.nodeType==n.NodeType.Super){f=!1,i=!0;break}}return u.options.goChildren=f,t};return n.getAstWalkerFactory().walk(t.bod,r),i},t.prototype.baseListPrivacyErrorReporter=function(t,i,r,u,f,e){var h=t.members[i].type.symbol,c=r.declAST.nodeType==n.NodeType.InterfaceDeclaration?"interface":"class",l=u?"extends":"implements",o=h.declAST.nodeType==n.NodeType.InterfaceDeclaration?"interface":"class",a="",s;e?(s="",n.isQuoted(f)||(s="'"),a=" is using inaccessible module ",o=" "+o+" from private module "+s+f+s):o=" private "+o+" '"+f+"'",this.checker.errorReporter.simpleError(t.members[i],"exported "+c+" '"+r.name+"' "+l+o)},t.prototype.typeCheckBaseListPrivacy=function(n,t,i){var f=this,u,r;if(n)for(u=n.members.length,r=0;r<u;r++)n.members[r].type&&n.members[r].type!=this.checker.anyType&&this.checkSymbolPrivacy(n.members[r].type.symbol,t,function(u,e){return f.baseListPrivacyErrorReporter(n,r,t,i,u,e)})},t.prototype.checkSymbolPrivacy=function(t,i,r){var e=null,o=null,f,u,s,l,a,h,c,v;if((!t.isExternallyVisible(this.checker)||(f=t.pathToRoot(),o=i.pathToRoot(),u=f.length,s=o.length,u>0&&(f[u-1].getType().isModuleType()&&f[u-1].isDynamic&&f[u-1]!=o[s-1]?e=f[u-1]:u>1&&f[u-2].getType().isModuleType()&&f[u-2].isDynamic&&(s==1||f[u-2]!=o[s-2])&&(e=f[u-2])),e!=null))&&(l=i.getInterfaceDeclFromSymbol(this.checker),!l||n.hasFlag(l.varFlags,n.VarFlags.Exported))){if(a=i,h=i.getVarDeclFromSymbol(),h){if(n.hasFlag(h.varFlags,n.VarFlags.Private))return;n.hasFlag(h.varFlags,n.VarFlags.Public)&&(a=i.container)}if(a.isExternallyVisible(this.checker)){if(c=t.name,e!=null){if(v=e.getPrettyNameOfDynamicModule(o),v!=null){this.currentScript.AddExternallyVisibleImportedSymbol(v.symbol,this.checker);return}c=e.prettyName}r(c,t.name!=c)}}},t.prototype.checkTypePrivacy=function(t,i,r){var u=this;if(t&&t.primitiveTypeClass==n.Primitive.None){if(t.isArray())return this.checkTypePrivacy(t.elementType,i,r);if(t.symbol&&t.symbol.name&&t.symbol.name!="_anonymous"&&(t.call==null&&t.construct==null&&t.index==null||t.members&&!t.isClass()))return this.checkSymbolPrivacy(t.symbol,i,r);t.members&&t.members.allMembers.map(function(t,f){var o=f;n.hasFlag(o.flags,n.SymbolFlags.BuiltIn)||u.checkTypePrivacy(o.getType(),i,r)},null),this.checkSignatureGroupPrivacy(t.call,i,r),this.checkSignatureGroupPrivacy(t.construct,i,r),this.checkSignatureGroupPrivacy(t.index,i,r)}},t.prototype.checkSignatureGroupPrivacy=function(n,t,i){var e,u,r,o,f,s;if(n)for(e=n.signatures.length,u=0;u<n.signatures.length;u++)if(r=n.signatures[u],!(e>1)||r!=n.definitionSignature)for(r.returnType&&this.checkTypePrivacy(r.returnType.type,t,i),o=r.parameters.length,f=0;f<o;f++)s=r.parameters[f],this.checkTypePrivacy(s.getType(),t,i)},t.prototype.functionArgumentPrivacyErrorReporter=function(t,i,r,u,f){var h=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor),c=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.SetAccessor),s=n.hasFlag(t.fncFlags,n.FncFlags.Public),l=t.type.symbol.getInterfaceDeclFromSymbol(this.checker)!=null,e="",o;f?(o="",n.isQuoted(u)||(o="'"),e=" is using inaccessible module "+o+u+o):e=" has or is using private type '"+u+"'",l?t.isConstructMember()?this.checker.errorReporter.simpleError(t.arguments.members[i],"exported interface's constructor parameter '"+r.name+"'"+e):t.isCallMember()?this.checker.errorReporter.simpleError(t.arguments.members[i],"exported interface's call parameter '"+r.name+"'"+e):t.isIndexerMember()||this.checker.errorReporter.simpleError(t.arguments.members[i],"exported interface's function parameter '"+r.name+"'"+e):t.isConstructor?this.checker.errorReporter.simpleError(t.arguments.members[i],"exported class's constructor parameter '"+r.name+"'"+e):c?this.checker.errorReporter.simpleError(t.arguments.members[i],(s?"public":"exported")+" setter parameter '"+r.name+"'"+e):h||this.checker.errorReporter.simpleError(t.arguments.members[i],(s?"public":"exported")+" function parameter '"+r.name+"'"+e)},t.prototype.returnTypePrivacyError=function(t,i,r,u){var s=i.isAccessor()&&n.hasFlag(i.fncFlags,n.FncFlags.GetAccessor),h=i.isAccessor()&&n.hasFlag(i.fncFlags,n.FncFlags.SetAccessor),o=n.hasFlag(i.fncFlags,n.FncFlags.Public),c=i.type.symbol.getInterfaceDeclFromSymbol(this.checker)!=null,f="",e;u?(e="",n.isQuoted(r)||(e="'"),f=" is using inaccessible module "+e+r+e):f=" has or is using private type '"+r+"'",c?i.isConstructMember()?this.checker.errorReporter.simpleError(t,"exported interface's constructor return type"+f):i.isCallMember()?this.checker.errorReporter.simpleError(t,"exported interface's call return type"+f):i.isIndexerMember()?this.checker.errorReporter.simpleError(t,"exported interface's indexer return type"+f):this.checker.errorReporter.simpleError(t,"exported interface's function return type"+f):s?this.checker.errorReporter.simpleError(t,(o?"public":"exported")+" getter return type"+f):h||this.checker.errorReporter.simpleError(t,(o?"public":"exported")+" function return type"+f)},t.prototype.functionReturnTypePrivacyErrorReporter=function(n,t,i,r){var f=!1,u;for(n.returnTypeAnnotation!=null&&n.returnTypeAnnotation.type==t.returnType.type&&this.returnTypePrivacyError(n.returnTypeAnnotation,n,i,r),u=0;u<n.returnStatementsWithExpressions.length;u++)n.returnStatementsWithExpressions[u].type==t.returnType.type?this.returnTypePrivacyError(n.returnStatementsWithExpressions[u],n,i,r):f=!0;f&&this.returnTypePrivacyError(n,n,i,r)},t.prototype.typeCheckFunction=function(t){var rt=this,w,e,b,at,o,k,l,vt,yt,ot,a,s,f,pt,r,wt,bt,kt,nt,d,gt,g,tt,it,h;this.nestingLevel=0;var u=t.type,ut=u.symbol,i=t.signature;if(this.checker.typeStatusIsFinished(i.typeCheckStatus))return t;if(i.typeCheckStatus==n.TypeCheckStatus.Started)return t.returnTypeAnnotation||!t.bod||t.isSignature()||t.isConstructor||!this.allReturnsAreVoid(t)?(t.returnTypeAnnotation==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType,ut.flags|=n.SymbolFlags.RecursivelyReferenced),t):(i.returnType.type=this.voidType,t);i.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(i);var p=this.scope,ni=this.thisFnc,ti=this.enclosingFncIsMethod,ii=this.thisClassNode;this.enclosingFncIsMethod=t.isMethod()||t.isConstructor,this.thisFnc=t;var v=t.type.symbol,ht=this.thisType,ri=this.checker.locationInfo,y=null,ft=!1,c=null,et=null,ui=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor),ct=t.isAccessor()&&n.hasFlag(t.fncFlags,n.FncFlags.SetAccessor),h=(ui||ct)&&t.accessorSymbol?t.accessorSymbol.getType():null,fi=this.checker.currentModDecl;if(t.isConstructor&&!t.isOverload){if(u.instanceType==null)return this.checker.errorReporter.simpleError(t,"Malformed function body (is this a class named the same as an existing interface?)"),t;this.scope=u.instanceType.constructorScope,o=this.scope,y=o.valueMembers.allMembers}else(!t.isSpecialFn()||t.fncFlags&n.FncFlags.Signature)&&!t.isOverload?(t.bod&&(this.scope=u.containedScope),o=this.scope,o&&o.valueMembers&&(y=o.valueMembers.allMembers)):(y=t.symbols,!n.hasFlag(t.fncFlags,n.FncFlags.Static)&&u.containedScope&&(this.scope=u.containedScope));if(t.isConstructor&&t.bod&&n.hasFlag(t.fncFlags,n.FncFlags.ClassMethod)){var lt=n.hasFlag(t.classDecl.type.instanceType.typeFlags,n.TypeFlags.HasBaseType),ei=!lt||n.hasFlag(t.classDecl.type.instanceType.typeFlags,n.TypeFlags.HasBaseTypeOfObject),oi=n.hasFlag(t.classDecl.varFlags,n.VarFlags.ClassSuperMustBeFirstCallInConstructor);ei&&this.classConstructorHasSuperCall(t)?this.checker.errorReporter.simpleError(t,"Calls to 'super' constructor are not allowed in classes that either inherit directly from 'Object' or have no base class"):lt&&(oi?t.bod&&t.bod.members.length&&(t.bod.members[0].nodeType==n.NodeType.Call&&t.bod.members[0].target.nodeType==n.NodeType.Super||n.hasFlag(t.bod.flags,n.ASTFlags.StrictMode)&&t.bod.members.length>1&&t.bod.members[1].nodeType==n.NodeType.Call&&t.bod.members[1].target.nodeType==n.NodeType.Super)||this.checker.errorReporter.simpleError(t,"If a derived class contains initialized properties or constructor parameter properties, the first statement in the constructor body must be a call to the super constructor"):this.classConstructorHasSuperCall(t)||this.checker.errorReporter.simpleError(t,"Constructors for derived classes must contain a call to the class's 'super' constructor"))}if(t.isMethod()&&t.type.enclosingType&&(w=null,t.type.enclosingType.symbol.declAST.nodeType==n.NodeType.FuncDecl?w=t.type.enclosingType.symbol.declAST.classDecl:t.type.enclosingType.symbol.declAST.nodeType==n.NodeType.ClassDeclaration&&(w=t.type.enclosingType.symbol.declAST),w&&(this.thisClassNode=w)),u.enclosingType&&(e=u.symbol.container,e&&e.isType()&&e.getType().isClass()&&(e=e.container),e&&e.declAST&&e.declAST.nodeType==n.NodeType.ModuleDeclaration&&(this.checker.currentModDecl=e.declAST)),t.unitIndex>0&&(this.checker.locationInfo=this.checker.units&&t.unitIndex<this.checker.units.length?this.checker.units[t.unitIndex]:n.unknownLocationInfo),this.thisType=u.enclosingType?u.enclosingType:ht,b=i.parameters.length,t.isConstructor||!t.bod||t.isSignature()){for(this.typeCheck(t.arguments),r=0;r<b;r++)i.parameters[r].parameter.typeLink.type=t.arguments.members[r].type,this.checkTypePrivacy(i.parameters[r].getType(),v,function(n,u){return rt.functionArgumentPrivacyErrorReporter(t,r,i.parameters[r],n,u)}),t.arguments.members[r].parameterPropertySym&&t.arguments.members[r].parameterPropertySym.setType(t.arguments.members[r].type);t.fncFlags&n.FncFlags.IndexerMember&&(!b||b>1?this.checker.errorReporter.simpleError(t,"Index signatures may take one and only one parameter"):t.arguments.members[0].type==this.checker.numberType?u.index.flags|=n.SignatureFlags.IsNumberIndexer:t.arguments.members[0].type==this.checker.stringType?u.index.flags|=n.SignatureFlags.IsStringIndexer:this.checker.errorReporter.simpleError(t.arguments.members[0],"Index signatures may only take 'string' or 'number' as their parameter"))}else{for(at=this.scope,o=this.scope,t.isMethod()||t.returnTypeAnnotation!=null||(p&&t.name&&!t.name.isMissing()&&(k=p.findAmbient(t.name.text,!1,!1),k&&k.declAST&&k.declAST.type&&this.checker.setContextualType(k.declAST.type,!1)),this.checker.hasTargetType()&&(f=this.checker.getTargetTypeContext(),l=f.contextualType,this.checker.canContextuallyTypeFunction(l,t,!0)?(vt=l.construct?l.construct:l.call,f.targetSig=vt.signatures[0],yt=f.targetSig.parameters,c=yt,et=f.targetSig.returnType.type,f.targetSig.declAST&&(f.targetSig.declAST.isConstructor?t.isTargetTypedAsMethod=!0:f.targetSig.declAST.isMethod()&&(t.isTargetTypedAsMethod=!0)),ut.type=f.contextualType,ft=!0):l&&t.isAccessor()?(h=l,f.targetAccessorType=h):this.checker.killCurrentContextualType())),ot=o.valueMembers,this.scope=new n.SymbolScopeBuilder(ot,null,null,null,p,v),r=0;r<b;r++)a=i.parameters[r],s=a.declAST,this.checker.hasTargetType()&&c&&(this.checker.getTargetTypeContext().targetSig.hasVariableArgList||r<c.length)?(f=this.checker.getTargetTypeContext(),pt=f.targetSig.hasVariableArgList,s.type=pt&&r>=c.length-1?c[c.length-1].getType().elementType:c[r].getType(),s.sym.setType(s.type),s.sym.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()):this.typeCheck(s),ct&&h&&(s=this.cast(s,h)),a.container=v,this.checkTypePrivacy(a.getType(),v,function(n,i){return rt.functionArgumentPrivacyErrorReporter(t,r,a,n,i)}),ot.publicMembers.add(a.name,a);this.scope=at}if(t.bod&&!t.isSignature()&&(t.isConstructor?(this.addConstructorLocalArgs(t.type.symbol,t.arguments,y,n.hasFlag(t.fncFlags,n.FncFlags.ClassMethod)),this.thisClassNode&&this.thisClassNode.extendsList&&(wt=this.scope,bt=new n.ScopedMembers(y),this.scope=new n.FilteredSymbolScopeBuilder(bt,p,t.type.symbol,function(t){return t.kind()==n.SymbolKind.Parameter}),this.typeCheckBaseCalls(this.thisClassNode.extendsList),this.scope=wt)):this.addFormals(v,i,y),kt=this.checker.currentModDecl,t.type&&t.type.symbol&&!t.isMethod()&&t.type.symbol.declModule&&(this.checker.currentModDecl=t.type.symbol.declModule),ft&&this.checker.setContextualType(null,this.checker.inProvisionalTypecheckMode()),this.typeCheck(t.bod),ft&&this.checker.unsetContextualType(),this.checker.currentModDecl=kt,this.checker.checkControlFlow&&(nt=t.buildControlFlow(),this.checker.printControlFlowGraph&&nt.print(this.checker.errorReporter.outfile),nt.reportUnreachable(this.checker.errorReporter),this.checker.checkControlFlowUseDef&&nt.useDef(this.checker.errorReporter,t.type.symbol)),t.isConstructor))for(var dt=t.scopes,si=dt.members.length,hi,ci,st=0;st<si;st++)d=dt.members[st],d.isSignature()||n.hasFlag(d.fncFlags,n.FncFlags.Method)&&!n.hasFlag(d.fncFlags,n.FncFlags.Static)&&this.checkPromoteFreeVars(d,t.type.symbol);if(this.scope=p,this.thisFnc=ni,this.thisClassNode=ii,this.enclosingFncIsMethod=ti,this.thisType=ht,this.checker.locationInfo=ri,this.checker.currentModDecl=fi,i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),t.returnTypeAnnotation?(this.checkForVoidConstructor(t.returnTypeAnnotation.type,t.returnTypeAnnotation),i.returnType.type==null&&this.checker.resolveTypeLink(this.scope,i.returnType,!1)):et&&(i.returnType.type=et),!(ut.flags&n.SymbolFlags.RecursivelyReferenced)&&t.returnStatementsWithExpressions.length>0)if(gt={getLength:function(){return t.returnStatementsWithExpressions.length},setTypeAtIndex:function(n,i){t.returnStatementsWithExpressions[n].type=i},getTypeAtIndex:function(n){return t.returnStatementsWithExpressions[n].type}},g=t.returnStatementsWithExpressions[0].type,g=this.checker.findBestCommonType(g,null,gt,!0),g)i.returnType.type=this.checker.widenType(g);else{for(tt=0;tt<t.returnStatementsWithExpressions.length;tt++)this.checker.errorReporter.simpleError(t.returnStatementsWithExpressions[tt],"Incompatible return type");i.returnType.type=this.anyType}return it=!1,i.returnType.type==null?n.hasFlag(t.fncFlags,n.FncFlags.HasReturnExpression)?(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType):i.returnType.type=this.voidType:i.returnType.type==this.nullType||i.returnType.type==this.checker.undefinedType?i.returnType.type=this.anyType:i.returnType.type!=this.voidType&&i.returnType.type!=this.checker.undefinedType&&i.returnType.type!=this.anyType&&(t.isSignature()||t.isConstructor||n.hasFlag(t.fncFlags,n.FncFlags.HasReturnExpression)||n.hasFlag(t.fncFlags,n.FncFlags.IsFatArrowFunction)||(it=t.bod.members.length>0&&t.bod.members[0].nodeType==n.NodeType.Throw,it||this.checker.errorReporter.simpleError(t.returnTypeAnnotation||t,"Function declared a non-void return type, but has no return expression")),this.checkTypePrivacy(i.returnType.type,v,function(n,r){return rt.functionReturnTypePrivacyErrorReporter(t,i,n,r)})),t.accessorSymbol&&(h=t.accessorSymbol.getType(),it||!n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)||n.hasFlag(t.fncFlags,n.FncFlags.HasReturnExpression)||this.checker.errorReporter.simpleError(t,"Getters must return a value"),h?(n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)&&h!=i.returnType.type||t.arguments.members.length>0&&h!=t.arguments.members[0].type)&&this.checker.errorReporter.simpleError(t,"Getter and setter types do not agree"):n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?t.accessorSymbol.setType(i.returnType.type):t.arguments.members.length!=1?this.checker.errorReporter.simpleError(t,"Setters may have one and only one argument"):t.accessorSymbol.setType(t.arguments.members[0].type)),this.typeCheckOverloadSignatures(u,t),t},t.prototype.typeCheckBases=function(t){var e=!1,u=t.extendsList,o=t.extendsTypeLinks,s,i,h;if(u)for(s=u.length,s>0&&(t.typeFlags|=n.TypeFlags.HasBaseType),i=0;i<s;i++){u[i]==this.checker.anyType&&(o[i].type=null,h=this.checker.errorReporter.getCapturedErrors(),n.CompilerDiagnostics.assert(h.length==0,"There shouldnt be any contextual errors when typechecking base type names"),this.checker.errorReporter.pushToErrorSink=!0,u[i]=this.checker.resolveBaseTypeLink(o[i],t.containedScope),this.checker.errorReporter.pushToErrorSink=!1,this.checker.errorReporter.freeCapturedErrors());var r=u[i],f=o[i].ast,c=r.symbol&&r.symbol.name=="Object"&&r.symbol.container==this.checker.gloMod;if(c&&(t.typeFlags|=n.TypeFlags.HasBaseTypeOfObject),r.isClassInstance())t.isClassInstance()?e&&this.checker.errorReporter.simpleError(f,"Class may not follow interface as base type"):this.checker.errorReporter.simpleError(f,"Interface base type must be interface");else if(r.isModuleType())this.checker.errorReporter.simpleError(f,"Types may not be derived from module types");else if(r.members)e||(e=!0);else{t.isClassInstance()?this.checker.errorReporter.simpleError(f,"Base type must be interface or class"):this.checker.errorReporter.simpleError(f,"Interface base type must be interface");break}}},t.prototype.checkMembersImplementInterfaces=function(t){var i=t.getInstanceType(),o,r,f,u,e;if(i.implementsList)for(o=i.implementsList.length,r=0;r<o;r++)f=i.implementsList[r],u=new n.TypeComparisonInfo,this.checker.sourceIsSubtypeOfTarget(i,f,u)||(e="Class '"+i.getTypeName()+"' declares interface '"+f.getTypeName()+"' but does not implement it",u.message?this.checker.errorReporter.simpleErrorFromSym(i.symbol,e+": "+u.message):this.checker.errorReporter.simpleErrorFromSym(i.symbol,e))},t.prototype.typeCheckBaseCalls=function(t){var u,i,r,f;if(t!=null)for(u=t.members.length,i=0;i<u;i++)r=t.members[i],f=null,r.nodeType==n.NodeType.Call&&this.typeCheckNew(r)},t.prototype.assertUniqueNamesInBaseTypes=function(t,i,r,u){var o=this,e,f;if(i&&(i.members&&i.members.publicMembers.map(function(n,f){var s=f,h=t.lookup(s.name);h?u&&o.checker.errorReporter.simpleError(r,"duplicate member name in bases for "+r.name.actualText+": "+i.symbol.name+" and "+h.container.name+" both contain member with name "+s.name):t.add(s.name,s)},null),i.extendsList))for(e=i.extendsList.length,f=0;f<e;f++)i.extendsList[f].symbol.flags&n.SymbolFlags.RecursivelyReferenced||this.assertUniqueNamesInBaseTypes(t,i.extendsList[f],r,u)},t.prototype.checkBaseTypeMemberInheritance=function(t,i){var f=this,r=t.getInstanceType(),e,o,u;if(r.extendsList!=null&&(e=r.extendsList.length,e>0)){if(o=new n.StringHashTable,r.isClassInstance())for(u=0;u<e;u++)this.assertUniqueNamesInBaseTypes(o,r.extendsList[u],i,u>0);r.members&&r.members.publicMembers.map(function(t,u){for(var s=u,l,h,a,v,c=0;c<e;c++)l=r.extendsList[c],l.memberScope==null?f.checker.errorReporter.simpleError(i,"Base type '"+l.symbol.name+"' lacks an implementation."):(h=l.memberScope.find(s.name,!1,!1),h&&(a=s.getType(),v=h.getType(),f.checker.sourceIsSubtypeOfTarget(a,v)?s.kind()==n.SymbolKind.Type&&h.kind()==n.SymbolKind.Field&&f.checker.errorReporter.simpleErrorFromSym(s,"Cannot override field '"+s.name+"' with method"):f.checker.errorReporter.simpleErrorFromSym(s,"Type of overridden member '"+s.name+"' is not subtype of original member defined by type '"+h.container.name+"'")))},null)}},t.prototype.typeCheckClass=function(t){var r=t.type.symbol,u,f,i,e,o,s;return r.typeCheckStatus==n.TypeCheckStatus.Finished?t:r.typeCheckStatus==n.TypeCheckStatus.Started?t:(r.typeCheckStatus=n.TypeCheckStatus.Started,this.checker.addStartedPTO(r),u=this.scope,f=this.thisClassNode,this.thisClassNode=t,i=t.type,this.typeCheckBases(i.instanceType),this.typeCheckBaseListPrivacy(t.extendsList,r,!0),this.typeCheckBaseListPrivacy(t.implementsList,r,!1),e=this.thisType,this.thisType=i.instanceType,this.scope=i.instanceType.containedScope,t.constructorDecl&&(this.scope=i.instanceType.constructorScope,o=this.scope,s=o.valueMembers.allMembers,this.addConstructorLocalArgs(t.constructorDecl.type.symbol,t.constructorDecl.arguments,s,!0)),this.typeCheck(t.members),r.typeCheckStatus=n.TypeCheckStatus.Finished,this.checkBaseTypeMemberInheritance(i,t),this.checkMembersImplementInterfaces(i),this.typeCheckOverloadSignatures(i,t),this.typeCheckOverloadSignatures(i.instanceType,t),t.constructorDecl||t.extendsList&&t.extendsList.members.length&&t.extendsList.members[0].type&&t.extendsList.members[0].type.symbol.type.isClass()&&n.cloneParentConstructGroupForChildType(t.type,t.extendsList.members[0].type.symbol.type),this.thisType=e,this.thisClassNode=f,this.scope=u,t)},t.prototype.typeCheckOverloadSignatures=function(n,t){n.call&&n.call.typeCheck(this.checker,t,n.construct!=null),n.construct&&n.construct.typeCheck(this.checker,t,!1),n.index&&n.index.typeCheck(this.checker,t,!1)},t.prototype.typeCheckInterface=function(n){if(this.typeCheckBases(n.type),this.typeCheckBaseListPrivacy(n.extendsList,n.type.symbol,!0),this.typeCheck(n.members),this.checkBaseTypeMemberInheritance(n.type,n),n.extendsList)for(var t=0;t<n.extendsList.members.length;t++)n.extendsList.members[t].type.call&&(n.type.call?n.type.call.signatures=n.type.call.signatures.concat(n.extendsList.members[t].type.call.signatures):n.type.call=n.extendsList.members[t].type.call),n.extendsList.members[t].type.construct&&(n.type.construct?n.type.construct.signatures=n.type.construct.signatures.concat(n.extendsList.members[t].type.construct.signatures):n.type.construct=n.extendsList.members[t].type.construct),n.extendsList.members[t].type.index&&(n.type.index?n.type.index.signatures=n.type.index.signatures.concat(n.extendsList.members[t].type.index.signatures):n.type.index=n.extendsList.members[t].type.index);return n},t.prototype.typeCheckImportDecl=function(t){var i=t.alias.type,r=null,u=this.inImportTypeCheck;return this.inImportTypeCheck=!0,this.typeCheck(t.alias),i=t.alias.type,i==null&&(this.checker.errorReporter.simpleError(t.alias,"Could not resolve module alias '"+t.id.actualText+"'"),i=this.checker.anyType,t.id.sym.type=i),t.id.type=i,r=i.symbol,i.isModuleType()?(r.type=i,this.checker.typeFlow.currentScript&&this.checker.typeFlow.currentScript.topLevelMod&&this.checker.typeFlow.currentScript.topLevelMod.mod&&this.checker.typeFlow.currentScript.topLevelMod.mod.importedModules.push(t),t.id.sym.type=i,i.symbol&&i.symbol.declAST&&(i.symbol.declAST.modFlags&=~n.ModuleFlags.ShouldEmitModuleDecl)):this.checker.errorReporter.simpleError(t.alias,"A module cannot be aliased to a non-module type"),this.inImportTypeCheck=u,t},t.prototype.typeCheckModule=function(t){if(!t.mod)return t;this.currentScript&&(this.currentScript.requiresGlobal=!0);var i=t.mod,r=null,u=this.scope,f=this.thisType,e=this.checker.currentModDecl;return this.checker.currentModDecl=t,this.thisType=null,this.scope=i.containedScope,this.typeCheck(t.members),r=i.symbol,this.checker.currentModDecl=e,this.thisType=f,this.scope=u,t.type=i,r&&(r.typeCheckStatus=n.TypeCheckStatus.Finished),t},t.prototype.typeCheckFor=function(n){return n.init=this.typeCheck(n.init),this.nestingLevel++,n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.incr=this.typeCheck(n.incr),this.nestingLevel--,n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"for statement"),n.type=this.voidType,n},t.prototype.typeCheckWith=function(n){return this.checker.errorsOnWith&&this.checker.errorReporter.simpleError(n.expr,"All symbols within a 'with' block will be typed as 'any'"),n.expr=this.typeCheck(n.expr),this.checker.inWith=!0,n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"with statement"),this.checker.inWith=!1,n},t.prototype.typeCheckForIn=function(t){if(t.obj=this.typeCheck(t.obj),t.lval=this.cast(this.typeCheck(t.lval),this.checker.stringType),t.lval.nodeType==n.NodeType.VarDecl){var i=t.lval;i.typeExpr&&this.checker.errorReporter.simpleError(i,"Variable declarations for for/in expressions may not contain a type annotation"),i.sym&&i.sym.setType(this.checker.stringType)}return t.body=this.typeCheck(t.body),this.typeCheckCompoundStmtBlock(t.body,"for in statement"),t},t.prototype.typeCheckWhile=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"while statement"),n.type=this.voidType,n},t.prototype.typeCheckDoWhile=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.body=this.typeCheck(n.body),this.typeCheckCompoundStmtBlock(n.body,"do while statement"),n.type=this.voidType,n},t.prototype.typeCheckCondExpr=function(t){this.checker.styleSettings.assignmentInCond&&t!==null&&t.nodeType>=n.NodeType.Asg&&t.nodeType<=n.NodeType.LastAsg&&this.checker.errorReporter.simpleError(t,"top-level assignment statement in conditional expression")},t.prototype.typeCheckCompoundStmtBlock=function(t,i){this.checker.styleSettings.blockInCompoundStmt&&t&&t.nodeType!=n.NodeType.Block&&this.checker.errorReporter.styleError(t,i+" requires a block")},t.prototype.typeCheckIf=function(n){return n.cond=this.typeCheck(n.cond),this.typeCheckCondExpr(n.cond),n.thenBod=this.typeCheck(n.thenBod),n.elseBod=this.typeCheck(n.elseBod),this.typeCheckCompoundStmtBlock(n.thenBod,"if statement"),this.typeCheckCompoundStmtBlock(n.elseBod,"if statement"),n.type=this.voidType,n},t.prototype.typeFromAccessorFuncDecl=function(t){return t.isAccessor()?n.hasFlag(t.fncFlags,n.FncFlags.GetAccessor)?t.type.call.signatures[0].returnType.type:t.type.call.signatures[0].parameters[0].getType():null},t.prototype.typeCheckObjectLit=function(t){var r=new n.Type,a,v,b,p,w,h,k,l;r.symbol=new n.TypeSymbol(this.checker.anon,t.minChar,t.limChar-t.minChar,this.checker.locationInfo.unitIndex,r),r.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),r.memberScope=new n.SymbolTableScope(r.members,null,null,null,null),a=new n.SymbolAggregateScope(r.symbol),a.addParentScope(r.memberScope),a.addParentScope(this.scope),r.containedScope=a;var y=t.operand,d=this.thisType,c=!1,u=null;if(this.checker.hasTargetType()&&(u=this.checker.getTargetTypeContext().contextualType,u&&u.symbol&&!this.checker.typeStatusIsFinished(u.symbol.typeCheckStatus)&&u.symbol.declAST&&this.typeCheck(u.symbol.declAST),c=!0),y)for(v=0,b=y.members.length;v<b;v++){var i=y.members[v],e=i.operand1,s,o=null,f=null;if(e.nodeType==n.NodeType.Name)s=e.text;else if(e.nodeType==n.NodeType.QString)p=e.text,s=p.substring(1,p.length-1);else{this.checker.errorReporter.simpleError(t,"malformed object literal"),r=this.anyType;break}c&&u.memberScope&&(o=u.memberScope.find(s,!1,!1)),i.operand2.nodeType==n.NodeType.FuncDecl&&i.operand2.isAccessor()&&(w=i.operand2,h=r.members.publicMembers.lookup(s),h=this.checker.createAccessorSymbol(w,h,r,!0,!1,r.memberScope,null),w.accessorSymbol=h,f=h,e.nodeType==n.NodeType.Name&&(e.sym=h)),this.checker.typeCheckWithContextualType(c&&o?o.getType():null,!1,c,i.operand2),c&&o?(i.operand2.type==this.anyType||this.checker.sourceIsAssignableToTarget(i.operand2.type,o.getType())||i.operand2.nodeType==n.NodeType.FuncDecl&&i.operand2.isAccessor()&&this.typeFromAccessorFuncDecl(i.operand2)==o.getType())&&(i.operand1.type=o.getType()):i.operand2.type=i.operand2.type==this.checker.undefinedType?this.anyType:i.operand2.type,f==null&&(k=i.operand2.type,l=new n.ValueLocation,f=new n.FieldSymbol(s,e.minChar,this.checker.locationInfo.unitIndex,!0,l),f.flags|=n.SymbolFlags.Property,l.symbol=f,f.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),l.typeLink=new n.TypeLink,l.typeLink.type=k,r.members.publicMembers.add(s,f)),f.isObjectLitField=!0}this.thisType=d,t.type=r,u&&(t.targetType=u)},t.prototype.typeCheckArrayLit=function(t){var u=t.operand,i=this.anyType,r=null,f=new n.TypeComparisonInfo,e,o,h,s;f.onlyCaptureFirstError=!0,this.checker.hasTargetType()&&(e=this.checker.getTargetTypeContext().contextualType,e.elementType&&(r=e.elementType)),u&&(o=this.inArrayElementTypeCheck,this.inArrayElementTypeCheck=!0,this.checker.typeCheckWithContextualType(r,this.checker.inProvisionalTypecheckMode(),r!=null,u),this.inArrayElementTypeCheck=o,i=u.members[0].type,h={getLength:function(){return u.members.length},setTypeAtIndex:function(n,t){u.members[n].type=t},getTypeAtIndex:function(n){return u.members[n].type}},i=this.checker.findBestCommonType(i,r,h,!1,f),i!=this.checker.undefinedType&&(o||i!=this.nullType)||(i=this.anyType)),i?r&&this.checker.sourceIsAssignableToTarget(i,r)&&(i=r):(s="Incompatible types in array literal expression",f.message?this.checker.errorReporter.simpleError(t,s+": "+f.message):this.checker.errorReporter.simpleError(t,s),i=this.anyType),t.type=this.checker.makeArrayType(i)},t.prototype.checkForVoidConstructor=function(n,t){if(n&&n.construct&&n.construct.signatures.length>0)for(var i=0;i<n.construct.signatures.length;i++)if(n.construct.signatures[i].returnType.type==this.checker.voidType){this.checker.errorReporter.simpleError(t,"Constructors may not have a return type of 'void'");break}},t.prototype.typeCheckReturn=function(t){var i,e,f,u,r;return this.thisFnc&&(i=null,this.checker.hasTargetType()&&(e=this.checker.getTargetTypeContext(),f=e.targetAccessorType,f?i=f:(u=this.checker.getTargetTypeContext().targetSig,u&&u.returnType.type!=this.voidType&&(i=u.returnType.type))),t.returnExpression?(this.thisFnc.fncFlags|=n.FncFlags.HasReturnExpression,i==null&&this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type&&this.thisFnc.returnTypeAnnotation.type!=this.voidType&&(i=this.thisFnc.returnTypeAnnotation.type),this.checker.typeCheckWithContextualType(i,this.checker.inProvisionalTypecheckMode(),i!=null,t.returnExpression),r=this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type?this.thisFnc.returnTypeAnnotation.type:i,r?r==this.voidType&&t.returnExpression.type!=this.voidType?(this.checker.errorReporter.simpleError(t,"Return with value expression in void function"),t.type=t.returnExpression.type):(t.returnExpression=this.cast(t.returnExpression,r),t.type=r):(i&&(t.returnExpression.type!=this.voidType?t.returnExpression=this.cast(t.returnExpression,i):t.returnExpression.type=i),t.type=t.returnExpression.type),this.thisFnc.returnStatementsWithExpressions[this.thisFnc.returnStatementsWithExpressions.length]=t):t.type=i==null?this.checker.voidType:i),t},t.prototype.typeCheckInstOf=function(n){var t=n;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),(t.operand1.type==this.checker.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand1.type,this.objectInterfaceType))&&(t.operand2.type==this.anyType||this.checker.sourceIsSubtypeOfTarget(t.operand2.type,this.functionInterfaceType))||this.checker.errorReporter.simpleError(n,"The instanceof operator requires the left operand to be of type Any or an object type, and the right operand to be of type Any or a subtype of the Function interface type"),t.type=this.booleanType,t},t.prototype.typeCheckCommaOperator=function(n){var t=n;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),t.type=t.operand2.type,t},t.prototype.typeCheckLogOr=function(n){n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2);var t=n.operand1.type,i=n.operand2.type;return n.type=t==this.checker.anyType||i==this.checker.anyType?this.checker.anyType:t==this.checker.booleanType?i==this.checker.booleanType?this.checker.booleanType:this.checker.anyType:t==this.checker.numberType?i==this.checker.numberType?this.checker.numberType:this.checker.anyType:t==this.checker.stringType?i==this.checker.stringType?this.checker.stringType:this.checker.anyType:this.checker.sourceIsSubtypeOfTarget(t,i)?i:this.checker.sourceIsSubtypeOfTarget(i,t)?t:this.checker.anyType,n},t.prototype.typeCheckLogAnd=function(n){return n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2),n.type=n.operand2.type,n},t.prototype.tryAddCandidates=function(n,t,i,r,u){var v=n.nonOptionalParameterCount,y=n.parameters.length,e=v,o=!1,s,f,h,c;if(t.length>=v&&(n.hasVariableArgList||t.length<=y)&&(e=n.hasVariableArgList?n.parameters.length:t.length,o=!0),s=null,o||n.hasVariableArgList){n.hasVariableArgList&&(e-=1,s=n.parameters[e].parameter.typeLink.type,s=s.elementType,o=t.length>=e);var p=t.length,l=o,a=o;for(f=0;f<p;f++)if(h=f<e?n.parameters[f].parameter.typeLink.type:s,c=t[f],h&&c&&this.checker.typesAreIdentical(h,c)||(l=!1),this.checker.sourceIsAssignableToTarget(c,h,u)||(a=!1),!(l||a))break;l?i[i.length]=n:a&&i.length==0&&(r[r.length]=n)}},t.prototype.resolveOverload=function(t,i){var c=this.resolutionDataCache.getResolutionData(),p=c.actuals,f=c.exactCandidates,d=c.conversionCandidates,l=null,tt=i.signatures.length>1,a=new n.TypeComparisonInfo,e=null,o=null,s,g,v,y,nt,u,w,b,k,r,h;if(t.nodeType==n.NodeType.Call||t.nodeType==n.NodeType.New){if(s=t,e=s.arguments,o=s.target,s.arguments)for(g=s.arguments.members.length,r=0;r<g;r++)p[r]=s.arguments.members[r].type}else t.nodeType==n.NodeType.Index&&(v=t,o=v.operand1,e=new n.ASTList,e.members[0]=v.operand2,p[0]=v.operand2.type);for(y=0,nt=i.signatures.length;y<nt;y++)(u=i.signatures[y],!tt||u!=i.definitionSignature||this.checker.canCallDefinitionSignature)&&(!u.returnType.type&&u.declAST&&u.typeCheckStatus!=n.TypeCheckStatus.Finished&&this.typeCheckFunction(u.declAST),this.tryAddCandidates(u,p,f,d,a));if(f.length==0)w=this.checker.getApplicableSignatures(d,e,a),w.length>0?(h=this.checker.findMostApplicableSignature(w,e),h.ambiguous&&this.checker.errorReporter.simpleError(o,"Ambiguous call expression - could not choose overload"),l=h.sig):(b="Supplied parameters do not match any signature of call target",a.message?this.checker.errorReporter.simpleError(o,b+":\n\t"+a.message):this.checker.errorReporter.simpleError(o,b));else if(f.length>1){for(k=[],r=0;r<f.length;r++)k[r]={signature:f[r],hadProvisionalErrors:!1};h=this.checker.findMostApplicableSignature(k,e),h.ambiguous&&this.checker.errorReporter.simpleError(o,"Ambiguous call expression - could not choose overload"),l=h.sig}else l=f[0];return this.resolutionDataCache.returnResolutionData(c),l},t.prototype.typeCheckNew=function(n){var t=n,r,i;return t.target=this.typeCheck(t.target),r=t.target,r.type.construct||r.type.call?this.preTypeCheckCallArgs(t.arguments):t.arguments=this.typeCheck(t.arguments),r.type==this.anyType?(t.type=this.anyType,t.arguments=this.typeCheck(t.arguments)):r.type.construct?(i=this.resolveOverload(t,r.type.construct),i==null?t.type=this.anyType:i.returnType.type==this.voidType?(t.type=this.anyType,t.signature=i):(t.type=i.returnType.type,t.signature=i)):r.type.call?(i=this.resolveOverload(t,r.type.call),i==null?t.type=this.anyType:i.returnType.type==this.voidType||i.returnType.type==this.anyType?(t.type=this.anyType,t.signature=i):this.checker.errorReporter.simpleError(t.target,"new expression only valid on constructors")):r.type.elementType?t.type=r.type:(this.checker.errorReporter.invalidCall(t,t.nodeType,this.scope),t.type=this.anyType),this.postTypeCheckCallArgs(t),t},t.prototype.preTypeCheckCallArgs=function(t){if(t)for(var i=0;i<t.members.length;i++)switch(t.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:continue;default:this.typeCheck(t.members[i])}},t.prototype.postTypeCheckCallArgs=function(t){var e=!1,i=0,r,f,h;if(t.target&&t.target.type&&t.signature&&t.arguments&&(r=t.signature,r&&t.arguments.members.length>=r.nonOptionalParameterCount)){e=!0;var u=null,o=r.hasVariableArgList?r.parameters.length-1:r.parameters.length,s=t.arguments.members.length<o?t.arguments.members.length:o;for(i=0;i<s;i++){u=r.parameters[i].getType();switch(t.arguments.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:this.checker.typeCheckWithContextualType(u,this.checker.inProvisionalTypecheckMode(),!r.parameters[i].declAST.isParenthesized,t.arguments.members[i])}}if(r.hasVariableArgList)for(f=r.nonOptionalParameterCount-1,u=r.parameters[f].getType(),u&&(u=u.elementType),h=!r.parameters[f].declAST.isParenthesized,i=s;i<t.arguments.members.length;i++)switch(t.arguments.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:this.checker.typeCheckWithContextualType(u,this.checker.inProvisionalTypecheckMode(),h,t.arguments.members[i])}}if(!e&&t.arguments)for(this.checker.killCurrentContextualType(),i=0;i<t.arguments.members.length;i++)switch(t.arguments.members[i].nodeType){case n.NodeType.FuncDecl:case n.NodeType.ObjectLit:case n.NodeType.ArrayLit:this.typeCheck(t.arguments.members[i]);break;default:continue}},t.prototype.typeCheckCall=function(t){var i=t,e,u,f,r;return this.checker.styleSettings.newMustBeUsed&&t.nodeType==n.NodeType.New?n.hasFlag(t.flags,n.ASTFlags.IsStatement)&&this.checker.errorReporter.styleError(t,"use of new expression as a statement"):this.checker.styleSettings.evalOK||t.nodeType!=n.NodeType.Call||i.target.nodeType==n.NodeType.Name&&i.target.text=="eval"&&this.checker.errorReporter.styleError(i,"eval not permitted"),i.target.nodeType==n.NodeType.FuncDecl&&(i.target.isInlineCallLiteral=!0),e=this.inSuperCall,i.target.nodeType==n.NodeType.Super&&(this.inSuperCall=!0),i.target=this.typeCheck(i.target),this.preTypeCheckCallArgs(i.arguments),u=i.target,u.type==null||u.type==this.anyType||this.functionInterfaceType&&u.type==this.functionInterfaceType?i.type=this.anyType:(f=u.type,f.call?(r=this.resolveOverload(i,f.call),r==null?i.type=this.anyType:(i.type=r.returnType.type,i.signature=r)):i.target.nodeType==n.NodeType.Super&&this.thisFnc&&this.thisFnc.isConstructor&&n.hasFlag(this.thisFnc.fncFlags,n.FncFlags.ClassMethod)?(r=f.symbol.type.construct?this.resolveOverload(i,f.symbol.type.construct):null,r==null?i.type=this.anyType:(i.flags|=n.ASTFlags.ClassBaseConstructorCall,i.type=r.returnType.type,i.signature=r)):(i.type=this.anyType,this.checker.errorReporter.invalidCall(i,i.nodeType,this.scope))),this.postTypeCheckCallArgs(i),this.inSuperCall=e,i},t.prototype.assignScopes=function(t){var u=t,i,r;this.checker.locationInfo=u.locationInfo,i=new f(this.checker.gloMod,null,this.globalScope),r=new n.AssignScopeContext(i,this,[this.checker.currentModDecl]),n.getAstWalkerFactory().walk(t,n.preAssignScopes,n.postAssignScopes,null,r)},t.prototype.findMemberScope=function(t,i){var f=t.getScope(),e=t.pos-t.getScriptFragmentPosition(),u=t.getScriptFragment(),r=new n.MemberScopeContext(this,e,i);return r.scope=f,u.nodeType==n.NodeType.Name?u.type.getMemberScope(this):(n.getAstWalkerFactory().walk(u,n.preFindMemberScope,null,null,r),r.ast&&t.enclosingClassDecl&&r.ast.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),r.type?r.type.getMemberScope(this):null)},t.prototype.findMemberScopeAt=function(t){return this.findMemberScope(t,n.ASTFlags.DotLHS)},t.prototype.findMemberScopeAtFullAst=function(t){var u=n.ASTFlags.DotLHS,i=t.pos,r=null,f=function(t,f,e){return n.isValidAstNode(t)&&(n.hasFlag(t.flags,u)&&(i==t.limChar||i-1==t.limChar)&&(r=t,e.options.stopWalk()),e.options.goChildren=t.minChar<=i&&i<=t.limChar),t},e=function(t,f,e){return n.isValidAstNode(t)&&(n.hasFlag(t.flags,u)&&t.minChar<i&&i<=t.limChar&&(r=t),e.options.goChildren=t.minChar<=i&&i<=t.limChar),t};return n.getAstWalkerFactory().walk(t.script,f),r==null&&n.getAstWalkerFactory().walk(t.script,e),r&&t.enclosingClassDecl&&r.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),r&&r.type?r.type.getMemberScope(this):null},t}(),n.TypeFlow=s}(TypeScript||(TypeScript={})),function(n){function h(n,t,i){var r=new e;return r.ast=n,r.type=n==null&&i?t.anyType:null,r}var i,t,u,r,o,f,s,e;(function(n){n._map=[],n.None=0,n.Void=1,n.Double=2,n.String=4,n.Boolean=8,n.Any=16,n.Null=32,n.Undefined=64})(n.Primitive||(n.Primitive={})),i=n.Primitive,t=function(){function n(){this.prefix="",this.suffix=""}return n.prototype.isString=function(){return!1},n.prototype.isArray=function(){return!1},n.prototype.toString=function(){return n.memberNameToString(this)},n.memberNameToString=function(t){var i=t.prefix,r,u;if(t.isString())i+=t.text;else for(r=t,u=0;u<r.entries.length;u++)i+=n.memberNameToString(r.entries[u]),i+=r.delim;return i+=t.suffix},n.create=function(n,t,i){if(typeof n=="string")return new u(n);var f=new r;return t&&(f.prefix=t),i&&(f.suffix=i),f.entries.push(n),f},n}(),n.MemberName=t,u=function(n){function t(t){n.call(this),this.text=t}return __extends(t,n),t.prototype.isString=function(){return!0},t}(t),n.MemberNameString=u,r=function(n){function t(){n.apply(this,arguments),this.delim="",this.entries=[]}return __extends(t,n),t.prototype.isArray=function(){return!0},t.prototype.add=function(n){this.entries.push(n)},t.prototype.addAll=function(n){for(var t=0;t<n.length;t++)this.entries.push(n[t])},t}(t),n.MemberNameArray=r,o=-1,f=function(){function u(){this.typeID=o++,this.construct=null,this.call=null,this.index=null,this.passTypeCreated=n.CompilerDiagnostics.analysisPass,this.primitiveTypeClass=i.None,this.typeFlags=n.TypeFlags.None}return u.prototype.baseClass=function(){return this.extendsList&&this.extendsList.length>0?this.extendsList[0]:null},u.prototype.getArrayBase=function(n,t){return this.arrayCache.specialize(n,t)},u.prototype.isClass=function(){return this.instanceType!=null},u.prototype.isArray=function(){return this.elementType!=null},u.prototype.isClassInstance=function(){return this.symbol&&!this.elementType&&this.symbol.type.isClass()},u.prototype.getInstanceType=function(){return this.isClass()?this.instanceType:this},u.prototype.hasImplementation=function(){return n.hasFlag(this.typeFlags,n.TypeFlags.HasImplementation)},u.prototype.setHasImplementation=function(){this.typeFlags|=n.TypeFlags.HasImplementation},u.prototype.isDouble=function(){return n.hasFlag(this.primitiveTypeClass,i.Double)},u.prototype.isString=function(){return n.hasFlag(this.primitiveTypeClass,i.String)},u.prototype.isBoolean=function(){return n.hasFlag(this.primitiveTypeClass,i.Boolean)},u.prototype.isNull=function(){return n.hasFlag(this.primitiveTypeClass,i.Null)},u.prototype.getTypeName=function(){return this.getMemberTypeName("",!0,!1,null)},u.prototype.getScopedTypeName=function(n){return this.getMemberTypeName("",!0,!1,n)},u.prototype.getScopedTypeNameEx=function(n){return this.getMemberTypeNameEx("",!0,!1,n)},u.prototype.callCount=function(){var n=0;return this.call&&(n+=this.call.signatures.length),this.construct&&(n+=this.construct.signatures.length),this.index&&(n+=this.index.signatures.length),n},u.prototype.getMemberTypeName=function(n,t,i,r){var u=this.getMemberTypeNameEx(n,t,i,r);return u.toString()},u.prototype.getMemberTypeNameEx=function(i,u,f,e){var s;if(this.elementType)return t.create(this.elementType.getMemberTypeNameEx(i,!1,!0,e),"","[]");if(this.symbol&&this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||n.hasFlag(this.typeFlags,n.TypeFlags.BuildingName)||this.members&&!this.isClass()))return s=this.symbol.scopeRelativeName(e),t.create(s=="null"?"any":s);if(this.members||this.call||this.construct){if(n.hasFlag(this.typeFlags,n.TypeFlags.BuildingName))return t.create("this");this.typeFlags|=n.TypeFlags.BuildingName;var y="",o=new r,h=f||this.index!=null,v=0,c="; ";this.members&&this.members.allMembers.map(function(t,i){var f=i,u;n.hasFlag(f.flags,n.SymbolFlags.BuiltIn)||(u=f.getTypeNameEx(e),u.isArray()&&u.delim==c?o.addAll(u.entries):o.add(u),v++,h=!0)},null);var l=this.callCount(),p,w=0,a=!h&&l==1&&u;return this.call&&o.addAll(this.call.toStrings(i,a,e)),this.construct&&o.addAll(this.construct.toStrings("new",a,e)),this.index&&o.addAll(this.index.toStrings("",a,e)),h||l>1&&u?(o.prefix="{ ",o.suffix="}",o.delim=c):o.entries.length>1&&(o.delim=c),this.typeFlags&=~n.TypeFlags.BuildingName,l==0&&v==0?t.create("{}"):o}return t.create("{}")},u.prototype.checkDecl=function(n){(this.isClassInstance()||this.isClass())&&this.symbol.declAST&&n.typeFlow.inScopeTypeCheckDecl(this.symbol.declAST)},u.prototype.getMemberScope=function(n){if(this==n.anyType)return null;if(this.isDouble())return n.numberInterfaceType?n.numberInterfaceType.memberScope:null;if(this.isBoolean())return n.booleanInterfaceType?n.booleanInterfaceType.memberScope:null;if(this==n.stringType)return n.stringInterfaceType?n.stringInterfaceType.memberScope:null;if(this.elementType){if(n.arrayInterfaceType){var t=this.elementType.getArrayBase(n.arrayInterfaceType,n.checker);return t.memberScope}return null}return this.memberScope},u.prototype.isReferenceType=function(){return this.members||this.extendsList||this.construct||this.call||this.index||this.elementType},u.prototype.specializeType=function(t,i,r,f){if(t==this)return i;var e=this;return f?this.isReferenceType()&&(e=new u,this.members&&(e.members=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.members.publicMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.members.addPublicMember(o.name,o)},null),this.members.privateMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.members.addPrivateMember(o.name,o)},null)),this.ambientMembers&&(e.ambientMembers=new n.ScopedMembers(new n.DualStringHashTable(new n.StringHashTable,new n.StringHashTable)),this.ambientMembers.publicMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.ambientMembers.addPublicMember(o.name,o)},null),this.ambientMembers.privateMembers.map(function(n,u){var s=u,o=s.specializeType(t,i,r);e.ambientMembers.addPrivateMember(o.name,o)},null)),e.containedScope=r.scopeOf(e),e.memberScope=e.containedScope):this.elementType?this.elementType==t?e=r.makeArrayType(i):this.elementType.elementType==t&&(e=r.makeArrayType(r.makeArrayType(i))):this.call&&(e=new u,e.call=this.call.specializeType(t,i,r)),e},u.prototype.hasBase=function(n){if(n==this)return!0;if(this.extendsList)for(var t=0,i=this.extendsList.length;t<i;t++)if(this.extendsList[t].hasBase(n))return!0;return!1},u.prototype.mergeOrdered=function(n,t,i,r){if(this==t.anyType||n==t.anyType)return t.anyType;if(this==n||n==t.nullType&&this!=t.nullType)return this;if(this==t.nullType&&n!=t.nullType)return n;if(i&&n==t.voidType&&this!=t.voidType)return this;if(i&&this==t.voidType&&n!=t.voidType)return n;if(n==t.undefinedType&&this!=t.undefinedType)return this;if(this==t.undefinedType&&n!=t.undefinedType)return n;if(this.elementType&&n.elementType){if(this.elementType==n.elementType)return this;var u=this.elementType.mergeOrdered(n.elementType,t,i,r);return u==null?t.makeArrayType(t.anyType):t.makeArrayType(u)}return t.sourceIsSubtypeOfTarget(this,n,r)?n:t.sourceIsSubtypeOfTarget(n,this,r)?this:null},u.prototype.isModuleType=function(){return!1},u.prototype.hasMembers=function(){return this.members!=null},u.prototype.getAllEnclosedTypes=function(){return null},u.prototype.getAllAmbientEnclosedTypes=function(){return null},u.prototype.getPublicEnclosedTypes=function(){return null},u.prototype.getpublicAmbientEnclosedTypes=function(){return null},u.prototype.getDocComments=function(){return this.elementType||!this.symbol?[]:this.isClassInstance()||this.isClass()?this.symbol.declAST.nodeType==n.NodeType.FuncDecl?this.symbol.declAST.classDecl.getDocComments():this.symbol.getDocComments():this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||this.members)?this.symbol.getDocComments():[]},u}(),n.Type=f,s=function(t){function i(n,i){t.call(this),this.enclosedTypes=n,this.ambientEnclosedTypes=i,this.importedModules=[]}return __extends(i,t),i.prototype.isModuleType=function(){return!0},i.prototype.hasMembers=function(){return this.members!=null||this.enclosedTypes!=null},i.prototype.getAllEnclosedTypes=function(){return this.enclosedTypes},i.prototype.getAllAmbientEnclosedTypes=function(){return this.ambientEnclosedTypes},i.prototype.getPublicEnclosedTypes=function(){return null},i.prototype.getpublicAmbientEnclosedTypes=function(){return null},i.findDynamicModuleNameInHashTable=function(t,i){var r=null;return i.map(function(i,u){if(r==null&&!n.isQuoted(i)){var e=u,o=e.getType();o==t&&(r={name:i,symbol:e})}},null),r},i.prototype.findDynamicModuleName=function(n){var t=null;return t=i.findDynamicModuleNameInHashTable(n,this.members.allMembers),t==null&&(t=i.findDynamicModuleNameInHashTable(n,this.ambientMembers.allMembers)),t},i}(f),n.ModuleType=s,e=function(){function n(){this.type=null,this.ast=null}return n}(),n.TypeLink=e,n.getTypeLink=h}(TypeScript||(TypeScript={})),function(n){function t(n){return n.replace('"',"").replace("'","").replace("'","").replace('"',"")}function p(n){return n.indexOf('"')!=-1||n.indexOf("'")!=-1||n.indexOf("'")!=-1||n.indexOf('"')!=-1}function e(n){return'"'+n+'"'}function w(n){return n.indexOf('"')!=-1?(n=n.replace('"',"'"),n=n.replace('"',"'")):(n=n.replace("'",'"'),n=n.replace("'",'"')),n}function r(n){return n.replace(/\\/g,"/")}function i(n){return n.length>6&&n.substring(n.length-6,n.length)==".d.str"?n.substring(0,n.length-6):n.length>4&&n.substring(n.length-4,n.length)==".str"?n.substring(0,n.length-4):n.length>5&&n.substring(n.length-5,n.length)==".d.ts"?n.substring(0,n.length-5):n.length>3&&n.substring(n.length-3,n.length)==".ts"?n.substring(0,n.length-3):n.length>3&&n.substring(n.length-3,n.length)==".js"?n.substring(0,n.length-3):n}function b(n){return s(n)?l(n):h(n)?o(n):o(n)}function u(n,t){var i=n.toLocaleUpperCase(),r=t.toLocaleUpperCase(),u=r.length;return i.length>u&&i.substring(i.length-u,i.length)==r}function k(n){return u(n,".js")}function s(n){return u(n,".str")}function h(n){return u(n,".ts")}function d(n){return u(n,".d.str")}function g(n){return u(n,".d.ts")}function nt(n,u,f){typeof u=="undefined"&&(u=!0),typeof f=="undefined"&&(f=!1);var s=f?r(n):i(t(n)),o=this.getPathComponents(s);return o.length?u?e(o[o.length-1]):o[o.length-1]:n}function c(n){return n.split("/")}function tt(n,t){var e,o;t=r(t);for(var u=this.getPathComponents(t),f=this.getPathComponents(n),i=0;i<u.length&&i<f.length;i++)if(f[i]!=u[i])break;if(i!=0){for(e="",o=u.slice(i,u.length);i<f.length;i++)f[i]!=""&&(e=e+"../");return e+o.join("/")}return t}function it(n){var u=i(t(n)),f=a(u),r,o;return f==""?n:(r=u.split(f),o=r.length>1?1:0,e(r[o]))}function rt(n){return i(t(n))+".str"}function l(n){return i(t(n))+".d.str"}function ut(n){return i(t(n))+".ts"}function o(n){return i(t(n))+".d.ts"}function ft(n){return n.charAt(0)=="."}function et(n){return n.charAt(0)=="\\"||n.charAt(0)=="/"||n.indexOf(":\\")!=-1||n.indexOf(":/")!=-1}function a(n){if(n=="")return n;var t=n.indexOf("/")!=-1;return t?y(n):""}function v(n){n=r(n);var t=c(n);return t.slice(0,t.length-1)}function y(n){var t=v(n);return t.join("/")+"/"}function ot(n){var u=/^(https?:\/\/[\-\w\.]+(:\d+)?\/)(.*)$/i,t=u.exec(n),i,r;return t?(i=t[1],r=t[3],i+f(r)):f(n)}function f(n){var u,i,t;for(n=r(n),u=n.charAt(0)==="/",i=this.getPathComponents(n),t=0;t<i.length;t++)(i[t]==="."||i[t]==="")&&(i.splice(t,1),t--),t>0&&i[t]===".."&&i[t-1]!==".."&&(i.splice(t-1,2),t-=2);return(u?"/":"")+i.join("/")}function st(n){return f(n)}n.stripQuotes=t,n.isQuoted=p,n.quoteStr=e,n.swapQuotes=w,n.switchToForwardSlashes=r,n.trimModName=i,n.getDeclareFilePath=b,n.isJSFile=k,n.isSTRFile=s,n.isTSFile=h,n.isDSTRFile=d,n.isDTSFile=g,n.getPrettyName=nt,n.getPathComponents=c,n.getRelativePathToFixedPath=tt,n.quoteBaseName=it,n.changePathToSTR=rt,n.changePathToDSTR=l,n.changePathToTS=ut,n.changePathToDTS=o,n.isRelative=ft,n.isRooted=et,n.getRootFilePath=a,n.filePathComponents=v,n.filePath=y,n.normalizeURL=ot,n.pathNormalizeRegExp=/\//g,n.normalizePath=f,n.normalizeImportPath=st}(TypeScript||(TypeScript={})),function(n){var t=function(){function n(n,t){this.path=n,this.content=t,this.referencedFiles=null}return n.prototype.getText=function(n,t){return this.content.substring(n,t)},n.prototype.getLength=function(){return this.content.length},n}(),i,r;n.SourceUnit=t,i=function(){function n(n,t){this.compilationSettings=n,this.ioHost=t,this.residentCode=[],this.code=[]}return n}(),n.CompilationEnvironment=i,r=function(){function i(n){this.environment=n,this.visited={}}return i.prototype.resolveCode=function(i,r,u,f){var o={content:"",path:i},s=this.environment.ioHost,y=n.isRelative(i),w=y?!1:n.isRooted(i),e=y?s.resolvePath(r+"/"+i):w||!r||u?i:r+"/"+i,a,l,h;if(n.isSTRFile(e)||n.isTSFile(e)||(e+=".ts"),e=n.switchToForwardSlashes(n.stripQuotes(e)),a=this.environment.compilationSettings.useCaseSensitiveFileResolution?e:e.toLocaleUpperCase(),!this.visited[a]){if(y||w||!u)try{n.CompilerDiagnostics.debugPrint("   Reading code from "+e);try{o.content=s.readFile(e)}catch(b){try{n.isSTRFile(e)?e=n.changePathToTS(e):n.isTSFile(e)&&(e=n.changePathToSTR(e)),n.CompilerDiagnostics.debugPrint("   Reading code from "+e),o.content=s.readFile(e)}catch(b){e=n.changePathToDSTR(e),n.CompilerDiagnostics.debugPrint("   Reading code from "+e);try{o.content=s.readFile(e)}catch(b){e=n.changePathToDTS(e),n.CompilerDiagnostics.debugPrint("   Reading code from "+e),o.content=s.readFile(e)}}}n.CompilerDiagnostics.debugPrint("   Found code at "+e),o.path=e,this.visited[a]=!0}catch(b){n.CompilerDiagnostics.debugPrint("   Did not find code for "+i)}else o=s.findFile(r,e),o||(n.isSTRFile(e)?e=n.changePathToTS(e):n.isTSFile(e)&&(e=n.changePathToSTR(e)),o=s.findFile(r,e)),o||(e=n.changePathToDTS(e),o=s.findFile(r,e),o||(e=n.changePathToDSTR(e),o=s.findFile(r,e))),o?(o.path=n.switchToForwardSlashes(n.stripQuotes(o.path)),n.CompilerDiagnostics.debugPrint(i+" resolved to: "+o.path),o.content=o.content,this.visited[a]=!0):n.CompilerDiagnostics.debugPrint("Could not find "+i);if(o&&o.content){var p=s.dirName(o.path),v=new t(o.path,o.content),c=n.preProcessFile(v,this.environment.compilationSettings);for(v.referencedFiles=c.referencedFiles,h=0;h<c.referencedFiles.length;h++){if(l=c.referencedFiles[h],e=n.isRooted(l.path)?l.path:p+"/"+l.path,e=s.resolvePath(e),i==e){f.postResolutionError(e,"File contains reference to itself",null);continue}this.resolveCode(l.path,p,!1,f)}for(h=0;h<c.importedFiles.length;h++)this.resolveCode(c.importedFiles[h].path,p,!0,f);f.postResolution(v.path,v)}}},i}(),n.CodeResolver=r}(TypeScript||(TypeScript={})),function(n){function f(t){var f=/^(\/\/\/\s*<reference\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,i=f.exec(t);if(i){var r=n.normalizePath(i[3]),e=n.normalizePath(r),u=i.length>=7&&i[6]=="true";return u&&n.CompilerDiagnostics.debugPrint(r+" is resident"),{minChar:0,limChar:0,path:n.switchToForwardSlashes(e),isResident:u}}return null}function e(n){var r=/^(\/\/\/\s*<amd-dependency\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,t=r.exec(n),i;return t?i=t[3]:null}function o(n){var t=/^(\/\/\/\s*<implicit-import\s*)*\/>/igm,i=t.exec(n);return i?!0:!1}function r(n,t){var o=/^(\/\/\/\s*<style\s+)(([a-zA-Z])+=('|").+('|"))\s*\/>/igm,u=o.exec(n),e,f,i,r;if(u&&(e=/^([a-zA-Z]+=['"]on['|"])/igm,u=e.exec(u[2]),u))for(f=0;f<u.length;f++){i=u[f].split("="),r='"on"';switch(i[0]){case"blockInCompoundStmt":t.blockInCompoundStmt=i[1]==r;break;case"eqeqeq":t.eqeqeq=i[1]==r;break;case"forin":t.forin=i[1]==r;break;case"emptyBlocks":t.emptyBlocks=i[1]==r;break;case"newMustBeUsed":t.newMustBeUsed=i[1]==r;break;case"requireSemi":t.requireSemi=i[1]==r;break;case"assignmentInCond":t.assignmentInCond=i[1]==r;break;case"eqnull":t.eqnull=i[1]==r;break;case"evalOK":t.evalOK=i[1]==r;break;case"innerScopeDeclEscape":t.innerScopeDeclEscape=i[1]==r;break;case"funcInLoop":t.funcInLoop=i[1]==r;break;case"reDeclareLocal":t.reDeclareLocal=i[1]==r;break;case"literalSubscript":t.literalSubscript=i[1]==r;break;case"implicitAny":t.implicitAny=i[1]==r}}}function s(n){var t=u(n,null,!1);return t.referencedFiles}function u(i,u,e){var s,d,l,c,g,y;typeof u=="undefined"&&(u=new t),typeof e=="undefined"&&(e=!0),s=new n.Scanner,s.resetComments(),s.setSourceText(i,n.LexMode.File);for(var o=s.scan(),a=[],h=null,p=[],v=u,w=[],b=[],k=!1;o.tokenId!=n.TokenID.EndOfFile;)e&&o.tokenId==n.TokenID.Import&&(o=s.scan(),(o.tokenId==n.TokenID.Identifier||n.convertTokToID(o,!1))&&(o=s.scan(),o.tokenId==n.TokenID.Equals&&(o=s.scan(),o.tokenId==n.TokenID.Module&&(o=s.scan(),o.tokenId==n.TokenID.OpenParen&&(o=s.scan(),o.tokenId==n.TokenID.StringLiteral&&(d={minChar:s.startPos,limChar:s.pos,path:n.stripQuotes(n.switchToForwardSlashes(o.getText())),isResident:!1},b.push(d))))))),o.tokenId==n.TokenID.OpenBrace&&p.push(o),o.tokenId==n.TokenID.CloseBrace&&p.pop(),o=s.scan();for(a=s.getComments(),l=0;l<a.length;l++)h=a[l],h.isBlock||(c=f(h.getText()),c&&(c.minChar=h.startPos,c.limChar=c.minChar+h.value.length,w.push(c)),v&&(r(h.getText(),v.styleSettings),g=/^(\/\/\/\s*<reference\s+no-default-lib=)('|")(.+?)\2\s*\/>/igm,y=g.exec(h.getText()),y&&(k=y[3]=="true")));return{settings:v,referencedFiles:w,importedFiles:b,isLibFile:k}}var i=function(){function n(){this.bitwise=!1,this.blockInCompoundStmt=!1,this.eqeqeq=!1,this.forin=!1,this.emptyBlocks=!0,this.newMustBeUsed=!1,this.requireSemi=!1,this.assignmentInCond=!1,this.eqnull=!1,this.evalOK=!0,this.innerScopeDeclEscape=!0,this.funcInLoop=!0,this.reDeclareLocal=!0,this.literalSubscript=!0,this.implicitAny=!1}return n.prototype.setOption=function(n,t){var i=this[n];return i!==undefined?(this[n]=t,!0):!1},n.prototype.parseOptions=function(n){for(var u=n.split(";"),o,i=0,f=u.length;i<f;i++){var t=u[i],e=!0,r=t.lastIndexOf(":");if(r>=0&&(o=t.substring(r+1),t=t.substring(0,r),o=="off"&&(e=!1)),!this.setOption(t,e))return!1}return!0},n}(),t;n.StyleSettings=i,t=function(){function t(){this.styleSettings=new i,this.propagateConstants=!1,this.minWhitespace=!1,this.parseOnly=!1,this.errorRecovery=!1,this.emitComments=!1,this.watch=!1,this.exec=!1,this.resolve=!0,this.controlFlow=!1,this.printControlFlow=!1,this.controlFlowUseDef=!1,this.errorOnWith=!0,this.preprocess=!0,this.canCallDefinitionSignature=!1,this.inferPropertiesFromThisAssignment=!1,this.useDefaultLib=!0,this.codeGenTarget=n.CodeGenTarget.ES3,this.moduleGenTarget=n.ModuleGenTarget.Synchronous,this.outputOption="",this.mapSourceFiles=!1,this.generateDeclarationFiles=!1,this.useCaseSensitiveFileResolution=!1}return t.prototype.setStyleOptions=function(n){this.styleSettings.parseOptions(n)},t}(),n.CompilationSettings=t,n.getAdditionalDependencyPath=e,n.getImplicitImport=o,n.getStyleSettings=r,n.getReferencedFiles=s,n.preProcessFile=u}(TypeScript||(TypeScript={})),function(n){var t=function(){function t(t){this.logger=t,this.astLogger=new n.AstLogger(this.logger)}return t.prototype.getEnclosingScopeContextIfSingleScopeEdit=function(t,i,r,u){var f,e,o;if(this.logger.log('checkEditsInsideSingleScope("'+i+'")'),u===null)throw new Error("editRange should be valid");return u.isUnknown()?(this.logger.log("  Bailing out because edit range is unknown"),null):(f=n.findEnclosingScopeAt(this.logger,t,r,u.minChar,!1),e=n.findEnclosingScopeAt(this.logger,t,r,u.limChar,!1),f==null||e==null)?(this.logger.log("  Bailing out because containing scopes cannot be determined"),null):f.scopeStartAST!==e.scopeStartAST?(this.logger.log("  Bailing out because edit overlaps 2 disctint scopes"),null):(o=f.scopeStartAST.limChar-f.scopeStartAST.minChar+u.delta,o<=0)?(this.logger.log("  Bailing out because scope has been entirely removed from new source text"),null):f},t.prototype.attemptIncrementalUpdateUnit=function(t,i,r,u){var f,s,h,e,o;if(this.logger.log('attemptIncrementalUpdateUnit("'+i+'")'),u===null)throw new Error("editRange should be valid");if(f=this.getEnclosingScopeContextIfSingleScopeEdit(t,i,r,u),f===null)return null;if(s=f.scopeStartAST.limChar-f.scopeStartAST.minChar+u.delta,s>=r.getLength()/2)return this.logger.log("  Bailing out because range of scope to reparse ("+s+" characters) is greater than half the size of the source text"),null;var c=[],a=function(t,i,r,u){c.push(new n.ErrorEntry(u,t,t+i,r))},l=n.quickParse(this.logger,f.scopeStartAST,r,f.scopeStartAST.minChar,f.scopeStartAST.minChar+s,a);return l.endLexState!=n.LexState.Start?(this.logger.log("  Bailing out because scope contains unterminated comment"),null):(h=l.Script,h.vars.members.length!==0)?(this.logger.log("  Bailing out because new source text defines variables"),null):h.bod.members.length!==1?(this.logger.log("  Bailing out because new source text defines more than one scope (or none)"),null):(e=f.scopeStartAST,o=h.bod.members[0],e.nodeType!=o.nodeType)?(this.logger.log("  Bailing out because new source text does not define the same scope type as the existing scope"),null):!e.leftCurlyCount||!e.rightCurlyCount?(this.logger.log("  Bailing out because sopce doesn't have left/right curly count"),null):e.leftCurlyCount!==o.leftCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) left curly braces"),null):e.rightCurlyCount!==o.rightCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) right curly braces"),null):o.minChar!==0?(this.logger.log("  Bailing out because new function declaration does not start at position 0"),null):o.limChar!==s?(this.logger.log("  Bailing out because new function declaration does not end at the new end position"),null):n.UpdateUnitResult.singleScopeEdits(t,h,e,o,u,c)},t.prototype.mergeTrees=function(t){var i=this;n.timeFunction(this.logger,"mergeTrees()",function(){var r=new n.ScriptEditRange(t.scope1.minChar,t.scope1.limChar,t.editRange.delta);i.applyDeltaPosition(t.script1,r.limChar,r.delta),i.applyDeltaPosition(t.script2,0,r.minChar),i.mergeLocationInfo(t.script1,t.script2,r),i.replaceAST(t.script1,t.scope1,t.scope2)})},t.prototype.replaceAST=function(t,i,r){var u=this,f=function(t,f,e){return t===i?(r.preComments=t.preComments,r.postComments=t.postComments,u.logger.log("replaced old AST node with new one in script AST"),e.options.stopWalk(),r):(n.isValidAstNode(t)&&(t.limChar<i.minChar||t.minChar>i.limChar)&&(e.options.goChildren=!1),t)};n.getAstWalkerFactory().walk(t,f)},t.prototype.mergeLocationInfo=function(n,t,i){var u=n.locationInfo.lineMap,e=t.locationInfo.lineMap;this.logger.information()&&(this.logger.log("lineMap1 (before):"),this.astLogger.logLinemap(u),this.logger.log("lineMap2 (quick parse):"),this.astLogger.logLinemap(e),this.logger.log("EditRange="+i));for(var r=2,f=2,o=u.length,s=e.length;r<o;)u[r]<=i.minChar?r++:u[r]>=i.limChar?(u[r]+=i.delta,r++):f<s?(u.splice(r,0,e[f]+i.minChar),r++,o++,f++):(u.splice(r,1),o--);if(f<s){if(u[o-1]>=e[f]+i.minChar)for(r=2;r<o&&f<s;)u[r]<e[f]+i.minChar?r++:(u.splice(r,0,e[f]+i.minChar),r++,o++,f++);for(;f<s;f++)u.push(e[f]+i.minChar)}this.logger.information()&&(this.logger.log("lineMap1 (after merge):"),this.astLogger.logLinemap(u))},t.prototype.applyDeltaPosition=function(t,i,r){var u=function(n){n.minChar!==-1&&n.minChar>=i&&(n.minChar+=r),n.limChar!==-1&&n.limChar>=i&&(n.limChar+=r)},f=function(n){if(n&&n.length>0)for(var t=0;t<n.length;t++)u(n[t])},e=function(n,t,r){return n.limChar!==-1&&n.limChar<i&&(r.options.goChildren=!1),u(n),f(n.preComments),f(n.postComments),n};n.getAstWalkerFactory().walk(t,e)},t}();n.IncrementalParser=t}(TypeScript||(TypeScript={})),function(n){var t=function(){function n(n){this.declFile=n,this.onNewLine=!0}return n.prototype.Write=function(n){this.declFile.Write(n),this.onNewLine=!1},n.prototype.WriteLine=function(n){this.declFile.WriteLine(n),this.onNewLine=!0},n.prototype.Close=function(){this.declFile.Close()},n}(),i;n.DeclFileWriter=t,i=function(){function i(t,i,r){this.checker=t,this.emitOptions=i,this.errorReporter=r,this.declFile=null,this.indenter=new n.Indenter,this.declarationContainerStack=[],this.isDottedModuleName=[],this.ignoreCallbackAst=null,this.singleDeclFile=null,this.varListCount=0}return i.prototype.getAstDeclarationContainer=function(){return this.declarationContainerStack[this.declarationContainerStack.length-1]},i.prototype.emitDottedModuleName=function(){return this.isDottedModuleName.length==0?!1:this.isDottedModuleName[this.isDottedModuleName.length-1]},i.prototype.setDeclarationFile=function(n){this.declFile=new t(n)},i.prototype.Close=function(){try{this.declFile.Close()}catch(n){this.errorReporter.emitterError(null,n.message)}},i.prototype.emitDeclarations=function(t){n.AstWalkerWithDetailCallback.walk(t,this)},i.prototype.getIndentString=function(n){return typeof n=="undefined"&&(n=!1),this.emitOptions.minWhitespace?"":this.indenter.getIndent()},i.prototype.emitIndent=function(){this.declFile.Write(this.getIndentString())},i.prototype.canEmitSignature=function(t,i,r){typeof i=="undefined"&&(i=!0),typeof r=="undefined"&&(r=!0);var u;return(u=r?this.getAstDeclarationContainer():this.declarationContainerStack[this.declarationContainerStack.length-2],u.nodeType==n.NodeType.ModuleDeclaration&&!n.hasFlag(t,n.DeclFlags.Exported))?!1:!i&&u.nodeType==n.NodeType.Script&&n.hasFlag(t,n.DeclFlags.Ambient)?!1:!0},i.prototype.canEmitPrePostAstSignature=function(t,i,r){return this.ignoreCallbackAst?(n.CompilerDiagnostics.assert(this.ignoreCallbackAst!=i,"Ignore Callback AST mismatch"),this.ignoreCallbackAst=null,!1):r&&!this.canEmitSignature(t,!0,r)?(this.ignoreCallbackAst=i,!1):!0},i.prototype.getDeclFlagsString=function(t,i){var r=this.getIndentString(),u="",f;return n.hasFlag(t,n.DeclFlags.GetAccessor)?u="get ":n.hasFlag(t,n.DeclFlags.SetAccessor)&&(u="set "),f=this.getAstDeclarationContainer(),f.nodeType==n.NodeType.ModuleDeclaration&&n.hasFlag(f.modFlags,n.ModuleFlags.IsWholeFile)&&n.hasFlag(t,n.DeclFlags.Exported)&&(r+="export "),r+=n.hasFlag(t,n.DeclFlags.LocalStatic)||n.hasFlag(t,n.DeclFlags.Static)?"static "+u:n.hasFlag(t,n.DeclFlags.Private)?"private "+u:n.hasFlag(t,n.DeclFlags.Public)?"public "+u:u==""?i+" ":u},i.prototype.emitDeclFlags=function(n,t){this.declFile.Write(this.getDeclFlagsString(n,t))},i.prototype.canEmitTypeAnnotationSignature=function(t){return typeof t=="undefined"&&(t=n.DeclFlags.None),!n.hasFlag(t,n.DeclFlags.Private)},i.prototype.pushDeclarationContainer=function(n){this.declarationContainerStack.push(n)},i.prototype.popDeclarationContainer=function(t){n.CompilerDiagnostics.assert(t!=this.getAstDeclarationContainer(),"Declaration container mismatch"),this.declarationContainerStack.pop()},i.prototype.emitTypeNamesMember=function(n,t){var i,r;if(typeof t=="undefined"&&(t=!1),n.prefix=="{ "?(t&&this.emitIndent(),this.declFile.WriteLine("{"),this.indenter.increaseIndent(),t=!0):n.prefix!=""&&(t&&this.emitIndent(),this.declFile.Write(n.prefix),t=!1),n.isString())t&&this.emitIndent(),this.declFile.Write(n.text);else for(i=n,r=0;r<i.entries.length;r++)this.emitTypeNamesMember(i.entries[r],t),i.delim=="; "&&this.declFile.WriteLine(";");n.suffix=="}"?(this.indenter.decreaseIndent(),this.emitIndent(),this.declFile.Write(n.suffix)):this.declFile.Write(n.suffix)},i.prototype.emitTypeSignature=function(t){var r=null,i=this.getAstDeclarationContainer(),u,f;switch(i.nodeType){case n.NodeType.ModuleDeclaration:case n.NodeType.InterfaceDeclaration:case n.NodeType.FuncDecl:i.type&&(r=i.type.containedScope);break;case n.NodeType.Script:u=i,u.bod&&(r=u.bod.enclosingScope);break;case n.NodeType.ClassDeclaration:i.type&&(r=i.type.instanceType.containedScope);break;default:n.CompilerDiagnostics.debugPrint("Unknown containing scope")}f=t.getScopedTypeNameEx(r),this.emitTypeNamesMember(f)},i.prototype.emitComment=function(n){var i=n.getText(),t;for(this.declFile.onNewLine?this.emitIndent():n.isBlockComment||(this.declFile.WriteLine(""),this.emitIndent()),this.declFile.Write(i[0]),t=1;t<i.length;t++)this.declFile.WriteLine(""),this.emitIndent(),this.declFile.Write(i[t]);n.endsLine||!n.isBlockComment?this.declFile.WriteLine(""):this.declFile.Write(" ")},i.prototype.emitDeclarationComments=function(n,t){var i,r;if((typeof t=="undefined"&&(t=!0),this.emitOptions.emitComments)&&(i=n.getDocComments(),i.length>0)){for(r=0;r<i.length;r++)this.emitComment(i[r]);t?this.declFile.onNewLine||this.declFile.WriteLine(""):this.declFile.onNewLine&&this.emitIndent()}},i.prototype.VarDeclCallback=function(t,i){var u,r;return t&&this.canEmitSignature(n.ToDeclFlags(i.varFlags),!1)&&(u=this.getAstDeclarationContainer().nodeType==n.NodeType.InterfaceDeclaration,this.emitDeclarationComments(i),u?(this.emitIndent(),this.declFile.Write(i.id.text),n.hasFlag(i.id.flags,n.ASTFlags.OptionalName)&&this.declFile.Write("?")):(this.varListCount>=0&&(this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"var"),this.varListCount=-this.varListCount),this.declFile.Write(i.id.text)),r=null,i.typeExpr&&i.typeExpr.type?r=i.typeExpr.type:i.sym&&(r=i.sym.getType(),r==this.checker.anyType&&(r=null)),r&&this.canEmitTypeAnnotationSignature(n.ToDeclFlags(i.varFlags))&&(this.declFile.Write(": "),this.emitTypeSignature(r)),this.varListCount>0?this.varListCount--:this.varListCount<0&&this.varListCount++,this.varListCount<0?this.declFile.Write(", "):this.declFile.WriteLine(";")),!1},i.prototype.BlockCallback=function(n,t){return t.isStatementBlock?!1:(this.varListCount=n?t.statements.members.length:0,!0)},i.prototype.emitArgDecl=function(t,i){this.emitDeclarationComments(t,!1),this.declFile.Write(t.id.text),t.isOptionalArg()&&this.declFile.Write("?"),(t.typeExpr||t.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(n.ToDeclFlags(i.fncFlags))&&(this.declFile.Write(": "),this.emitTypeSignature(t.type))},i.prototype.FuncDeclCallback=function(t,i){var e,o,u,s,f,r,h,c;if(!t)return!1;if(i.isAccessor())return this.emitPropertyAccessorSignature(i);if(e=this.getAstDeclarationContainer().nodeType==n.NodeType.InterfaceDeclaration,i.bod){if(i.isConstructor){if(i.type.construct&&i.type.construct.signatures.length>1)return!1}else if(i.type.call&&i.type.call.signatures.length>1)return!1}else if(!e&&n.hasFlag(i.fncFlags,n.FncFlags.Private)&&i.type.call&&i.type.call.signatures.length>1&&(o=i.type.call.signatures,u=o[0].declAST,u.bod&&(u=o[1].declAST),u!=i))return!1;if(!this.canEmitSignature(n.ToDeclFlags(i.fncFlags),!1))return!1;if(this.emitDeclarationComments(i),i.isConstructor?(this.emitIndent(),this.declFile.Write("constructor")):(s=i.getNameText(),e?(this.emitIndent(),i.isConstructMember()?this.declFile.Write("new"):i.isCallMember()||i.isIndexerMember()||(this.declFile.Write(s),n.hasFlag(i.name.flags,n.ASTFlags.OptionalName)&&this.declFile.Write("? "))):(this.emitDeclFlags(n.ToDeclFlags(i.fncFlags),"function"),this.declFile.Write(s))),i.isIndexerMember()?this.declFile.Write("["):this.declFile.Write("("),this.indenter.increaseIndent(),i.arguments)for(f=i.arguments.members.length,i.variableArgList&&f--,r=0;r<f;r++)h=i.arguments.members[r],this.emitArgDecl(h,i),r<f-1&&this.declFile.Write(", ");return i.variableArgList&&(c=i.arguments.members[i.arguments.members.length-1],i.arguments.members.length>1?this.declFile.Write(", ..."):this.declFile.Write("..."),this.emitArgDecl(c,i)),this.indenter.decreaseIndent(),i.isIndexerMember()?this.declFile.Write("]"):this.declFile.Write(")"),!i.isConstructor&&(i.returnTypeAnnotation||i.signature.returnType.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(n.ToDeclFlags(i.fncFlags))&&(this.declFile.Write(": "),this.emitTypeSignature(i.signature.returnType.type)),this.declFile.WriteLine(";"),!1},i.prototype.emitBaseList=function(n,t){var r,i;if(n&&n.members.length>0)for(this.declFile.Write(" "+t+" "),r=n.members.length,i=0;i<r;i++){var u=n.members[i],e=u.type.symbol,f=u.type;i>0&&this.declFile.Write(", "),this.emitTypeSignature(f)}},i.prototype.emitPropertyAccessorSignature=function(t){var i=t.accessorSymbol,r;return i.getter&&i.getter.declAST!=t?!1:(this.emitDeclarationComments(i),this.emitDeclFlags(n.ToDeclFlags(i.flags),"var"),this.declFile.Write(t.name.text),r=i.getType(),this.canEmitTypeAnnotationSignature(n.ToDeclFlags(i.flags))&&(this.declFile.Write(" : "),this.emitTypeSignature(r)),this.declFile.WriteLine(";"),!1)},i.prototype.emitClassMembersFromConstructorDefinition=function(t){var u,r,i;if(t.arguments)for(u=t.arguments.members.length,t.variableArgList&&u--,r=0;r<u;r++)i=t.arguments.members[r],n.hasFlag(i.varFlags,n.VarFlags.Property)&&(this.emitDeclarationComments(i),this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"var"),this.declFile.Write(i.id.text),i.typeExpr&&this.canEmitTypeAnnotationSignature(n.ToDeclFlags(i.varFlags))&&(this.declFile.Write(": "),this.emitTypeSignature(i.type)),this.declFile.WriteLine(";"))},i.prototype.ClassDeclarationCallback=function(t,i){if(!this.canEmitPrePostAstSignature(n.ToDeclFlags(i.varFlags),i,t))return!1;if(t){var r=i.name.text;this.emitDeclarationComments(i),this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"class"),this.declFile.Write(r),this.emitBaseList(i.extendsList,"extends"),this.emitBaseList(i.implementsList,"implements"),this.declFile.WriteLine(" {"),this.pushDeclarationContainer(i),this.indenter.increaseIndent(),i.constructorDecl&&this.emitClassMembersFromConstructorDefinition(i.constructorDecl)}else this.indenter.decreaseIndent(),this.popDeclarationContainer(i),this.emitIndent(),this.declFile.WriteLine("}");return!0},i.prototype.InterfaceDeclarationCallback=function(t,i){if(!this.canEmitPrePostAstSignature(n.ToDeclFlags(i.varFlags),i,t))return!1;if(t){var r=i.name.text;this.emitDeclarationComments(i),this.emitDeclFlags(n.ToDeclFlags(i.varFlags),"interface"),this.declFile.Write(r),this.emitBaseList(i.extendsList,"extends"),this.declFile.WriteLine(" {"),this.indenter.increaseIndent(),this.pushDeclarationContainer(i)}else this.indenter.decreaseIndent(),this.popDeclarationContainer(i),this.emitIndent(),this.declFile.WriteLine("}");return!0},i.prototype.ImportDeclarationCallback=function(n,t){return n&&this.declarationContainerStack[0].isExternallyVisibleSymbol(t.id.sym)&&(this.emitDeclarationComments(t),this.emitIndent(),this.declFile.Write("import "),this.declFile.Write(t.id.text+" = "),t.isDynamicImport?this.declFile.WriteLine("module ("+t.getAliasName()+");"):this.declFile.WriteLine(t.getAliasName()+";")),!1},i.prototype.emitEnumSignature=function(t){var u,r,i;if(!this.canEmitSignature(n.ToDeclFlags(t.modFlags)))return!1;for(this.emitDeclarationComments(t),this.emitDeclFlags(n.ToDeclFlags(t.modFlags),"enum"),this.declFile.WriteLine(t.name.text+" {"),this.indenter.increaseIndent(),u=t.members.members.length,r=1;r<u;r++)i=t.members.members[r],i.nodeType==n.NodeType.VarDecl?(this.emitDeclarationComments(i),this.emitIndent(),this.declFile.WriteLine(i.id.text+",")):n.CompilerDiagnostics.assert(i.nodeType!=n.NodeType.Asg,"We want to catch this");return this.indenter.decreaseIndent(),this.emitIndent(),this.declFile.WriteLine("}"),!1},i.prototype.ModuleDeclarationCallback=function(i,r){var e,o,u,f;if(n.hasFlag(r.modFlags,n.ModuleFlags.IsWholeFile)){if(n.hasFlag(r.modFlags,n.ModuleFlags.IsDynamic))if(i){if(!this.emitOptions.outputMany){this.singleDeclFile=this.declFile,n.CompilerDiagnostics.assert(this.indenter.indentAmt==0,"Indent has to be 0 when outputing new file"),e=this.emitOptions.mapOutputFileName(n.stripQuotes(r.name.sym.name),n.TypeScriptCompiler.mapToDTSFileName),o=r.containsUnicodeChar||this.emitOptions.emitComments&&r.containsUnicodeCharInComment;try{this.declFile=new t(this.emitOptions.ioHost.createFile(e,o))}catch(s){this.errorReporter.emitterError(null,s.message)}}this.pushDeclarationContainer(r)}else{if(!this.emitOptions.outputMany){n.CompilerDiagnostics.assert(this.singleDeclFile!=this.declFile,"singleDeclFile cannot be null as we are going to revert back to it"),n.CompilerDiagnostics.assert(this.indenter.indentAmt==0,"Indent has to be 0 when outputing new file");try{this.declFile.Close()}catch(s){this.errorReporter.emitterError(null,s.message)}this.declFile=this.singleDeclFile}this.popDeclarationContainer(r)}return!0}return r.isEnum()?(i&&this.emitEnumSignature(r),!1):this.canEmitPrePostAstSignature(n.ToDeclFlags(r.modFlags),r,i)?(i?(this.emitDottedModuleName()?this.dottedModuleEmit+=".":this.dottedModuleEmit=this.getDeclFlagsString(n.ToDeclFlags(r.modFlags),"module"),this.dottedModuleEmit+=r.name.text,u=r.members.members.length==1&&r.members.members[0].nodeType==n.NodeType.ModuleDeclaration&&!r.members.members[0].isEnum()&&n.hasFlag(r.members.members[0].modFlags,n.ModuleFlags.Exported),f=r.getDocComments(),u=u&&(f==null||f.length==0),this.isDottedModuleName.push(u),this.pushDeclarationContainer(r),u||(this.emitDeclarationComments(r),this.declFile.Write(this.dottedModuleEmit),this.declFile.WriteLine(" {"),this.indenter.increaseIndent())):(this.emitDottedModuleName()||(this.indenter.decreaseIndent(),this.emitIndent(),this.declFile.WriteLine("}")),this.popDeclarationContainer(r),this.isDottedModuleName.pop()),!0):!1},i.prototype.ScriptCallback=function(t,i){var r,u,f;if(t){if(this.emitOptions.outputMany)for(r=0;r<i.referencedFiles.length;r++)u=i.referencedFiles[r].path,f=n.isRooted(u)?this.emitOptions.mapOutputFileName(u,n.TypeScriptCompiler.mapToDTSFileName):n.getDeclareFilePath(i.referencedFiles[r].path),this.declFile.WriteLine('/// <reference path="'+f+'" />');this.pushDeclarationContainer(i)}else this.popDeclarationContainer(i);return!0},i.prototype.DefaultCallback=function(t,i){return!n.hasFlag(i.flags,n.ASTFlags.IsStatement)},i}(),n.DeclarationEmitter=i}(TypeScript||(TypeScript={})),function(n){var t,f,i,u,e,r,o;(function(n){n._map=[],n._map[0]="Unknown",n.Unknown=0,n._map[1]="NoEdits",n.NoEdits=1,n._map[2]="EditsInsideSingleScope",n.EditsInsideSingleScope=2})(n.UpdateUnitKind||(n.UpdateUnitKind={})),t=n.UpdateUnitKind,f=function(){function n(n,t,i){this.minChar=n,this.limChar=t,this.delta=i}return n.unknown=function(){return new n(-1,-1,-1)},n.prototype.isUnknown=function(){return this.minChar===-1&&this.limChar===-1&&this.delta===-1},n.prototype.containsPosition=function(n){return this.minChar<=n&&n<this.limChar||this.minChar<=n&&n<this.limChar+this.delta},n.prototype.toString=function(){return"editRange(minChar="+this.minChar+", limChar="+this.limChar+", delta="+this.delta+")"},n}(),n.ScriptEditRange=f,i=function(){function n(n,t,i,r){this.kind=n,this.unitIndex=t,this.script1=i,this.script2=r,this.scope1=null,this.scope2=null,this.editRange=null,this.parseErrors=[]}return n.noEdits=function(i){return new n(t.NoEdits,i,null,null)},n.unknownEdits=function(i,r,u){var f=new n(t.Unknown,i.locationInfo.unitIndex,i,r);return f.parseErrors=u,f},n.singleScopeEdits=function(i,r,u,f,e,o){var s=new n(t.EditsInsideSingleScope,i.locationInfo.unitIndex,i,r);return s.scope1=u,s.scope2=f,s.editRange=e,s.parseErrors=o,s},n}(),n.UpdateUnitResult=i,u=function(){function n(n,t,i,r){this.unitIndex=n,this.minChar=t,this.limChar=i,this.message=r}return n}(),n.ErrorEntry=u,n.defaultSettings=new n.CompilationSettings,e=function(){function r(t,i,r){typeof i=="undefined"&&(i=new n.NullLogger),typeof r=="undefined"&&(r=n.defaultSettings),this.errorOutput=t,this.logger=i,this.settings=r,this.parser=new n.Parser,this.typeFlow=null,this.scripts=new n.ASTList,this.units=[],this.errorReporter=new n.ErrorReporter(this.errorOutput),this.persistentTypeState=new n.PersistentGlobalTypeState(this.errorReporter),this.errorReporter.parser=this.parser,this.initTypeChecker(this.errorOutput),this.parser.style_requireSemi=this.settings.styleSettings.requireSemi,this.parser.style_funcInLoop=this.settings.styleSettings.funcInLoop,this.parser.inferPropertiesFromThisAssignment=this.settings.inferPropertiesFromThisAssignment,this.emitSettings=new n.EmitOptions(this.settings),n.codeGenTarget=r.codeGenTarget}return r.prototype.timeFunction=function(t,i){return n.timeFunction(this.logger,t,i)},r.prototype.initTypeChecker=function(){this.persistentTypeState.refreshPersistentState(),this.typeChecker=new n.TypeChecker(this.persistentTypeState),this.typeChecker.errorReporter=this.errorReporter,this.typeChecker.checkControlFlow=this.settings.controlFlow,this.typeChecker.checkControlFlowUseDef=this.settings.controlFlowUseDef,this.typeChecker.printControlFlowGraph=this.settings.printControlFlow,this.typeChecker.errorsOnWith=this.settings.errorOnWith,this.typeChecker.styleSettings=this.settings.styleSettings,this.typeChecker.canCallDefinitionSignature=this.settings.canCallDefinitionSignature,this.errorReporter.checker=this.typeChecker,this.setErrorOutput(this.errorOutput)},r.prototype.setErrorOutput=function(n){this.errorOutput=n,this.errorReporter.setErrOut(n),this.parser.outfile=n},r.prototype.emitCommentsToOutput=function(){this.emitSettings=new n.EmitOptions(this.settings)},r.prototype.setErrorCallback=function(n){this.parser.errorCallback=n},r.prototype.updateUnit=function(t,i,r){return this.updateSourceUnit(new n.StringSourceText(t),i,r)},r.prototype.updateSourceUnit=function(n,t,i){var r=this;return this.timeFunction("updateSourceUnit("+t+")",function(){var u=r.partialUpdateUnit(n,t,i);return r.applyUpdateResult(u)})},r.prototype.applyUpdateResult=function(i){var u,f,r;switch(i.kind){case t.NoEdits:return!1;case t.Unknown:for(this.scripts.members[i.unitIndex]=i.script2,this.units[i.unitIndex]=i.script2.locationInfo,u=0,f=i.parseErrors.length;u<f;u++)r=i.parseErrors[u],this.parser.errorCallback&&this.parser.errorCallback(r.minChar,r.limChar-r.minChar,r.message,r.unitIndex);return!0;case t.EditsInsideSingleScope:return new n.IncrementalParser(this.logger).mergeTrees(i),!0}},r.prototype.partialUpdateUnit=function(n,t,r){var f=this;return this.timeFunction("partialUpdateUnit("+t+")",function(){for(var l,a,e=0,s=f.units.length;e<s;e++)if(f.units[e].filename==t){if(f.scripts.members[e].isResident)return i.noEdits(e);r&&f.parser.setErrorRecovery(null);var h,c=[],v=function(n,t,i,r){c.push(new u(r,n,n+t,i))},o=f.parser.errorCallback;return o&&(f.parser.errorCallback=v),l=f.scripts.members[e],a=f.parser.parse(n,t,e),o&&(f.parser.errorCallback=o),h=i.unknownEdits(l,a,c)}throw new Error('Unknown file "'+t+'"');})},r.prototype.addUnit=function(t,i,r,u){return typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=[]),this.addSourceUnit(new n.StringSourceText(t),i,r,u)},r.prototype.addSourceUnit=function(t,i,r,u){typeof u=="undefined"&&(u=[]);var f=this;return this.timeFunction("addSourceUnit("+i+", "+r+")",function(){var e=f.parser.parse(t,i,f.units.length,n.AllowedElements.Global),o;return e.referencedFiles=u,e.isResident=r,f.persistentTypeState.setCollectionMode(r?n.TypeCheckCollectionMode.Resident:n.TypeCheckCollectionMode.Transient),o=f.units.length,f.units[o]=e.locationInfo,f.typeChecker.collectTypes(e),f.scripts.append(e),e})},r.prototype.parseUnit=function(t,i){return this.parseSourceUnit(new n.StringSourceText(t),i)},r.prototype.parseSourceUnit=function(n,t){this.parser.setErrorRecovery(this.errorOutput);var i=this.parser.parse(n,t,0),r=this.units.length;this.units[r]=i.locationInfo,this.typeChecker.collectTypes(i),this.scripts.append(i)},r.prototype.typeCheck=function(){var t=this;return this.timeFunction("typeCheck()",function(){var f=new n.Binder(t.typeChecker);t.typeChecker.units=t.units,f.bind(t.typeChecker.globalScope,t.typeChecker.globals),f.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobals),f.bind(t.typeChecker.globalScope,t.typeChecker.globalTypes),f.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobalTypes),t.typeFlow=new n.TypeFlow(t.logger,t.typeChecker.globalScope,t.parser,t.typeChecker);var i=0,r=null,u=t.scripts.members.length;for(t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Resident),i=0;i<u;i++)(r=t.scripts.members[i],r.isResident&&!r.hasBeenTypeChecked)&&(t.typeFlow.assignScopes(r),t.typeFlow.initLibs());for(i=0;i<u;i++)(r=t.scripts.members[i],r.isResident&&!r.hasBeenTypeChecked)&&(t.typeFlow.typeCheck(r),r.hasBeenTypeChecked=!0);for(t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Transient),u=t.scripts.members.length,i=0;i<u;i++)(r=t.scripts.members[i],r.isResident)||(t.typeFlow.assignScopes(r),t.typeFlow.initLibs());for(i=0;i<u;i++)(r=t.scripts.members[i],r.isResident)||t.typeFlow.typeCheck(r);return null})},r.prototype.cleanASTTypesForReTypeCheck=function(t){function i(t){var u,f,e,r,o;return t.type=null,t.nodeType==n.NodeType.VarDecl?(u=t,u.sym=null):t.nodeType==n.NodeType.ArgDecl?(f=t,f.sym=null):t.nodeType==n.NodeType.Name?(e=t,e.sym=null):t.nodeType==n.NodeType.FuncDecl?(r=t,r.signature=null,r.freeVariables=[],r.symbols=null,r.accessorSymbol=null,r.scopeType=null):t.nodeType==n.NodeType.ModuleDeclaration?(o=t,o.mod=null):t.nodeType==n.NodeType.With?t.withSym=null:t.nodeType==n.NodeType.Catch&&(t.containedScope=null),t}n.getAstWalkerFactory().walk(t,i)},r.prototype.cleanTypesForReTypeCheck=function(){var n=this;return this.timeFunction("cleanTypesForReTypeCheck()",function(){for(var i,t=0,r=n.scripts.members.length;t<r;t++)(i=n.scripts.members[t],i.isResident)||(n.cleanASTTypesForReTypeCheck(i),n.typeChecker.collectTypes(i));return null})},r.prototype.attemptIncrementalTypeCheck=function(){return this.timeFunction("attemptIncrementalTypeCheck()",function(){return!1})},r.prototype.reTypeCheck=function(){var t=this;return this.timeFunction("reTypeCheck()",function(){return n.CompilerDiagnostics.analysisPass++,t.initTypeChecker(t.errorOutput),t.persistentTypeState.setCollectionMode(n.TypeCheckCollectionMode.Transient),t.cleanTypesForReTypeCheck(),t.typeCheck()})},r.prototype.isDynamicModuleCompilation=function(){for(var t,n=0,i=this.scripts.members.length;n<i;n++)if(t=this.scripts.members[n],!t.isDeclareFile&&t.topLevelMod!=null)return!0;return!1},r.prototype.updateCommonDirectoryPath=function(){for(var u=[],i=-1,e,h,r,o,t,f=0,s=this.scripts.members.length;f<s;f++)if(e=this.scripts.members[f],e.emitRequired(this.emitSettings))if(h=e.locationInfo.filename,r=n.filePathComponents(h),i==-1)u=r,i=u.length;else{for(o=!1,t=0;t<i&&t<r.length;t++)if(u[t]!=r[t]){if(i=t,o=!0,t==0){this.errorReporter.emitterError(null,"Cannot find the common subdirectory path for the input files");return}break}!o&&r.length<i&&(i=r.length)}this.emitSettings.commonDirectoryPath=u.slice(0,i).join("/")+"/",this.emitSettings.outputOption.charAt(this.emitSettings.outputOption.length-1)!="/"&&(this.emitSettings.outputOption+="/")},r.prototype.parseEmitOption=function(t){if(this.emitSettings.ioHost=t,this.emitSettings.outputOption==""){this.emitSettings.outputMany=!0,this.emitSettings.commonDirectoryPath="";return}this.emitSettings.outputOption=n.switchToForwardSlashes(this.emitSettings.ioHost.resolvePath(this.emitSettings.outputOption)),this.emitSettings.outputMany=this.emitSettings.ioHost.directoryExists(this.emitSettings.outputOption)?!0:this.emitSettings.ioHost.fileExists(this.emitSettings.outputOption)?!1:!n.isJSFile(this.emitSettings.outputOption),this.isDynamicModuleCompilation()&&!this.emitSettings.outputMany&&this.errorReporter.emitterError(null,"Cannot compile dynamic modules when emitting into single file"),this.emitSettings.outputMany&&this.updateCommonDirectoryPath()},r.prototype.useUTF8ForFile=function(n){return this.emitSettings.outputMany?this.outputScriptToUTF8(n):this.outputScriptsToUTF8(this.scripts.members)},r.mapToDTSFileName=function(t){return n.getDeclareFilePath(t)},r.prototype.canEmitDeclarations=function(n){return this.settings.generateDeclarationFiles?!!n&&(n.isDeclareFile||n.isResident||n.bod==null)?!1:!0:!1},r.prototype.emitDeclarationsUnit=function(t,i,u){if(!this.canEmitDeclarations(t))return null;if(!u){var f=this.emitSettings.mapOutputFileName(t.locationInfo.filename,r.mapToDTSFileName),e=this.createFile(f,this.useUTF8ForFile(t));u=new n.DeclarationEmitter(this.typeChecker,this.emitSettings,this.errorReporter),u.setDeclarationFile(e)}return u.emitDeclarations(t),i?u:(u.Close(),null)},r.prototype.emitDeclarations=function(){var n,t,r,i;if(this.canEmitDeclarations()&&!this.errorReporter.hasErrors&&this.scripts.members.length!=0){for(n=null,t=0,r=this.scripts.members.length;t<r;t++)i=this.scripts.members[t],this.emitSettings.outputMany||n==null?n=this.emitDeclarationsUnit(i,!this.emitSettings.outputMany):this.emitDeclarationsUnit(i,!0,n);n&&n.Close()}},r.mapToFileNameExtension=function(n,t,i){if(i)return t;var r=t.split(".");return r.pop(),r.join(".")+n},r.mapToJSFileName=function(n,t){return r.mapToFileNameExtension(".js",n,t)},r.prototype.emitUnit=function(t,i,u){var e,f,o;return t.emitRequired(this.emitSettings)?(e=t.locationInfo.filename,u?this.settings.mapSourceFiles&&u.setSourceMappings(new n.SourceMapper(e,u.emittingFileName,u.outfile,u.sourceMapper.sourceMapOut,this.errorReporter)):(f=this.emitSettings.mapOutputFileName(e,r.mapToJSFileName),o=this.createFile(f,this.useUTF8ForFile(t)),u=new n.Emitter(this.typeChecker,f,o,this.emitSettings,this.errorReporter),this.settings.mapSourceFiles&&u.setSourceMappings(new n.SourceMapper(e,f,o,this.createFile(f+n.SourceMapper.MapFileExtension,!1),this.errorReporter))),this.typeChecker.locationInfo=t.locationInfo,u.emitJavascript(t,n.TokenID.Comma,!1),i?u:(u.Close(),null)):null},r.prototype.emit=function(n){var t,i,u,r;for(this.parseEmitOption(n),t=null,i=0,u=this.scripts.members.length;i<u;i++)r=this.scripts.members[i],this.emitSettings.outputMany||t==null?t=this.emitUnit(r,!this.emitSettings.outputMany):this.emitUnit(r,!0,t);t&&t.Close()},r.prototype.emitToOutfile=function(t){var r,i,f,u;if(this.settings.mapSourceFiles)throw Error("Cannot generate source map");if(this.settings.generateDeclarationFiles)throw Error("Cannot generate declaration files");if(this.settings.outputOption!="")throw Error("Cannot parse output option");for(r=r=new n.Emitter(this.typeChecker,"stdout",t,this.emitSettings,this.errorReporter),i=0,f=this.scripts.members.length;i<f;i++)u=this.scripts.members[i],this.typeChecker.locationInfo=u.locationInfo,r.emitJavascript(u,n.TokenID.Comma,!1)},r.prototype.emitAST=function(t){var i,f,u,o,e;for(this.parseEmitOption(t),i=null,f=null,u=0,o=this.scripts.members.length;u<o;u++){if(e=this.scripts.members[u],this.emitSettings.outputMany||f==null){var s=this.units[u].filename,h=function(n,t){return r.mapToFileNameExtension(".txt",n,t)},c=this.emitSettings.mapOutputFileName(s,h);i=this.createFile(c,this.useUTF8ForFile(e)),f=new n.PrintContext(i,this.parser)}if(n.getAstWalkerFactory().walk(e,n.prePrintAST,n.postPrintAST,null,f),this.emitSettings.outputMany)try{i.Close()}catch(l){this.errorReporter.emitterError(null,l.message)}}if(!this.emitSettings.outputMany)try{i.Close()}catch(l){this.errorReporter.emitterError(null,l.message)}},r.prototype.outputScriptToUTF8=function(n){return n.containsUnicodeChar||this.emitSettings.emitComments&&n.containsUnicodeCharInComment},r.prototype.outputScriptsToUTF8=function(n){for(var r,t=0,i=n.length;t<i;t++)if(r=n[t],this.outputScriptToUTF8(r))return!0;return!1},r.prototype.createFile=function(n,t){try{return this.emitSettings.ioHost.createFile(n,t)}catch(i){this.errorReporter.emitterError(null,i.message)}},r}(),n.TypeScriptCompiler=e,r=function(){function n(n,t,i){this.name=n,this.type=t,this.sym=i}return n}(),n.ScopeEntry=r,o=function(){function t(n){this.compiler=n}return t.prototype.getScope=function(n){return n.enclosingObjectLit&&n.isMemberCompletion?n.getObjectLiteralScope():n.isMemberCompletion?n.useFullAst?this.compiler.typeFlow.findMemberScopeAtFullAst(n):this.compiler.typeFlow.findMemberScopeAt(n):n.getScope()},t.prototype.getScopeEntries=function(t){var u=this.getScope(t),f,e,r,i,o,s;if(u==null)return[];for(f=new n.StringHashTable,e=u.getAllSymbolNames(t.isMemberCompletion),r=0;r<e.length;r++)(i=e[r],i!=n.globalId&&i!="_Core"&&i!="_element")&&f.add(i,"");return o=this.compiler.typeChecker.currentModDecl,this.compiler.typeChecker.currentModDecl=t.deepestModuleDecl,s=this.getTypeNamesForNames(t,f.getAllKeys(),u),this.compiler.typeChecker.currentModDecl=o,s},t.prototype.getTypeNamesForNames=function(t,i,u){for(var s=[],a=t.getScope(),c,l,o=0;o<i.length;o++){var e=i[o],h=t.publicsOnly&&t.isMemberCompletion,f=u.find(e,h,!1);f==null&&(f=u.find(e,h,!0)),c=f&&f.flags&n.SymbolFlags.Private?f.container==u.container:!0,f?!c||n.isQuoted(f.name)||n.isRelative(f.name)||(l=f.getType().getScopedTypeName(a),s.push(new r(e,l,f))):(e=="true"||e=="false")&&s.push(new r(e,"bool",this.compiler.typeChecker.booleanType.symbol))}return s},t}(),n.ScopeTraversal=o}(TypeScript||(TypeScript={})),function(n){function f(n,t,i){var r=+new Date,u=i(),f=+new Date;return n.log(t+" completed in "+(f-r)+" msec"),u}function e(n,t){var r="",u=function(t){var i=n.charCodeAt(t);switch(i){case 9:r+="\\t";break;case 10:r+="\\n";break;case 11:r+="\\v";break;case 12:r+="\\f";break;case 13:r+="\\r";break;case 34:r+='\\"';break;case 39:r+="\\'";break;case 92:r+="\\";break;default:r+=n.charAt(t)}},e=n.length>t,f,i;if(e){for(f=t>>1,i=0;i<f;i++)u(i);for(r+="(...)",i=n.length-f;i<n.length;i++)u(i)}else for(t=n.length,i=0;i<t;i++)u(i);return r}var u,t,i,r;(function(n){function t(t){n.diagnosticWriter&&n.diagnosticWriter.Alert(t)}function i(i){n.debug&&t(i)}function r(i,r){n.debug&&(i||t(r))}n.debug=!1,n.diagnosticWriter=null,n.analysisPass=0,n.Alert=t,n.debugPrint=i,n.assert=r})(n.CompilerDiagnostics||(n.CompilerDiagnostics={})),u=n.CompilerDiagnostics,t=function(){function n(){}return n.prototype.information=function(){return!1},n.prototype.debug=function(){return!1},n.prototype.warning=function(){return!1},n.prototype.error=function(){return!1},n.prototype.fatal=function(){return!1},n.prototype.log=function(){},n}(),n.NullLogger=t,i=function(){function n(n){this.logger=n,this._information=this.logger.information(),this._debug=this.logger.debug(),this._warning=this.logger.warning(),this._error=this.logger.error(),this._fatal=this.logger.fatal()}return n.prototype.information=function(){return this._information},n.prototype.debug=function(){return this._debug},n.prototype.warning=function(){return this._warning},n.prototype.error=function(){return this._error},n.prototype.fatal=function(){return this._fatal},n.prototype.log=function(n){this.logger.log(n)},n}(),n.LoggerAdapter=i,r=function(){function n(){this.logContents=[]}return n.prototype.information=function(){return!1},n.prototype.debug=function(){return!1},n.prototype.warning=function(){return!1},n.prototype.error=function(){return!1},n.prototype.fatal=function(){return!1},n.prototype.log=function(n){this.logContents.push(n)},n}(),n.BufferedLogger=r,n.timeFunction=f,n.stringToLiteral=e}(TypeScript||(TypeScript={}));